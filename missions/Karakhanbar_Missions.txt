Z54_1_branching = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		NOT = { has_country_flag = Z54_hardliner_branch }
		NOT = { has_country_flag = Z54_moderate_branch }
	} 

	Z54_branching2 = {
		icon = mission_unknown_mission
		position = 3
		required_missions = { 
            Z54_branching1
        }
		trigger = {
			custom_trigger_tooltip = { 
                tooltip = karakhanbar_this_is_a_branching_mission_tt 
                always = no 
            }
		}
		effect = {
			custom_tooltip = karakhanbar_this_is_a_branching_mission_tt
		} 
	}

	Z54_branching4 = {
		icon = mission_unknown_mission
		position = 4
		required_missions = {
            Z54_branching2
            Z54_branching3
        } 

		trigger = {  
			custom_trigger_tooltip = { 
                tooltip = karakhanbar_this_is_a_branching_mission_tt 
                always = no 
            }
		}
		effect = {  
			custom_tooltip = karakhanbar_this_is_a_branching_mission_tt
		} 
	}
    
    Z54_spread_the_songs_B = {
        icon = league_of_the_public_weal
        position = 6
        required_missions = {
            Z54_orcish_soul_B
            Z54_branching4
        }
    
        trigger = {
            religious_unity = 0.90
            if = {
                limit = {
                    religion = bulgu_orazan
                }
                num_of_aspects = 2
            }
            else_if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                church_power = 100
            }
            else = {
                OR = {
                    advisor = inquisitor
                    advisor = theologian
                }
            
            }
        }
        effect = {
            if = {
                limit = {
                    religion = bulgu_orazan
                }
                custom_tooltip = karakhanbar_spread_the_songs_effect_bulgu_tt
                set_country_flag = songs_of_bron_haver
            }
            else_if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                custom_tooltip = karakhanbar_spread_the_songs_effect_dookanist_tt
                set_country_flag = bless_the_black_hearth_haver
            }
            else = {
                add_stability = 1
            }
        }
    }
}

Z54_2_branching = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		NOT = { has_country_flag = Z54_hardliner_branch }
		NOT = { has_country_flag = Z54_moderate_branch }
	} 

	Z54_branching1 = {
		icon = mission_unknown_mission
		position = 2
		required_missions = { 
            Z54_aftermath_of_the_emeraldtide
        }
		trigger = {
			custom_trigger_tooltip = { 
                tooltip = karakhanbar_this_is_a_branching_mission_tt 
                always = no 
            }
		}
		effect = {
			custom_tooltip = karakhanbar_this_is_a_branching_mission_tt
		} 
	}

	Z54_branching3 = {
		icon = mission_unknown_mission
		position = 3
		required_missions = {
            Z54_branching1
        } 

		trigger = {  
			custom_trigger_tooltip = { 
                tooltip = karakhanbar_this_is_a_branching_mission_tt 
                always = no 
            }
		}
		effect = {  
			custom_tooltip = karakhanbar_this_is_a_branching_mission_tt
		} 
	}

    Z54_fey_repellant_B = {
        icon = mission_hanged_tree
        position = 4
        required_missions = {
            Z54_our_cities_in_woods
            Z54_branching3
        }
        provinces_to_highlight = {
            owned_by = Z54
            NOT = {
                has_terrain = gladeway
                has_terrain = fey_gladeway
                has_terrain = cavern
            }
            NOT = {
                OR = {
                    has_influencing_fort = yes
                    any_neighbor_province = { has_influencing_fort = yes }
                }
            }
        }
        trigger = {
            national_focus = MIL
            estate_loyalty = {
                estate = estate_church
                loyalty = 60
            }
            if = {
                limit = {
                    has_estate = estate_mages
                }
                estate_loyalty = {
                    estate = estate_mages
                    loyalty = 50
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_fey_repellant_trigger_tt
                all_owned_province = {
                    if = {
                        limit = {
                            OR = {
                                province_group = deepwoods_mountain_grove
                                province_group = deepwoods_lake_grove
                                province_group = deepwoods_bone_grove
                                province_group = deepwoods_thorn_grove
                                province_group = deepwoods_hunter_grove
                                province_group = deepwoods_arrow_grove
                                province_group = deepwoods_flower_grove
                                province_group = deepwoods_river_grove
                                province_group = deepwoods_shadow_grove
                            }
                        }
                        OR = {
                            has_influencing_fort = yes
                            any_neighbor_province = { has_influencing_fort = yes }
                        }
                    }
                }
            }
            has_government_power = {
                mechanic_type = karakhanbar_flames_of_the_black_hearth_mechanic
                power_type = karakhanbar_flames_of_the_black_hearth_power
                value = 40
            }
        }
        effect = {
            add_prestige_or_monarch_power = { amount = 20 }
            custom_tooltip = karakhanbar_fey_repellant_effect_tt
            clr_country_flag = karakhanbar_common_fey_nuissance
            set_country_flag = karakhanbar_rare_fey_nuissance
        }
    }

    Z54_orcish_soul_B = {
        icon = league_of_the_public_weal
        position = 5
        required_missions = {
            Z54_fey_repellant_B
            Z54_branching4
        }
        provinces_to_highlight = { }
        trigger = {
            NOT = { current_age = age_of_discovery }
            OR = {
                AND = {
                    any_known_country = {
                        NOT = { has_matching_religion = ROOT }
                        has_opinion = {
                            who = ROOT
                            value = 50
                        }
                    }
                    if = {
                        limit = { has_estate = estate_burghers }
                        has_estate_privilege = estate_burghers_enforced_interfaith_dialogue
                    }
                }
                AND = {
                    any_known_country = {
                        NOT = { has_matching_religion = ROOT }
                        has_opinion_modifier = {
                            who = ROOT
                            modifier = scornfully_insulted
                        }
                    }
                    if = {
                        limit = { has_estate = estate_church }
                        has_estate_privilege = estate_church_one_faith_one_culture
                    }
                }
            }
        }
        effect = {
            if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                country_event = {
                    id = flavour_karakhanbar.17
                }
                custom_tooltip = karakhanbar_event_insight_17_tt
            }
            else_if = {
                limit = { religion = bulgu_orazan }
                country_event = {
                    id = flavour_karakhanbar.5
                }
                custom_tooltip = karakhanbar_event_insight_5_tt
            }
            else = {
                add_country_modifier = {
                    name = karakhanbar_shamans_controlled
                    duration = -1
                }
            }
        }
    }

}

Z54_1_hardliner = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
        has_country_flag = Z54_hardliner_branch
	} 

	Z54_root_out_their_influence = {
		icon = mission_burning_man
		position = 3
		required_missions = { 
            Z54_last_shards_of_emerald
        }
		trigger = {
            if = {
                limit = {
                    any_known_country = {
                        OR = {
                            culture = forest_goblin
                            culture = wood_elf
                        }
                        capital_scope = {
                            superregion = deepwoods_superregion
                        }
                    }
                }
                all_known_country = {
                    OR = {
                        culture = forest_goblin
                        culture = wood_elf
                    }
                    capital_scope = {
                        superregion = deepwoods_superregion
                    }
                    OR = {
                        has_opinion_modifier = {
                            who = ROOT
                            modifier = insulted
                        }
                        has_opinion_modifier = {
                            who = ROOT
                            modifier = scornfully_insulted
                        }
                    }
                }
            }
            if = {
                limit = {
                    any_owned_province = {
                        OR = {
                            culture = wood_elf
                            culture = forest_goblin
                        }
                        superregion = deepwoods_superregion
                    }
                }
                all_owned_province = {
                    OR = {
                        NOT = {
                            superregion = deepwoods_superregion
                            culture = wood_elf
                            culture = forest_goblin
                        }
                        OR = {
                            has_province_modifier = autonomy_decreased
                            NOT = { local_autonomy_above_min = 10 }
                        }
                    }
                }
            }
            else = {
                religious_unity = 0.9
                statesman = 2
            }
            OR = {
                has_country_modifier = racial_pop_elven_purge
                has_country_modifier = racial_pop_elven_expulsion
            }
            OR = {
                has_country_modifier = racial_pop_goblin_purge
                has_country_modifier = racial_pop_goblin_expulsion
            }
		}
		effect = {
            add_stability_or_adm_power = yes
            every_owned_province = {
                limit = { culture = green_orc }
                change_culture = karakhanbari_orc
            }
            for = {
                amount = 5
                effect = "random_owned_province = { limit = { culture = karakhanbari_orc NOT = { has_country_flag = karakhanbar_manpower_gained } } add_base_production = 1 set_province_flag = karakhanbar_manpower_gained }"
            }
            define_advisor = {
                type = artist
                cost_multiplier = 0.5
            }
		} 
	}

	Z54_bane_of_the_deepwoods = {
		icon = mission_burning_separation
		position = 4
		required_missions = {
            Z54_root_out_their_influence
            Z54_support_of_shamans
        } 

		trigger = {
            deepwoods_superregion = {
                type = all
                OR = {
                    culture = green_orc
                    culture = karakhanbari_orc
                }
            }
		}
		effect = {
            custom_tooltip = karakhanbar_branching_missions_end_effect_tt
            custom_tooltip = karakhanbar_bane_of_the_deepwoods_effect_tt
            set_country_flag = karakhanbar_hardliners_won
            clr_country_flag = karakhanbar_hardliners_vs_moderates
            add_country_modifier = {
                name = karakhanbar_bane_of_the_deepwoods
                duration = -1
            }
		} 
	}

    Z54_spread_the_songs_H = {
        icon = league_of_the_public_weal
        position = 6
        required_missions = {
            Z54_orcish_soul_H
            Z54_bane_of_the_deepwoods
        }
    
        trigger = {
            religious_unity = 0.90
            if = {
                limit = {
                    religion = bulgu_orazan
                }
                num_of_aspects = 2
            }
            else_if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                church_power = 100
            }
            else = {
                OR = {
                    advisor = inquisitor
                    advisor = theologian
                }
            
            }
        }
        effect = {
            if = {
                limit = {
                    religion = bulgu_orazan
                }
                custom_tooltip = karakhanbar_spread_the_songs_effect_bulgu_tt
                set_country_flag = songs_of_bron_haver
            }
            else_if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                custom_tooltip = karakhanbar_spread_the_songs_effect_dookanist_tt
                set_country_flag = bless_the_black_hearth_haver
            }
            else = {
                add_stability = 1
            }
        }
    }
}

Z54_2_hardliner = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		has_country_flag = Z54_hardliner_branch
	} 

	Z54_last_shards_of_emerald = {
		icon = mission_transmutation
		position = 2
		required_missions = { 
            Z54_aftermath_of_the_emeraldtide
        }
		trigger = {
            if = {
                limit = {
                    any_owned_province = {
                        culture = emerald_orc
                    }
                    all_owned_province = {
                        culture = emerald_orc
                        num_of_units_in_province = {
                            who = ROOT
                            amount = 2
                        }
                    }
                }
            }
            else_if = {
                limit = {
                    any_known_country = {
                        capital_scope = {
                            superregion = deepwoods_superregion
                        }
                        exists = yes
                    }
                }
                any_known_country = {
                    capital_scope = { 
                        superregion = deepwoods_superregion
                    }
                    NOT = { army_size = ROOT }
                }
            }
            mil_power = 50
		}
		effect = {
            add_mil_power = -50
            every_owned_province = {
                limit = { 
                    superregion = deepwoods_superregion 
                    num_of_units_in_province = {
                        who = ROOT
                        amount = 2
                    }
                }
                remove_core = I46
            }
            every_owned_province = {
                limit = { 
                    culture = emerald_orc 
                    num_of_units_in_province = {
                        who = ROOT
                        amount = 2
                    }
                }
                add_devastation = 15
                change_culture = karakhanbari_orc
            }
            add_country_modifier = {
                name = karakhanbar_anti_fey_sentiment
                duration = 18250
            }
		} 
	}

	Z54_support_of_shamans = {
		icon = mission_gain_mana
		position = 3
		required_missions = {
            Z54_last_shards_of_emerald
        } 

		trigger = {
            num_of_estate_agendas_completed = {
                estate = estate_church
                value = 2
            }
            num_of_estate_privileges = {
                estate = estate_church
                value = 3
            }
            has_estate_privilege = estate_church_for_the_faith
		}
		effect = {
            set_country_flag = karakhanbar_zealous_feyslayers
            set_estate_privilege = estate_church_karakhanbar_zealous_feyslayers
            define_general = {
                shock = 8
                fire = 2
                manuever = 4
                siege = 5
                trait = war_wizard_personality
            }
		} 
	}

    Z54_fey_repellant_H = {
        icon = mission_hanged_tree
        position = 4
        required_missions = {
            Z54_our_cities_in_woods
            Z54_support_of_shamans
        }
        provinces_to_highlight = {
            owned_by = Z54
            NOT = {
                OR = {
                    has_influencing_fort = yes
                    any_neighbor_province = { has_influencing_fort = yes }
                }
            }
        }
        trigger = {
            national_focus = MIL
            estate_loyalty = {
                estate = estate_church
                loyalty = 60
            }
            if = {
                limit = {
                    has_estate = estate_mages
                }
                estate_loyalty = {
                    estate = estate_mages
                    loyalty = 50
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_fey_repellant_trigger_tt
                all_owned_province = {
                    if = {
                        limit = {
                            OR = {
                                province_group = deepwoods_mountain_grove
                                province_group = deepwoods_lake_grove
                                province_group = deepwoods_bone_grove
                                province_group = deepwoods_thorn_grove
                                province_group = deepwoods_hunter_grove
                                province_group = deepwoods_arrow_grove
                                province_group = deepwoods_flower_grove
                                province_group = deepwoods_river_grove
                                province_group = deepwoods_shadow_grove
                            }
                        }
                        OR = {
                            has_influencing_fort = yes
                            any_neighbor_province = { has_influencing_fort = yes }
                        }
                    }
                }
            }
            has_government_power = {
                mechanic_type = karakhanbar_flames_of_the_black_hearth_mechanic
                power_type = karakhanbar_flames_of_the_black_hearth_power
                value = 40
            }
        }
        effect = {
            add_prestige_or_monarch_power = { amount = 20 }
            custom_tooltip = karakhanbar_fey_repellant_effect_tt
            clr_country_flag = karakhanbar_common_fey_nuissance
            set_country_flag = karakhanbar_rare_fey_nuissance
        }
    }

    Z54_orcish_soul_H = {
        icon = league_of_the_public_weal
        position = 5
        required_missions = {
            Z54_fey_repellant_H
            Z54_bane_of_the_deepwoods
        }
        provinces_to_highlight = { }
        trigger = {
            NOT = { current_age = age_of_discovery }
            OR = {
                AND = {
                    any_known_country = {
                        NOT = { has_matching_religion = ROOT }
                        has_opinion = {
                            who = ROOT
                            value = 50
                        }
                    }
                    if = {
                        limit = { has_estate = estate_burghers }
                        has_estate_privilege = estate_burghers_enforced_interfaith_dialogue
                    }
                }
                AND = {
                    any_known_country = {
                        NOT = { has_matching_religion = ROOT }
                        has_opinion_modifier = {
                            who = ROOT
                            modifier = scornfully_insulted
                        }
                    }
                    if = {
                        limit = { has_estate = estate_church }
                        has_estate_privilege = estate_church_one_faith_one_culture
                    }
                }
            }
        }
        effect = {
            if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                country_event = {
                    id = flavour_karakhanbar.17
                }
                custom_tooltip = karakhanbar_event_insight_17_tt
            }
            else_if = {
                limit = { religion = bulgu_orazan }
                country_event = {
                    id = flavour_karakhanbar.5
                }
                custom_tooltip = karakhanbar_event_insight_5_tt
            }
            else = {
                add_country_modifier = {
                    name = karakhanbar_shamans_controlled
                    duration = -1
                }
            }
        }
    }
}

Z54_1_moderate = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
        has_country_flag = Z54_moderate_branch
	} 

	Z54_elven_dissidents = {
		icon = mission_elf_smiling
		position = 3
		required_missions = { 
            Z54_different_but_not_lost
        }
		trigger = {
            OR = {
                medium_tolerance_elven_race_trigger = yes
                high_tolerance_elven_race_trigger = yes
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_demonsterize_tt
                OR = {
                    has_country_flag = removing_monstrous
                    NOT = { has_country_modifier = monstrous_nation }
                }
            }
            dip_power = 100
		}
		effect = {
            add_dip_power = -100
            if = {
                limit = { has_country_flag = removing_monstrous }
                custom_tooltip = decrease_monstrous_10_tooltip
			    hidden_effect = { subtract_variable = { monstrousPoints = 25 } }
            }
            else = {
                change_government_reform_progress = 50
            }
            set_country_flag = karakhanbar_elven_mercenaries
            custom_tooltip = karakhanbar_elven_dissidents_effect_mercenaries_tt
            custom_tooltip = karakhanbar_elven_dissidents_effect_elves_tt
            hidden_effect = {
                for = {
                    amount = 6
                    effect = "random_owned_province = { limit = { NOT = { has_terrain = gladeway has_terrain = fey_gladeway has_province_flag = karakhanbar_elves } } add_elven_minority_size_effect = yes set_province_flag = karakhanbar_elves }"
                }
            }
		} 
	}

	Z54_united_in_the_forest = {
		icon = mission_city_prosperity
		position = 4
		required_missions = {
            Z54_elven_dissidents
            Z54_kartels_of_deepwoods
        } 

		trigger = {
            accepted_culture = forest_goblin
            accepted_culture = wood_elf
            accepted_culture = emerald_orc
            high_tolerance_elven_race_trigger = yes
            high_tolerance_goblin_race_trigger = yes
		}
		effect = {
            custom_tooltip = karakhanbar_branching_missions_end_effect_tt
            set_country_flag = karakhanbar_moderates_won
            clr_country_flag = karakhanbar_hardliners_vs_moderates
            custom_tooltip = karakhanbar_united_in_the_forest_effect_tt
            add_country_modifier = {
                name = karakhanbar_knowledge_of_forest_dwellers
                duration = -1
            }
		} 
	}

    Z54_spread_the_songs_M = {
        icon = league_of_the_public_weal
        position = 6
        required_missions = {
            Z54_orcish_soul_M
            Z54_united_in_the_forest
        }
    
        trigger = {
            religious_unity = 0.90
            if = {
                limit = {
                    religion = bulgu_orazan
                }
                num_of_aspects = 2
            }
            else_if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                church_power = 100
            }
            else = {
                OR = {
                    advisor = inquisitor
                    advisor = theologian
                }
            
            }
        }
        effect = {
            if = {
                limit = {
                    religion = bulgu_orazan
                }
                custom_tooltip = karakhanbar_spread_the_songs_effect_bulgu_tt
                set_country_flag = songs_of_bron_haver
            }
            else_if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                custom_tooltip = karakhanbar_spread_the_songs_effect_dookanist_tt
                set_country_flag = bless_the_black_hearth_haver
            }
            else = {
                add_stability = 1
            }
        }
    }
}

Z54_2_moderate = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		has_country_flag = Z54_moderate_branch
	} 

	Z54_different_but_not_lost = {
		icon = mission_forest_shrine
		position = 2
		required_missions = { 
            Z54_aftermath_of_the_emeraldtide
        }
		trigger = {
            OR = {
                AND = {
                    num_of_estate_agendas_completed = {
                        estate = estate_mages
                        value = 1
                    }
                    estate_loyalty = {
                        estate = estate_mages
                        loyalty = 50
                    }
                    capital_scope = {
                        has_building = mage_tower
                    }
                }
                AND = {
                    num_of_estate_agendas_completed = {
                        estate = estate_church
                        value = 2
                    }
                    estate_loyalty = {
                        estate = estate_church
                        loyalty = 60
                    }
                    capital_scope = {
                        has_building = temple
                    }
                }
            }
		}
		effect = {
            every_owned_province = {
                limit = { superregion = deepwoods_superregion is_core = I46 }
                remove_core = I46
            }
            add_accepted_culture = emerald_orc
            every_owned_province = {
                limit = { culture = emerald_orc }
                add_province_modifier = {
                    name = karakhanbar_slaves_no_longer
                    duration = 18250
                }
            }
            capital_scope = {
                add_goblin_minority_size_effect = yes
                add_elven_minority_size_effect = yes
            }
            large_increase_of_goblin_tolerance_effect = yes
            large_increase_of_elven_tolerance_effect = yes
		} 
	}

	Z54_kartels_of_deepwoods = {
		icon = mission_globlin
		position = 3
		required_missions = {
            Z54_different_but_not_lost
        } 

		trigger = {
            OR = {
                medium_tolerance_goblin_race_trigger = yes
                high_tolerance_goblin_race_trigger = yes
            }
            if = {
                limit = { has_dlc = "Domination" }
                has_estate_privilege = estate_burghers_control_over_the_coinage
                treasury = 200
            }
            else = {
                treasury = 400
            }
        }
		effect = {
            if = {
                limit = { has_dlc = "Domination" }
                remove_estate_privilege = estate_burghers_control_over_the_coinage
                add_treasury = -200
            }
            else = {
                add_treasury = -400
            }
            set_estate_privilege = estate_burghers_karakhanbar_cooperation_with_goblin_cartels
            set_country_flag = karakhanbar_cartels
            custom_tooltip = karakhanbar_kartels_of_deepwoods_effect_tt
            hidden_effect = {
                for = {
                    amount = 9
                    effect = "random_owned_province = { limit = { NOT = { has_terrain = gladeway has_terrain = fey_gladeway has_province_flag = karakhanbar_goblins } } add_goblin_minority_size_effect = yes set_province_flag = karakhanbar_goblins }"
                }
            }
        } 
    }

    Z54_fey_repellant_M = {
        icon = mission_hanged_tree
        position = 4
        required_missions = {
            Z54_our_cities_in_woods
            Z54_kartels_of_deepwoods
        }
        provinces_to_highlight = {
            owned_by = Z54
            NOT = {
                OR = {
                    has_influencing_fort = yes
                    any_neighbor_province = { has_influencing_fort = yes }
                }
            }
        }
        trigger = {
            national_focus = MIL
            estate_loyalty = {
                estate = estate_church
                loyalty = 60
            }
            if = {
                limit = {
                    has_estate = estate_mages
                }
                estate_loyalty = {
                    estate = estate_mages
                    loyalty = 50
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_fey_repellant_trigger_tt
                all_owned_province = {
                    if = {
                        limit = {
                            OR = {
                                province_group = deepwoods_mountain_grove
                                province_group = deepwoods_lake_grove
                                province_group = deepwoods_bone_grove
                                province_group = deepwoods_thorn_grove
                                province_group = deepwoods_hunter_grove
                                province_group = deepwoods_arrow_grove
                                province_group = deepwoods_flower_grove
                                province_group = deepwoods_river_grove
                                province_group = deepwoods_shadow_grove
                            }
                        }
                        OR = {
                            has_influencing_fort = yes
                            any_neighbor_province = { has_influencing_fort = yes }
                        }
                    }
                }
            }
            has_government_power = {
                mechanic_type = karakhanbar_flames_of_the_black_hearth_mechanic
                power_type = karakhanbar_flames_of_the_black_hearth_power
                value = 40
            }
        }
        effect = {
            add_prestige_or_monarch_power = { amount = 20 }
            custom_tooltip = karakhanbar_fey_repellant_effect_tt
            clr_country_flag = karakhanbar_common_fey_nuissance
            set_country_flag = karakhanbar_rare_fey_nuissance
        }
    }

    Z54_orcish_soul_M = {
        icon = mission_magical_forest
        position = 5
        required_missions = {
            Z54_fey_repellant_M
            Z54_united_in_the_forest
        }
        provinces_to_highlight = { }
        trigger = {
            NOT = { current_age = age_of_discovery }
            OR = {
                AND = {
                    any_known_country = {
                        NOT = { has_matching_religion = ROOT }
                        has_opinion = {
                            who = ROOT
                            value = 50
                        }
                    }
                    if = {
                        limit = { has_estate = estate_burghers }
                        has_estate_privilege = estate_burghers_enforced_interfaith_dialogue
                    }
                }
                AND = {
                    any_known_country = {
                        NOT = { has_matching_religion = ROOT }
                        has_opinion_modifier = {
                            who = ROOT
                            modifier = scornfully_insulted
                        }
                    }
                    if = {
                        limit = { has_estate = estate_church }
                        has_estate_privilege = estate_church_one_faith_one_culture
                    }
                }
            }
        }
        effect = {
            if = {
                limit = {
                    OR = {
                        religion = old_dookan
                        religion = great_dookan
                    }
                }
                country_event = {
                    id = flavour_karakhanbar.17
                }
                custom_tooltip = karakhanbar_event_insight_17_tt
            }
            else_if = {
                limit = { religion = bulgu_orazan }
                country_event = {
                    id = flavour_karakhanbar.5
                }
                custom_tooltip = karakhanbar_event_insight_5_tt
            }
            else = {
                add_country_modifier = {
                    name = karakhanbar_shamans_controlled
                    duration = -1
                }
            }
        }
    }
}

Z54_1_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = Z54
	}

    Z54_better_solution = {
        icon = league_of_the_public_weal
        position = 7
        required_missions = {
            Z54_following_our_threats
        }
        provinces_to_highlight = {}
        trigger = {
            OR = {
                has_dip_advisor_2 = yes
                advisor = trader
            }
            calc_true_if = {
                amount = 3
                808 = { #Vernham
	                trade_share = {
		                country = ROOT
		                share = 25
	                }
                }
                880 = { #Esswyck
                    trade_share = {
                        country = ROOT
                        share = 25
                    }
                }
                4100 = { #Serpentreach
                    trade_share = {
                        country = ROOT
                        share = 25
                    }
                }
                1303 = { #Dostanesck
                    trade_share = {
                        country = ROOT
                        share = 25
                    }
                }
                671 = { #Seionquan
                    trade_share = {
                        country = ROOT
                        share = 25
                    }
                }
                1312 = { #Bahar
                    trade_share = {
                        country = ROOT
                        share = 25
                    }
                }
            }
        }
        effect = {
            custom_tooltip = karakhanbar_better_solution_effect_trade_power_tt
            tooltip = {
                add_trade_modifier = {
                    who = ROOT
                    duration = 9125
                    power = 50
                    key = KARAKHANBAR_ORCISH_NEGOTIATORS
                }
            }
            if = {
                limit = {
                    808 = { #Vernham
                        trade_share = {
                            country = ROOT
                            share = 25
                        }
                    }
                    880 = { #Esswyck
                        trade_share = {
                            country = ROOT
                            share = 25
                        }
                    }
                    4100 = { #Serpentreach
                        trade_share = {
                            country = ROOT
                            share = 25
                        }
                    }
                    1303 = { #Dostanesck
                        trade_share = {
                            country = ROOT
                            share = 25
                        }
                    }
                    671 = { #Seionquan
                        trade_share = {
                            country = ROOT
                            share = 25
                        }
                    }
                    1312 = { #Bahar
                        trade_share = {
                            country = ROOT
                            share = 25
                        }
                    }
                }
                custom_tooltip = karakhanbar_better_solution_effect_trade_power_yes_tt
                hidden_effect = {
                    808 = {
                        add_trade_modifier = {
                            who = ROOT
                            duration = -1
                            power = 50
                            key = KARAKHANBAR_ORCISH_NEGOTIATORS
                        }
                    }
                    880 = {
                        add_trade_modifier = {
                            who = ROOT
                            duration = -1
                            power = 50
                            key = KARAKHANBAR_ORCISH_NEGOTIATORS
                        }
                    }
                    4100 = {
                        add_trade_modifier = {
                            who = ROOT
                            duration = -1
                            power = 50
                            key = KARAKHANBAR_ORCISH_NEGOTIATORS
                        }
                    }
                    1303 = {
                        add_trade_modifier = {
                            who = ROOT
                            duration = -1
                            power = 50
                            key = KARAKHANBAR_ORCISH_NEGOTIATORS
                        }
                    }
                    671 = {
                        add_trade_modifier = {
                            who = ROOT
                            duration = -1
                            power = 50
                            key = KARAKHANBAR_ORCISH_NEGOTIATORS
                        }
                    }
                    1312 = {
                        add_trade_modifier = {
                            who = ROOT
                            duration = -1
                            power = 50
                            key = KARAKHANBAR_ORCISH_NEGOTIATORS
                        }
                    }
                }
            }
            else = {
                custom_tooltip = karakhanbar_better_solution_effect_trade_power_no_tt
                hidden_effect = {
                    if = {
                        limit = {
                            808 = { #Vernham
                                trade_share = {
                                    country = ROOT
                                    share = 25
                                }
                            }
                        }
                        808 = {
                            add_trade_modifier = {
                                who = ROOT
                                duration = 9125
                                power = 50
                                key = KARAKHANBAR_ORCISH_NEGOTIATORS
                            }
                        }
                    }
                    if = {
                        limit = {
                            880 = { #Esswyck
                                trade_share = {
                                    country = ROOT
                                    share = 25
                                }
                            }
                        }
                        880 = {
                            add_trade_modifier = {
                                who = ROOT
                                duration = 9125
                                power = 50
                                key = KARAKHANBAR_ORCISH_NEGOTIATORS
                            }
                        }
                    }
                    if = {
                        limit = {
                            4100 = { #Serpentreach
                                trade_share = {
                                    country = ROOT
                                    share = 25
                                }
                            }
                        }
                        4100 = {
                            add_trade_modifier = {
                                who = ROOT
                                duration = 9125
                                power = 50
                                key = KARAKHANBAR_ORCISH_NEGOTIATORS
                            }
                        }
                    }
                    if = {
                        limit = {
                            1303 = { #Dostanesck
                                trade_share = {
                                    country = ROOT
                                    share = 25
                                }
                            }
                        }
                        1303 = {
                            add_trade_modifier = {
                                who = ROOT
                                duration = 9125
                                power = 50
                                key = KARAKHANBAR_ORCISH_NEGOTIATORS
                            }
                        }
                    }
                    if = {
                        limit = {
                            671 = { #Seionquan
                                trade_share = {
                                    country = ROOT
                                    share = 25
                                }
                            }
                        }
                        671 = {
                            add_trade_modifier = {
                                who = ROOT
                                duration = 9125
                                power = 50
                                key = KARAKHANBAR_ORCISH_NEGOTIATORS
                            }
                        }
                    }
                    if = {
                        limit = {
                            1312 = { #Bahar
                                trade_share = {
                                    country = ROOT
                                    share = 25
                                }
                            }
                        }
                        1312 = {
                            add_trade_modifier = {
                                who = ROOT
                                duration = 9125
                                power = 50
                                key = KARAKHANBAR_ORCISH_NEGOTIATORS
                            }
                        }
                    }
                }
            }
            custom_tooltip = karakhanbar_better_solution_effect_trade_policy_tt
            set_country_flag = can_always_use_improve_inland_routes
        }
    }

    Z54_a_weapon_as_good_as_any = {
        icon = mission_assassination
        position = 8
        required_missions = {
            Z54_better_solution
            Z54_acessing_the_sea
        }
        provinces_to_highlight = {
            province_id = 451
        }
        trigger = {
            451 = { 
                owned_by = ROOT
                province_has_center_of_trade_of_level = 3
            }
            mercantilism = 25
            OR = {
                national_focus = DIP
                dip_power = 200
                full_idea_group = spy_ideas
                dip = 4
            }
        }
        effect = {
            if = {
                limit = {
                    NOT = {
                        OR = {
                            national_focus = DIP
                            full_idea_group = spy_ideas
                            dip = 4
                        }
                    }
                }
                add_dip_power = -200
            }
            custom_tooltip = karakhanbar_a_weapon_as_good_as_any_effect_tt
            tooltip = {
                add_country_modifier = {
                    name = karakhanbar_experienced_extortionists
                    duration = -1
                }
            }
            hidden_effect = {
                remove_country_modifier = karakhanbar_cutthroat_politics
                add_country_modifier = {
                    name = karakhanbar_experienced_extortionists
                    duration = -1
                }
            }
            country_event = {
                id = flavour_karakhanbar.8
            }
            custom_tooltip = karakhanbar_event_insight_8_tt
        }
    }

    Z54_a_modern_orcish_state = {
        icon = mission_vedic_education
        position = 10
        required_missions = {
            Z54_history_of_ashentree
        }
        trigger = {
            university = 10
            capital_scope = {
                has_building = state_house
            }
            num_of_owned_provinces_with = {
                value = 25
                has_courthouse_building_trigger = yes
            }
            absolutism = 50
            calc_true_if = {
                any_known_country = {
                    culture_group = orcish
                    NOT = { total_development = ROOT }
                }
                any_known_country = {
                    culture_group = orcish
                    NOT = { tech_difference = 1 }
                }
                any_known_country = {
                    culture_group = orcish
                    NOT = { army_size = ROOT }
                }
                amount = 2
            }         
        }
        effect = {
            custom_tooltip = karakhanbar_a_modern_orcish_state_effect_tt
            set_country_flag = karakhanbar_not_losing_development_chance
            set_country_flag = no_more_comet_sighted_event
        }
    }

    Z54_hegemonic_ambitions = {
        icon = league_of_the_public_weal
        position = 11
        required_missions = {
            Z54_a_modern_orcish_state
            Z54_seek_power
        }
        provinces_to_highlight = {
        }
        trigger = {
            custom_trigger_tooltip = {
                tooltip = karakhanbar_hegemonic_ambitions_trigger_western_cannor_tt
                any_known_country = { 
                    capital_scope = { 
                        OR = {
                            region = lencenor_region
                            region = small_country_region
                            region = dragon_coast_region
                        }
                    } 
                    NOT = {
                        any_known_country = { 
                            capital_scope = { 
                                OR = {
                                    region = lencenor_region
                                    region = small_country_region
                                    region = dragon_coast_region
                                } 
                            }
                            total_development = PREV
                        }  
                    }
                    ROOT = {
                        has_won_war_against = {
                            who = PREV
                            max_years_since = 50
                        }
                    }
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_hegemonic_ambitions_trigger_central_cannor_tt
                any_known_country = { 
                    capital_scope = { 
                        OR = {
                            region = west_dameshead_region
                            region = damescrown_region
                            region = esmaria_region
                            region = east_dameshead_region
                            region = businor_region
                            region = the_borders_region
                        }
                    } 
                    NOT = {
                        any_known_country = { 
                            capital_scope = { 
                                OR = {
                                    region = west_dameshead_region
                                    region = damescrown_region
                                    region = esmaria_region
                                    region = east_dameshead_region
                                    region = businor_region
                                    region = the_borders_region
                                } 
                            }
                            total_development = PREV
                        }  
                    }
                    ROOT = {
                        has_won_war_against = {
                            who = PREV
                            max_years_since = 50
                        }
                    }
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_hegemonic_ambitions_trigger_northern_cannor_tt
                any_known_country = { 
                    capital_scope = { 
                        OR = {
                            region = alenic_frontier_region
                            region = dalr_region
                            region = gerudian_frontier_region
                            region = olavlund_region
                            region = alenic_reach_region
                        }
                    } 
                    NOT = {
                        any_known_country = { 
                            capital_scope = { 
                                OR = {
                                    region = alenic_frontier_region
                                    region = dalr_region
                                    region = gerudian_frontier_region
                                    region = olavlund_region
                                    region = alenic_reach_region
                                } 
                            }
                            total_development = PREV
                        }  
                    }
                    ROOT = {
                        has_won_war_against = {
                            who = PREV
                            max_years_since = 50
                        }
                    }
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_hegemonic_ambitions_trigger_escann_tt
                any_known_country = { 
                    capital_scope = { 
                        OR = {
                            region = inner_castanor_region
                            region = south_castanor_region
                            region = west_castanor_region
                            region = forlorn_vale_region
                        }
                    } 
                    NOT = {
                        any_known_country = { 
                            capital_scope = { 
                                OR = {
                                    region = inner_castanor_region
                                    region = south_castanor_region
                                    region = west_castanor_region
                                    region = forlorn_vale_region
                                } 
                            }
                            total_development = PREV
                        }  
                    }
                    ROOT = {
                        has_won_war_against = {
                            who = PREV
                            max_years_since = 50
                        }
                    }
                }
            }
        }
        effect = {
            custom_tooltip = karakhanbar_hegemonic_ambitions_effect_tt
            set_country_flag = karakhanbar_enable_military_hegemon
            tooltip = {
                add_country_modifier = {
                    name = karakhanbar_hegemonic_demands
                    duration = -1
                }
            }
            hidden_effect = {
                remove_country_modifier = karakhanbar_experienced_extortionists
                add_country_modifier = {
                    name = karakhanbar_hegemonic_demands
                    duration = -1
                }
            }
        }
    }
}

Z54_2_1 = {
    slot = 2
    generic = no
    ai = yes
    has_country_shield = yes
    potential = {
        tag = Z54
   }

    Z54_following_our_threats = {
        icon = mission_cannons_firing
        position = 6
        required_missions = {
            Z54_might_makes_right
        }

        trigger = {
            monthly_mil = 12
            any_war_enemy_country = {
                num_of_owned_provinces_with = {
                    value = 20
                    OR = {
                        has_province_modifier = scorched_earth
                        devastation = 50
                    }
                }
            }
        }
        effect = {
            add_country_modifier = {
                name = karakhanbar_cutthroat_politics
                duration = -1
            }
        }
    }

    Z54_acessing_the_sea = {
        icon = mission_fleet_arrival
        position = 7
        required_missions = {
            Z54_following_our_threats
        }
        provinces_to_highlight = {
            OR = {
                region = ourdia_region
                region = daravans_folly_region
            }
            has_port = yes
            NOT = { owned_by = ROOT }
        }
        trigger = {
            num_of_owned_provinces_with = {
                value = 8
                OR = {
                    region = ourdia_region
                    region = daravans_folly_region
                }
                has_port = yes
            }
            any_owned_province = {
                development = 25
                OR = {
                    region = ourdia_region
                    region = daravans_folly_region
                }
                has_port = yes
                has_dock_building_trigger = yes
                has_shipyard_building_trigger = yes
                province_has_current_tech_fort_trigger = yes
            }
        }
        effect = {
            if = {
                limit = {
                    has_country_flag = karakhanbar_naval_idea_reward_flag
                }
                add_country_modifier = {
                    name = karakhanbar_naval_enthusiasm
                    duration = -1
                }
            }
            else = {
                add_country_modifier = {
                    name = karakhanbar_naval_enthusiasm
                    duration = 9125
                }
            }
            custom_tooltip = karakhanbar_acessing_the_sea_effect_tt
            tooltip = {
                add_province_modifier = {
                    name = karakhanbar_headquarters_of_the_burning_navy
                    duration = -1
                }
            }
            hidden_effect = {
                select_highest_dev_province_with_limit = { 
                    limit = "OR = { region = ourdia_region region = daravans_folly_region } has_port = yes has_dock_building_trigger = yes has_shipyard_building_trigger = yes province_has_current_tech_fort_trigger = yes" 
                    effect = "add_province_modifier = { name = karakhanbar_headquarters_of_the_burning_navy duration = -1 }"
                }
            }
        }
    }

    Z54_history_of_ashentree = {
        icon = mission_dark_book
        position = 9
        required_missions = {
            Z54_a_weapon_as_good_as_any
            Z54_acessing_the_sea
        }
        provinces_to_highlight = {
            province_id = 8
        }
        trigger = {
            8 = {
                controlled_by = ROOT
                is_looted = yes
                devastation = 25
            }
        }
        effect = {
            define_advisor = {
                type = philosopher
                skill = 3
                culture = 8
                religion = 8
                cost_multiplier = 0.5
            }
            clr_country_flag = karakhanbar_rare_fey_nuissance
            custom_tooltip = karakhanbar_history_of_ashentree_effect_tt
            country_event = {
                id = flavour_karakhanbar.9
                days = 7
            }
            custom_tooltip = karakhanbar_event_insight_9_tt
        }
    }
}

Z54_3_1 = {
    slot = 3
    generic = no
    ai = yes
    has_country_shield = yes
    potential = {
        tag = Z54
    }

    Z54_aftermath_of_the_emeraldtide = {
        icon = mission_alone_in_the_forest
        position = 1
        provinces_to_highlight = { 
		    controlled_by = REB
	    }
        trigger = {
       		if = {
			    limit = { NOT = { was_tag = I41 } }
			    custom_trigger_tooltip = {
                    tooltip = karakhanbar_aftermath_of_the_emeraldtide_trigger_tt
                    has_country_flag = green_orc_war_of_the_black_trees_won
            	}
		    }
		    NOT = { num_of_rebel_controlled_provinces = 1 }
		    NOT = { war_exhaustion = 1 }
		    manpower_percentage = 0.4
        	is_at_war = no
        }
        effect = {
            deepwoods_superregion = {
                limit = { NOT = { owned_by = ROOT } }
                add_permanent_claim = ROOT
            }
            hidden_effect = {
                6258 = {
                    add_permanent_claim = ROOT
                }
            }
            country_event = { 
                id = flavour_karakhanbar.1
            }
            custom_tooltip = karakhanbar_event_insight_1_tt
        }
    }

    Z54_strike_the_heart_of_fey = {
        icon = the_fountain_of_youth
        position = 2
        required_missions = {
            Z54_aftermath_of_the_emeraldtide
        }
        provinces_to_highlight = { 
            province_id = 6258
            province_id = 3058
            province_id = 3053
            province_id = 3052
        }
        trigger = {
            if = {
                limit = {
                    owns_core_province = 6258
                }
                6258 = {
                    num_of_units_in_province = {
                        who = ROOT
                        amount = 10
                    }
                    unit_has_leader = yes
                }
            }
            else = {
                mil_power = 50
                owns_core_province = 3053
                owns_core_province = 3052
                owns_core_province = 3058
                custom_trigger_tooltip = {
		            tooltip = karakhanbar_strike_the_heart_of_fey_trigger_tt
		            OR = {
                        3053 = {
                            num_of_units_in_province = {
                                who = ROOT
                                amount = 10
                            }
                            unit_has_leader = yes
                        }
                        3052 = {
                            num_of_units_in_province = {
                                who = ROOT
                                amount = 10
                            }
                            unit_has_leader = yes
                        }
                        3058 = {
                            num_of_units_in_province = {
                                who = ROOT
                                amount = 10
                            }
                            unit_has_leader = yes
                        }
                    }
		        }
            }
        }
        effect = {
            add_country_modifier = {
                name = karakhanbar_barks_weaken_magic_fades
                duration = 9125
            }
            country_event = {
                id = flavour_karakhanbar.2
                days = 50
                random = 20
            }
            custom_tooltip = karakhanbar_event_insight_2_tt
        }
    }

    Z54_our_cities_in_woods = {
        icon = mission_ne_palisades
        position = 3
        required_missions = { 
            Z54_strike_the_heart_of_fey
        }
        provinces_to_highlight = {
            OR = {
                AND = {
                    owned_by = ROOT
                    OR = {
                        has_production_building_trigger = no
                        NOT = { has_building = temple }
                        NOT = { has_building = workshop }
                    }
                }
		        province_id = 3023
            }
        }
        trigger = {
            num_of_owned_provinces_with = {
                value = 10
                has_production_building_trigger = yes
            }
            num_of_owned_provinces_with = {
                value = 10
                has_tax_building_trigger = yes
            }
            num_of_owned_provinces_with = {
                value = 10
                has_manpower_building_trigger = yes
            }
		    mercantilism = 15
            trading_policy_in_node = {
                node = 3023 # Deepwoods node
                policy = improve_inland_routes
            }
        }
        effect = {
            custom_tooltip = karakhanbar_our_cities_in_woods_effect_tt
            if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 10
                        has_production_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_20_production_building_tt
                for = {
                    amount = 4
                    effect = "random_owned_province = { limit = { has_production_building_trigger = yes NOT = { has_province_flag = karakhanbar_production_building } } add_or_upgrade_production_building = yes set_province_flag = karakhanbar_production_building }"
                }
            }
            else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 15
                        has_production_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_15_production_building_tt
                for = {
                    amount = 3
                    effect = "random_owned_province = { limit = { has_production_building_trigger = yes NOT = { has_province_flag = karakhanbar_production_building } } add_or_upgrade_production_building = yes set_province_flag = karakhanbar_production_building }"
                }
            }
		    else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 10
                        has_production_building_trigger = yes
                    }
                }
			    custom_tooltip = karakhanbar_our_cities_in_woods_effect_10_production_building_tt
		        for = {
                    amount = 2
                    effect = "random_owned_province = { limit = { has_production_building_trigger = yes NOT = { has_province_flag = karakhanbar_production_building } } add_or_upgrade_production_building = yes set_province_flag = karakhanbar_production_building }"
                }
            }
            else = {
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_no_production_building_tt
            }
            if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 20
                        has_tax_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_20_tax_building_tt
                for = {
                    amount = 4
                    effect = "random_owned_province = { limit = { has_tax_building_trigger = yes NOT = { has_province_flag = karakhanbar_tax_building } } add_or_upgrade_tax_building = yes set_province_flag = karakhanbar_tax_building }"
                }
            }
            else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 15
                        has_tax_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_15_tax_building_tt
                for = {
                    amount = 3
                    effect = "random_owned_province = { limit = { has_tax_building_trigger = yes NOT = { has_province_flag = karakhanbar_tax_building } } add_or_upgrade_tax_building = yes set_province_flag = karakhanbar_tax_building }"
                }
            }
            else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 10
                        has_tax_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_10_tax_building_tt
                for = {
                    amount = 2
                    effect = "random_owned_province = { limit = { has_tax_building_trigger = yes NOT = { has_province_flag = karakhanbar_tax_building } } add_or_upgrade_tax_building = yes set_province_flag = karakhanbar_tax_building }"
                }
            }
            else = {
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_no_tax_building_tt
            }
            if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 20
                        has_manpower_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_20_manpower_building_tt
                for = {
                    amount = 4
                    effect = "random_owned_province = { limit = { has_manpower_building_trigger = yes NOT = { has_province_flag = karakhanbar_manpower_building } } add_or_upgrade_manpower_building = yes set_province_flag = karakhanbar_manpower_building }"
                }
            }
            else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 15
                        has_manpower_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_15_manpower_building_tt
                for = {
                    amount = 3
                    effect = "random_owned_province = { limit = { has_manpower_building_trigger = yes NOT = { has_province_flag = karakhanbar_manpower_building } } add_or_upgrade_manpower_building = yes set_province_flag = karakhanbar_manpower_building }"
                }
            }
            else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 10
                        has_manpower_building_trigger = yes
                    }
                }
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_10_manpower_building_tt
                for = {
                    amount = 2
                    effect = "random_owned_province = { limit = { has_manpower_building_trigger = yes NOT = { has_province_flag = karakhanbar_manpower_building } } add_or_upgrade_manpower_building = yes set_province_flag = karakhanbar_manpower_building }"
                }
            }
            else = {
                custom_tooltip = karakhanbar_our_cities_in_woods_effect_no_manpower_building_tt
            }
        }
    }
    
    Z54_rattle_the_blades = {
        icon = mission_alliances
        position = 4
        required_missions = {
            Z54_our_cities_in_woods
            Z54_secure_entrances
        }
        provinces_to_highlight = {
            province_id = 3054
            province_id = 3068
            province_id = 7029
            province_id = 3048
            province_id = 3071
            province_id = 3065
            province_id = 3064
            province_id = 3070
            province_id = 3069
        }
        trigger = {
            custom_trigger_tooltip = {
                tooltip = karakhanbar_demonsterize_tt
                OR = {
                    has_country_flag = removing_monstrous
                    NOT = { has_country_modifier = monstrous_nation }
                }
            }
            has_dip_advisor_3 = yes
            custom_trigger_tooltip = {
                tooltip = karakhanbar_rattle_the_blades_trigger_tt
                OR = {
                    3054 = {
                        infantry_in_province = 2
                    }
                    3068 = {
                        infantry_in_province = 2
                    }
                    7029 = {
                        infantry_in_province = 2
                    }
                    3048 = {
                        infantry_in_province = 2
                    }
                    3071 = {
                        infantry_in_province = 2
                    }
                    3065 = {
                        infantry_in_province = 2
                    }
                    3064 = {
                        infantry_in_province = 2
                    }
                    3070 = {
                        infantry_in_province = 2
                    }
                    3069 = {
                        infantry_in_province = 2
                    }
                }
            }
        }
        effect = {
            if = {
                limit = { NOT = { dip = 6 } }
                change_dip = 1
            }
            else = {
                add_dip_power = 100
            }
            if = {
                limit = { 
                    3048 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_daravans_folly_tt
                hidden_effect = {
                    3048 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    daravans_folly_region = {
                        discover_country = ROOT
                    }
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_daravans_folly_tt
            }
            if = {
                limit = { 
                    7029 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_dostanor_tt
                hidden_effect = {
                    7029 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    dostanor_region = {
                        discover_country = ROOT
                    }
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_dostanor_tt
            }
            if = {
                limit = { 
                    3071 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_ourdia_tt
                hidden_effect = {
                    3071 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    ourdia_region = {
                        discover_country = ROOT
                    }
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_ourdia_tt
            }
            if = {
                limit = { 
                    3065 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_serpentreach_tt
                hidden_effect = {
                    3065 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    serpentreach_region = {
                        discover_country = ROOT
                    }
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_serpentreach_tt
            }
            if = {
                limit = { 
                    3064 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_harpy_hills_tt
                hidden_effect = {
                    3064 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    harpy_hills_region = {
                        discover_country = ROOT
                    }
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_harpy_hills_tt
            }
            if = {
                limit = { 
                    3070 = { infantry_in_province = 2 }
                    3069 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_west_dwarovar_tt
                hidden_effect = {
                    3070 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    3069 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    west_dwarovar_region = {
                        discover_country = ROOT
                    }     
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_west_dwarovar_tt
            }
            if = {
                limit = { 
                    3054 = { infantry_in_province = 2 }
                    3068 = { infantry_in_province = 2 }
                }
                custom_tooltip = karakhanbar_rattle_the_blades_effect_yes_castanor_tt
                hidden_effect = {
                    3054 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    3068 = {
                        kill_units = {
                            who = ROOT
                            amount = 2
                        }
                    }
                    south_castanor_region = {
                        discover_country = ROOT
                    }
                    inner_castanor_region = {
                        discover_country = ROOT
                    }
                    west_castanor_region = {
                        discover_country = ROOT
                    }     
                }
            }
            else = {
                custom_tooltip = karakhanbar_rattle_the_blades_effect_no_castanor_tt
            }
            hidden_effect = {
                country_event = {
                    id = flavour_karakhanbar.4
                    days = 350
                    random = 30
                }
            }
        }
    }

    Z54_might_makes_right = {
        icon = mission_destroyed_city
        position = 5
        required_missions = { 
            Z54_rattle_the_blades
        }
        trigger = {
            num_of_regiments_at_full_drill = 30
            num_of_generals_with_traits = 1
            custom_trigger_tooltip = {
                tooltip = karakhanbar_might_makes_right_trigger_tt
                OR = {
                    full_idea_group = aristocracy_ideas
                    full_idea_group = plutocracy_ideas
                    full_idea_group = horde_gov_ideas
                    full_idea_group = theocracy_gov_ideas
                    full_idea_group = indigenous_ideas
                    full_idea_group = offensive_ideas
                    full_idea_group = defensive_ideas
                    full_idea_group = quality_ideas
                    full_idea_group = quantity_ideas
                    full_idea_group = naval_ideas
                    full_idea_group = mercenary_ideas
                }
            }
        }
        effect = {
            custom_tooltip = karakhanbar_might_makes_right_effect_scorch_earth_tt
            set_country_flag = karakhanbar_powerful_scorch_earth
            if = {
                limit = { 
                    OR = {
                        full_idea_group = quality_ideas
                        full_idea_group = offensive_ideas
                    }
                }
                custom_tooltip = karakhanbar_might_makes_right_effect_superior_firepower_yes_tt
                add_country_modifier = {
                    name = karakhanbar_superior_firepower
                    duration = 18250
                }
            }
            else = {
                custom_tooltip = karakhanbar_might_makes_right_effect_superior_firepower_no_tt
            }
            if = { 
                limit = { 
                    OR = {
                        full_idea_group = defensive_ideas
                        full_idea_group = quantity_ideas
                    }
                }
                custom_tooltip = karakhanbar_might_makes_right_effect_defence_in_depths_of_forest_yes_tt
                add_country_modifier = {
                    name = karakhanbar_defence_in_depths_of_forest
                    duration = 18250
                }
            }
            else = {
                custom_tooltip = karakhanbar_might_makes_right_effect_defence_in_depths_of_forest_no_tt
            }
            if = { 
                limit = { 
                    OR = {
                        full_idea_group = aristocracy_ideas
                        full_idea_group = plutocracy_ideas
                        full_idea_group = horde_gov_ideas
                        full_idea_group = theocracy_gov_ideas
                        full_idea_group = indigenous_ideas
                    }
                }
                custom_tooltip = karakhanbar_might_makes_right_effect_governmental_ideas_yes_tt
                add_stability_or_adm_power = yes
                add_legitimacy_equivalent = { amount = 20 republican_tradition = 10 }
                if = {
                    limit = { adm = 6 }
                    add_adm_power = 100
                }
                else = {
                    change_adm = 1
                }
                if = {
                    limit = { dip = 6 }
                    add_dip_power = 100
                }
                else = {
                    change_dip = 1
                }
                if = {
                    limit = { mil = 6 }
                    add_mil_power = 100
                }
                else = {
                    change_mil = 1
                }
            }
            else = {
                custom_tooltip = karakhanbar_might_makes_right_effect_governmental_ideas_no_tt
            }
            if = { 
                limit = { full_idea_group = naval_ideas }
                custom_tooltip = karakhanbar_might_makes_right_effect_permanent_naval_enthusiasm_yes_tt
                set_country_flag = karakhanbar_naval_idea_reward_flag
            }
            else = {
                custom_tooltip = karakhanbar_might_makes_right_effect_permanent_naval_enthusiasm_no_tt
            }
            if = { 
                limit = { full_idea_group = mercenary_ideas }
                custom_tooltip = karakhanbar_might_makes_right_effect_karakhanbari_grenadiers_yes_tt
                set_country_flag = karakhanbar_might_makes_right_effect_mercenary_idea_reward_flag
            }
            else = {
                custom_tooltip = karakhanbar_might_makes_right_effect_karakhanbari_grenadiers_no_tt
            }
        }
    }

    Z54_a_new_escann = {
        icon = mission_forest_pilgrim
        position = 7
        required_missions = { 
            Z54_following_our_threats
            Z54_might_makes_right
            Z54_engineer_corps
        }
        trigger = {
            if ={
                limit = {
                    any_known_country = {
                        culture_group = orcish
                        capital_scope = {
                            OR = {
                                region = south_castanor_region
                                region = inner_castanor_region
                                region = west_castanor_region
                            }
                        }
                    }
                }
                OR = {
                    all_known_country = {
                        culture_group = orcish
                        capital_scope = {
                            OR = {
                                region = south_castanor_region
                                region = inner_castanor_region
                                region = west_castanor_region
                            }
                        }
                        has_opinion = {
                            who = ROOT
                            value = 100
                        }
                    }
                    all_known_country = {
                        culture_group = orcish
                        capital_scope = {
                            OR = {
                                region = south_castanor_region
                                region = inner_castanor_region
                                region = west_castanor_region
                            }
                        }
                        OR = {
                            has_opinion_modifier = {
                                who = ROOT
                                modifier = insulted
                            }
                            has_opinion_modifier = {
                                who = ROOT
                                modifier = scornfully_insulted
                            }
                        }
                    }
                }
            }
            hornwood_area = {
                type = all
                NOT = {
                    owner = {
                        army_size = ROOT
                    }
                }
            }
            banesfork_area = {
                type = all
                NOT = {
                    owner = {
                        army_size = ROOT
                    }
                }
            }
        }
        effect = {
            hornwood_area = {
                add_permanent_claim = ROOT
            }
            banesfork_area = {
                add_permanent_claim = ROOT
            }
            if ={
                limit = {
                    NOT = { 
                        any_known_country = {
                            culture_group = orcish
                            capital_scope = {
                                OR = {
                                    region = south_castanor_region
                                    region = inner_castanor_region
                                    region = west_castanor_region
                                }
                            }
                        }
                    }
                }
                define_advisor = {
                    type = diplomat
                    cost_multiplier = 0.5
                }
            }
            else_if = {
                limit = {
                    all_known_country = {
                        culture_group = orcish
                        capital_scope = {
                            OR = {
                                region = south_castanor_region
                                region = inner_castanor_region
                                region = west_castanor_region
                            }
                        }
                        has_opinion = {
                            who = ROOT
                            value = 100
                        }
                    }
                }
                define_advisor = {
                    type = diplomat
                    cost_multiplier = 0.25
                }
            }
            else = {
                define_advisor = {
                    type = diplomat
                    cost_multiplier = 0.75
                }
            }
        }
    }

    Z54_gain_foothold_in_escann = {
        icon = mission_heated_battle
        position = 8
        required_missions = { 
            Z54_a_new_escann
        }
        provinces_to_highlight = {}
        trigger = {
            owns_all_provinces = {
                OR = {
                    area = hornwood_area
                    area = banesfork_area
                }
            }
            hornwood_area = {
                type = all
                has_manpower_building_trigger = yes
            }
            hornwood_area = {
                has_supply_depot = ROOT
            }
            banesfork_area = {
                type = all
                has_manpower_building_trigger = yes
            }
            banesfork_area = {
                has_supply_depot = ROOT
            }
            any_known_country = {
                capital_scope = {
                    OR = {
                        region = inner_castanor_region
                        region = west_castanor_region
                        region = south_castanor_region
                    }
                }
                NOT = { army_size = ROOT }
            }
        }
        effect = {
            south_castanor_region = {
                add_permanent_claim = ROOT
            }
            create_general = { 
                tradition = 60
                add_fire = 2
                add_siege = 1
            }
        }
    }

    Z54_vanguard_victorious = {
        icon = mission_burning_castle
        position = 9
        required_missions = { 
            Z54_gain_foothold_in_escann
        }
        provinces_to_highlight = {
            region = south_castanor_region
        }
        trigger = {
            owns_all_provinces = {
                region = south_castanor_region
            }
            south_castanor_region = {
                type = all
                OR = {
                    NOT = { local_autonomy_above_min = 10 }
                    has_province_modifier = autonomy_decreased
                }
            }
        }
        effect = {
            country_event = {
                id = flavour_karakhanbar.13
            }
            custom_tooltip = karakhanbar_event_insight_13_tt
        }
    }
}

Z54_4_1 = {
    slot = 4
    generic = no
    ai = yes
    has_country_shield = yes
    potential = {
        tag = Z54
   }

    Z54_warlords_of_deepwoods = {
        icon = mission_native_build_army_mission
        position = 2
        required_missions = { 
            Z54_aftermath_of_the_emeraldtide
            Z54_preserve_the_black_hearth
        }
        provinces_to_highlight = {
            superregion = deepwoods_superregion
            is_city = yes
            NOT = { owned_by = ROOT }
        }
        trigger = {
            owns_all_provinces = {
                superregion = deepwoods_superregion
                is_city = yes
            }
            has_institution = feudalism
        }
        effect = {
            change_government_reform_progress = 100
            if = {
                limit = {
                    capital_scope = {
                        NOT = { renaissance = 100 }
                    }
                }
                capital_scope = {
                    add_next_institution_embracement = 50
                }
            }
            else_if = {
                limit = {
                    capital_scope = {
                        renaissance = 100
                    }
                    NOT = { is_institution_enabled = new_world_i }
                }
                add_dip_power = 50
                add_mil_power = 50
                add_adm_power = 50
            }
            else_if = {
                limit = {
                    capital_scope = {
                        renaissance = 100
                        NOT = { new_world_i = 100 }
                    }
                    is_institution_enabled = new_world_i
                }
                capital_scope = {
                    add_next_institution_embracement = 50
                }
            }
            else = {
                add_dip_power = 100
                add_mil_power = 100
                add_adm_power = 100
            }
        }
    }

    Z54_secure_entrances = {
        icon = mission_conquer_mewar
        position = 3
        required_missions = {
            Z54_strike_the_heart_of_fey
            Z54_warlords_of_deepwoods
        }
        provinces_to_highlight = {
            province_group = deepwoods_outward_gladeways
		    NOT = { 
			    OR = {
				    base_manpower = 3
				    province_has_current_tech_fort_trigger = yes
			    }
		    }
        }
        trigger = {
            deepwoods_outward_gladeways = {
		        type = all
                OR = {
                    base_manpower = 3
                    province_has_current_tech_fort_trigger = yes
                }
            }
        }
        effect = {
		    deepwoods_outward_gladeways = {
                add_province_modifier = {
                    name = karakhanbar_walls_of_the_deepwoods_fortress
                    duration = -1
                }
            }
        }
    }

    Z54_turn_their_magic_against_them = {
        icon = mission_magical_forest
        position = 5
        required_missions = { 
            Z54_secure_entrances
        }
        provinces_to_highlight = {
            has_terrain = fey_gladeway
        }
        trigger = {
            if = {
                limit = { has_estate = estate_mages }
                num_of_owned_provinces_with = {
                    value = 2
                    has_terrain = fey_gladeway
                    has_production_building_trigger = yes
                    has_building = mage_tower
                }
                capital_scope = {
                    has_production_building_trigger = yes
                    has_building = mage_tower
                }
            }
            else_if = {
                limit = { 
                    has_estate = estate_artificers
                    NOT = { has_estate = estate_mages }
                }
                num_of_owned_provinces_with = {
                    value = 2
                    has_terrain = fey_gladeway
                    has_production_building_trigger = yes
                }
                capital_scope = {
                    has_production_building_trigger = yes
                }
                num_artifice_inventions_discovered = {
                    VAL = 5
                }
            }
            else_if = {
                limit = {
                    NOT = { has_estate = estate_artificers }
                    NOT = { has_estate = estate_mages }
                }
                num_of_owned_provinces_with = {
                    value = 2
                    has_terrain = fey_gladeway
                    has_production_building_trigger = yes
                }
                capital_scope = {
                    has_production_building_trigger = yes
                }
                check_variable = {
                    which = centralize_state_counter
                    value = 5
                }
            }
        }
        effect = {
            custom_tooltip = karakhanbar_turn_their_magic_effect_tt
            tooltip = {
                add_permanent_province_modifier = {
                    name = karakhanbar_feytouched_supply_lines
                    duration = -1
                }
            }
            hidden_effect = {
                every_owned_province = {
                    limit = { has_terrain = fey_gladeway }
                    add_permanent_province_modifier = {
                        name = karakhanbar_feytouched_supply_lines
                        duration = -1
                    }
                }
            }
            fey_abundant_goods_provinces = {
                remove_province_modifier = fey_dummy_goods
                remove_province_modifier = fey_abundant_goods
                remove_province_modifier = fey_abundant_goods_improved
            }
        }
    }

    Z54_engineer_corps = {
        icon = mission_mithril_cannons
        position = 6
        required_missions = { 
            Z54_might_makes_right
            Z54_turn_their_magic_against_them
            Z54_to_reach_for_resources
        }
        trigger = {
            weapons = 5
            OR = {
                has_mil_advisor_3 = yes
                army_reformer = 2
            }
            OR = {
                army_professionalism = 0.3
                AND = {
                    army_professionalism = 0.2
                    mil_power = 100
                }
                AND = {
                    army_professionalism = 0.1
                    mil_power = 200
                }
            }
            artillery_fraction = 0.2
        }
        effect = {
            if = {
                limit = {
                    army_professionalism = 0.1
                    NOT = { army_professionalism = 0.2 }
                }
                add_mil_power = -200
            }
            else_if ={
                limit = {
                    army_professionalism = 0.2
                    NOT = { army_professionalism = 0.3}
                }
                add_mil_power = -100
            }
            define_advisor = {
                type = fortification_expert
                name = "Larluk Ironside"
                skill = 3
                culture = karakhanbari_orc
                religion = ROOT
                cost_multiplier = 0.25
            }
            add_country_modifier = {
                name = karakhanbar_professional_army
                duration = 7300
            }
            country_event = {
                id = flavour_karakhanbar.7
            }
            custom_tooltip = karakhanbar_event_insight_7_tt
         }
    }

    Z54_the_woods_controlled = {
        icon = mission_big_house
        position = 7
        required_missions = { 
            Z54_engineer_corps
            Z54_learning_from_dwarves
        }
        provinces_to_highlight = {
            superregion = deepwoods_superregion
            NOT = { has_terrain = gladeway }
            NOT = { has_terrain = fey_gladeway }
            NOT = { has_terrain = cavern }
            NOT = { development = 8 }
        }
        trigger = {
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_8_development_tt
                deepwoods_superregion = {
                    type = all
                    OR = {
                        has_terrain = gladeway
                        has_terrain = fey_gladeway
                        has_terrain = cavern
                        development = 8
                    }
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_mountain_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_mountain_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_mountain_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_lake_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_lake_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_lake_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_bone_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_bone_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_bone_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_thorn_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_thorn_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_thorn_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_hunter_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_hunter_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_hunter_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_arrow_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_arrow_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_arrow_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_flower_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_flower_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_flower_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_river_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_river_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_river_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_the_woods_controlled_trigger_shadow_grove_tt
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_shadow_grove
                        has_production_building_trigger = yes
                    }
                    amount = 4
                }
                calc_true_if = {
                    all_owned_province = {
                        province_group = deepwoods_shadow_grove
                        has_manufactory_trigger = yes
                    }
                    amount = 2
                }
            }
            
        }
        effect = {
            custom_tooltip = karakhanbar_the_woods_controlled_effect_tt
            set_country_flag = karakhanbar_upgrade_government
        }
    }

    Z54_copper_of_bahar = {
        icon = mission_anvil
        position = 8
        required_missions = { 
            Z54_a_new_escann
            Z54_the_woods_controlled
        }
        provinces_to_highlight = {
            region = bahar_region
            NOT = { owned_by = ROOT }
        }
        trigger = {
            num_of_owned_provinces_with = {
                value = 25
                region = bahar_region
            }
            526 = {
                development = 45
                has_trade_building_trigger = yes
                has_production_building_trigger = yes
                has_manufactory_trigger = yes
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_copper_of_bahar_trigger_tt
                1312 = {
                    num_investments_in_trade_company_region = { 
                        investment = brokers_exchange
                        value = 5
                    }
                }
            }
            has_promote_investments = trade_company_bahar
        }
        effect = {
            if = {
                limit = {
                    has_global_flag = iron_working_happened
                }
                add_treasury = 1000
                add_country_modifier = {
                    name = karakhanbar_abundance_of_copper
                    duration = 9125
                }
            }
            else = {
                add_country_modifier = {
                    name = karakhanbar_abundance_of_copper
                    duration = -1
                }
            }
            526 = {
                if = {
                    limit = {
                        OR = {
                            province_has_center_of_trade_of_level = 1
                            province_has_center_of_trade_of_level = 2
                        }
                    }
                    add_center_of_trade_level = 1
                }
                else = {
                    PREV = { add_treasury = 500 }
                }
            }
            custom_tooltip = karakhanbar_copper_of_bahar_effect_tt
            set_country_flag = karakhanbar_industrious_rulers
        }
    }
}

Z54_5_1 = {
    slot = 5
    generic = no
    ai = yes
    has_country_shield = yes
    potential = {
        tag = Z54
    }

    Z54_preserve_the_black_hearth = {
        icon = mission_torch_fire
        position = 1
        required_missions = {}
        provinces_to_highlight = {
		    is_capital_of = ROOT
        }
        trigger = {
            capital_scope = {
                development = 20
                has_building = fort_15th
                has_building = marketplace
                has_building = temple
                if = {
                    limit = { has_dlc = "Leviathan" }
                    num_of_times_expanded_infrastructure = 1
                }
            }
           custom_trigger_tooltip = {
		        tooltip = karakhanbar_preserve_the_black_hearth_trigger_tt
		        has_country_flag = had_bron_event
		    }
        }
        effect = {
            capital_scope = {
                add_province_modifier = {
                    name = karakhanbar_centre_of_industry
                    duration = -1
                }
                if = {
                    limit = {
                        province_has_center_of_trade_of_level = 2
                    }
                    PREV = {
                        add_treasury = 200
                    }
                }
                else_if = {
                    limit = {
                        province_has_center_of_trade_of_level = 1
                    }
                    add_center_of_trade_level = 1
                }
                else = {
                    center_of_trade = 1
                }
            }
            add_government_reform = karakhanbar_black_hearth_council_reform
            hidden_effect = {
                set_variable = {
                    which = karakhanbarGovButtonCost
                    value = 0
                }
                add_republican_tradition = 10
            }
            if = {
                limit = {
                    has_country_flag = bron_the_bonfire_is_leader
                }
                add_government_power = {
                    mechanic_type = karakhanbar_flames_of_the_black_hearth_mechanic
                    power_type = karakhanbar_flames_of_the_black_hearth_power
                    value = 30
                }
            }
        }
    }

    Z54_fires_burning_bright = {
        icon = mission_fire_judgement
        position = 2
        required_missions = { 
            Z54_preserve_the_black_hearth
        }
        provinces_to_highlight = {
            province_group = deepwoods_mountain_grove
        }
        trigger = {
		    if = {
			    limit = { 
				    has_country_flag = bron_the_bonfire_is_leader
			    }
			    custom_trigger_tooltip = {
				    tooltip = karakhanbar_fires_burning_bright_trigger_tt
				    has_country_flag = bron_the_bonfire_is_leader
			    }
		    }
            else = {
                estate_loyalty = {
                    estate = estate_church
                    loyalty = 60
                }
            }
            has_adm_advisor_2 = yes
            owns_all_provinces = {
                province_group = deepwoods_mountain_grove
            }
            num_of_owned_provinces_with = {
	            value = 5
	            has_province_modifier = karakhanbar_slash_and_burn
            }
        }
        effect = {
            every_owned_province = {
                limit = {
                    province_group = deepwoods_mountain_grove
                }
                add_province_modifier = {
                    name = karakhanbar_thorough_prospecting
                    duration = 9125
                }
            }
        }
    }

    Z54_the_bald_peak = {
        icon = mission_war_chest
        position = 3
        required_missions = { 
            Z54_fires_burning_bright
            Z54_warlords_of_deepwoods
        }
        provinces_to_highlight = {
            province_group = deepwoods_mountain_grove
            NOT = { base_production = 4 }
        }
        trigger = {
            deepwoods_mountain_grove = {
                type = all
                base_production = 4
            }
            3020 = {
                base_production = 6
            }
        }
        effect = {
            4100 = {
                add_permanent_claim = ROOT
            }
            7008 = {
                change_trade_goods = copper
		        hidden_effect = {
                	add_province_modifier = {
                   		name = karakhanbar_fledgeling_mines
                    	duration = 9125
                	}
		        }
            }
            3019 = {
                change_trade_goods = copper
		        hidden_effect = {
                	add_province_modifier = {
                   		name = karakhanbar_fledgeling_mines
                    	duration = 9125
                	}
		        }
            }
            3021 = {
                change_trade_goods = iron
		        hidden_effect = {
                	add_province_modifier = {
                   		name = karakhanbar_fledgeling_mines
                    	duration = 9125
                	}
		        }
            }
            3022 = {
                change_trade_goods = iron
		        hidden_effect = {
                	add_province_modifier = {
                   		name = karakhanbar_fledgeling_mines
                    	duration = 9125
                	}
		        }
            }
            7010 = {
                change_trade_goods = iron
		        hidden_effect = {
                	add_province_modifier = {
                   		name = karakhanbar_fledgeling_mines
                    	duration = 9125
                	}
		        }
            }
		    tooltip = {
			    add_province_modifier = {
                   	name = karakhanbar_fledgeling_mines
                    duration = 9125
                }
		    }
            3020 = {
                province_event = {
                    id = flavour_karakhanbar.3
                }
                custom_tooltip = karakhanbar_event_insight_3_tt
            }
        }
    }

    Z54_break_through_gates = {
        icon = mission_mountain_castle
        position = 4
        required_missions = { 
            Z54_secure_entrances
            Z54_the_bald_peak
        }
        provinces_to_highlight = {
            province_id = 4100
        }
        trigger = {
            manpower = 10
            monthly_adm = 10
            if = {
                limit = {
                    4100 = {
                        is_city = no
                        is_colony = no
                    }
                }
                3065 = {
                    num_of_units_in_province = {
                        amount = 25
                    }
                }
            }
            else = {
                owns_or_non_sovereign_subject_of = 4100
            }
        }
        effect = {
            if = {
                limit = {
                    4100 = {
                        is_city = no
                        is_colony = no
                    }
                }
                4100 = { add_siberian_construction = 500 }
            }
            stunad_skomdihr_area = {
                add_permanent_claim = ROOT
            }
            argrod_9_11_area = {
                add_permanent_claim = ROOT
            }
            argrod_6_8_area = {
                add_permanent_claim = ROOT
            }
            set_country_flag = karakhanbar_mining_frontier_flag
            custom_tooltip = karakhanbar_break_through_gates_effect_tt
        }
    }

    Z54_to_reach_for_resources = {
        icon = mission_underground_cave
        position = 5
        required_missions = { 
            Z54_break_through_gates
        }
        provinces_to_highlight = {
            area = stunad_skomdihr_area
        }
        trigger = {
            owns_all_provinces = {
                area = stunad_skomdihr_area
            }
            stunad_skomdihr_area = {
                type = all
                is_city = yes
            }
            4100 = {
                hold_condition = { Repaired = yes }
            }
            any_known_country = {   
                capital_scope = {
                    region = serpentreach_region
                }
                NOT = { army_size = ROOT }
            }
        }
        effect = {
            every_known_country = {
                limit = {
                    capital_scope = { region = serpentreach_region }
                    NOT = { total_development = 200 }
                }
                ROOT = {
                    add_casus_belli = {
                        target = PREV
                        type = cb_vassalize_mission
                        months = 120
                    }
                }
            }
            serpentreach_region = {
                limit = { NOT = { owned_by = ROOT } }
                add_permanent_claim = ROOT
            }
            set_country_flag = karakhanbar_monopoly_on_fuel
            custom_tooltip = karakhanbar_to_reach_for_resources_effect_tt
        }
    }

    Z54_learning_from_dwarves = {
        icon = mission_mechanical_mining
        position = 6
        required_missions = { 
            Z54_to_reach_for_resources
        }
        provinces_to_highlight = {
            region = serpentreach_region
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            serpentreach_region = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
            num_of_owned_provinces_with = {
                value = 5
                AND = {
                    region = serpentreach_region
                    OR = {
                        has_province_modifier = restored_rail
                        has_province_modifier = advanced_rail
                    }
                }
            }
            trade_goods_produced_amount = {
                trade_goods = copper
                amount = 20
            }
            trade_goods_produced_amount = {
                trade_goods = iron
                amount = 20
            }
        }
        effect = {
            if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 22
                        AND = {
                            region = serpentreach_region
                            OR = {
                                has_province_modifier = restored_rail
                                has_province_modifier = advanced_rail
                            }
                        }
                    }
                }
                custom_tooltip = karakhanbar_learning_from_dwarves_effect_innovativeness_yes_tt
                hidden_effect = { change_innovativeness = 10 } 
            }
            else = {
                custom_tooltip = karakhanbar_learning_from_dwarves_effect_innovativeness_no_tt
                hidden_effect = { change_innovativeness = 5 }
            }
            custom_tooltip = karakhanbar_learning_from_dwarves_effect_serpentspine_abundance_tt
            hidden_effect = {
                if = {
                    limit = { NOT = { has_global_flag = mithril_abundance_happened } }
                    set_global_flag = mithril_abundance_happened
                }
                if = {
                    limit = { NOT = { has_global_flag = serpentspine_abundance_happened } }
                    set_global_flag = serpentspine_abundance_happened
                }
            }
            if = {
                limit = { has_country_flag = karakhanbar_static_artificery_cap_increase_potential }
                ROOT = {
                    change_variable = {
                        which = MaxArtificePoints
                        value = 10
                    }
                }
            }
            else = {
                set_country_flag = karakhanbar_static_artificery_cap_increase_potential
                custom_tooltip = karakhanbar_learning_from_dwarves_effect_potential_artificery_tt
            }
            custom_tooltip = karakhanbar_learning_from_dwarves_effect_jorkad_dam_tt
            set_country_flag = allow_jorkad_dam_building
        }
    }

    Z54_clip_their_wings = {
        icon = mission_head_on_spike
        position = 7
        required_missions = { 
            Z54_learning_from_dwarves
        }
        provinces_to_highlight = {
            OR = {
                area = firanyalen_area
                area = misharallen_area              
            }
        }
        trigger = {
            owns_all_provinces = {
                OR = {
                    area = firanyalen_area
                    area = misharallen_area
                }
            }
            OR = {
                has_country_modifier = racial_pop_harpy_purge
                has_country_modifier = racial_pop_harpy_expulsion  
                medium_tolerance_harpy_race_trigger = yes
            }
            treasury = 750
            custom_trigger_tooltip = {
                tooltip = karakhanbar_clip_their_wings_trigger_672_tt
                672 = { owned_by = ROOT }
                672 = { NOT = { has_construction = building } }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_clip_their_wings_trigger_676_tt
                676 = { owned_by = ROOT }
                676 = { NOT = { has_construction = building } }
            }
            custom_trigger_tooltip = {
                tooltip = karakhanbar_clip_their_wings_trigger_677_tt
                677 = { owned_by = ROOT }
                677 = { NOT = { has_construction = building } }
            }
        }
        effect = {
            add_treasury = -750
            672 = {
                add_building_construction = {
                    building = ramparts
                    speed = 1
                    cost = 0
                }
            }
            676 = {
                add_building_construction = {
                    building = ramparts
                    speed = 1
                    cost = 0
                }
            }
            677 = {
                add_building_construction = {
                    building = ramparts
                    speed = 1
                    cost = 0
                }
            }
        }
    }

    Z54_new_model_smithing = {
        icon = mission_rb_central_belt_coal_mining
        position = 9
        required_missions = { 
            Z54_copper_of_bahar
            Z54_clip_their_wings
        }
        trigger = {
            OR = {
                has_institution = manufactories
                num_of_owned_provinces_with = {
                    value = 75
                    has_manufactory_trigger = yes
                }
            }
            has_estate_privilege = estate_noble_monopoly_of_fuel
            num_of_owned_provinces_with = {
                value = 50
                OR = {
                    trade_goods = copper
                    trade_goods = gold
                    trade_goods = iron
                    trade_goods = mithril
                }
            }
        }
        effect = {
            if = {
                limit = { has_institution = manufactories }
                country_event = {
                    id = flavour_karakhanbar.14
                }
                custom_tooltip = karakhanbar_event_insight_14_tt
            }
            else_if = {
                limit = {
                    num_of_owned_provinces_with = {
                        value = 75
                        has_manufactory_trigger = yes
                    }
                }
                add_country_modifier = {
                    name = karakhanbar_prototype_smelters
                    duration = -1
                }
            }
            custom_tooltip = karakhanbar_new_model_smithing_effect_monopoly_tt
            set_country_flag = karakhanbar_upgrade_of_monopoly
        }
    }

    Z54_the_torchbearers = {
        icon = mission_rb_build_furnaces
        position = 10
        required_missions = {
            Z54_new_model_smithing
        }
        trigger = {
            OR = {
                has_mil_advisor_5 = yes
                AND = {
                    has_mil_advisor_3 = yes
                    treasury = 2500
                }
            }
            has_leader_with = {
                fire = 4
            }
            OR = {
                army_professionalism = 0.6
                AND = {
                    army_professionalism = 0.5
                    mil_power = 100
                }
                AND = {
                    army_professionalism = 0.4
                    mil_power = 200
                }
                AND = {
                    army_professionalism = 0.3
                    mil_power = 300
                }
            }
            artillery_fraction = 0.33
        }
        effect = {
            if = {
                limit = {
                    NOT = {
                        has_mil_advisor_5 = yes
                    }
                }
                add_treasury = -2500
            }
            if = {
                limit = {
                    army_professionalism = 0.3
                    NOT = { army_professionalism = 0.4 }
                }
                add_mil_power = -300
            }
            else_if = {
                limit = {
                    army_professionalism = 0.4
                    NOT = { army_professionalism = 0.5 }
                }
                add_mil_power = -200
            }
            else_if = {
                limit = {
                    army_professionalism = 0.5
                    NOT = { army_professionalism = 0.6 }
                }
                add_mil_power = -100
            }
            if = {
                limit = { has_country_modifier = karakhanbar_karakhanbari_siege_corps_1 }
                remove_country_modifier = karakhanbar_karakhanbari_siege_corps_1
                add_country_modifier = {
                    name = karakhanbar_karakhanbari_siege_corps_2
                    duration = -1
                }
            }
            if = {
                limit = { has_country_modifier = karakhanbar_karakhanbari_artillery_corps_1 }
                remove_country_modifier = karakhanbar_karakhanbari_artillery_corps_1
                add_country_modifier = {
                    name = karakhanbar_karakhanbari_artillery_corps_2
                    duration = -1
                }
            }
            add_country_modifier = {
                name = karakhanbar_professional_army
                duration = 7300
            }
            custom_tooltip = karakhanbar_the_torchbearers_effect_artificery_tt
            set_country_flag = unlocked_black_hearth_torches_invention
            custom_tooltip = karakhanbar_the_torchbearers_effect_coal_tt
            hidden_effect = {
                select_highest_dev_province_with_limit = { 
                    limit = "superregion = deepwoods_superregion trade_goods = tropical_wood" 
                    effect = "change_trade_goods = coal"
                }
            }
        }
    }

}

Z54_2_endgame = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		has_country_flag = Z54_found_the_origins
	}

    Z54_seek_power = {
        icon = mission_the_covenant
        position = 10
        required_missions = {
            Z54_history_of_ashentree
            Z54_vanguard_victorious
        }
        provinces_to_highlight = {
            province_id = 441
        }
        trigger = {
            custom_trigger_tooltip = {
                tooltip = karakhanbar_seek_power_trigger_tt
                has_country_flag = karakhanbar_had_encounter_with_vampires
            }
            num_of_owned_provinces_with = {
                value = 12
                region = dostanor_region
            }
            441 = {
                owned_by = ROOT
                has_great_project = {
                    type = bal_dostan
                    tier = 2
                }
                NOT = { has_province_modifier = ruined_castanorian_citadel }
            }
        }
        effect = {
            country_event = {
                id = flavour_karakhanbar.15
            }
            custom_tooltip = karakhanbar_event_insight_15_tt
        }
    }
}

Z54_3_endgame = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		has_country_flag = Z54_found_the_origins
	}

    Z54_second_burning_of_the_worldtree = {
        icon = mission_fire_acolyte
        position = 11
        required_missions = {
            Z54_seek_power
            Z54_break_through_white_walls
         }
        provinces_to_highlight = {
            province_id = 874
        }
        trigger = {
            owns_core_province = 874
            874 = {
                has_ruler_leader_from = ROOT
                infantry_in_province = 40
            }
        }
        effect = {
            874 = {
                kill_units = {
                    who = ROOT
                    type = infantry
                    amount = 20
                }
            }
            country_event = {
                id = flavour_karakhanbar.16
            }
            custom_tooltip = karakhanbar_event_insight_16_tt
        }
    }
}

Z54_4_endgame = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes

	potential = { 
        tag = Z54
		has_country_flag = Z54_found_the_origins
	}

    Z54_break_through_white_walls = {
        icon = mission_white_tower
        position = 10
        required_missions = { 
            Z54_vanguard_victorious
        }
        provinces_to_highlight = {
            province_id = 866
            province_id = 873
            province_id = 874 
        }
        trigger = {
            has_global_modifier_value = {
                which = discipline
                value = 0.15
            }
            owns_all_provinces = {
                area = oldhaven_area
            }
            oldhaven_area = {
                type = all
                NOT = { has_fort_building_trigger = yes }
                artillery_in_province = 6
            }
        }
        effect = {
            866 = {
                remove_province_modifier = white_walls_of_castanor
            }
            873 = {
                remove_province_modifier = white_walls_of_castanor
            }
            874 = {
                remove_province_modifier = white_walls_of_castanor
            }
            deepwoods_outward_gladeways = {
                remove_province_modifier = karakhanbar_walls_of_the_deepwoods_fortress
                add_province_modifier = {
                    name = karakhanbar_reinforced_walls_of_the_deepwoods_fortress
                    duration = -1
                }
            }
            custom_tooltip = karakhanbar_break_through_white_walls_effect_tt
            set_country_flag = karakhanbar_improved_advisors
        }
    }
}
