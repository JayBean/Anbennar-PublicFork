
khugdihr_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
	}
	
	khugdihr_secure_the_north = {
		icon = mission_verdant_secret
		position = 2
		required_missions = {
			khugdihr_the_asra_bank
		}
		
		provinces_to_highlight = {
			OR = {
				AND = {
					region = northern_pass_region
					NOT = {
						ROOT = {
							num_of_owned_provinces_with = {
								region = northern_pass_region
								value = 7
							}
						}
					}
				}
				area = dwaroval_area
			}
			NOT = { owned_by = ROOT }
		}
		
		trigger = {
			num_of_owned_provinces_with = {
				region = northern_pass_region
				value = 7
			}
			dwaroval_area = {
				type = all
				owned_by = ROOT
			}
		}
		
		effect = {
			set_country_flag = khug_manifest_destiny_flag
			custom_tooltip = khug_tooltip_manifest_destiny
			add_mil_power = 100
			northern_pass_region = {
				add_claim = ROOT
			}
		}
	}
	
	khugdihr_balgar_venerated_ancestor = {
		icon = mission_women_prayer
		position = 3
		required_missions = {
		}
		
		provinces_to_highlight = {
			province_id = 2863
		}
		
		trigger = {
			OR = {
				has_personal_deity = balgar
				religion = corinite
			}
			num_of_owned_provinces_with = {
				has_tax_building_trigger = yes
				value = 5
			}
			2863 = {
				base_tax = 15
			}
			estate_influence = {
				estate = estate_church
				influence = 40
			}
		}
		
		effect = {
			country_event = { id = flavour_khug.1 }
			add_legitimacy = 25
			add_republican_tradition = 10
		}
	}
	
	khugdihr_alliance_of_faith = {
		icon = hungarian_union  #bohemia, emperor
		position = 4
		required_missions = {
			khugdihr_balgar_venerated_ancestor
		}
		
		provinces_to_highlight = {
			is_capital = yes
			owner = { religion = ancestor_worship }
		}
		
		trigger = {
			calc_true_if = {
				all_known_country = {
					religion = ancestor_worship
					has_100_opinion_improved_relation = { target = ROOT }
			#		OR = {
			#			has_opinion = { who = ROOT value = 125 }
			#			trust = { who = ROOT value = 60 }
			#		}
				}
				amount = 2
			}
			estate_loyalty = {
				estate = estate_church
				loyalty = 60
			}
		}
		
		effect = {
			set_country_flag = ancestral_worshippers_unlocked
			custom_tooltip = khug_tooltip_unlock_ancestral_worshippers
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -20
			}
		}
	}
	
	khugdihr_the_ancestral_holds = {
		icon = mission_approach_throne
		position = 5
		required_missions = {
			khugdihr_alliance_of_faith
			khugdihr_follow_the_dwarven_rail_road
		}
		
		provinces_to_highlight = {
			OR = {
				province_id = 4119
				province_id = 2931
			}
			OR = {
				NOT = { has_tax_building_trigger = yes }
				NOT = { owned_by = ROOT }
				NOT = { culture_group = dwarven }
				has_province_modifier = ruined_hold
				has_province_modifier = partially_ruined_hold
				has_province_modifier = damaged_hold
				has_province_modifier = infested_hold
			}
		}
		
		trigger = {
			4119 = {
				has_tax_building_trigger = yes
				owned_by = ROOT
				culture_group = dwarven
				NOT = { has_province_modifier = ruined_hold }
				NOT = { has_province_modifier = partially_ruined_hold }
				NOT = { has_province_modifier = damaged_hold }
				NOT = { has_province_modifier = infested_hold }
			}
			2931 = {
				has_tax_building_trigger = yes
				owned_by = ROOT
				culture_group = dwarven
				NOT = { has_province_modifier = ruined_hold }
				NOT = { has_province_modifier = partially_ruined_hold }
				NOT = { has_province_modifier = damaged_hold }
				NOT = { has_province_modifier = infested_hold }
			}
			estate_loyalty = {
				estate = estate_church
				loyalty = 60
			}
			has_estate_privilege = estate_church_khug_ancestral_worshippers
		}
		
		effect = {
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -20
			}
			2931 = {
				change_religion = ancestor_worship
				add_province_modifier = {
					name = khug_ancestral_holy_site
					duration = -1
				}
			}
			4119 = {
				change_religion = ancestor_worship
				add_province_modifier = {
					name = khug_ancestral_holy_site
					duration = -1
				}
			}
		}
	}
}

khugdihr_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
	}
	
	khugdihr_the_asra_bank = {
		icon = mission_diplomacy_missive
		position = 1
		required_missions = {
		}
		
		provinces_to_highlight = {
			province_id = 2863
		}
		
		trigger = {
			2863 = {
				development = 40
				NOT = { has_province_modifier = ruined_hold }
				NOT = { has_province_modifier = partially_ruined_hold }
				NOT = { has_province_modifier = damaged_hold }
				#NOT = { has_province_modifier = infested_hold }
			}
			num_of_owned_provinces_with = {
				value = 7
				region = west_dwarovar_region
			}
		}
		
		effect = {
			country_event = { id = flavour_khug.2 }
			add_prestige = 10
		}
	}
	
	khugdihr_funding_the_reconquest = {
		icon = dominant_economy #germany, emperor
		position = 2
		required_missions = {
			khugdihr_the_asra_bank
		}
		
		trigger = {
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
			estate_influence = {
				estate = estate_burghers
				influence = 50
			}
		}
		
		effect = {
			add_country_modifier = {
				name = khug_reclamation_effort
				duration = 9125
			}
			dwarovrod_1_3_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			dwarovrod_4_6_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			dwarovrod_7_9_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			dwarovrod_10_12_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}
	}
	
	khugdihr_follow_the_dwarven_rail_road = {
		icon = mission_rb_conquer_brittany
		position = 4
		required_missions = {
			khugdihr_funding_the_reconquest
		}
		
		provinces_to_highlight = {
			OR = {
				area = dwarovrod_1_3_area
				area = dwarovrod_4_6_area
				area = dwarovrod_7_9_area
				area = dwarovrod_10_12_area
			}
			NOT = { owned_by = ROOT }
		}
		
		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					area = dwarovrod_1_3_area
					area = dwarovrod_4_6_area
					area = dwarovrod_7_9_area
					area = dwarovrod_10_12_area
				}
				value = 10
			}
		}
		
		effect = {
			2931 = { add_permanent_claim = ROOT }
			4119 = { add_permanent_claim = ROOT }
			2868 = { add_permanent_claim = ROOT }
			4236 = { add_permanent_claim = ROOT }
			add_prestige = 20
		}
	}
	
	khugdihr_industrial_dwarovar = {
		icon = mission_smith
		position = 5
		required_missions = {
			khugdihr_follow_the_dwarven_rail_road
		}
		
		provinces_to_highlight = {
			OR = {
				province_id = 2868
				province_id = 4236
			}
			OR = {
				NOT = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				NOT = { owned_by = ROOT }
				NOT = { culture_group = dwarven }
				has_province_modifier = ruined_hold
				has_province_modifier = partially_ruined_hold
				has_province_modifier = damaged_hold
				has_province_modifier = infested_hold
			}
		}
		
		trigger = {
			2868 = {
				OR = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				owned_by = ROOT
				culture_group = dwarven
				NOT = { has_province_modifier = ruined_hold }
				NOT = { has_province_modifier = partially_ruined_hold }
				NOT = { has_province_modifier = damaged_hold }
				NOT = { has_province_modifier = infested_hold }
			}
			4236 = {
				OR = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				owned_by = ROOT
				culture_group = dwarven
				NOT = { has_province_modifier = ruined_hold }
				NOT = { has_province_modifier = partially_ruined_hold }
				NOT = { has_province_modifier = damaged_hold }
				NOT = { has_province_modifier = infested_hold }
			}
		}
		
		effect = {
			add_country_modifier = {
				name = khug_dwarovar_industry
				duration = 9125
			}
			2868 = { add_base_production = 2 }
			4236 = { add_base_production = 2 }
		}
	}
}

khugdihr_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
	}
	
	khugdihr_anbenncoster_contacts = {
		icon = secure_the_republic
		position = 2
		required_missions = {
			khugdihr_the_asra_bank
			khugdihr_foreign_investment
		}
		
		provinces_to_highlight = {
			province_id = 8
		}
		
		trigger = {
			8 = {
				owner = {
					has_opinion = { who = ROOT value = 100 }
					has_spy_network_from = { who = ROOT value = 25 }
				}
			}
		}
		
		effect = {
			add_country_modifier = {
				name = khug_exchange_of_personnel
				duration = 9125
			}
			hidden_effect = {
				every_known_country = {
					limit = { is_part_of_hre = yes }
					2863 = { discover_country = PREV }
				}
				8 = { owner = { set_country_flag = khug_helped } }
			}
			custom_tooltip = khug_tooltip_eoa_discovers_you
		}
	}
	
	khugdihr_investor_dividends_and_future_incentives = {
		icon = reform_the_monte
		position = 3
		required_missions = {
			khugdihr_funding_the_reconquest
			khugdihr_anbenncoster_contacts
		}
		
		trigger = {
			treasury = 250
			NOT = { corruption = 1 }
		}
		
		effect = {
			add_treasury = -250
			add_country_modifier = {
				name = khug_credible_state
				duration = 18250
			}
			country_event = { id = flavour_khug.9 }
			define_advisor = {
				type = treasurer
				name = "Magnus Asra"
				skill = 3
				culture = agate_dwarf
				discount = yes
				religion = regent_court
			}
		}
	}
	
	khugdihr_allowing_bank_influence = {
		icon = mission_rb_weather_the_reformation #rule brittania
		position = 4
		required_missions = {
			khugdihr_investor_dividends_and_future_incentives
		}
		
		trigger = {
			has_dip_advisor_3 = yes
			has_adm_advisor_3 = yes
			stability = 1
			legitimacy_equivalent = 100
			if = {
				limit = { has_estate = estate_nobles }
				estate_loyalty = {
					estate = estate_nobles
					loyalty = 60
				}
			}
			else = {
				mil_power = 50
			}
			if = {
				limit = { has_parliament = yes }
				current_size_of_parliament = 15
				has_active_debate = yes
			}
		}
		
		effect = {
			add_treasury = 1000
			if = {
				limit = { has_estate = estate_nobles }
				add_estate_loyalty = {
					estate = estate_nobles
					loyalty = -30
				}
			}
			else = {
				add_mil_power = -50
			}
			add_country_modifier = {
				name = khug_bank_puppet_strong
				duration = -1
			}
			add_legitimacy = -20
			add_republican_tradition = -10
			add_corruption = 5
			add_stability = -1
			2863 = {
				spawn_rebels = {
					type = noble_rebels
					size = 2
				}
			}
		}
	}
	
	khugdihr_nationalising_the_bank = {
		icon = mission_monarch_diplomacy
		position = 5
		required_missions = {
			khugdihr_allowing_bank_influence
		}
		
		trigger = {
			NOT = {
				num_of_loans = 1
				inflation = 1
				corruption = 1
			}
			years_of_income = 1.0
			if = {
				limit = { has_estate = estate_nobles }
				estate_loyalty = {
					estate = estate_nobles
					loyalty = 60
				}
			}
			else = {
				mil_power = 50
			}
			if = {
				limit = { has_parliament = yes }
				current_size_of_parliament = 20
				has_active_debate = yes
			}
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
		}
		
		effect = {
			if = {
				limit = { government = monarchy }
				add_government_reform = khug_asra_reform_monarchy
				country_event = { id = flavour_khug.4 }
			}
			else_if = {
				limit = { government = republic }
				#add_government_reform = khug_asra_reform_republic
				custom_tooltip = khug_tooltip_unlock_asra_reform_republic
				change_government_reform_progress = 100
				set_country_flag = unlock_asra_reform_republic
				define_advisor = {
					type = treasurer
					name = "Erin Asra"
					skill = 3
					culture = agate_dwarf
					discount = yes
					religion = regent_court
					female = yes
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = bank }
					has_idea_group = economic_ideas
					economic_ideas = 3
					adm = 4
				}
				country_event = { id = 4042 days = 5 }
			}
			else = { add_stability_or_adm_power = yes }
			
			if = {
				limit = { NOT = { has_estate = estate_nobles } }
				add_mil_power = -50
			}
			else = {
				change_estate_land_share = { estate = estate_nobles share = -5 }
			}
			change_estate_land_share = { estate = estate_burghers share = -5 }
		}
	}
	
	khugdihr_successors_of_asra = {
		icon = standardize_relazioni
		position = 6
		required_missions = {
			khugdihr_the_ancestral_holds
			khugdihr_nationalising_the_bank
			khugdihr_a_cannorian_hold
		}
		
		trigger = {
			is_subject = no
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_owns_the_agate 
				has_country_modifier = dwarovkron_agate 
			}
			crown_land_share = 50
		}
		
		effect = {
			country_event = { id = flavour_khug.24 }
		}
	}
}

khugdihr_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
	}
	
	khugdihr_foreign_investment = {
		icon = mission_alliances
		position = 1
		required_missions = {
		}
		
		trigger = {
			diplomat = 1
		}
		
		effect = {
			hidden_effect = {
				western_cannor_superregion = {
					discover_country = ROOT
				}
				escann_superregion = {
					discover_country = ROOT
				}
				dameshead_sea_region = {
					discover_country = ROOT
				}
				every_known_country = {
					limit = {
						capital_scope = { superregion = escann_superregion }   #needs custom tooltip
						NOT = { culture_group=orcish }
						NOT = { culture_group=goblin }
					}
					2863 = { discover_country = PREV }
				}
			}
			custom_tooltip = khug_tooltip_discover_cannor
			2863 = {
				discover_country = A38
				discover_country = A20
				discover_country = A73
			}
			custom_tooltip = khug_tooltip_escann_discovers_you
			add_dip_power = 50
		}
	}
	
	khugdihr_dwarven_aid = {
		icon = mission_noble_council
		position = 2
		required_missions = {
			khugdihr_foreign_investment
		}
		
		provinces_to_highlight = {
			OR = {
				province_id = 62
				province_id = 912
			}
			NOT = { owner = { has_opinion = { who = ROOT value = 100 } } }
		}
		
		trigger = {
			62 = { owner = { has_opinion = { who = ROOT value = 100 } } }
			912 = { owner = { has_opinion = { who = ROOT value = 100 } } }
			dip_power = 50
		}
		
		effect = {
			add_dip_power = -50
			2863 = { add_base_manpower = 2 }
			add_country_modifier = {
				name = khug_dwarven_aid
				duration = 18250
			}
			hidden_effect = {
				62 = { owner = { set_country_flag = khug_helped } }
				912 = { owner = { set_country_flag = khug_helped } }
			}
		}
	}
	
	khugdihr_anbennarian_aid = {
		icon = mission_princess_writing
		position = 3
		required_missions = {
			khugdihr_anbenncoster_contacts
			khugdihr_dwarven_aid
		}
		
		provinces_to_highlight = {
			is_part_of_hre = yes
			owner = {
				OR = {
					culture_group = anbennarian
					culture_group = alenic
				}
				NOT = { has_country_flag = khug_helped }
			}
		}
		
		trigger = {
			calc_true_if = {
				all_known_country = {
					has_opinion = { who = ROOT value = 100 }
					is_part_of_hre = yes
					OR = {
						culture_group = anbennarian
						culture_group = alenic
					}
					custom_trigger_tooltip = {
						tooltip = khug_tooltip_cannot_have_same_helpers
						NOT = { has_country_flag = khug_helped }
					}
				}
				amount = 2
			}
			dip_power = 50
		}
		
		effect = {
			add_dip_power = -50
			2863 = {
				add_base_tax = 2
				add_human_minority_size_effect = yes
			}
			hidden_effect = {
				random_known_country = {
					limit = {
						has_opinion = { who = ROOT value = 100 }
						is_part_of_hre = yes
						OR = {
							culture_group = anbennarian
							culture_group = alenic
						}
						NOT = { has_country_flag = khug_helped }
					}
					set_country_flag = khug_helped
				}
				random_known_country = {
					limit = {
						has_opinion = { who = ROOT value = 100 }
						is_part_of_hre = yes
						OR = {
							culture_group = anbennarian
							culture_group = alenic
						}
						NOT = { has_country_flag = khug_helped }
					}
					set_country_flag = khug_helped
				}
			}
			2863 = {
				discover_country = A06
				discover_country = A19
			}
		}
	}
	
	khugdihr_gnomish_aid = {
		icon = mission_mechanical_mining
		position = 4
		required_missions = {
			khugdihr_anbennarian_aid
		}
		
		provinces_to_highlight = {
			OR = {
				province_id = 169
				province_id = 126
				province_id = 271
			}
			NOT = { owner = { has_opinion = { who = ROOT value = 100 } } }
		}
		
		trigger = {
			OR = {
				169 = { owner = { has_opinion = { who = ROOT value = 100 } } }
				126 = { owner = { has_opinion = { who = ROOT value = 100 } } }
				271 = { owner = { has_opinion = { who = ROOT value = 100 } } }
			}
			dip_power = 25
		}
		
		effect = {
			add_dip_power = -25
			2863 = {
				add_base_production = 2
				add_gnomish_minority_size_effect = yes
			}
			hidden_effect = {
				169 = { owner = { set_country_flag = khug_helped } }
				126 = { owner = { set_country_flag = khug_helped } }
			}
			hidden_effect = {
				every_known_country = {
					limit = { capital_scope = { superregion = western_cannor_superregion } }
					2863 = { discover_country = PREV }
				}
			}
			custom_tooltip = khug_tooltip_cannor_discovers_you
		}
	}
	
	khugdihr_a_cannorian_hold = {
		icon = catholic_confraternity
		position = 5
		required_missions = {
			khugdihr_allowing_bank_influence
			khugdihr_gnomish_aid
		}
		
		provinces_to_highlight = {
			superregion = western_cannor_superregion
			owner = { NOT = { has_country_flag = khug_helped } }
		}
		
		trigger = {
			calc_true_if = {
				all_known_country = {
					has_opinion = { who = ROOT value = 100 }
					capital_scope = { superregion = western_cannor_superregion }
					custom_trigger_tooltip = {
						tooltip = khug_tooltip_cannot_have_same_helpers
						NOT = { has_country_flag = khug_helped }
					}
				}
				amount = 3
			}
			dip_power = 75
		}
		
		effect = {
			add_dip_power = -75
			if = {
				limit = {
					NOT = {
						religion = regent_court
						religion = corinite
					}
				}
				change_religion = regent_court #this is a safety measure, if you parkoured your way into forming khug as a AW country
			}
			2863 = {
				add_base_tax = 1
				add_base_manpower = 1
				add_base_production = 1
				change_religion = ROOT
			}
			add_country_modifier = {
				name = khug_a_cannorian_hold
				duration = 18250
			}
			hidden_effect = {
				random_known_country = {
					limit = {
						has_opinion = { who = ROOT value = 100 }
						capital_scope = { superregion = western_cannor_superregion }
						NOT = { has_country_flag = khug_helped }
					}
					set_country_flag = khug_helped
				}
				random_known_country = {
					limit = {
						has_opinion = { who = ROOT value = 100 }
						capital_scope = { superregion = western_cannor_superregion }
						NOT = { has_country_flag = khug_helped }
					}
					set_country_flag = khug_helped
				}
				random_known_country = {
					limit = {
						has_opinion = { who = ROOT value = 100 }
						capital_scope = { superregion = western_cannor_superregion }
						NOT = { has_country_flag = khug_helped }
					}
					set_country_flag = khug_helped
				}
			}
		}
	}
}

khugdihr_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
	}
	
	khugdihr_sponsor_the_reclamation_effort = {
		icon = reform_the_state #emperor, brandenburg
		position = 2
		required_missions = {
			khugdihr_foreign_investment
		}
		
		provinces_to_highlight = {
			is_capital = yes
			owner = { has_country_flag = adventurer_derived_government }
			continent = serpentspine
		}
		
		trigger = {
			treasury = 100
			any_ally = {
				custom_trigger_tooltip = {
					tooltip = khug_tooltip_was_adventurer
					has_country_flag = adventurer_derived_government
					capital_scope = { continent = serpentspine }
				}
				OR = {
					has_opinion = { who = ROOT value = 125 }
					trust = { who = ROOT value = 60 }
				}
			}
		}
		
		effect = {
			add_treasury = -100
			add_dip_power = 50
			random_ally = {
				limit = {
					custom_trigger_tooltip = {
						tooltip = khug_tooltip_was_adventurer
						has_country_flag = adventurer_derived_government
						capital_scope = { continent = serpentspine }
					}
					has_opinion = { who = ROOT value = 125 }
				}
				add_country_modifier = {
					name = khug_sponsored_by_khug
					duration = 9125
				}
				country_event = { id = flavour_khug.6 }
			}
			add_country_modifier = {
				name = khug_sponsoring_reclamation
				duration = 18250
			}
		}
	}
	
	khugdihr_a_natural_ally = {
		icon = mission_rb_unite_the_clans
		position = 3
		required_missions = {
		}
		
		provinces_to_highlight = {
			OR = {
				AND = {
					exists = Z36
					is_capital_of = Z36
				}
				AND = {
					NOT = { exists = B18 }
					NOT = { exists = Z36 }
					province_id = 849
					NOT = { owned_by = ROOT }
				}
			}
		}
		
		trigger = {
			OR = {
				AND = {
					exists = Z36
					alliance_with = Z36
				}
				AND = {
					NOT = { exists = B18 }
					NOT = { exists = Z36 }
					is_year = 1500
					849 = { owned_by = ROOT }
				}
			}
		}
		
		effect = {
			if = {
				limit = { NOT = { exists = Z36 } }
				849 = {
					add_core = Z36
					remove_core = ROOT
					change_culture = stone_dwarf
					change_religion = ROOT
				}
				create_vassal_with_religion_and_culture = { tag = Z36 religion = ROOT culture = stone_dwarf }
			}
			Z36 = { add_historical_friend = ROOT }
			ROOT = { add_historical_friend = Z36 }
		}
	}
	
	khugdihr_securing_regional_stability = {
		icon = mission_cannons_firing
		position = 4
		required_missions = {
			khugdihr_a_natural_ally
		}
		
		trigger = {
			stability = 1
			OR = {
				Z36 = { is_in_war = { attacker_leader = ROOT } }
				is_in_war = { attacker_leader = Z36 }
			}
			Z36 = { trust = { who = ROOT value = 60 } }
		}
		
		effect = {
			hidden_effect = {
				every_owned_province = {
					if = {
						limit = { NOT = { has_province_flag = got_prosperity_temp } }
						if = {
							limit = { is_capital = yes }
							add_prosperity = 100
						}
						else = {
							add_prosperity = 25
						}
						area = {
							set_province_flag = got_prosperity_temp
						}
					}
				}
				every_owned_province = {
					clr_province_flag = got_prosperity_temp
				}
			}
			custom_tooltip = khug_tooltip_every_province_gets_prosperity
			Z36 = { capital_scope = { add_prosperity = 100 } }
		}
	}
	
	khugdihr_cannorian_dwarovar_exchange_treaty = {
		icon = mission_warrior_gold
		position = 5
		required_missions = {
			khugdihr_securing_regional_stability
		}
		
		provinces_to_highlight = {
			owned_by = ROOT
			OR = {
				trade_goods = fungi
				trade_goods = serpentbloom
			}
			NOT = { has_building = farm_estate }
		}
		
		trigger = {
			any_owned_province = {
				OR = {
					trade_goods = fungi
					trade_goods = serpentbloom
				}
				has_building = farm_estate
			}
		}
		
		effect = {
			add_country_modifier = {
				name = khug_exchange_treaty
				duration = -1
			}
			add_dip_power = 100
			Z36 = {
				add_country_modifier = {
					name = khug_exchange_treaty
					duration = -1
				}
			}
		}
	}
}

khugdihr_1_pt_2 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	
	potential = {
		tag = I07
		has_country_flag = khugdihr_missions_part_2
	}
	
	khugdihr_asra_a_lead = {
		icon = mission_missive
		position = 7
		required_missions = {
			khugdihr_successors_of_asra
		}
		
		provinces_to_highlight = {
			province_id = 4074
			OR = {
				NOT = { owned_by = ROOT }
				has_province_modifier = expedition_target
			}
		}
		
		trigger = {
			4074 = { 
				owned_by = ROOT 
				NOT = { has_province_modifier = expedition_target }
			}
		}
		
		effect = {
			if = {
				limit = {
					has_country_flag = khug_fognir_died
					has_ruler_flag = khug_daughter
				}
				country_event = { id = flavour_khug.14 }
			}
			else_if = {
				limit = {
					has_country_flag = khug_fognir_died
					NOT = { has_ruler_flag = khug_daughter }
				}
				country_event = { id = flavour_khug.12 }
			}
			else_if = {
				limit = {
					NOT = { has_country_flag = khug_fognir_died }
					has_ruler_flag = khug_daughter
				}
				country_event = { id = flavour_khug.13 }
			}
			else = {
				country_event = { id = flavour_khug.11 }
			}
		}
	}
	
	khugdihr_the_search_for_mintbrick = {
		icon = mission_writing_book
		position = 8
		required_missions = {
			khugdihr_asra_a_lead
		}
		
		provinces_to_highlight = {
			province_id = 4074
			has_province_modifier = expedition_target
		}
		
		trigger = {
			4074 = { NOT = { has_province_modifier = expedition_target } }
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_expedition_made
				4074 = { has_province_flag = khug_expedition_1_created }
			}
		}
		
		effect = {
			if = {
				limit = { has_country_flag = khug_fognir_died }
				country_event = { id = flavour_khug.27 days = 30 }
			}
			else = {
				country_event = { id = flavour_khug.26 days = 30 }
			}
			hidden_effect = { 4074 = { clr_province_flag = khug_expedition_1_created } }
		}
	}
	
	khugdihr_gnomish_insight = {
		icon = the_fountain_of_youth
		position = 9
		required_missions = {
			khugdihr_the_search_for_mintbrick
		}
		
		provinces_to_highlight = {
			province_id = 2863
			NOT = { has_integrated_gnomish_minority_trigger = yes }
		}
		
		trigger = {
			2863 = { has_integrated_gnomish_minority_trigger = yes }
			dip_power = 100
			adm_power = 100
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_has_insight
				has_country_flag = khug_dwarven_insight
			}
		}
		
		effect = {
			add_adm_power = -100
			add_dip_power = -100
			country_event = { id = flavour_khug.18 }
		}
	}
	
	khugdihr_repair_the_golem = {
		icon = mission_science
		position = 11
		required_missions = {
			khugdihr_sponsor_the_artificers
		}
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_engineers_returned
				has_country_flag = khug_engineer_search_failed
			}
			num_of_estate_privileges = {
				estate = estate_artificers
				value = 4
			}
		}
		
		effect = {
			country_event = { id = flavour_khug.20 }
		}
	}
	
	khugdihr_asra_sunk_cost_fallacy = {
		icon = mission_star_comet
		position = 12
		required_missions = {
			khugdihr_repair_the_golem
		}
		
		provinces_to_highlight = {
			province_id = 4074
			has_province_modifier = expedition_target
		}
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_expedition_2_made 
				4074 = { has_province_flag = khug_expedition_2_created }
			}
			4074 = { NOT = { has_province_modifier = expedition_target } }
		}
		
		effect = {
			country_event = { id = flavour_khug.21 }
		}
	}
}

khugdihr_2_pt_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
		has_country_flag = khugdihr_missions_part_2
	}
	
	khugdihr_finish_western_conquest = {
		icon = mission_west_serpentspine_map
		position = 7
		required_missions = {
			khugdihr_successors_of_asra
		}
		
		provinces_to_highlight = {
			OR = {
				area = amldihr_area
				province_id = 4147
				province_id = 4020
			}
			NOT = { owned_by = ROOT }
		}
		
		trigger = {
			amldihr_area = {
				type = all
				owned_by = ROOT
			}
			4147 = { owned_by = ROOT }
			4020 = { owned_by = ROOT }
		}
		
		effect = {
			add_prestige = 20
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 20
			}
		}
	}
	
	khugdihr_securing_the_capital = {
		icon = fortify_the_passes
		position = 8
		required_missions = {
			khugdihr_finish_western_conquest
		}
		
		provinces_to_highlight = {
			OR = {
				AND = {
					OR = {
						province_id = 2863
						province_id = 2897
					}
					NOT = { province_has_current_tech_fort_trigger = yes }
				}
				AND = {
					province_id = 2897
					NOT = { has_building = ramparts }
				}
			}
		}
		
		trigger = {
			2863 = { province_has_current_tech_fort_trigger = yes }
			2897 = {
				has_building = ramparts
				province_has_current_tech_fort_trigger = yes
			}
		}
		
		effect = {
			2863 = {
				add_permanent_province_modifier = {
					name = khug_defensive_fortifications
					duration = -1
				}
			}
			2897 = {
				add_permanent_province_modifier = {
					name = khug_defensive_fortifications
					duration = -1
				}
			}
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 20
			}
			add_mil_power = 75
		}
	}
	
	khugdihr_sponsor_the_artificers = {
		icon = mission_artificier_experience
		position = 10
		required_missions = {
			khugdihr_gnomish_insight
			khugdihr_reconciliation_with_the_bank
		}
		
		provinces_to_highlight = {
			province_id = 2863
		}
		
		trigger = {
			dip_power = 50
			adm_power = 50
			treasury = 2500
			has_estate = estate_artificers
			estate_loyalty = {
				estate = estate_artificers
				loyalty = 60
			}
		}
		
		effect = {
			add_dip_power = -50
			add_adm_power = -50
			add_treasury = -2500
			mission_reward_artifice_points_5 = yes
		}
	}
	
	khugdihr_the_new_headquarters = {
		icon = mission_early_modern_university
		position = 11
		required_missions = {
			khugdihr_buying_out_the_shareholders
		}
		
		provinces_to_highlight = {
			province_id = 2863
			NOT = { has_dwarven_hold_7 = yes  }
		}
		
		trigger = {
			2863 = { has_dwarven_hold_7 = yes }
			8 = {
				owner = {
					has_opinion = { who = ROOT value = 125 }
					has_25_opinion_sent_gift = { target = ROOT }
				}
			}
		}
		
		effect = {
			country_event = { id = flavour_khug.3 }
			add_adm_power = 75
		}
	}
	
	khugdihr_experiments_in_golems = {
		icon = mission_runeforged_cannons
		position = 12
		required_missions = {
			khugdihr_repair_the_golem
		}
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_has_golem_of_mintbrick
				has_country_modifier = khug_golem_of_mintbrick
			}
			num_artifice_inventions_discovered = { VAL = 5 }
		}
		
		effect = {
			add_prestige = 25
			hidden_effect = { set_country_flag = asra_model_golem_unlocked }
			custom_tooltip = khug_tooltip_asra_model_golem_unlocked
		}
	}
}

khugdihr_3_pt_2 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
		has_country_flag = khugdihr_missions_part_2
	}
	
	khugdihr_the_banker_clans = {
		icon = mission_thinking_king
		position = 7
		required_missions = {
			khugdihr_successors_of_asra
		}
		trigger = {
			if = {
				limit = { has_estate = estate_nobles }
				estate_loyalty = {
					estate = estate_nobles
					loyalty = 60
				}
				NOT = {
					estate_influence = {
						estate = estate_nobles
						influence = 40
					}
				}
			}
			else = {
				mil_power = 50
			}
			if = {
				limit = { has_parliament = yes }
				current_size_of_parliament = 25
				has_active_debate = yes
			}
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
		}
		
		effect = {
			if = {
				limit = { NOT = { has_estate = estate_nobles } }
				add_mil_power = -50
			}
			else = {
				add_estate_loyalty = {
					estate = estate_nobles
					loyalty = -20
				}
				add_estate_influence_modifier = {
					estate = estate_nobles
					desc = khug_tooltip_banker_clans
					influence = 10
					duration = 7300
				}
			}
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = -20
			}
			remove_country_modifier = khug_bank_puppet_strong
			add_country_modifier = {
				name = khug_bank_puppet_weak
				duration = -1
			}
		}
	}
	
	khugdihr_invest_in_the_holds = {
		icon = mission_treasure_room
		position = 8
		required_missions = {
			khugdihr_finish_western_conquest
			khugdihr_the_banker_clans
		}
		
		provinces_to_highlight = {
			owned_by = ROOT
			OR = {
				has_terrain = dwarven_hold
				has_terrain = dwarven_hold_surface
			}
			OR = {
				NOT = {
					AND = {
						province_has_current_tech_fort_trigger = yes
						has_manufactory_trigger = yes
						development = 40
					}
				}
				has_province_modifier = ruined_hold
				has_province_modifier = partially_ruined_hold
				has_province_modifier = damaged_hold
				has_province_modifier = infested_hold
			}
		}
		
		trigger = {
			NOT = {
				any_owned_province = {
					OR = {
						has_terrain = dwarven_hold
						has_terrain = dwarven_hold_surface
					}
					NOT = {
						province_has_current_tech_fort_trigger = yes
						has_manufactory_trigger = yes
						development = 40
					}
					OR = {
						has_province_modifier = ruined_hold
						has_province_modifier = partially_ruined_hold
						has_province_modifier = damaged_hold
						has_province_modifier = infested_hold
					}
				}
			}
		}
		
		effect = {
			add_country_modifier = {
				name = khug_anti_hoardcurse
				duration = 9125
			}
			add_adm_power = 50
		}
	}
	
	khugdihr_reconciliation_with_the_bank = {
		icon = rein_in_the_nobles
		position = 9
		required_missions = {
			khugdihr_invest_in_the_holds
		}
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_hoardcurse_happened
				ROOT = { has_country_flag = hoardcurse_happened }
			}
			NOT = { num_of_loans = 1 }
			is_bankrupt = no
		}
		
		effect = {
			country_event = { id = flavour_khug.7 }
			add_adm_power = 100
		}
	}
	
	khugdihr_buying_out_the_shareholders = {
		icon = mission_war_chest
		position = 10
		required_missions = {
			khugdihr_reconciliation_with_the_bank
			khugdihr_securing_serpentspine_monopoly
		}
		
		trigger = {
			years_of_income = 3
			stability = 1
			if = {
				limit = { has_estate = estate_nobles }
				estate_loyalty = {
					estate = estate_nobles
					loyalty = 60
				}
			}
			else = {
				mil_power = 50
			}
			if = {
				limit = { has_parliament = yes }
				current_size_of_parliament = 30
				has_active_debate = yes
			}
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
		}
		
		effect = {
			add_years_of_income = -3
			remove_country_modifier = khug_bank_puppet_weak
			if = {
				limit = { NOT = { has_estate = estate_nobles } }
				add_mil_power = -50
			}
		}
	}
	
	khugdihr_dwarvonomics = {
		icon = unite_the_league
		position = 11
		required_missions = {
			khugdihr_buying_out_the_shareholders
			khugdihr_return_of_investment
		}
		
		provinces_to_highlight = {
			is_capital = yes
			owner = { is_great_power = yes }
		}
		
		trigger = {
			years_of_income = 5
			calc_true_if = {
				all_known_country = {
					is_great_power = yes
					has_25_opinion_sent_gift = { target = ROOT }
				}
				amount = 3
			}
		}
		
		effect = {
			hidden_effect = {
				every_known_country = {
					add_trust = {
						who = ROOT
						value = 10
					}
				}
			}
			custom_tooltip = khug_tooltip_10_trust_with_world
			add_dip_power = 75
		}
	}
	
	khugdihr_the_face_of_the_reclamation = {
		icon = kingdom_of_lombardy
		position = 12
		required_missions = {
			khugdihr_the_new_headquarters
			khugdihr_dwarvonomics
		}
		
		trigger = {
			years_of_income = 7.5
			total_development = 750
		}
		
		effect = {
			set_government_rank = 3
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 50
			}
			add_country_modifier = {
				name = khug_face_of_the_reclamation
				duration = -1
			}
			country_event = { id = flavour_khug.8 }
		}
	}
}

khugdihr_4_pt_2 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
		has_country_flag = khugdihr_missions_part_2
	}
	
	khugdihr_balgar_ascended_god = {
		icon = mission_pray_light
		position = 7
		required_missions = {
			khugdihr_successors_of_asra
		}
		
		trigger = {
			OR = {
				has_personal_deity = balgar
				religion = corinite
			}
			num_of_owned_provinces_with = {
				has_tax_building_trigger = yes
				value = 20
			}
			estate_influence = {
				estate = estate_church
				influence = 50
			}
		}
		
		effect = {
			add_legitimacy = 20
			add_prestige = 20
			custom_tooltip = khug_tooltip_balgar_is_powered_up
			custom_tooltip = khug_tooltip_balgar_is_powered_up_corinite
			set_country_flag = upgraded_balgar
			hidden_effect = {
				if = {
					limit = { religion = regent_court }
					change_personal_deity = balgar_upgraded
				}
				if = {
					limit = { has_country_flag = balgar_order_picked }
					every_owned_province = {
						if = {
							limit = { holy_order = balgar_order }
							add_permanent_province_modifier = {
								name = corinite_balgar_upgraded
								duration = -1
							}
						}
					}
					clr_country_flag = corinite_mil_order_picked
					country_event = {
						id = corinite.302
						days = 7
					}
				}
			}
		}
	}
	
	khugdihr_balgars_masterpiece = {
		icon = unify_piedmont
		position = 8
		required_missions = {
			khugdihr_balgar_ascended_god
			khugdihr_the_balgaric_union
		}
		
		provinces_to_highlight = {
			OR = {
				AND = {
					OR = {
						area = castonath_area
						province_id = 840
					}
					NOT = { owned_by = Z36 }
				}
				AND = {
					province_id = 840
					NOT = { has_province_modifier = castanorian_citadel }
				}
			}
		}
		
		trigger = {
			castonath_area = {
				type = all
				owned_by = Z36
			}
			840 = {
				owned_by = Z36
				has_province_modifier = castanorian_citadel
			}
		}
		
		effect = {
			840 = {
				if = {
					limit = { Z36 = { primary_culture = iron_dwarf } }
					change_culture = iron_dwarf
				}
				else = {
					change_culture = stone_dwarf
				}
				change_religion = ROOT
				add_province_modifier = {
					name = khug_ancestral_holy_site
					duration = -1
				}
				remove_province_modifier = ravelian_lodge
				remove_province_modifier = ravelian_society
			}
		}
	}
	
	khugdihr_securing_serpentspine_monopoly = {
		icon = mission_sw_torquoise_mining
		position = 9
		required_missions = {
			khugdihr_invest_in_the_holds
			khugdihr_enforcing_regional_stability
		}
		
		provinces_to_highlight = {
			OR = {
				province_id = 2863
				province_id = 4119
			}
		}
		
		trigger = {
			4119 = {
				trade_share = {
					country = ROOT
					share = 95
				}
			}
			OR = {
				AND = {
					2863 = { province_has_center_of_trade_of_level = 3 }
					4119 = { province_has_center_of_trade_of_level = 3 }
				}
				AND = {
					2863 = { has_building = trade_depot }
					4119 = { has_building = trade_depot }
				}
				AND = {
					2863 = { has_building = stock_exchange }
					4119 = { has_building = stock_exchange }
				}
			}
			num_of_trading_bonuses = 2
		}
		
		effect = {
			add_mercantilism = 5
			define_advisor = {
				type = trader
				name = "Thorgrim Asra"
				skill = 3
				culture = agate_dwarf
				discount = yes
				religion = ROOT
			}
		}
	}
	
	khugdihr_return_of_investment = {
		icon = sponsor_the_arts
		position = 9
		required_missions = {
			khugdihr_securing_serpentspine_monopoly
		}
		
		provinces_to_highlight = {
			is_capital = yes
			owner = {
				has_country_flag = khug_helped
				NOT = {
					OR = {
						has_opinion = { who = ROOT value = 50 }
						is_rival = ROOT
					}
				}
			}
		}
		
		trigger = {
			treasury = 5000
			custom_trigger_tooltip = {
				tooltip = khug_tooltip_every_investor_has_50_opinion
				all_known_country = {
					OR = {
						NOT = { has_country_flag = khug_helped }
						OR = {
							has_opinion = { who = ROOT value = 50 }
							is_rival = ROOT
						}
					}
				}
			}
		}
		
		effect = {
			add_treasury = -5000
			every_known_country = {
				limit = {
					has_country_flag = khug_helped
					NOT = { is_rival = ROOT }
				}
				add_treasury = 500  #this just confuses ev. players maybe? maybe a non-issue as youd notice why in a MP setting
				add_opinion = {
					who = ROOT
					modifier = khug_opinion_modifier
				}
			}
			add_country_modifier = {
				name = khug_generous_to_investors
				duration = 9125
			}
		}
	}
	
	khugdihr_the_marrhold_connection = {
		icon = prosper_in_piedmont
		position = 11
		required_missions = {
			khugdihr_protecting_our_trade_interests
		}
		
		provinces_to_highlight = {
			province_id = 4097
			NOT = {
				province_has_current_tech_fort_trigger = yes
				development = 60
			}
		}
		
		trigger = {
			4097 = {
				province_has_current_tech_fort_trigger = yes
				development = 60
			}
		}
		
		effect = {
			add_prestige = 25
			4097 = {
				add_permanent_province_modifier = {
					name = khug_proper_hold
					duration = -1
				}
			}
		}
	}
}

khugdihr_5_pt_2 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = I07
		has_country_flag = khugdihr_missions_part_2
	}
	
	khugdihr_the_balgaric_union = {
		icon = mission_swear_fealty_knight
		position = 7
		required_missions = {
			khugdihr_successors_of_asra
			khugdihr_cannorian_dwarovar_exchange_treaty
		}
		
		trigger = {
			Z36 = {
				trust = { who = ROOT value = 100 }
				has_spy_network_from = { who = ROOT value = 50 }
			}
		}
		
		effect = {
			country_event = { id = flavour_khug.10 }
		}
	}
	
	khugdihr_enforcing_regional_stability = {
		icon = mission_assemble_an_army
		position = 8
		required_missions = {
			khugdihr_the_balgaric_union
		}
		
		provinces_to_highlight = {
			OR = {
				AND = {
					region = inner_castanor_region
					NOT = { owned_by = Z36 }
					NOT = {
						Z36 = {
							num_of_owned_provinces_with = {
								value = 25
								region = inner_castanor_region
							}
						}
					}
				}
				AND = {
					province_id = 849
					NOT = {
						AND = {
							owned_by = Z36
							province_has_current_tech_fort_trigger = yes
							base_manpower = 12
						}
					}
				}
			}
		}
		
		trigger = {
			Z36 = {
				num_of_owned_provinces_with = {
					value = 25
					region = inner_castanor_region
				}
			}
			849 = {
				owned_by = Z36
				province_has_current_tech_fort_trigger = yes
				base_manpower = 12
			}
		}
		
		effect = {
			849 = {
				add_permanent_province_modifier = {
					name = khug_defensive_fortifications
					duration = -1
				}
			}
			steelhyl_area = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
			clouded_wood_area = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
			nortessord_area = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
			esshyl_area = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
			marrhold_area = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
		}
	}
	
	khugdihr_protecting_our_trade_interests = {
		icon = purely_for_commerce
		position = 10
		required_missions = {
			khugdihr_securing_serpentspine_monopoly
		}
		
		provinces_to_highlight = {
			province_id = 4097
			OR = {
				NOT = {
					owned_by = Z36
					owned_by = ROOT
				}
				has_province_modifier = ruined_hold
				has_province_modifier = partially_ruined_hold
				has_province_modifier = damaged_hold
			}
		}
		
		trigger = {
			4097 = {
				OR = {
					owned_by = Z36
					owned_by = ROOT
				}
				NOT = { has_province_modifier = ruined_hold }
				NOT = { has_province_modifier = partially_ruined_hold }
				NOT = { has_province_modifier = damaged_hold }
			}
			dip_power = 200
		}
		
		effect = {
			add_dip_power = -200
			4097 = {
				if = {
					limit = { Z36 = { primary_culture = iron_dwarf } }
					change_culture = iron_dwarf
				}
				else = {
					change_culture = stone_dwarf
				}
				change_religion = owner
			}
		}
	}
	
	khugdihr_escanni_consolidation = {
		icon = consolidate_switzerland
		position = 12
		required_missions = {
			khugdihr_protecting_our_trade_interests
		}
		
		provinces_to_highlight = {
			region = inner_castanor_region
			NOT = { owned_by = Z36 }
		}
		
		trigger = {
			inner_castanor_region = {
				type = all
				owned_by = Z36
			}
			current_age = age_of_absolutism
		}
		
		effect = {
			west_castanor_region = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
			south_castanor_region = {
				limit = {
					NOT = { is_core = Z36 }
					NOT = { is_permanent_claim = Z36 }
				}
				add_permanent_claim = Z36
			}
			if = {
				limit = { Z36 = { is_subject = yes } }
				Z36 = {
					add_country_modifier = {
						name = khug_balgaric_union_solidified
						duration = -1
					}
				}
			}
			else = {
				Z36 = {
					add_country_modifier = {
						name = khug_balgaric_union_strengthened
						duration = -1
					}
				}
				add_country_modifier = {
					name = khug_balgaric_union_strengthened
					duration = -1
				}
			}
		}
	}
}
