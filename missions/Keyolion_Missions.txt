################################################
##           Creator: @DichoMire#1370         ##
################################################

G58_1_missions = { 
	slot = 1
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = G58 }

	G58_1_1_the_new_plantations = {
		icon = mission_sw_yucca_plants
		position = 1
		required_missions = {
		}

		provinces_to_highlight = { 
			area = keyolion_area
			NOT = {
				AND = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}

		trigger = {
			keyolion_area = {
				type = all
				owned_by = ROOT
				is_core = ROOT
			}
		}

		effect = {
			2671 = { #Rgesdeam
				change_trade_goods = sugar
				add_base_production = 2
			}
			2709 = { #Dkhonai
				change_trade_goods = sugar
				add_base_production = 2
			}
			hidden_effect = {
				country_event = {
					id = keyolion_events.3
					days = 365
				}
			}
		}
	}

	G58_1_2_fund_magical_research = {
		icon = mission_che_botanical_exports
		position = 2
		required_missions = { 
			G58_1_1_the_new_plantations
		}

		provinces_to_highlight = { 
			province_id = 2669 #Keyolion
			has_construction = building
		}

		trigger = {
			custom_trigger_tooltip = {
				tooltip = G58_harvest_failure_trigger_tt
				has_country_flag = harvest_failure
			}
			
			estate_loyalty = {
				estate = estate_mages
				loyalty = 40
			}
			has_estate_privilege = estate_mages_patronage_of_the_magical_arts
			treasury = 100
			2669 = { #Keyolion
				NOT = {
					has_construction = building
				}
			}
		}

		effect = {
			2669 = { #Keyolion
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
				add_building_construction = {
					building = mage_tower
					speed = 1
					cost = 0
				}
			}
			add_treasury = -100
		}
	}
	
	G58_1_3_organize_the_agronomers = {
		icon = mission_scholar_officials
		position = 3
		required_missions = {
			G58_1_2_fund_magical_research
		}

		provinces_to_highlight = {
		}

		trigger = {
			reform_level = 2
			adm_power = 50
			has_kheionist_philosophy_basic = {
				type = adm
			}
		}

		effect = {
			hidden_effect = {
				set_country_flag = G58_agronomers_association_flag
			}
			add_adm_power = -50
			add_country_modifier = {
				name = G58_agronomers_reform_modifier
				duration = 7300
			}
			add_government_reform = G58_agronomers_association_reform
		}
	}

	G58_1_4_the_sugar_port = {
		icon = mission_secure_hajj_ports
		position = 4
		required_missions = {
			G58_1_3_organize_the_agronomers
		}

		provinces_to_highlight = {
			province_id = 2669 #Keyolion
			NOT = {
				AND = {
					development = 20
					has_trade_building_trigger = yes
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_dock_building_trigger = yes
				}
			}
		}

		trigger = {
			2669 = { #Keyolion
				development = 20
				has_trade_building_trigger = yes
				OR = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				has_dock_building_trigger = yes
			}
			trade_goods_produced_amount = {
				trade_goods = sugar
				amount = 8
			}
		}

		effect = {
			2669 = { #Keyolion
				if = {
					limit = {
						province_has_center_of_trade_of_level = 1
					}
					if = {
						limit = {
							province_has_center_of_trade_of_level = 2
						}
						add_base_production = 2
					}
					else = {
						add_center_of_trade_level = 1
					}
				}
				else = {
					center_of_trade = 1
				}
			}
			random_owned_province = {
				limit = {
					has_port = yes
				}
				add_unit_construction = {
					type = light_ship
					amount = 5
					speed = 0.75
					cost = 0
				}
			}
		}
	}
	
	G58_1_5_the_sugar_must_flow = {
		icon = mission_dominate_home_trade_node
		position = 5
		required_missions = {
			G58_1_4_the_sugar_port
			G58_2_4_the_institute_of_agronomy
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					region = devand_region
					trade_goods = sugar
					NOT = {
						OR = {
							owned_by = G53
							AND = {
								owned_by = ROOT
								is_core = ROOT
								base_production = 5
								has_production_building_trigger = yes
							}
						}
					}	
				}
				AND = {
					region = alecand_region
					has_terrain = city_terrain
					NOT = {
						owned_by = ROOT
					}
					NOT = {
						ROOT = {
							num_of_owned_provinces_with = {
								value = 2
								region = alecand_region
								has_terrain = city_terrain
							}
						}
					}
				}
			}
		}

		trigger = {
			custom_trigger_tooltip = {
				tooltip = G58_controlling_sugar_trade_trigger_tt
				devand_region = {
					type = all
					OR= {
						NOT = {
							trade_goods = sugar
						}
						owned_by = G53 #Empkeios
						AND = {
							owned_by = ROOT
							is_core = ROOT
							base_production = 5
							has_production_building_trigger = yes
						}
					}
				}
			}
			OR = {
				any_known_country = {
					capital_scope = {
						region = alecand_region
					}
					culture_group = kheionai_ruinborn_elf
					alliance_with = ROOT
					has_opinion = {
						who = ROOT
						value = 150
					}
				}
				num_of_owned_provinces_with = {
					value = 2
					region = alecand_region
					has_terrain = city_terrain
				}
			}
		}

		effect = {
			1741 = { #Kheionai Trade Node
				add_trade_modifier = {
					who = ROOT
					duration = 18250
					power = 10
					key = G58_sugar_monopoly
				}
			}
			hidden_effect = {
				all_owned_province = {
					if = {
						limit = {
							OR = {
								has_province_modifier = G58_sugar_experimental_modifier
								has_province_modifier = G58_sugar_cold_resistant_modifier
								has_province_modifier = G58_sugar_cold_immune_modifier
							}
						}
					}
					add_base_production = 1
				}
			}
			custom_tooltip = G58_the_sugar_must_flow_reward_tt
		}
	}

	G58_1_6_mastering_the_craft = {
		icon = mission_ne_agriculture
		position = 6
		required_missions = {
			G58_1_5_the_sugar_must_flow
			G58_2_5_reaching_new_heights
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					owned_by = ROOT
					NOT = {
						OR = {
							trade_goods = gold
							trade_goods = sugar
						}
					}
					has_terrain = mountain
					OR = {
						has_winter = mild_winter
						has_winter = normal_winter
					}
					NOT = {
						AND = {
							base_production = 6
							has_production_building_trigger = yes
							has_building = mage_tower
						}
					}
				}
				AND = {
					owned_by = ROOT
					has_province_modifier = G58_sugar_cold_resistant_modifier
					NOT = {
						AND = {
							base_production = 6
							has_production_building_trigger = yes
						}
					}
				}
			}
		}

		trigger = {
			OR = {
				trading_bonus = {
					trade_goods = sugar
					value = yes
				}
				production_leader = {
					trade_goods = sugar
				}
			}
			# estate_loyalty = {
			# 	estate = estate_mages
			# 	loyalty = 60
			# }
			# estate_influence = {
			# 	estate = estate_mages
			# 	influence = 30
			# }
			advisor = court_mage
			any_owned_province = {
				NOT = {
					OR = {
						trade_goods = sugar
						trade_goods = gold
					}
				}
				has_terrain = mountain
				OR = {
					has_winter = mild_winter
					has_winter = normal_winter
				}
				base_production = 6
				has_production_building_trigger = yes
				has_building = mage_tower
			}
			custom_trigger_tooltip = {
				tooltip = G58_mastering_the_craft_req_1_tt
				all_owned_province = {
					if = {
						limit = {
							has_province_modifier = G58_sugar_cold_resistant_modifier
						}
						base_production = 6
						has_production_building_trigger = yes
					}
				}
			}
		}

		effect = {
			custom_tooltip = G58_mastering_the_craft_reward_tt
			hidden_effect = {
				keyolion_mastering_the_craft_se = yes
				keyolion_mastering_the_craft_se = yes
			}
			country_event = {
				id = keyolion_events.7
			}
		}
	}
}

G58_2_missions = { 
	slot = 2
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = G58 }

	G58_2_1_collect_a_sample = {
		icon = colonize_the_cape
		position = 1
		required_missions = { 
		}

		provinces_to_highlight = {
			region = devand_region
			has_terrain = drylands
			NOT = {
				AND = {
					transports_in_province = 3
					transports_in_province = ROOT
					OR = {
						num_of_units_in_province = {
							who = ROOT
							amount = 3
						}
					}
				}
			}
		}

		trigger = {
			devand_region = {
				has_terrain = drylands
				custom_trigger_tooltip = {
					tooltip = G58_collecting_a_sample_tt
					hidden_trigger = {
						transports_in_province = 3
						transports_in_province = ROOT
					}
				} 
				OR = {
					num_of_units_in_province = {
						who = ROOT
						amount = 3
					}
					custom_trigger_tooltip = {
						tooltip = G58_collecting_a_sample_gift_tt
						ROOT = {
							treasury = 10
						}
					}
				}
			}
		}

		effect = {
			if = {
				limit = {
					NOT = {
						devand_region = {
							has_terrain = drylands
							custom_trigger_tooltip = {
								tooltip = G58_collecting_a_sample_tt
								hidden_trigger = {
									transports_in_province = 3
									transports_in_province = ROOT
								}
							} 
							OR = {
								num_of_units_in_province = {
									who = ROOT
									amount = 3
								}
							}
						}
					}
				}
				add_treasury = -10
				#A little lesson in trickery:
				#We should be adding 10 cash to the AI, but that can lead to jank, so we don't 
			}
			2670 = { #Poroga
				add_permanent_province_modifier = {
					name = G58_studying_sample_modifier
					duration = 1825
				}
			}
			country_event = {
				id = keyolion_events.4
				days = 365
			}
		}
	}
	
	G58_2_2_the_arpedifer_technique = {
		icon = bohemian_crystal
		position = 2
		required_missions = {
			G58_2_1_collect_a_sample 
		}

		provinces_to_highlight = {
			province_id = 2728 #Arpedifer
			NOT = {
				OR = {
					owned_by = ROOT
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 50
						}
					}
				}
			}
		}

		trigger = {
			2728 = { #Arpedifer
				OR = {
					owned_by = ROOT
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 50
						}
					}
				}

			}
			dip_power = 100
		}

		effect = {
			2670 = { #Poroga
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
				if = {
					limit = {
						has_province_modifier = G58_poroga_local_upstart_modifier
					}
					remove_province_modifier = G58_poroga_local_upstart_modifier
				}
				add_province_modifier = {
					name = G58_poroga_experienced_crafters_modifier
					duration = -1
				}
			}
			add_dip_power = -100
		}
	}
	
	G58_2_3_ramp_up_production = {
		icon = mission_have_manufactories
		position = 3
		required_missions = { 
			G58_2_2_the_arpedifer_technique
		}

		provinces_to_highlight = {
			province_id = 2670 #Poroga
			NOT = {
				AND = {
					has_trade_building_trigger = yes
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					base_production = 8
				}
			}
		}

		trigger = {
			2670 = { #Poroga
				has_trade_building_trigger = yes
				OR = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				base_production = 8
			}
		}

		effect = {
			add_country_modifier = {
				name = G58_building_with_glass_modifier
				duration = -1
			}
			2670 = { #Poroga
				if = {
					limit = {
						has_province_modifier = G58_poroga_experienced_crafters_modifier
					}
					remove_province_modifier = G58_poroga_experienced_crafters_modifier
				}
				add_permanent_province_modifier = {
					name = G58_poroga_organized_guilds_modifier
					duration = -1
				}
			}
		}
	}
	
	G58_2_4_the_institute_of_agronomy = {
		icon = mission_rb_trinity_college_dublin
		position = 4
		required_missions = { 
			G58_1_3_organize_the_agronomers
			G58_2_3_ramp_up_production
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					province_id = 2671 #Rgesdeam
					has_construction = building
				}
				AND = {
					province_id = 2709 #Dkhonani
					has_construction = building
				}
			}
		}

		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 50
			}
			has_kheionist_philosophy_basic = {
				type = adm
			}
			treasury = 200
			crown_land_share = 20
			2671 = { #Rgesdeam
				NOT = {
					has_construction = building
				}
			}
			2709 = { #Dkhonani
				NOT = {
					has_construction = building
				}
			}
		}

		effect = {
			2709 = { #Dkhonani
				add_building_construction = {
					building = mage_tower
					speed = 0.6
					cost = 0
				}
			}
			2671 = { #Dkhonani
				add_building_construction = {
					building = mage_tower
					speed = 0.6
					cost = 0
				}
			}
			add_treasury = -200
			change_estate_land_share = {
				estate = estate_mages
				share = 10
			}
			2669 = { #Keyolion
				add_permanent_province_modifier = {
					name = G58_institute_of_agronomy_modifier
					duration = -1
				}
			}
			keyolion_area = {
				limit = {
					NOT = {
						province_id = 2669 #Keyolion
					}
				}
				hidden_effect = {
					add_permanent_province_modifier = {
						name = G58_institute_of_agronomy_manufactories_modifier
						duration = -1
					}
				}
			}
			country_event = {
				id = keyolion_events.5
			}
		}
	}
	

	G58_2_5_reaching_new_heights = {
		icon = mission_potosi_silver
		position = 5
		required_missions = {
			G58_2_4_the_institute_of_agronomy
			G58_3_4_secure_raw_materials
		}

		provinces_to_highlight = {  
			OR = {
				AND = {
					province_id = 2669 #Keyolion
					NOT = {
						development = 20
					}
				}
				AND = {
					owned_by = ROOT
					NOT = {
						trade_goods = sugar
					}
					OR = {
						has_terrain = hills
						has_terrain = highlands
						has_terrain = mountain
					}
					NOT = {
						OR = {
							has_winter = mild_winter
							has_winter = normal_winter
							has_winter = severe_winter
						}
					}
					NOT = {
						base_production = 3
					}
				}
				AND = {
					owned_by = ROOT
					NOT = {
						trade_goods = sugar
					}
					OR = {
						has_terrain = hills
						has_terrain = highlands
						has_terrain = mountain
					}
					OR = {
						has_winter = mild_winter
						has_winter = normal_winter
						has_winter = severe_winter
					}
					NOT = {
						base_production = 3
					}
				}
			}
			
		}

		trigger = {
			2669 = { #Keyolion
				development = 20
			}
			num_of_owned_provinces_with = {
				value = 2
				is_core = ROOT
				AND = {
					NOT = {
						trade_goods = sugar
					}
					OR = {
						has_terrain = hills
						has_terrain = highlands
						has_terrain = mountain
					}
					custom_trigger_tooltip = {
						tooltip = G58_weather_is_not_winter_trigger_tt
						NOT = {
							OR = {
								has_winter = mild_winter
								has_winter = normal_winter
								has_winter = severe_winter
							}
						}
					}
				}
				base_production = 3
			}
			num_of_owned_provinces_with = {
				value = 1
				is_core = ROOT
				AND = {
					NOT = {
						trade_goods = sugar
					}
					has_terrain = mountain
					OR = {
						has_winter = mild_winter
						has_winter = normal_winter
					}
				}
				base_production = 3
			}
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
			estate_influence = {
				estate = estate_mages
				influence = 30
			}
		}

		effect = {
			custom_tooltip = G58_reaching_new_heights_tt
			hidden_effect = {
				random_owned_province = {
					limit = {
						NOT = {
							trade_goods = sugar
						}
						AND = {
							OR = {
								has_terrain = hills
								has_terrain = highlands
								has_terrain = mountain
							}
							NOT = {
								OR = {
									has_winter = mild_winter
									has_winter = normal_winter
									has_winter = severe_winter
								}
							}
						}
						base_production = 3
					}
					change_trade_goods = sugar
					add_base_production = 3
					add_permanent_province_modifier = {
						name = G58_sugar_experimental_modifier
						duration = -1
					}
				}
				random_owned_province = {
					limit = {
						NOT = {
							trade_goods = sugar
						}
						AND = {
							OR = {
								has_terrain = hills
								has_terrain = highlands
								has_terrain = mountain
							}
							NOT = {
								OR = {
									has_winter = mild_winter
									has_winter = normal_winter
									has_winter = severe_winter
								}
							}
						}
						base_production = 3
					}
					change_trade_goods = sugar
					add_base_production = 3
					add_permanent_province_modifier = {
						name = G58_sugar_experimental_modifier
						duration = -1
					}
				}
				random_owned_province = {
					limit = {
						NOT = {
							trade_goods = sugar
						}
						AND = {
							has_terrain = mountain
							OR = {
								has_winter = mild_winter
								has_winter = normal_winter
							}
						}
						base_production = 3
					}
					change_trade_goods = sugar
					add_permanent_province_modifier = {
						name = G58_sugar_experimental_modifier
						duration = -1
					}
				}
			}
			country_event = {
				id = keyolion_events.6
			}
		}
	}
}


G58_3_missions = { 
	slot = 3
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = G58 }

	G58_3_2_find_a_supporter = {
		icon = mission_alliances
		position = 2
		required_missions = { 
			G58_4_1_the_slave_trade
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					region = alecand_region
					is_capital = yes
					owner = {
						NOT = {
							OR = {
								tag = G60
								tag = G47
								tag = G51
							}
						}
						NOT = {
							AND = {
								has_opinion = {
									who = ROOT
									value = 100
								}
								is_supporting_independence_of = ROOT
							}
						}
					}
				}
				AND = {
					is_capital_of = G47
					owner = {
						NOT = {
							OR = {
								has_opinion_modifier = {
									modifier = insulted
									who = ROOT
								}
								has_opinion_modifier = {
									modifier = scornfully_insulted
									who = ROOT
								}
							}
						}
					}
				}
			}
			
		}

		trigger = {
			custom_trigger_tooltip = {
				tooltip = G58_overlords_intervene_trigger_tt
				has_country_flag = G58_overlords_intervene_flag
			}
			G47 = { #Oktikheion
				OR = {
					has_opinion_modifier = {
						modifier = insulted
						who = ROOT
					}
					has_opinion_modifier = {
						modifier = scornfully_insulted
						who = ROOT
					}
				}
			}
			any_known_country = {
				capital_scope = {
					region = alecand_region
				}
				NOT = {
					tag = G51 #Arpedifer
				}
				has_opinion = {
					who = ROOT
					value = 100
				}
				is_supporting_independence_of = ROOT
			}
        }

		effect = {
			if = {
				limit = {
					is_year = 1470
				}
				add_country_modifier = {
					name = G58_war_support_tax_2_modifier
					duration = 3650
				}
			}
			else = {
				add_country_modifier = {
					name = G58_war_support_tax_modifier
					duration = 3650
				}
				custom_tooltip = G58_find_supporter_tt
			}
		}	
	}

	G58_3_3_the_dhanam_port = {
		icon = mission_caribbean_cn
		position = 3
		required_missions = { 
			G58_2_2_the_arpedifer_technique
		}

		provinces_to_highlight = {
			province_id = 2598 #Dhanam
			NOT = {
				AND = {
					owned_by = G58
					is_core = G58
				}
			}
		}

		trigger = {
			owns_core_province = 2598 #Dhanam
		}

		effect = {
			elokos_area = {
				add_permanent_claim = ROOT
			}
			2597 = { #Kheilokos
				add_permanent_claim = ROOT
			}
			2598 = { #Dhanam
				add_permanent_province_modifier = {
					name = G58_dhanam_port_modifier
					duration = 9125
				}
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
		}
	}

	G58_3_4_secure_raw_materials = {
		icon = overseas_empire
		position = 4
		required_missions = {
			G58_2_3_ramp_up_production
			G58_3_3_the_dhanam_port
			G58_4_3_gain_our_freedom
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					owned_by = G58
					region = devand_region
					has_terrain = drylands
					NOT = {
						AND = {
							has_production_building_trigger = yes
							development = 8
						}
					}
				}
				AND = {
					province_id = 2598 #Dhanam
					NOT = {
						AND = {
							has_trade_building_trigger = yes
							has_dock_building_trigger = yes
							development = 15
						}
					}
				}
				AND = {
					province_id = 2670 #Poroga
					NOT = {
						AND = {
							has_dock_building_trigger = yes
							development = 20
						}
					}
				}
			}
		}

		trigger = {
			any_owned_province = {
				region = devand_region
				has_terrain = drylands
				has_production_building_trigger = yes
				development = 8
			}
			2598 = { #Dhanam
				has_trade_building_trigger = yes
				has_dock_building_trigger = yes
				development = 15
			}
			2670 = { #Poroga
				has_dock_building_trigger = yes
				development = 20
			}
		}

		effect = {
			2670 = { #Poroga
				remove_province_modifier = G58_poroga_organized_guilds_modifier
				add_permanent_province_modifier = {
					name = G58_poroga_mass_production_modifier
					duration = -1
				}
			}
			random_owned_province = {
				limit = {
					region = devand_region
					has_terrain = drylands
					is_core = ROOT
					has_production_building_trigger = yes
					development = 8
				}
				add_permanent_province_modifier = {
					name = G58_devand_growing_province_modifier
					duration = 9125
				}
			}
		}
	}

	G58_3_5_the_twin_capital = {
		icon = imperial_capitals
		position = 5
		required_missions = {
			G58_3_4_secure_raw_materials
		}

		provinces_to_highlight = {  
			OR = {
				AND = {
					province_id = 2669 #Keyolion
					NOT = {
						AND = {
							development = 30
							has_trade_building_trigger = yes
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_dock_building_trigger = yes
							has_shipyard_building_trigger = yes
							has_manpower_building_trigger = yes
						}
					}
				}
				AND = {
					province_id = 2670
					NOT = {
						AND = {
							development = 30
							has_trade_building_trigger = yes
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_dock_building_trigger = yes
							has_shipyard_building_trigger = yes
							has_manpower_building_trigger = yes
							NOT = {
								has_construction = building
							}
						}
					}
				}
			}
		}

		trigger = {
			has_kheionist_philosophy_basic = {
				type = adm
			}
			2669 = { #Keyolion
				development = 30
				has_trade_building_trigger = yes
				OR = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				has_dock_building_trigger = yes
				has_shipyard_building_trigger = yes
				has_manpower_building_trigger = yes
			}
			2670 = { #Poroga
				development = 30
				has_trade_building_trigger = yes
				OR = {
					has_production_building_trigger = yes
					trade_goods = gold
				}
				has_dock_building_trigger = yes
				has_shipyard_building_trigger = yes
				has_manpower_building_trigger = yes
				NOT = {
					has_construction = building
				}
			}
		}

		effect = {
			custom_tooltip = G58_the_twin_capital_tt
			if = {
				limit = {
					mission_completed = G58_5_5_unite_the_nekheis
					exists = G53
				}
				country_event = {
					id = keyolion_events.12
				}
			}

			add_republican_tradition = 10
			2669 = { #Keyolion
				remove_province_modifier = G58_coastal_urbanization_modifier
				add_permanent_province_modifier = {
					name = G58_coastal_urban_center_modifier
					duration = -1
				}
			}
			2670 = { #Poroga
				remove_province_modifier = G58_coastal_urbanization_modifier
				add_permanent_province_modifier = {
					name = G58_coastal_urban_center_modifier
					duration = -1
				}
				add_building_construction = {
					building = state_house
					speed = 1
					cost = 0
				}
			}
		}
	}

	G58_3_6_coastal_utopia = {
		icon = develop_provence
		position = 6
		required_missions = {
			G58_3_5_the_twin_capital
			G58_4_5_build_up_the_north
		}

		provinces_to_highlight = {
			owned_by = ROOT
			OR = {
				has_province_modifier = G58_coastal_urbanization_modifier
				has_province_modifier = G58_coastal_urban_center_modifier
			}
			NOT = {
				AND = {
					development = 30
					has_trade_building_trigger = yes
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_manpower_building_trigger = yes
				}
			}
		}

		trigger = {
			mission_completed = G58_5_6_build_up_the_south
			has_kheionist_philosophy_basic = {
				type = adm
			}
				
			custom_trigger_tooltip = {
				tooltip = G58_coastal_utopia_trigger_tt
				all_owned_province = {
					if = {
						limit = {
							OR = {
								has_province_modifier = G58_coastal_urbanization_modifier
								has_province_modifier = G58_coastal_urban_center_modifier
							}
						}
						development = 30
						has_trade_building_trigger = yes
						OR = {
							has_production_building_trigger = yes
							trade_goods = gold
						}
						has_manpower_building_trigger = yes
					}
				}
			}
		}

		effect = {
			custom_tooltip = G58_coastal_utopia_reward_tt
			hidden_effect = {
				2595 = { #Empkeios
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
				2598 = { #Dhanam
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
				2674 = { #Eneion
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
				2677 = { #Besolaki
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
				2680 = { #Apikhoxi
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
				2684 = { #Amgremos
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
				2625 = { #Deyeion
					remove_province_modifier = G58_coastal_urbanization_modifier
					add_permanent_province_modifier = {
						name = G58_coastal_urban_center_modifier
						duration = -1
					}
				}
			}
			if = {
				limit = {
					economic_ideas = 1
				}
				# I hate that I did this instead of every_owned_province limit 
				# has_province_modifier = coastal_urban_center, but hey, at least it's 1 nanosecond 
				# more efficient
				hidden_effect = {
					2595 = { #Empkeios
						add_base_tax = 1
						add_base_production = 1
					}
					2669 = { #Keyolion
						add_base_tax = 1
						add_base_production = 1
					}
					2670 = { #Poroga
						add_base_tax = 1
						add_base_production = 1
					}
					2598 = { #Dhanam
						add_base_tax = 1
						add_base_production = 1
					}
					2674 = { #Eneion
						add_base_tax = 1
						add_base_production = 1
					}
					2677 = { #Besolaki
						add_base_tax = 1
						add_base_production = 1
					}
					2680 = { #Empkeios
						add_base_tax = 1
						add_base_production = 1
					}
					2684 = { #Apikhoxi
						add_base_tax = 1
						add_base_production = 1
					}
					2625 = { #Deyeion
						add_base_tax = 1
						add_base_production = 1
					}
				}
				custom_tooltip = G58_coastal_utopia_reward3_tt
			}
			hidden_effect = {
				add_country_modifier = {
					name = G58_coastal_utopia_modifier
					duration = 18250
				}
			}
			custom_tooltip = G58_coastal_utopia_reward2_tt
		}
	}
}

G58_4_missions = { 
	slot = 4
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = G58 }

	G58_4_1_the_slave_trade = {
		icon = mission_colonise_brazil
		position = 1
		required_missions = { 
		}

		provinces_to_highlight = {  
			OR = {
				AND = {
					province_id = 1712 #Axehead Gulf
					NOT = {
						AND = {
							light_ships_in_province = ROOT
							light_ships_in_province = 2
						}
					}
				}
				AND = {
					province_id = 2595 #Empkeios
					NOT = {
						OR = {
							owned_by = ROOT
							owner = {
								has_opinion = {
									who = ROOT
									value = 50
								}
							}
						}
					}
				}
			}
		}

		trigger = {
			has_kheionist_philosophy_basic = {
				type = dip
			}
			1712 = { #Axehead Gulf
				custom_trigger_tooltip = {
					tooltip = G58_slave_trade_tt
					hidden_trigger = {
						light_ships_in_province = ROOT
						light_ships_in_province = 2
					}
				}
			}
			2595 = { #Empkeios
				OR = {
					owned_by = ROOT
					owner = {
						has_opinion = {
							who = ROOT
							value = 50
						}
					}
				}
			}
		}

		effect = {
			2669 = { #Keyolion
				add_permanent_province_modifier = {
					name = G58_slave_trade_keyo_full_modifier
					duration = 18250
				}
			}
			hidden_effect = {
				country_event = {
					id = keyolion_events.300
					days = 1095
				}
			}
			if = {
				limit = {
					exists = G58
				}
				G53 = {
					country_event = {
						id = keyolion_events.102
					}
				}
			}
			add_prestige = 10
		}
	}
	
	G58_4_2_independence_plot = {
		icon = mission_abolish_mestnichestvo
		position = 2
		required_missions = { 
			G58_4_1_the_slave_trade
		}

		provinces_to_highlight = {  
		}

		trigger = {
			custom_trigger_tooltip = {
				tooltip = G58_overlords_intervene_trigger_tt
				has_country_flag = G58_overlords_intervene_flag
			}
			OR = {
				OR = {
					advisor = diplomat
					advisor = statesman
					dip_power = 50
				}
				NOT = {
					exists = G53 #Empkeios
				}
			}
		}

		effect = {
			custom_tooltip = G58_independence_war_quality_bonus_tt
			if = {
				limit = {
					exists = G53 #Empkeios
				}
				G53 = {
					country_event = {
						id = keyolion_events.103
					}
				}
				if = {
					limit = {
						NOT = {
							OR = {
								advisor = diplomat
								advisor = statesman
							}
						}
					}
					add_dip_power = -50
				}
			}
			else = {
				empkeios_area = {
					limit = {
						is_core = G53 #Empkeios
					}
					hidden_effect = {
						add_permanent_claim = ROOT
					}
				}
			}
		}
	}

	G58_4_3_gain_our_freedom = {
		icon = mission_monarch_in_throne_room
		position = 3
		required_missions = {
			G58_3_2_find_a_supporter
			G58_4_2_independence_plot
			G58_5_2_bolster_an_army
		}

		provinces_to_highlight = {  
		}

		trigger = {
			is_subject = no
			is_at_war = no
		}

		effect = {
			add_stability = 1
			eneion_area = {
				add_permanent_claim = ROOT
			}
			besolaki_area = {
				add_permanent_claim = ROOT
			}
			if = {
				limit = {
					G53 = { #Empkeios
						has_country_flag = G58_joined_independence_war_flag
					}
				}
				2669 = { #Keyolion
					remove_province_modifier = G58_slave_trade_keyo_half_modifier
					add_permanent_province_modifier = {
						name = G58_slave_trade_keyo_full_modifier
						duration = 18250
					}
				}
				#TODO - This should become an event that Empkeios clicks to notify them of the modifier.
				#When Empkeios MT gets done.
				hidden_effect = {
					2595 = { #Empkeios
						remove_province_modifier = G58_slave_trade_empk_half_modifier
						add_permanent_province_modifier = {
							name = G58_slave_trade_empk_full_modifier
							duration = 18250
						}
					}
				}
			}
			else = {
				add_country_modifier = {
					name = G58_solo_independence_war_modifier
					duration = 9125
				}
				custom_tooltip = G58_independence_war_rewards_tt
			}
		}
	}

	G58_4_4_the_northern_brethren = {
		icon = mission_swedish_peasantry
		position = 4
		required_missions = {
			G58_4_3_gain_our_freedom
		}

		provinces_to_highlight = {  
			province_id = 2595 #Empkeios
			NOT = {
				OR = {
					AND = {
						owned_by = G58
						is_core = G58
					}
					AND = {
						owner = {
							is_vassal = no
							alliance_with = ROOT
							owns_core_province = 2595 #Empkeios
							trust = {
								who = ROOT
								value = 85
							}
							has_opinion = {
								who = ROOT
								value = 150
							}
						}
					}
				}
			}
		}

		trigger = {
			OR = {
				owns_core_province = 2595 #Empkeios
				G53 = {
					is_vassal = no
					alliance_with = ROOT
					owns_core_province = 2595 #Empkeios
					trust = {
						who = ROOT
						value = 85
					}
					has_opinion = {
						who = ROOT
						value = 150
					}
				}
			}
			treasury = 100
		}

		effect = {
			custom_tooltip = G58_northern_brethren_dev_tt
			hidden_effect = {
				for = { 
					amount = 6
						effect = " 
							random_owned_province = {
								limit = { 
									trade_goods = sugar
								}
								add_base_production = 1
							}
						"
				}
			}
			2595 = { #Empkeios
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
			add_treasury = -100
		}
	}

	G58_4_5_build_up_the_north = {
		icon = public_works
		position = 5
		required_missions = {
			G58_4_4_the_northern_brethren
			G58_5_4_the_southern_threats
		}

		provinces_to_highlight = {  
			OR = {
				AND = {
					area = eneion_area
					devastation = 0.01
				}
				AND = {
					province_id = 2674 #Eneion
					NOT = {
						AND = {
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_trade_building_trigger = yes
							has_manpower_building_trigger = yes
						}
					}
				}
				AND = {
					area = besolaki_area
					devastation = 0.01
				}
				AND = {
					province_id = 2677 #Besolaki
					NOT = {
						AND = {
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_trade_building_trigger = yes
							has_manpower_building_trigger = yes
						}
					}
				}
			}
		}

		trigger = {
			AND = {
				eneion_area = {
					type = all
					NOT = {
						devastation = 0.01
					}
				}
				2674 = { #Eneion
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_trade_building_trigger = yes
					has_manpower_building_trigger = yes
				}
			}
			AND = {
				besolaki_area = {
					type = all
					NOT = {
						devastation = 0.01
					}
				}
				2677 = { #Besolaki
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_trade_building_trigger = yes
					has_manpower_building_trigger = yes
				}
			}
		}

		effect = {
			2674 = { #Eneion
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
			2677 = { #Besolaki
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
		}
	}
}

G58_5_missions = { 
	slot = 5
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = G58 }

	G58_5_1_the_keyolioni_militia = {
		icon = dom_ara_remensa_war
		position = 1
		required_missions = { 
		}

		provinces_to_highlight = {  
			if = {
				limit = {
					has_dlc = "Mandate of Heaven"
				}
				province_id = 2669 #Keyolion
				NOT = {
					AND = {
						has_state_edict = edict_promote_military_recruitment
						NOT = {
							has_construction = building
						}
					}
				}
			}
			else = {
				province_id = 2669 #Keyolion
				has_construction = building
			}
		}

		trigger = {
			has_kheionist_philosophy_basic = { 
				type = mil
			}
			army_size_percentage = 1
			if = {
				limit = {
					has_dlc = "Mandate of Heaven"
				}
				2669 = { #Keyolion
					has_state_edict = edict_promote_military_recruitment
					NOT = {
						has_construction = building
					}
				}
			}
			else = {
				has_estate_privilege = estate_nobles_levies
				2669 = { #Keyolion
					NOT = {
						has_construction = building
					}
				}
			}
		}

		effect = {
			2669 = { #Keyolion
				add_permanent_province_modifier = {
					name = G58_keyolioni_militia_modifier
					duration = 7300
				}
				if = {
					limit = {
						2669 = {
							has_manpower_building_trigger = yes
						}
					}
					ROOT = {
						add_country_modifier = {
							name = G58_keyolioni_militia_alternative_modifier
							duration = 7300
						}
					}
				}
				else = {
					add_building_construction = {
						building = barracks
						speed = 2
						cost = 0
					}
				}
			}
		}
	}

	G58_5_2_bolster_an_army = {
		icon = mission_assemble_an_army
		position = 2
		required_missions = { 
			G58_4_1_the_slave_trade
			G58_5_1_the_keyolioni_militia
		}

		provinces_to_highlight = {
			province_id = 2669 #Keyolion
			NOT = {
				AND = {
					num_of_units_in_province = {
						who = ROOT
						amount = 5
					}
					unit_has_leader = yes
				}
			}
		}

		trigger = {
			OR = {
				employed_advisor = {
					category = MIL
				}
				mil_power = 50
			}
			2669 = { #Keyolion
				custom_trigger_tooltip = {
					tooltip = G58_independence_war_troops_bonus_trigger_tt
					AND = {
						num_of_units_in_province = {
							who = ROOT
							amount = 5
						}
						unit_has_leader = yes
					}
				}
			}
		}

		effect = {
			add_country_modifier = {
				name = G58_bolster_an_army_modifier
				duration = 7300
			}
			custom_tooltip = G58_independence_war_troops_bonus_tt
			if = {
				limit = {
					NOT = {
						employed_advisor = {
							category = MIL
						}
					}
				}
				add_mil_power = -50
			}
		}
	}

	G58_5_3_soldiers_by_law = {
		icon = mission_modern_knight_army
		position = 3
		required_missions = {
			G58_5_2_bolster_an_army
		}

		provinces_to_highlight = {  
			if = {
				limit = {
					has_dlc = "Mandate of Heaven"
				}
				OR = {
					AND = {
						area = keyolion_area
						NOT = {
							keyolion_area = {
								has_manpower_building_trigger = yes
								has_state_edict = edict_promote_military_recruitment
							}
						}
					}
					AND = {
						area = elokos_area
						NOT = {
							elokos_area = {
								has_manpower_building_trigger = yes
								has_state_edict = edict_promote_military_recruitment
							}
						}
					}
					AND = {
						area = dtsiaerh_area
						NOT = {
							dtsiaerh_area = {
								has_manpower_building_trigger = yes
								has_state_edict = edict_promote_military_recruitment
							}
						}
					}
				}
			}
			else = {
				OR = {
					AND = {
						area = keyolion_area
						NOT = {
							keyolion_area = {
								has_manpower_building_trigger = yes
							}
						}
					}
					AND = {
						area = elokos_area
						NOT = {
							elokos_area = {
								has_manpower_building_trigger = yes
							}
						}
					}
					AND = {
						area = dtsiaerh_area
						NOT = {
							dtsiaerh_area = {
								has_manpower_building_trigger = yes
							}
						}
					}
				}
			}
		}

		trigger = {
			num_of_owned_provinces_with = {
				value = 10
				is_core = ROOT
			}
			if = {
				limit = {
					has_dlc = "Mandate of Heaven"
				}
				keyolion_area = {
					type = any
					has_manpower_building_trigger = yes
					has_state_edict = edict_promote_military_recruitment
				}
				elokos_area = {
					type = any
					has_manpower_building_trigger = yes
					has_state_edict = edict_promote_military_recruitment
				}
				dtsiaerh_area = {
					type = any
					has_manpower_building_trigger = yes
					has_state_edict = edict_promote_military_recruitment
				}
			}
			else = {
				keyolion_area = {
					type = any
					has_manpower_building_trigger = yes
				}
				elokos_area = {
					type = any
					has_manpower_building_trigger = yes
				}
				dtsiaerh_area = {
					type = any
					has_manpower_building_trigger = yes
				}
			}
		}

		effect = {
			custom_tooltip = G58_compulsory_military_service_areas2_tt
			random_owned_province = {
				limit = {
					area = keyolion_area
					has_manpower_building_trigger = yes
				}
				add_base_manpower = 2
			}
			random_owned_province = {
				limit = {
					area = elokos_area
					has_manpower_building_trigger = yes
				}
				add_base_manpower = 2
			}
			random_owned_province = {
				limit = {
					area = dtsiaerh_area
					has_manpower_building_trigger = yes
				}
				add_base_manpower = 2
			}
			add_country_modifier = {
				name = G58_compulsory_military_service_1_modifier
				duration = -1
			}
		}
	}

	G58_5_4_the_southern_threats = {
		icon = qng_ten_grand_campaigns
		position = 4
		required_missions = {
			G58_4_3_gain_our_freedom
			G58_5_3_soldiers_by_law
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					area = eneion_area
					NOT = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
				AND = {
					area = besolaki_area
					NOT = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
			}
		}

		trigger = {
			eneion_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			besolaki_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}

		effect = {
			country_event = {
				id = keyolion_events.10
			}
			apikhoxi_area = {
				add_permanent_claim = ROOT
			}
			amgremos_area = {
				add_permanent_claim = ROOT
			}
			eiongremos_area = {
				add_permanent_claim = ROOT
			}
			deyeion_area = {
				add_permanent_claim = ROOT
			}
			add_prestige = 20
		}
	}

	G58_5_5_unite_the_nekheis = {
		icon = mission_unite_home_region
		position = 5
		required_missions = {
			G58_5_4_the_southern_threats
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					area = apikhoxi_area
					NOT = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
				AND = {
					area = amgremos_area
					NOT = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
				AND = {
					area = deyeion_area
					NOT = {
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
				AND = {
					province_id = 2684 #Amgremos
					has_construction = building
				}
			}
		}

		trigger = {
			apikhoxi_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			amgremos_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			deyeion_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			treasury = 50
			2684 = { #Amgremos
				NOT = {
					has_construction = building
				}
			}	
		}

		effect = {
			custom_tooltip = G58_unite_the_nekheis_tt
			if = {
				limit = {
					mission_completed = G58_3_5_the_twin_capital
					exists = G53
				}
				country_event = {
					id = keyolion_events.12
				}
			}
			country_event = {
				id = keyolion_events.11
			}
			add_prestige = 10
		}
	}

	G58_5_6_build_up_the_south = {
		icon = mission_pol_develop_countryside
		position = 6
		required_missions = {
			G58_4_5_build_up_the_north
			G58_5_5_unite_the_nekheis
		}

		provinces_to_highlight = {
			OR = {
				AND = {
					area = apikhoxi_area
					devastation = 0.01
				}
				AND = {
					province_id = 2680 #Apikhoxi
					NOT = {
						AND = {
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_trade_building_trigger = yes
							has_manpower_building_trigger = yes
						}
					}
				}
				AND = {
					area = deyeion_area
					devastation = 0.01
				}
				AND = {
					province_id = 2625 #Deyeion
					NOT = {
						AND = {
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_trade_building_trigger = yes
							has_manpower_building_trigger = yes
						}
					}
				}
				AND = {
					area = deyeion_area
					devastation = 0.01
				}
				AND = {
					province_id = 2684 #Amgremos
					NOT = {
						AND = {
							OR = {
								has_production_building_trigger = yes
								trade_goods = gold
							}
							has_dock_building_trigger = yes
							has_shipyard_building_trigger = yes
						}
					}
				}
			} 
		}

		trigger = {
			num_of_owned_provinces_with = {
				value = 1
				has_forcelimit_building_trigger = yes
			}
			AND = {
				apikhoxi_area = {
					type = all
					NOT = {
						devastation = 0.01
					}
				}
				2680 = { #Apikhoxi
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_trade_building_trigger = yes
					has_manpower_building_trigger = yes
				}
			}
			AND = {
				deyeion_area = {
					type = all
					NOT = {
						devastation = 0.01
					}
				}
				2625 = { #Deyeion
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_trade_building_trigger = yes
					has_manpower_building_trigger = yes
				}
			}
			AND = {
				amgremos_area = {
					type = all
					NOT = {
						devastation = 0.01
					}
				}
				2684 = { #Amgremos
					OR = {
						has_production_building_trigger = yes
						trade_goods = gold
					}
					has_dock_building_trigger = yes
					has_shipyard_building_trigger = yes
				}
			}
		}

		effect = {
			hidden_effect = {
				remove_country_modifier = G58_compulsory_military_service_1_modifier
			}
			add_country_modifier = {
				name = G58_compulsory_military_service_2_modifier
				duration = -1
			}
			2680 = { #Apikhoxi
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
			2625 = { #Deyeion
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
			2684 = { #Amgremos
				add_permanent_province_modifier = {
					name = G58_coastal_urbanization_modifier
					duration = -1
				}
			}
		}
	}
}