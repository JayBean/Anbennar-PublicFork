
######################
### Court Disaster ###
######################

rahen_calc_reform_ministry_of_agriculture = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_agriculture } }
		
		set_variable = { which = reformMinistryAgricultureScore value = 0 }
		
		if = {
			limit = { NOT = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 1 OR = { has_province_modifier = rahen_neglected_infrastructure has_province_modifier = rahen_severely_neglected_infrastructure } } } }
			change_variable = { which = reformMinistryAgricultureScore value = 15 }
		}
		if = {
			limit = { estate_loyalty = { estate = estate_lowercastes loyalty = 60 } estate_influence = { estate = estate_lowercastes influence = 50 } }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		
		if = {
			limit = { monthly_adm = 9 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		if = {
			limit = { monthly_adm = 10 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		if = {
			limit = { monthly_adm = 11 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		
		if = {
			limit = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 5 has_building = farm_estate } }
			change_variable = { which = reformMinistryAgricultureScore value = 10 }
		}
		if = {
			limit = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 10 has_terrain = farmlands development = 18 } }
			change_variable = { which = reformMinistryAgricultureScore value = 10 }
		}
		if = {
			limit = { monthly_income = 20 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		if = {
			limit = { NOT = { num_of_loans = 1 } }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
	}
}

rahen_calc_reform_ministry_of_philosophy = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_philosophy } }
		
		set_variable = { which = reformMinistryPhilosophyScore value = 0 }
		
		if = {
			limit = { 4411 = { check_variable = { which = rahen_court_case_strength value = 30 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = rahen_court_case_strength value = 50 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = rahen_court_case_strength value = 70 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		
		if = {
			limit = { check_variable = { which = rahen_num_of_invited_scholars value = 3 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		
		if = {
			limit = { NOT = { corruption = 1 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { corruption = 5 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { corruption = 10 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		
		if = {
			limit = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 20 has_tax_building_trigger = yes } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { has_estate_privilege = estate_raj_ministries_ceremonial_ruler_act } }
			change_variable = { which = reformMinistryPhilosophyScore value = 10 }
		}
		if = {
			limit = { estate_loyalty = { estate = estate_uppercastes loyalty = 60 } estate_influence = { estate = estate_uppercastes influence = 50 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { estate_territory = { estate = estate_raj_ministries territory = 20 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 10 }
		}
	}
}

rahen_calc_reform_ministry_of_internal_relations = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_internal_relations } }
		
		set_variable = { which = reformMinistryInternalRelationsScore value = 0 }
		
		if = {
			limit = { all_subject_country = { is_at_war = no } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { all_subject_country = { estate_influence = { estate = estate_raj_ministries influence = 50 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 10 }
		}
		
		if = {
			limit = { 4411 = { check_variable = { which = raj_cohesion value = 40 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = raj_cohesion value = 60 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = raj_cohesion value = 80 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		
		if = {
			limit = { monthly_mil = 9 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_mil = 10 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_mil = 11 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		
		if = {
			limit = { stability = 3 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { all_subject_country = { NOT = { num_of_rebel_armies = 1 num_of_rebel_controlled_provinces = 1 } } NOT = { num_of_rebel_armies = 1 num_of_rebel_controlled_provinces = 1 } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { all_subject_country = { NOT = { liberty_desire = 50 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { legitimacy = 100 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 10 }
		}
	}
}

rahen_calc_reform_ministry_of_foreign_relations = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_foreign_relations } }
		
		set_variable = { which = reformMinistryForeignRelationsScore value = 0 }
		
		if = {
			limit = { calc_true_if = { amount = 5 all_known_country = { NOT = { is_subject_of = ROOT  } has_opinion = { who = ROOT value = 150 } } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { calc_true_if = { amount = 10 all_known_country = { NOT = { is_subject_of = ROOT  } has_opinion = { who = ROOT value = 150 } } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { calc_true_if = { amount = 15 all_known_country = { NOT = { is_subject_of = ROOT  } has_opinion = { who = ROOT value = 150 } } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { has_global_modifier_value = { which = diplomatic_reputation value = 3 } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 10 }
		}
		
		if = {
			limit = { num_of_war_reparations = 3 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { num_of_war_reparations = 6 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { num_of_war_reparations = 9 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { monthly_dip = 9 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_dip = 10 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_dip = 11 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { prestige = 80 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { any_ally = { trust = { who = ROOT value = 70 } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { calc_true_if = { amount = 1 all_known_country = { NOT = { is_subject_of = ROOT  } marriage_with = ROOT } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { has_won_war_against = { who = R62 max_years_since = 20 } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 20 }
		}
	}
}

rahen_add_new_neglected_infrastructure = {
	random_subject_country = {
		limit = { any_owned_province = { NOT = { has_province_modifier = rahen_severely_neglected_infrastructure has_province_modifier = rahen_neglected_infrastructure } } }
		random_owned_province = {
			limit = { NOT = { has_province_modifier = rahen_severely_neglected_infrastructure has_province_modifier = rahen_neglected_infrastructure } }
			random_list = {
				1 = {
					add_permanent_province_modifier = {
						name = rahen_severely_neglected_infrastructure
						duration = -1
					}
					set_variable = { which = rahen_months_to_repair value = 6 }
				}
				7 = {
					add_permanent_province_modifier = {
						name = rahen_neglected_infrastructure
						duration = -1
					}
					set_variable = { which = rahen_months_to_repair value = 6 }
				}
			}
		}
	}
}

rahen_clear_court_disaster_province_modifiers = {
	remove_province_modifier = rahen_suspicious_ministry_estate
	remove_province_modifier = rahen_neglected_infrastructure
	remove_province_modifier = rahen_severely_neglected_infrastructure
}

rahen_ai_disaster_progress_effect = {
	if = {
		limit = { ai = yes }
		if = {
			limit = {
				NOT = {
					has_country_flag = rahen_disaster_progress_agriculture_ai
					has_country_flag = rahen_disaster_progress_philosophy_ai
					has_country_flag = rahen_disaster_progress_internal_relations_ai
					has_country_flag = rahen_disaster_progress_foreign_relations_ai
				}
			}
			random_list = {
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_agriculture } }
					set_country_flag = rahen_disaster_progress_agriculture_ai
				}
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_philosophy } }
					set_country_flag = rahen_disaster_progress_philosophy_ai
				}
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_internal_relations } }
					set_country_flag = rahen_disaster_progress_internal_relations_ai
				}
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_foreign_relations } }
					set_country_flag = rahen_disaster_progress_foreign_relations_ai
				}
			}
		}
		random_list = {
			1 = { }
			1 = {
				modifier = { factor = 0.8 NOT = { mil = 1 } }
				modifier = { factor = 0.8 NOT = { mil = 2 } }
				modifier = { factor = 0.8 NOT = { mil = 3 } }
				modifier = { factor = 1.2 mil = 4 }
				modifier = { factor = 1.2 mil = 5 }
				modifier = { factor = 1.2 mil = 6 }
				modifier = { factor = 0.8 NOT = { dip = 1 } }
				modifier = { factor = 0.8 NOT = { dip = 2 } }
				modifier = { factor = 0.8 NOT = { dip = 3 } }
				modifier = { factor = 1.2 dip = 4 }
				modifier = { factor = 1.2 dip = 5 }
				modifier = { factor = 1.2 dip = 6 }
				modifier = { factor = 0.8 NOT = { adm = 1 } }
				modifier = { factor = 0.8 NOT = { adm = 2 } }
				modifier = { factor = 0.8 NOT = { adm = 3 } }
				modifier = { factor = 1.2 adm = 4 }
				modifier = { factor = 1.2 adm = 5 }
				modifier = { factor = 1.2 adm = 6 }
				modifier = { factor = 1.2 has_country_modifier = great_conqueror_modifier }
				modifier = { factor = 1.5 has_country_modifier = mythical_conqueror_modifier }
				
				change_variable = {
					which = reformMinistryProgressAI
					value = 1
				}
			}
			1 = {
				trigger = { OR = { has_country_modifier = great_conqueror_modifier has_country_modifier = mythical_conqueror_modifier } }
				modifier = { factor = 1.2 has_country_modifier = mythical_conqueror_modifier }
				
				change_variable = {
					which = reformMinistryProgressAI
					value = 2
				}
			}
		}
	}
}

rahen_add_completed_reforms_flag = {
	if = {
		limit = {
			4411 = { 
				NOT = {
					has_province_modifier = rahen_corrupt_ministery_of_agriculture
					has_province_modifier = rahen_corrupt_ministery_of_philosophy
					has_province_modifier = rahen_corrupt_ministery_of_internal_relations
					has_province_modifier = rahen_corrupt_ministery_of_foreign_relations
				}
			}
		}
		set_country_flag = reformed_rahen_court
	}
}

clear_oracle_prophecy_flag = {
	clr_ruler_flag = prophecy_bad_outcome
	clr_ruler_flag = prophecy_grey_outcome
	clr_ruler_flag = prophecy_good_outcome
	clr_ruler_flag = prophecy_low_intensity
	clr_ruler_flag = prophecy_high_intensity
	clr_ruler_flag = oracle_prophecy_ongoing
}

####################
### Raj Cohesion ###
####################

raj_monthy_calc = {
	4411 = { 
		change_variable = { which = raj_cohesion which = rajCohesionMonthy }
		if = { limit = { check_variable = { raj_cohesion = 100 } }
			set_variable = { which = raj_cohesion value = 100 }
		}
		else_if = { limit = { NOT = { check_variable = { raj_cohesion = 0 } } }
			set_variable = { which = raj_cohesion value = 0 }
		}
	}
	raj_cohesion_calc = yes
}

raj_cohesion_calc = {
	4411 = {
		set_variable = { which = rajCohesionMonthy value = 0 }
		set_variable = { which = rajCohesionMonthy_mandate value = 0 }
		set_variable = { which = rajCohesionMonthy_ministries_influence value = 0 }
		set_variable = { which = rajCohesionMonthy_low_liberty_desire value = 0 }
		set_variable = { which = rajCohesionMonthy_high_liberty_desire value = 0 }
		set_variable = { which = rajDev value = 0 }
		set_variable = { which = rajNbMandate value = 0 }
		set_variable = { which = rajNbLowLD value = 0 }
		set_variable = { which = rajNbHighLD value = 0 }
		
		owner = {
			every_subject_country = {
				export_to_variable = { which = rajDev value = total_development }
				4411 = { change_variable = { which = rajDev which = PREV } }
			}
			export_to_variable = { which = rajDev value = total_development }
			4411 = { change_variable = { which = rajDev which = PREV } }
			
			every_subject_country = {
				4411 = { PREV = { divide_variable = { which = rajDev which = PREV } } }	#divides the country's dev but the total Raj dev
				if = { limit = { has_estate = estate_raj_ministries }
					if = { limit = { estate_influence = { estate = estate_raj_ministries influence = 60 } }
						raj_cohesion_change = {	amount = 1 ministries_influence = yes }
					}
					else_if = { limit = { estate_influence = { estate = estate_raj_ministries influence = 40 } }
						raj_cohesion_change = {	amount = 0.5 ministries_influence = yes }
					}
					else_if = { limit = { NOT = { estate_influence = { estate = estate_raj_ministries influence = 20 } } }
						raj_cohesion_change = {	amount = -1 ministries_influence = yes }
					}
					else_if = { limit = { NOT = { estate_influence = { estate = estate_raj_ministries influence = 1 } } }
						raj_cohesion_change = {	amount = -2 ministries_influence = yes }
					}
					
					if = { limit = { liberty_desire = 60 }
						raj_cohesion_change = {	amount = -1 high_liberty_desire = yes }
					}
					else_if = { limit = { liberty_desire = 40 }
						raj_cohesion_change = {	amount = -0.5 high_liberty_desire = yes }
					}
					else_if = { limit = { NOT = { liberty_desire = 15 } }
						raj_cohesion_change = {	amount = 0.5 low_liberty_desire = yes }
					}
				}
			}
			
			4411 = { PREV = { divide_variable = { which = rajDev which = PREV } } }
			if = { limit = { estate_influence = { estate = estate_raj_ministries influence = 60 } }
				raj_cohesion_change = {	amount = 1 ministries_influence = yes }
			}
			else_if = { limit = { estate_influence = { estate = estate_raj_ministries influence = 40 } }
				raj_cohesion_change = {	amount = 0.5 ministries_influence = yes }
			}
			else_if = { limit = { NOT = { estate_influence = { estate = estate_raj_ministries influence = 20 } } }
				raj_cohesion_change = {	amount = -1 ministries_influence = yes }
			}
		}
		
		change_variable = { which = rajCohesionMonthy which = rajCohesionMonthy_internal_wars }
		
		change_variable = { which = rajCohesionMonthy which = rajaVizierCohesion }
	}
}

raj_rounding_variables = {
	4411 = {
		divide_variable = { which = raj_cohesion value = 10 }
		divide_variable = { which = rajCohesionMonthy value = 10 }
		divide_variable = { which = rajCohesionMonthy_mandate value = 10 }
		divide_variable = { which = rajCohesionMonthy_ministries_influence value = 10 }
		divide_variable = { which = rajCohesionMonthy_low_liberty_desire value = 10 }
		divide_variable = { which = rajCohesionMonthy_high_liberty_desire value = 10 }
		divide_variable = { which = rajCohesionMonthy_internal_wars value = 10 }
		multiply_variable = { which = raj_cohesion value = 10 }
		multiply_variable = { which = rajCohesionMonthy value = 10 }
		multiply_variable = { which = rajCohesionMonthy_mandate value = 10 }
		multiply_variable = { which = rajCohesionMonthy_ministries_influence value = 10 }
		multiply_variable = { which = rajCohesionMonthy_low_liberty_desire value = 10 }
		multiply_variable = { which = rajCohesionMonthy_high_liberty_desire value = 10 }
		multiply_variable = { which = rajCohesionMonthy_internal_wars value = 10 }
	}
}

raj_cohesion_change = {

	# Arguments (mandatory):
	#  - amount = float
	#  - One of:
		#  - mandate = yes
		#  - ministries_influence = yes
		#  - ministries_agenda = yes
		#  - ministries_events = yes
		#  - low_liberty_desire = yes
		#  - high_liberty_desire = yes
		#  - vassal_integration = yes
		#  - internal_wars = yes
		#  - non_monthy = yes
	#
	
	hidden_effect = {
		#Set amount to change by
		set_variable = { which = rajCohesionChangeAmount value = $amount$ }
		if = { limit = { NOT = { overlord = { has_reform = raja_reform } } }	#Raj countries already have this part calculated every month
			export_to_variable = { which = rajDev value = total_development }
			4411 = { PREV = { divide_variable = { which = rajDev which = PREV } } }	#divides the country's dev but the total Raj dev
		}
		else_if = { limit = { NOT = { check_variable = { which = rajDev value = 0.001 } } }
			export_to_variable = { which = rajDev value = total_development }
			4411 = { PREV = { divide_variable = { which = rajDev which = PREV } } }
		}
		multiply_variable = { which = rajCohesionChangeAmount which = rajDev }
		
		#debug stuff
		# if = { limit = { check_variable = { which = rajDev value = 1 } }
			# random_known_country = {
				# limit = { ai = no }
				# country_event = { id = rahenraj.4000 }
			# }
		# }
		
		4411 = {
			set_variable = { which = rajCohesionChangeAmount which = PREV }
			[[mandate]
				change_variable = { which = rajCohesionMonthy_mandate which = rajCohesionChangeAmount }
				change_variable = { which = rajCohesionMonthy which = rajCohesionChangeAmount }
			]
			[[ministries_influence]
				change_variable = { which = rajCohesionMonthy_ministries_influence which = rajCohesionChangeAmount }
				change_variable = { which = rajCohesionMonthy which = rajCohesionChangeAmount }
			]
			[[ministries_agenda]
				change_variable = { which = raj_cohesion which = rajCohesionChangeAmount }
				
				if = { limit = { check_variable = { raj_cohesion = 100 } }
					set_variable = { which = raj_cohesion value = 100 }
				}
				else_if = { limit = { NOT = { check_variable = { raj_cohesion = 0 } } }
					set_variable = { which = raj_cohesion value = 0 }
				}
			]
			[[ministries_events]
				change_variable = { which = raj_cohesion which = rajCohesionChangeAmount }
				
				if = { limit = { check_variable = { raj_cohesion = 100 } }
					set_variable = { which = raj_cohesion value = 100 }
				}
				else_if = { limit = { NOT = { check_variable = { raj_cohesion = 0 } } }
					set_variable = { which = raj_cohesion value = 0 }
				}
			]
			[[low_liberty_desire]
				change_variable = { which = rajCohesionMonthy_low_liberty_desire which = rajCohesionChangeAmount }
				change_variable = { which = rajCohesionMonthy which = rajCohesionChangeAmount }
			]
			[[high_liberty_desire]
				change_variable = { which = rajCohesionMonthy_high_liberty_desire which = rajCohesionChangeAmount }
				change_variable = { which = rajCohesionMonthy which = rajCohesionChangeAmount }
			]
			[[internal_wars]
				change_variable = { which = rajCohesionMonthy_internal_wars which = rajCohesionChangeAmount }
				change_variable = { which = rajCohesionMonthy which = rajCohesionChangeAmount }
			]
			[[vassal_integration]
				change_variable = { which = rajCohesionChangeAmount value = -10 }
				if = { limit = { NOT = { check_variable = { which = rajCohesionChangeAmount value = -50 } } }
					set_variable = { which = rajCohesionChangeAmount value = -50 }
				}
				
				change_variable = { which = raj_cohesion which = rajCohesionChangeAmount }
				
				if = { limit = { NOT = { check_variable = { raj_cohesion = 0 } } }
					set_variable = { which = raj_cohesion value = 0 }
				}
			]
			[[non_monthly]
				change_variable = { which = raj_cohesion which = rajCohesionChangeAmount }
				
				if = { limit = { check_variable = { raj_cohesion = 100 } }
					set_variable = { which = raj_cohesion value = 100 }
				}
				else_if = { limit = { NOT = { check_variable = { raj_cohesion = 0 } } }
					set_variable = { which = raj_cohesion value = 0 }
				}
			]
		}
	}
	4411 = {
		if = { limit = { owner = { ai = no } }
			if = { limit = { NOT = { check_variable = { which = rajCohesionChangeNull value = $amount$ } } }
				if = { limit = { check_variable = { which = rajCohesionIncreaseSmall value = $amount$ } }
					custom_tooltip = raj_cohesion_increase_tiny_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionIncreaseMedium value = $amount$ } }
					custom_tooltip = raj_cohesion_increase_small_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionIncreaseLarge value = $amount$ } }
					custom_tooltip = raj_cohesion_increase_medium_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionIncreaseHuge value = $amount$ } }
					custom_tooltip = raj_cohesion_increase_large_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionIncreaseGargantuan value = $amount$ } }
					custom_tooltip = raj_cohesion_increase_huge_tt
				}
				else = {
					custom_tooltip = raj_cohesion_increase_gargantuan_tt
				}
			}
			else = {
				if = { limit = { check_variable = { which = rajCohesionDecreaseGargantuan value = $amount$ } }
					custom_tooltip = raj_cohesion_decrease_gargantuan_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionDecreaseHuge value = $amount$ } }
					custom_tooltip = raj_cohesion_decrease_huge_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionDecreaseLarge value = $amount$ } }
					custom_tooltip = raj_cohesion_decrease_large_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionDecreaseMedium value = $amount$ } }
					custom_tooltip = raj_cohesion_decrease_medium_tt
				}
				else_if = { limit = { check_variable = { which = rajCohesionDecreaseSmall value = $amount$ } }
					custom_tooltip = raj_cohesion_decrease_small_tt
				}
				else = {
					custom_tooltip = raj_cohesion_decrease_tiny_tt
				}
			}
		}
	}
}

raj_cohesion_change_absolute = {
	hidden_effect = {
		4411 = {
			change_variable = { which = raj_cohesion value = $amount$ }
			
			if = { limit = { check_variable = { raj_cohesion = 100 } }
				set_variable = { which = raj_cohesion value = 100 }
			}
			else_if = { limit = { NOT = { check_variable = { raj_cohesion = 0 } } }
				set_variable = { which = raj_cohesion value = 0 }
			}
		}
	}
	tooltip = { change_variable = { which = raj_cohesion value = $amount$ } }
}

raj_vizier_sway_change = {
	hidden_effect = {
		4411 = {
			change_variable = { which = vizierSway value = $amount$ }
			
			if = { limit = { check_variable = { vizierSway = 100 } }
				set_variable = { which = vizierSway value = 100 }
			}
			else_if = { limit = { NOT = { check_variable = { vizierSway = 0 } } }
				set_variable = { which = vizierSway value = 0 }
			}
		}
	}
	tooltip = { change_variable = { which = vizierSway value = $amount$ } }
}

remove_raj_mandate = {
	remove_country_modifier = raj_mandate_raja_protection
	remove_country_modifier = raj_mandate_right_to_expansion
	remove_country_modifier = raj_mandate_guaranteed_autonomy
	remove_country_modifier = raj_mandate_mercantile_preference
	remove_country_modifier = raj_mandate_sanctioned_armoury
	remove_country_modifier = raj_mandate_ministry_lectures
	remove_country_modifier = raj_mandate_senapti_primacy
	remove_country_modifier = raj_mandate_extended_prabhi_privileges
	remove_country_modifier = raj_mandate_territorial_limits
}

raj_clear_vizier = {
	clr_country_flag = raj_vizier
	clr_country_flag = raj_swayed_senaptia
	clr_country_flag = raj_gathered_ministries
	clr_country_flag = raj_outmaneuvered_raja
	clr_country_flag = raj_discredited_raja
	clr_country_flag = raj_became_raja_confident
	
	clr_country_flag = raj_had_promising_heir_event
	clr_country_flag = raj_had_harassed_by_elephants_event
	clr_country_flag = raj_had_tianlou_event
	clr_country_flag = raj_had_deputised_event
	clr_country_flag = raj_had_religious_school_event
	clr_country_flag = raj_had_wife_offer_event
}

raj_cohesion_yearly_tick = {
	raj_calc_max_allowed_senaptia = yes
	raj_calc_vizier_sway = yes
	4411 = {
		owner = {
			if = { limit = { NOT = { any_subject_country = { has_country_flag = raj_vizier } } }
				country_event = { id = rahenraj.2100 }
			}
		}
		change_variable = { which = vizierSway which = vizierYearlySway }
		if = { limit = { check_variable = { which = vizierSway value = 100 } }
			set_variable = { which = vizierSway value = 100 }
		}
		else_if = { limit = { NOT = { check_variable = { which = vizierSway value = 0 } } }
			set_variable = { which = vizierSway value = 0 }
		}
	}
}

raj_calc_vizier_sway = {
	4411 = {
		owner = {			
			random_subject_country = {
				limit = { has_country_flag = raj_vizier }
				4411 = {
					export_to_variable = { which = vizierTotalDev value = total_development who = PREV }
					export_to_variable = { which = vizierAdm value = ADM who = PREV }
					export_to_variable = { which = vizierDip value = DIP who = PREV }
					export_to_variable = { which = vizierMil value = MIL who = PREV }
				}
			}
			
			4411 = {		
				export_to_variable = { which = rajaAdm value = ADM who = PREV }
				export_to_variable = { which = rajaDip value = DIP who = PREV }
				export_to_variable = { which = rajaMil value = MIL who = PREV }
			}
		}
		
		#Cohesion
		if = { limit = { check_variable = { which = vizierAdm which = rajaAdm } }
			set_variable = { which = rajaVizierCohesion which = vizierAdm }
		}
		else = {
			set_variable = { which = rajaVizierCohesion which = rajaAdm }
		}
		if = { limit = { check_variable = { which = vizierDip which = rajaDip } }
			change_variable = { which = rajaVizierCohesion which = vizierDip }
		}
		else = {
			change_variable = { which = rajaVizierCohesion which = rajaDip }
		}
		if = { limit = { check_variable = { which = vizierMil which = rajaMil } }
			change_variable = { which = rajaVizierCohesion which = vizierMil }
		}
		else = {
			change_variable = { which = rajaVizierCohesion which = rajaMil }
		}
		subtract_variable = { which = rajaVizierCohesion value = 9 }
		divide_variable = { which = rajaVizierCohesion value = 300 }
		multiply_variable = { which = rajaVizierCohesion value = 10 } #For rounding purposes
		
		#Sway
		set_variable = { which = vizierSkillDiff which = vizierAdm }
		change_variable = { which = vizierSkillDiff which = vizierDip }
		change_variable = { which = vizierSkillDiff which = vizierMil }
		subtract_variable = { which = vizierSkillDiff which = rajaAdm }
		subtract_variable = { which = vizierSkillDiff which = rajaDip }
		subtract_variable = { which = vizierSkillDiff which = rajaMil }
		
		divide_variable = { which = vizierTotalDev which = rajDev }
		
		set_variable = { which = vizierYearlySway which = vizierTotalDev }
		multiply_variable = { which = vizierYearlySway value = 100 }
		change_variable = { which = vizierYearlySway which = vizierSkillDiff }
		multiply_variable = { which = vizierYearlySway value = 0.15 }
		
		divide_variable = { which = vizierYearlySway value = 100 }
		multiply_variable = { which = vizierYearlySway value = 100 }
	}
}

raj_calc_internal_wars = {
	4411 = {
		set_variable = { which = rajCohesionMonthy_internal_wars value = 0 }
		owner = {
			every_subject_country = {
				limit = { is_in_war = { attacker_leader = THIS } }
				save_event_target_as = raj_subject_at_war
				if = {
					limit = {
						PREV = {
							any_subject_country = {
								is_in_war = {
									attacker_leader = event_target:raj_subject_at_war
									defender_leader = THIS
								}
							}
						}
					}
					if = { limit = { NOT = { check_variable = { which = rajDev value = 0.0001 } } }
						export_to_variable = { which = rajDev value = total_development }
						4411 = { PREV = { divide_variable = { which = rajDev which = PREV } } }
					}
					set_variable = { which = rajCohesionMonthy_internal_wars which = rajDev }
					4411 = { change_variable = { which = rajCohesionMonthy_internal_wars which = PREV } }
				}
			}
		}
		multiply_variable = { which = rajCohesionMonthy_internal_wars value = -2.5 } #ratio between % of dev at war and monthly cohesion impact
	}
}

raj_calc_max_allowed_senaptia = {
	4411 = {
		if = {
			limit = { owner = { num_of_subjects = 100 } }
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 14
			}
		}
		else_if = {
			limit = { owner = { num_of_subjects = 70 } }
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 12
			}
		}
		else_if = {
			limit = { owner = { num_of_subjects = 50 } }
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 10
			}
		}
		else_if = {
			limit = { owner = { num_of_subjects = 35 } }
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 8
			}
		}
		else_if = {
			limit = { owner = { num_of_subjects = 25 } }
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 6
			}
		}
		else_if = {
			limit = { owner = { num_of_subjects = 15 } }
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 4
			}
		}
		else = {
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 2
			}
		}
		
		if = {
			limit = { owner = { has_estate_privilege = estate_raj_ministries_expanded_senaptia_ranks } }
			change_variable = {
				which = raj_max_allowed_senaptia
				value = 2
			}
		}
		if = {
			limit = { owner = { has_estate_privilege = estate_raj_ministries_reduced_senaptia_ranks } }
			change_variable = {
				which = raj_max_allowed_senaptia
				value = -2
			}
		}
		
		set_variable = { which = rajNbSenapti value = 0 }
		owner = {
			every_subject_country = {
				limit = { is_subject_of_type = great_daimyo_vassal }
				4411 = { change_variable = { rajNbSenapti = 1 } }
			}
			
			#If a senapti rank is available
			if = { limit = { raj_below_allowed_senaptia = yes }
				export_to_variable = { which = senaptiCandidateMilTech value = mil_tech }
				every_subject_country = {
					limit = {
						is_subject_of_type = daimyo_vassal
						if = {
							limit = { overlord = { has_country_modifier = raj_closed_senapti_ranks } }
							if = {
								limit = { overlord = { culture_group = harimari } }
								ruler_is_harimari = yes
							}
							else = {
								ruler_is_human = yes
							}
						}
						NOT = { has_country_modifier = prabhi_promotion_rejected }
						NOT = { has_country_modifier = senapti_recently_demoted }
						NOT = { has_country_modifier = raj_mandate_extended_prabhi_privileges }
						num_of_cities = 2
					}
					if = { limit = { ai = no }
						country_event = { id = rahenraj.7 days = 1 }	#info event "a senapti rank is available"
						set_country_flag = raj_player_senapti_candidate
					}
					else = {
						set_country_flag = raj_senapti_candidate
					}
					
					export_to_variable = { which = senaptiCandidateDev value = total_development }
					divide_variable = { which = senaptiCandidateDev value = 4 }
					
					export_to_variable = { which = senaptiCandidateOpinion value = opinion who = PREV }
					divide_variable = { which = senaptiCandidateOpinion value = 10 }
					
					export_to_variable = { which = senaptiCandidateMilTech value = mil_tech }
					subtract_variable = { which = senaptiCandidateMilTech which = PREV }
					multiply_variable = { which = senaptiCandidateMilTech value = 15 }
					
					export_to_variable = { which = senaptiCandidateForceLimit value = land_forcelimit }
					
					set_variable = { which = senaptiCandidateScore which = senaptiCandidateDev }
					change_variable = { which = senaptiCandidateScore which = senaptiCandidateOpinion }
					change_variable = { which = senaptiCandidateScore which = senaptiCandidateMilTech }
					change_variable = { which = senaptiCandidateScore which = senaptiCandidateForceLimit }
				}
				
				random_subject_country = {
					limit = { has_country_flag = raj_senapti_candidate }
					save_event_target_as = next_ai_senapti
				}
				every_subject_country = { 
					limit = {
						has_country_flag = raj_senapti_candidate
						check_variable = { which = senaptiCandidateScore which = event_target:next_ai_senapti }
					}
					save_event_target_as = next_ai_senapti
				}
				every_subject_country = {
					limit = {
						OR = {
							has_country_flag = raj_senapti_candidate
							has_country_flag = raj_player_senapti_candidate
						}
					}
					divide_variable = { which = senaptiCandidateScore which = event_target:next_ai_senapti }
					clr_country_flag = raj_senapti_candidate
					clr_country_flag = raj_player_senapti_candidate
				}
				
				if = { limit = { ai = no }
					country_event = { id = rahenraj.7 days = 1 }	#info event "a senapti rank is available"
				}
				else = {
					event_target:next_ai_senapti = {	#The n°1 ai candidate will become senapti in 150 days if the raja is ai
						overlord = { country_event = { id = rahenraj.4 days = 150 } }
					}
				}
			}
			else = {
				remove_country_modifier = raj_got_senapti_info
			}
		}
	}
}

raj_calc_vizier_shortlist = {
	hidden_effect = {
		every_subject_country = {
			limit = {
				OR = {
					has_reform = prabhi_reform
					has_reform = senapti_reform
				}
				NOT = { has_opinion_modifier = { who = PREV modifier = raj_dismissed_vizier_opinion } }
			}
			
			if = { limit = { has_country_flag = raj_vizier }
				save_event_target_as = current_vizier
				capital_scope = { save_event_target_as = current_vizier_capital }
			}
			else = {
				set_country_flag = raj_not_sorted
			}
			
			export_to_variable = { which = rajaAdm value = ADM who = PREV }
			export_to_variable = { which = rajaDip value = DIP who = PREV }
			export_to_variable = { which = rajaMil value = MIL who = PREV }
			export_to_variable = { which = vizierTotalDev value = total_development }
			export_to_variable = { which = vizierDipRep value = modifier:diplomatic_reputation }
			export_to_variable = { which = vizierAdm value = ADM }
			export_to_variable = { which = vizierDip value = DIP }
			export_to_variable = { which = vizierMil value = MIL }
			export_to_variable = { which = rajaOpinion value = opinion who = PREV }
			divide_variable = { which = rajaOpinion value = 5 }
			
			#Monthly Cohesion
			if = { limit = { check_variable = { which = vizierAdm which = rajaAdm } }
				set_variable = { which = vizierCohesion which = vizierAdm }
			}
			else = {
				set_variable = { which = vizierCohesion which = rajaAdm }
			}
			if = { limit = { check_variable = { which = vizierDip which = rajaDip } }
				change_variable = { which = vizierCohesion which = vizierDip }
			}
			else = {
				change_variable = { which = vizierCohesion which = rajaDip }
			}
			if = { limit = { check_variable = { which = vizierMil which = rajaMil } }
				change_variable = { which = vizierCohesion which = vizierMil }
			}
			else = {
				change_variable = { which = vizierCohesion which = rajaMil }
			}
			subtract_variable = { which = vizierCohesion value = 9 }
			divide_variable = { which = vizierCohesion value = 300 }
			multiply_variable = { which = vizierCohesion value = 10 } #For rounding purposes
			
			#Yearly Sway
			4411 = {
				set_variable = { which = temp which = rajDev }
				PREV = { set_variable = { which = temp which = PREV } }
			}
			divide_variable = { which = vizierTotalDev which = temp }
			
			set_variable = { which = vizierYearlySway which = vizierTotalDev }
			multiply_variable = { which = vizierYearlySway value = 100 }
			change_variable = { which = vizierYearlySway which = vizierAdm }
			change_variable = { which = vizierYearlySway which = vizierDip }
			change_variable = { which = vizierYearlySway which = vizierMil }
			subtract_variable = { which = vizierYearlySway which = rajaAdm }
			subtract_variable = { which = vizierYearlySway which = rajaDip }
			subtract_variable = { which = vizierYearlySway which = rajaMil }
			divide_variable = { which = vizierYearlySway value = 1000 }
			multiply_variable = { which = vizierYearlySway value = 150 }			
			
			#Vizier Score
			set_variable = { which = vizierScore which = vizierTotalDev }
			multiply_variable = { which = vizierScore value = 200 }
			change_variable = { which = vizierScore which = vizierAdm }
			change_variable = { which = vizierScore which = vizierDip }
			change_variable = { which = vizierScore which = vizierMil }
			change_variable = { which = vizierScore which = rajaOpinion }
			multiply_variable = { which = vizierDipRep value = 3 }
			change_variable = { which = vizierScore which = vizierDipRep }
		}
		
		random_subject_country = {
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_1
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_1 }
			}
			save_event_target_as = shortlisted_vizier_1
		}
		event_target:shortlisted_vizier_1 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_1_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		random_subject_country = { 
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_2
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_2 }
			}
			save_event_target_as = shortlisted_vizier_2
		}
		event_target:shortlisted_vizier_2 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_2_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		random_subject_country = { 
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_3
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_3 }
			}
			save_event_target_as = shortlisted_vizier_3
		}
		event_target:shortlisted_vizier_3 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_3_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		random_subject_country = { 
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_4
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_4 }
			}
			save_event_target_as = shortlisted_vizier_4
		}
		event_target:shortlisted_vizier_4 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_4_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		random_subject_country = { 
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_5
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_5 }
			}
			save_event_target_as = shortlisted_vizier_5
		}
		event_target:shortlisted_vizier_5 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_5_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		random_subject_country = { 
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_6
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_6 }
			}
			save_event_target_as = shortlisted_vizier_6
		}
		event_target:shortlisted_vizier_6 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_6_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		random_subject_country = { 
			limit = { has_country_flag = raj_not_sorted }
			save_event_target_as = shortlisted_vizier_7
		}
		every_subject_country = { 
			limit = {
				has_country_flag = raj_not_sorted
				check_variable = { which = vizierScore which = event_target:shortlisted_vizier_7 }
			}
			save_event_target_as = shortlisted_vizier_7
		}
		event_target:shortlisted_vizier_7 = {
			capital_scope = { save_event_target_as = shortlisted_vizier_7_capital }
			clr_country_flag = raj_not_sorted
			set_variable = { which = vizierScore value = 0 }
		}
		
		every_subject_country = {
			clr_country_flag = raj_not_sorted
		}
	}
}

raj_calc_vizier_ranking = {
	hidden_effect = {
		4411 = {
			set_variable = { which = temp which = rajDev }
			owner = {
				set_variable = { which = numRajSubjects value = 0 }
			
				every_subject_country = {
					limit = {
						OR = {
							has_reform = prabhi_reform
							has_reform = senapti_reform
						}
					}
					PREV = { change_variable = { which = numRajSubjects value = 1 } }
					set_country_flag = raj_not_sorted
					
					export_to_variable = { which = vizierTotalDev value = total_development }
					4411 = { PREV = { set_variable = { which = temp which = PREV } } }
					divide_variable = { which = vizierTotalDev which = temp }
					export_to_variable = { which = vizierDipRep value = modifier:diplomatic_reputation }
					export_to_variable = { which = vizierAdm value = ADM }
					export_to_variable = { which = vizierDip value = DIP }
					export_to_variable = { which = vizierMil value = MIL }
					export_to_variable = { which = rajaOpinion value = opinion who = PREV }
					divide_variable = { which = rajaOpinion value = 5 }
					set_variable = { which = vizierRanking value = 9 }		
					
					#Vizier Score
					set_variable = { which = vizierScore which = vizierTotalDev }
					multiply_variable = { which = vizierScore value = 200 }
					change_variable = { which = vizierScore which = vizierAdm }
					change_variable = { which = vizierScore which = vizierDip }
					change_variable = { which = vizierScore which = vizierMil }
					change_variable = { which = vizierScore which = rajaOpinion }
					multiply_variable = { which = vizierDipRep value = 3 }
					change_variable = { which = vizierScore which = vizierDipRep }
				}
				
				set_variable = { which = vizierRanking value = 1 }
				
				random_subject_country = {
					limit = { has_country_flag = raj_not_sorted }
					save_event_target_as = ranked_vizier
				}
				
				while = {
					limit = {
						NOT = { check_variable = { which = vizierRanking value = 9 } }
						check_variable = { which = numRajSubjects which = vizierRanking }
					}
					
					every_subject_country = { 
						limit = {
							has_country_flag = raj_not_sorted
							check_variable = { which = vizierScore which = event_target:ranked_vizier }
						}
						save_event_target_as = ranked_vizier
					}
					event_target:ranked_vizier = {
						clr_country_flag = raj_not_sorted
						set_variable = { which = vizierScore value = 0 }
						set_variable = { which = vizierRanking which = PREV }
					}
					
					change_variable = { which = vizierRanking value = 1 }
				}
				
				every_subject_country = {
					clr_country_flag = raj_not_sorted
				}
			}
		}
	}
}

raj_vizier_nomination_effects = {
	custom_tooltip = raj_reset_vizier_sway_tt
	if = { limit = { overlord = { any_subject_country = { has_country_flag = raj_vizier } } }
		if = { limit = { 4411 = { check_variable = { which = vizierSway value = 90 } } }
			raj_cohesion_change_absolute = { amount = -50 }
			event_target:current_vizier = { add_liberty_desire = 50 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 80 } } }
			raj_cohesion_change_absolute = { amount = -45 }
			event_target:current_vizier = { add_liberty_desire = 45 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 70 } } }
			raj_cohesion_change_absolute = { amount = -40 }
			event_target:current_vizier = { add_liberty_desire = 40 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 60 } } }
			raj_cohesion_change_absolute = { amount = -35 }
			event_target:current_vizier = { add_liberty_desire = 35 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 50 } } }
			raj_cohesion_change_absolute = { amount = -30 }
			event_target:current_vizier = { add_liberty_desire = 30 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 40 } } }
			raj_cohesion_change_absolute = { amount = -25 }
			event_target:current_vizier = { add_liberty_desire = 25 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 30 } } }
			raj_cohesion_change_absolute = { amount = -20 }
			event_target:current_vizier = { add_liberty_desire = 20 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 20 } } }
			raj_cohesion_change_absolute = { amount = -15 }
			event_target:current_vizier = { add_liberty_desire = 15 }
		}
		else_if = { limit = { 4411 = { check_variable = { which = vizierSway value = 10 } } }
			raj_cohesion_change_absolute = { amount = -10 }
			event_target:current_vizier = { add_liberty_desire = 10 }
		}
		else = {
			raj_cohesion_change_absolute = { amount = -5 }
			event_target:current_vizier = { add_liberty_desire = 5 }
		}
	}
	
	custom_tooltip = raj_unhappy_big_vassals_tt
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_1 } } } }
		event_target:shortlisted_vizier_1 = { add_liberty_desire = 20 }
	}
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_2 } } } }
		event_target:shortlisted_vizier_2 = { add_liberty_desire = 20 }
	}
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_3 } } } }
		event_target:shortlisted_vizier_3 = { add_liberty_desire = 20 }
	}
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_4 } } } }
		event_target:shortlisted_vizier_4 = { add_liberty_desire = 20 }
	}
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_5 } } } }
		event_target:shortlisted_vizier_5 = { add_liberty_desire = 20 }
	}
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_6 } } } }
		event_target:shortlisted_vizier_6 = { add_liberty_desire = 20 }
	}
	if = { limit = { $scope$ = { NOT = { check_variable = { which = vizierTotalDev which = event_target:shortlisted_vizier_7 } } } }
		event_target:shortlisted_vizier_7 = { add_liberty_desire = 20 }
	}
	
	hidden_effect = {
		4411 = {
			set_variable = { which = vizierSway value = 0 }
			set_variable = { which = vizierYearlySway which = event_target:shortlisted_vizier_1 }
		}
		event_target:current_vizier = {
			raj_clear_vizier = yes
			country_event = { id = rahenraj.2103 days = 1 }
		}
		$scope$ = {
			set_country_flag = raj_vizier
			save_event_target_as = new_vizier
			country_event = { id = rahenraj.2102 days = 1 }
		}
	}
}

raj_change_setting = {
	4411 = {
		if = { limit = { is_variable_equal = { which = raj$mandate$Setting value = 3 } }
			set_variable = { which = raj$mandate$Setting value = 0 }
		}
		else = {
			change_variable = { which = raj$mandate$Setting value = 1 }
		}
	}
}

######################
### Caste Fluidity ###
######################

caste_fluidity_increase_minute = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_minute_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 3 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_small = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_small_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 5 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_medium = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_medium_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 10 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_large = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_large_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 15 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_huge = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_huge_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 20 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_gargantuan = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_gargantuan_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 25 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_minute = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_minute_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 3 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_small = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_small_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 5 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_medium = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_medium_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 10 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_large = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_large_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 15 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_huge = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_huge_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 20 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_gargantuan = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_gargantuan_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 25 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

#------# Blood Lotus #------#
blood_lotus_hardline_stance_setup = {
	# 1-33 		==> hardline harimari
	# 34-66 	==> neutral
	# 67-100 	==> hardline human
	set_variable = { which = blHardlineVar value = 5 }
}

#HOW TO USE example: blood_lotus_hardline_stance_change = { humanhardline = 2 }
blood_lotus_hardline_stance_change = { 

    # Arguments (mandatory):
    #  - hardline direction = enum( harimarihardline / neutral / humanhardline )
	#  - an amount to move, must be 0-100
    #  - example "harimarihardline = 15"

	# small change: "harimarihardline = 3"
	# normal change: "harimarihardline = 5"
	# large change: "harimarihardline = 10"
    
    [[harimarihardline] 
        custom_tooltip = blHardlineVarHarimari_tt
        hidden_effect = { subtract_variable = { which = blHardlineVar value = $harimarihardline$ } }
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutral_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } }                              
				subtract_variable = { which = blHardlineVar value = $neutral$ } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.                          
				change_variable = { which = blHardlineVar value = $neutral$ } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHuman_tt
        hidden_effect = { change_variable = { which = blHardlineVar value = $humanhardline$ } }
    ]
}

#HOW TO USE example: blood_lotus_hardline_stance_change_small = { humanhardline = yes }
blood_lotus_hardline_stance_change_small = {
	# NOTE: normal steps are 4 for hardline directions 
	# This is was done to balance the flow of the disaster.

	[[harimarihardline] 
        custom_tooltip = blHardlineVarHarimariSmall_tt
        hidden_effect = { 
			random_list = {
				40 = { subtract_variable = { which = blHardlineVar value = 3 } }
				40 = { subtract_variable = { which = blHardlineVar value = 5 } }
				20 = { subtract_variable = { which = blHardlineVar value = 7 } }
			}
		}
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutralSmall_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } } 
				random_list = {
					40 = { subtract_variable = { which = blHardlineVar value = 3 } }
					40 = { subtract_variable = { which = blHardlineVar value = 5 } }
					20 = { subtract_variable = { which = blHardlineVar value = 7 } }
				}
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.
				random_list = {
					40 = { change_variable = { which = blHardlineVar value = 3 } }
					40 = { change_variable = { which = blHardlineVar value = 5 } }
					20 = { change_variable = { which = blHardlineVar value = 7 } }
				}
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHumanSmall_tt
        hidden_effect = { 
			random_list = {
				40 = { change_variable = { which = blHardlineVar value = 3 } }
				40 = { change_variable = { which = blHardlineVar value = 5 } }
				20 = { change_variable = { which = blHardlineVar value = 7 } }
			}
		}
    ]
}

#HOW TO USE example: blood_lotus_hardline_stance_change_medium = { humanhardline = yes }
blood_lotus_hardline_stance_change_medium = {
	[[harimarihardline] 
        custom_tooltip = blHardlineVarHarimariMedium_tt
        hidden_effect = { subtract_variable = { which = blHardlineVar value = 10 } }
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutralMedium_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } }                              
				subtract_variable = { which = blHardlineVar value = 10 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.                          
				change_variable = { which = blHardlineVar value = 10 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHumanMedium_tt
        hidden_effect = { change_variable = { which = blHardlineVar value = 10 } }
    ]
}

#HOW TO USE example: blood_lotus_hardline_stance_change_large = { humanhardline = yes }
blood_lotus_hardline_stance_change_large = {
	[[harimarihardline] 
        custom_tooltip = blHardlineVarHarimariLarge_tt
        hidden_effect = { subtract_variable = { which = blHardlineVar value = 15 } }
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutralLarge_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } }                              
				subtract_variable = { which = blHardlineVar value = 15 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.                          
				change_variable = { which = blHardlineVar value = 15 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHumanLarge_tt
        hidden_effect = { change_variable = { which = blHardlineVar value = 15 } }
    ]
}

blood_lotus_rebellion_spawns_headquarters = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_sympathizers
				}
				superregion = rahen_superregion
				NOT = {
					calc_true_if = {
						region_for_scope_province = { has_province_modifier = blood_lotus_headquarter }
						amount = 2
					}
				}
			}
			add_province_modifier = {
				name = blood_lotus_headquarter
				duration = -1
			}
			spawn_rebels = {
				type = blood_lotus_rebel
				size = 2
				win = yes
			}
		}
	}
}

blood_lotus_rebellion_spawns_headquarters_on_guerrillas = {
	random_owned_province = {
		limit = {
			OR = {
				culture_group = upper_raheni
				culture_group = middle_raheni
				culture_group = south_raheni
				has_human_minority_trigger = yes
			}
			OR = {
				has_province_modifier = blood_lotus_guerrillas
				has_province_modifier = blood_lotus_guerrillas_hidden
			}
			superregion = rahen_superregion
			NOT = {
				# If there are more than 5 rebels there may be 2 HQ. 
				AND = {
					calc_true_if = {
						region_for_scope_province = { has_province_modifier = blood_lotus_headquarter }
						amount = 1
					}
					calc_true_if = {
						region_for_scope_province = { 
							OR = {
								has_province_modifier = blood_lotus_guerrillas 
								has_province_modifier = blood_lotus_guerrillas_hidden 
							}
						}
						amount = 5
					}
				}
				# If there are more than 5 rebels there may be 2 HQ. 
				calc_true_if = {
					region_for_scope_province = { has_province_modifier = blood_lotus_headquarter }
					amount = 2
				}
			}
		}
		add_province_modifier = {
			name = blood_lotus_headquarter
			duration = -1
		}
		spawn_rebels = {
			type = blood_lotus_rebel
			size = 2
			win = yes
		}
	}
}

blood_lotus_rebellion_spawns = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_headquarter
				}
				superregion = rahen_superregion
			}
			add_province_modifier = {
				name = blood_lotus_guerrillas
				duration = -1
			}
		}
	}
}

blood_lotus_rebellion_spawns_hidden = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_headquarter
				}
				superregion = rahen_superregion
				has_province_modifier = blood_lotus_sympathizers
			}
			add_province_modifier = {
				name = blood_lotus_guerrillas_hidden
				duration = -1
				hidden = yes
			}
		}
	}
}

blood_lotus_rebellion_spreads = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_headquarter
				}
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas
					duration = -1
				}
			}
		}
	}
}

blood_lotus_rebellion_spreads_hidden = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_headquarter
				}
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas_hidden
					duration = -1
					hidden = yes
				}
			}
		}
	}
}

blood_lotus_rebellion_moves = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				has_province_modifier = blood_lotus_guerrillas
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas
					duration = -1
				}
				PREV = { remove_province_modifier = blood_lotus_guerrillas }
			}
		}
	}
}

blood_lotus_rebellion_moves_hidden = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
				}
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas_hidden
					duration = -1
					hidden = yes
				}
				PREV = { remove_province_modifier = blood_lotus_guerrillas }
				PREV = { remove_province_modifier = blood_lotus_guerrillas_hidden }
			}
		}
	}
}

blood_lotus_rebellion_hides = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				has_province_modifier = blood_lotus_guerrillas
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas_hidden
					duration = -1
					hidden = yes
				}
				PREV = { remove_province_modifier = blood_lotus_guerrillas }
			}
		}
	}
}

blood_lotus_new_sympathizers = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				superregion = rahen_superregion
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_sympathizers
					has_province_modifier = blood_lotus_headquarter
					has_province_modifier = blood_lotus_dissuaded_sympathizers
				}
			}
			area = {
				limit = {
					OR = {
						culture_group = upper_raheni
						culture_group = middle_raheni
						culture_group = south_raheni
						has_human_minority_trigger = yes
					}
					NOT = {
						has_province_modifier = blood_lotus_sympathizers
						has_province_modifier = blood_lotus_headquarter
						has_province_modifier = blood_lotus_dissuaded_sympathizers
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				add_province_modifier = {
					name = blood_lotus_sympathizers
					duration = -1
				}
			}
		}
	}
}

blood_lotus_sympathizers_spreads = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				has_province_modifier = blood_lotus_sympathizers
				superregion = rahen_superregion
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					OR = {
						culture_group = upper_raheni
						culture_group = middle_raheni
						culture_group = south_raheni
						has_human_minority_trigger = yes
					}
					NOT = {
						has_province_modifier = blood_lotus_sympathizers
						has_province_modifier = blood_lotus_headquarter
						has_province_modifier = blood_lotus_dissuaded_sympathizers
					}
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					OR = {
						culture_group = upper_raheni
						culture_group = middle_raheni
						culture_group = south_raheni
						has_human_minority_trigger = yes
					}
					NOT = {
						has_province_modifier = blood_lotus_sympathizers
						has_province_modifier = blood_lotus_headquarter
						has_province_modifier = blood_lotus_dissuaded_sympathizers
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				area = {
					limit = {
						OR = {
							culture_group = upper_raheni
							culture_group = middle_raheni
							culture_group = south_raheni
							has_human_minority_trigger = yes
						}
						NOT = {
							has_province_modifier = blood_lotus_sympathizers
							has_province_modifier = blood_lotus_headquarter
							has_province_modifier = blood_lotus_dissuaded_sympathizers
						}
						superregion = rahen_superregion
						owned_by = ROOT
					}
					add_province_modifier = {
						name = blood_lotus_sympathizers
						duration = -1
					}
				}
			}
		}
	}
}

#------# The Command #------#
command_new_ruler_effect = {
	add_faction_influence = {
		faction = hob_$command$_command
		influence = 10
	}
	add_ruler_modifier = {
		name = command_rule_of_the_$command$
		duration = -1
	}
	change_primary_culture = $command$_command
	set_ruler_culture = $command$_command
	
	
	# if = {
		# limit = { mission_completed = R62_a_good_marshal }
		# #no unproven leadership
	# }
	# else = {
		# add_ruler_modifier = {
			# name = command_unproven_leadership
			# duration = 1825
		# }
	# }
	
	hidden_effect = {
		if = {
			limit = { mission_completed = R62_a_good_marshal }
			add_legitimacy = 100
			add_legitimacy = -25
		}
		else = {
			add_legitimacy = 100
			add_legitimacy = -50
		}
	}
}

command_set_new_campaign_effect = {
	#first clear all flags
	clr_country_flag = command_shamakhad_campaign_activated_flag
	clr_country_flag = command_dhujat_campaign_activated_flag
	clr_country_flag = command_ghavaanaj_campaign_activated_flag
	clr_country_flag = command_bhuvauri_campaign_activated_flag
	clr_country_flag = command_dhenbasana_campaign_activated_flag
	clr_country_flag = command_rakhadesh_campaign_activated_flag
	clr_country_flag = command_rahen_coast_campaign_activated_flag
	
	clr_country_flag = command_xiadao_campaign_activated_flag
	clr_country_flag = command_xianjie_campaign_activated_flag
	
	clr_country_flag = command_telebei_campaign_activated_flag
	clr_country_flag = command_hukai_campaign_activated_flag
	clr_country_flag = command_sikai_campaign_activated_flag
	clr_country_flag = command_baihon_xinh_campaign_activated_flag
	clr_country_flag = command_thidinkai_campaign_activated_flag
	clr_country_flag = command_lupulan_campaign_activated_flag
	clr_country_flag = command_arawkelin_campaign_activated_flag
	
	clr_country_flag = command_bianfang_campaign_activated_flag
	clr_country_flag = command_yanszin_campaign_activated_flag
	clr_country_flag = command_zyujyut_campaign_activated_flag
	clr_country_flag = command_tianlou_campaign_activated_flag
	clr_country_flag = command_jiantsiang_campaign_activated_flag
	
	clr_country_flag = command_tree_of_stone_campaign_activated_flag
	clr_country_flag = command_azjakuma_campaign_activated_flag
	
	#set new flags
	set_country_flag = command_$campaign$_campaign_activated_flag
	
	#swap missions
	swap_non_generic_missions = yes
}

command_complete_campaign_effect = {
	set_country_flag = command_$campaign$_campaign_completed_flag
	
	if = {
		limit = { has_country_modifier = command_unproven_leadership }
		remove_country_modifier = command_unproven_leadership
	}
	else_if = {
		limit = { has_country_modifier = command_exemplary_leadership }
		remove_country_modifier = command_exemplary_leadership
		add_ruler_modifier = {
			name = command_respected_leadership
			duration = -1
		}
	}
	else_if = {
		limit = { has_country_modifier = command_respected_leadership }
		remove_country_modifier = command_respected_leadership
		add_ruler_modifier = {
			name = command_legendary_leadership
			duration = -1
		}
	}
	else_if = {
		limit = { NOT = { has_country_modifier = command_legendary_leadership } }
		add_ruler_modifier = {
			name = command_exemplary_leadership
			duration = -1
		}
	}
	else = {
		add_mil_power = 50
	}
	
	hidden_effect = {
		change_variable = {
			which = command_completed_campaigns
			value = 1
		}
	}
	add_legitimacy_or_monarch_power = { VAL = 5 }
}

command_new_command_effect = {
	if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 5
			}
		}
		command_new_command_sub_effect = { AMOUNT = -2 }
	}
	else_if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 4
			}
		}
		command_new_command_sub_effect = { AMOUNT = -2.5 }
	}
	else_if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 3
			}
		}
		command_new_command_sub_effect = { AMOUNT = -3.33 }
	}
	else_if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 2
			}
		}
		command_new_command_sub_effect = { AMOUNT = -5 }
	}
	else = {
		command_new_command_sub_effect = { AMOUNT = -10 }
	}
	
	if = {
		limit = {
			mission_completed = R62_the_dragon_command
			mission_completed = R62_the_elephant_command
			mission_completed = R62_the_tiger_command
		}
		clr_country_flag = command_act_of_division_unlocked_flag
	}
}

command_new_command_sub_effect = {
	if = {
		limit = {
			has_estate_privilege = estate_wolf_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_wolf_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_wolf_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_wolf_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_wolf_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_boar_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_boar_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_boar_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_boar_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_boar_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_lion_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_lion_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_lion_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_lion_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_lion_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_dragon_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_dragon_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_dragon_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_dragon_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_dragon_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_elephant_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_elephant_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_elephant_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_elephant_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_elephant_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_tiger_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_tiger_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_tiger_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_tiger_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_tiger_command_act_of_division
	}
}

command_generate_move_target_canditates = {
	if = {
		limit = {
			any_owned_province = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
			save_event_target_as = command_move_target_candidate_1
			set_province_flag = command_move_target_candidate_1
		}
	}
	else = {
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
			}
			save_event_target_as = command_move_target_candidate_1
			set_province_flag = command_move_target_candidate_1
		}
	}
	if = {
		limit = {
			any_owned_province = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
			save_event_target_as = command_move_target_candidate_2
			set_province_flag = command_move_target_candidate_2
		}
	}
	else = {
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
			}
			save_event_target_as = command_move_target_candidate_2
			set_province_flag = command_move_target_candidate_2
		}
	}
	if = {
		limit = {
			any_owned_province = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
					has_province_flag = command_move_target_candidate_2
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
					has_province_flag = command_move_target_candidate_2
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
			save_event_target_as = command_move_target_candidate_3
			set_province_flag = command_move_target_candidate_3
		}
	}
	else = {
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
					has_province_flag = command_move_target_candidate_2
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
			}
			save_event_target_as = command_move_target_candidate_3
			set_province_flag = command_move_target_candidate_3
		}
	}
}

command_move_orc_slave_state = { #tag = R63 OR R64   target = command_move_target_candidate_NUMBER
	if = {
		limit = { ai = no }
		custom_tooltip = command_moving_slave_states_costs_dip_tt
		hidden_effect = {
			export_to_variable = {
				which = moveTargetDevelopment
				value = total_development
				who = $tag$
			}
			if = {
				limit = { has_country_flag = command_slave_state_reduced_move_cost_flag }
				while = {
					limit = {
						check_variable = {
							which = moveTargetDevelopment
							value = 1
						}
					}
					add_dip_power = -3
					subtract_variable = {
						which = moveTargetDevelopment
						value = 1
					}
				}
			}
			else = {
				while = {
					limit = {
						check_variable = {
							which = moveTargetDevelopment
							value = 1
						}
					}
					add_dip_power = -4
					subtract_variable = {
						which = moveTargetDevelopment
						value = 1
					}
				}
			}
		}
	}
	
	if = {
		limit = { R63 = { tag = $tag$ } }
		add_country_modifier = {
			name = hobgoblin_thunderfist_enforcers
			duration = 3650
		}
	}
	if = {
		limit = { R64 = { tag = $tag$ } }
		add_country_modifier = {
			name = hobgoblin_bloodsong_advance_guard
			duration = 3650
		}
	}
	
	event_target:$target$ = {
		area = {
			cede_province = $tag$
			if = {
				limit = { is_core = R62 }
				remove_core = R62
				add_core = $tag$
			}
		}
	}
	hidden_effect = {
		$tag$ = {
			every_owned_province = {
				limit = {
					NOT = { has_province_flag = $target$ }
				}
				if = {
					limit = { has_province_flag = command_converted_province_flag }
					add_base_manpower = -2
					change_culture = variable:previousCulture
					change_religion = variable:previousReligion
					if = {
						limit = { $tag$ = { primary_culture = wuhyun_half_orc } culture_is_human = yes }
						random_list = {
							1 = {
								if = {
									limit = { superregion = rahen_superregion }
									change_culture = kusonin
								}
								else_if = {
									limit = { superregion = yanshen_superregion }
									change_culture = ikaniwagain
								}
								else_if = {
									limit = { superregion = south_haless_superregion }
									change_culture = kintonan
								}
							}
							1 = {
								change_culture = wuhyun_half_orc
							}
						}
					}
					clr_province_flag = command_converted_province_flag
				}
				cede_province = R62
				if = {
					limit = { is_core = $tag$ }
					remove_core = $tag$
					add_core = R62
				}
			}
			random_owned_province = {
				hidden_effect = {
					export_to_variable = {
						variable_name = previousCulture
						value = culture
					}
					export_to_variable = {
						variable_name = previousReligion
						value = religion
					}
				}
				add_core = PREV
				change_culture = PREV
				change_religion = PREV
				add_base_manpower = 2
				$tag$ = {
					set_capital = PREV
				}
				
				set_province_flag = command_converted_province_flag
			}
			every_owned_province = {
				clr_province_flag = command_move_target_candidate_1
				clr_province_flag = command_move_target_candidate_2
				clr_province_flag = command_move_target_candidate_3
			}
			
			change_variable = {
				which = number_of_times_moved
				value = 1
			}
			
			if = {
				limit = { ai = yes }
				add_country_modifier = {
					name = command_slave_state_ai_accepted_culture_removal
					hidden = yes
					duration = 260
				}
			}
			add_country_modifier = {
				name = command_slave_state_adjusting_to_surroundings
				duration = 730
			}
		}
	}
	
	if = {
		limit = { has_country_flag = command_obedient_zanyu_kikunin_flag }
		$tag$ = {
			add_country_modifier = {
				name = hobgoblin_zanyu_kikun
				duration = 3650
			}
		}
	}
}

command_change_korashi_supply = {
	[[increase]
		custom_tooltip = command_change_korashi_supply_increase_tt
		hidden_effect = {
			if = {
				limit = { has_country_modifier = command_korashi_supply_4 }
				remove_country_modifier = command_korashi_supply_4
				add_country_modifier = {
					name = command_korashi_supply_5
					duration = -1
				}
			}
			else_if = {
				limit = { has_country_modifier = command_korashi_supply_3 }
				remove_country_modifier = command_korashi_supply_3
				add_country_modifier = {
					name = command_korashi_supply_4
					duration = -1
				}
			}
			else_if = {
				limit = { has_country_modifier = command_korashi_supply_2 }
				remove_country_modifier = command_korashi_supply_2
				add_country_modifier = {
					name = command_korashi_supply_3
					duration = -1
				}
			}
			else_if = {
				limit = { has_country_modifier = command_korashi_supply_1 }
				remove_country_modifier = command_korashi_supply_1
				add_country_modifier = {
					name = command_korashi_supply_2
					duration = -1
				}
			}
			else = {
				add_country_modifier = {
					name = command_korashi_supply_1
					duration = -1
				}
			}
		}
	]
	[[decrease]
		custom_tooltip = command_change_korashi_supply_decrease_tt
		hidden_effect = {
			if = {
				limit = { has_country_modifier = command_korashi_supply_5 }
				remove_country_modifier = command_korashi_supply_5
				add_country_modifier = {
					name = command_korashi_supply_4
					duration = -1
				}
			}
			else_if = {
				limit = { has_country_modifier = command_korashi_supply_4 }
				remove_country_modifier = command_korashi_supply_4
				add_country_modifier = {
					name = command_korashi_supply_3
					duration = -1
				}
			}
			else_if = {
				limit = { has_country_modifier = command_korashi_supply_3 }
				remove_country_modifier = command_korashi_supply_3
				add_country_modifier = {
					name = command_korashi_supply_2
					duration = -1
				}
			}
			else_if = {
				limit = { has_country_modifier = command_korashi_supply_2 }
				remove_country_modifier = command_korashi_supply_2
				add_country_modifier = {
					name = command_korashi_supply_1
					duration = -1
				}
			}
			else = {
				remove_country_modifier = command_korashi_supply_1
			}
		}
	]
}

command_army_resupply = {
	if = {
		limit = { has_country_modifier = command_$command$_merc_ab1_cooldown }
		custom_tooltip = command_army_resupply_instructions_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			manpower = 10
			any_hired_mercenary_company = {
				template = merc_command_$command$_army
				location = {
					has_province_modifier = command_$command$_warcamp
					controlled_by = ROOT
				}
			}
		}
		custom_tooltip = command_army_resupply_instructions_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_$command$_army
			}
			add_company_manpower = 1
		}
		add_manpower = -10
		# hidden_effect = {
			# add_country_modifier = {
				# name = command_$command$_merc_ab1_cooldown
				# duration = 3650
				# hidden = yes
			# }
		# }
	}
	else_if = {
		limit = {
			mil_power = 25
			manpower = 10
			any_hired_mercenary_company = {
				template = merc_command_$command$_army
				location = {
					has_supply_depot = ROOT
					controlled_by = ROOT
				}
			}
		}
		custom_tooltip = command_army_resupply_instructions_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_$command$_army
			}
			add_company_manpower = 0.5
		}
		add_manpower = -10
		add_mil_power = -10
		# hidden_effect = {
			# add_country_modifier = {
				# name = command_$command$_merc_ab1_cooldown
				# duration = 3650
				# hidden = yes
			# }
		# }
	}
	else = {
		custom_tooltip = command_army_resupply_instructions_tt
	}
}

command_army_settle_down = {
	if = {
		limit = { has_country_modifier = command_$command$_merc_ab2_cooldown }
		custom_tooltip = command_army_settle_down_instructions_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_command_$command$_army
				has_company_manpower = 0.5
				location = {
					owned_by = ROOT
					is_core = ROOT
					OR = {
						has_supply_depot = ROOT
						fort_level = 1
					}
				}
			}
		}
		custom_tooltip = command_army_settle_down_instructions_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_$command$_army
			}
			hidden_effect = {
				add_company_manpower = 1
				add_company_manpower = -0.5
			}
			location = {
				if = {
					limit = {
						has_large_hobgoblin_minority_trigger = yes
						NOT = { development = 12 }
					}
					change_culture = $command$_command
					change_religion = godlost
				}
				else = {
					add_hobgoblin_minority_size_effect = yes
				}
				add_base_manpower = 1
			}
			disband_mercenary_company = THIS
		}
		add_manpower = -1
		random_owned_province = {
			limit = { has_province_modifier = command_$command$_warcamp }
			add_base_manpower = -1
		}
		hidden_effect = {
			add_country_modifier = {
				name = command_$command$_merc_ab2_cooldown
				duration = 1825
				hidden = yes
			}
			
			clr_country_flag = command_armies_menu_2_open
			country_event = { id = the_command.310 }
		}
	}
	else = {
		custom_tooltip = command_army_settle_down_instructions_tt
	}
}

command_army_special_ability_wolf = {
	if = {
		limit = { has_country_modifier = command_wolf_merc_ab3_cooldown }
		custom_tooltip = command_wolf_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_wolf_army
				location = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}
		custom_tooltip = command_wolf_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_wolf_army
			}
			location = {
				area = {
					limit = { owned_by = ROOT }
					add_local_autonomy = -100
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_wolf_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
		}
	}
	else = {
		custom_tooltip = command_wolf_army_ability_3_trigger_tt
	}
}
command_army_special_ability_boar = {
	if = {
		limit = { has_country_modifier = command_boar_merc_ab3_cooldown }
		custom_tooltip = command_boar_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_boar_army
				location = {
					OR = {
						unit_in_battle = yes
						unit_in_siege = yes
					}
				}
			}
		}
		custom_tooltip = command_boar_army_ability_3_trigger_tt
		
		add_country_modifier = {
			name = command_the_march_of_the_boar
			duration = 66
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_boar_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
		}
	}
	else = {
		custom_tooltip = command_boar_army_ability_3_trigger_tt
	}
}
command_army_special_ability_lion = {
	if = {
		limit = { has_country_modifier = command_lion_merc_ab3_cooldown }
		custom_tooltip = command_lion_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_lion_army
				location = {
					owned_by = ROOT
				}
			}
		}
		custom_tooltip = command_lion_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_lion_army
			}
			location = {
				area = {
					limit = { owned_by = ROOT }
					add_province_modifier = {
						name = command_display_of_the_lion
						duration = 1825
					}
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_lion_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
		}
	}
	else = {
		custom_tooltip = command_lion_army_ability_3_trigger_tt
	}
}
command_army_special_ability_dragon = {
	if = {
		limit = { has_country_modifier = command_dragon_merc_ab3_cooldown }
		custom_tooltip = command_dragon_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_dragon_army
				location = {
					has_siege = yes
				}
			}
		}
		custom_tooltip = command_dragon_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_dragon_army
				location = {
					has_siege = yes
				}
			}
			location = {
				change_siege = 5
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_dragon_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
		}
	}
	else = {
		custom_tooltip = command_dragon_army_ability_3_trigger_tt
	}
}
command_army_special_ability_elephant = {
	if = {
		limit = { has_country_modifier = command_elephant_merc_ab3_cooldown }
		custom_tooltip = command_elephant_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_elephant_army
				location = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}
		custom_tooltip = command_elephant_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_elephant_army
			}
			location = {
				area = {
					limit = { owned_by = ROOT }
					add_province_modifier = {
						name = command_hammers_of_the_elephant
						duration = 1825
					}
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_elephant_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
		}
	}
	else = {
		custom_tooltip = command_elephant_army_ability_3_trigger_tt
	}
}
command_army_special_ability_tiger = {
	if = {
		limit = { has_country_modifier = command_tiger_merc_ab3_cooldown }
		custom_tooltip = command_tiger_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_tiger_army
				location = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}
		custom_tooltip = command_tiger_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_tiger_army
			}
			location = {
				if = {
					limit = {
						OR = {
							religion = godlost
							religion = high_philosophy
						}
					}
					add_scaled_local_adm_power = 3
					add_scaled_local_dip_power = 3
					add_scaled_local_mil_power = 3
				}
				else = {
					add_scaled_local_adm_power = 2
					add_scaled_local_dip_power = 2
					add_scaled_local_mil_power = 2
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_tiger_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
		}
	}
	else = {
		custom_tooltip = command_tiger_army_ability_3_trigger_tt
	}
}

command_weaken_capital = {
	if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t1 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t1
			add_province_modifier = {
				name = command_capital_stronghold_t2
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t2 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t2
			add_province_modifier = {
				name = command_capital_stronghold_t3
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t3 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t3
			add_province_modifier = {
				name = command_capital_stronghold_t4
				duration = -1
			}
		}
	}
}

command_strengthen_capital = {
	if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t4 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t4
			add_province_modifier = {
				name = command_capital_stronghold_t3
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t3 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t3
			add_province_modifier = {
				name = command_capital_stronghold_t2
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t2 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t2
			add_province_modifier = {
				name = command_capital_stronghold_t1
				duration = -1
			}
		}
	}
}

########################
### Tughayasa Oracle ###
########################
oracle_ruler_give_random_divination_spell_school = {
	# Talented/Renowned/Legendary Divination school, 40/40/20 chance 
	random_list = {
		40 = {
			if = {
				limit = {
					is_divination_1 = yes
				}
				set_ruler_flag = divination_2
			}
			else_if = {
				limit = {
					is_divination_2 = yes
				}
				set_ruler_flag = divination_3
			}
			else = {
				set_ruler_flag = divination_1
			}
		}
		40 = {
			if = {
				limit = {
					is_divination_2 = yes
				}
				set_ruler_flag = divination_3
			}
			else = {
				set_ruler_flag = divination_2
			}
		}
		20 = {
			set_ruler_flag = divination_1
		}
	}
}