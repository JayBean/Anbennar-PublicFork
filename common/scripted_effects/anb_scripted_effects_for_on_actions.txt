
anb_initialize_schools_effect = { #Used in on_startup on_action
	if = {
		limit = { NOT = { has_global_flag = anb_schools_initiated } }
		set_global_flag = anb_schools_initiated
		#Unbroken Claw vs Radiant Sun
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = unbroken_claw_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = radiant_sun_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = radiant_sun_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = unbroken_claw_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Radiant Sun vs Starry Eye
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = radiant_sun_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = starry_eye_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = starry_eye_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = radiant_sun_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Orange Sash vs Radiant Sun
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = orange_sash_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = radiant_sun_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = radiant_sun_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = orange_sash_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Golden Palace vs Silk Turban
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = golden_palace_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = silk_turban_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = silk_turban_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = golden_palace_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Orange Sash vs Silk Turban
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = orange_sash_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = silk_turban_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = silk_turban_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = orange_sash_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Ascendant Soul vs Silk Turban
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = ascendant_soul_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = silk_turban_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = silk_turban_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = ascendant_soul_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Ascendant Soul vs Golden Palace
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = ascendant_soul_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = golden_palace_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = golden_palace_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = ascendant_soul_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = -1
				}
			}
		}
		#Ascendant Soul vs Starry Eye
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = ascendant_soul_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = starry_eye_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = 1
				}
			}
		}
		random_country = { 
			limit = {
				religious_school = {
					group = raheni
					school = starry_eye_school
				}
			}
			random_country = {
				limit = {
					religious_school = {
						group = raheni
						school = ascendant_soul_school
					}
				}
				set_school_opinion = {
					who = PREV
					opinion = 1
				}
			}
		}
	}
}

xia_won_war_count = {
	if = {
		limit = {
			has_country_flag = xia_nation
		}
		change_variable = { xiaWarsWon = 1 }
	}
}
G35_won_war_count = {
	if = {
		limit = {
			tag = G35
		}
	}
	change_variable = { G35WarsWon = 1 }
}

feast_of_the_gods_won_war_count = {
	if = {
		limit = {
			religion = feast_of_the_gods
		}
		change_variable = { fotg_war_wins = 1 }
	}
}

feast_of_the_gods_increment_sacrifices = {
	if = {
		limit = { 
			is_subject = yes
			overlord = {
				religion = feast_of_the_gods 
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = sacrificed_ruler
					value = -100
				} # who = overlord does not work, so done this way
			}
		}
		overlord = { change_variable = { fotg_sacrifices = 1 } } # give the overlord the sacrifices
	}
}

anb_on_province_owner_change_government_reform_effect = {
	if = {
		limit = { 
			trade_goods = tropical_wood 
			owner = {
				has_reform = wood_elf_clan_inward_focus
			}
		}
		add_province_modifier = {
			name = deepwoods_government_reform_isolation_mod
			duration = -1
		}
	}
}

startup_1444_effects = {
	if = {
		limit = {
			NOT = {
				is_year = 1445	# is 1444
				is_month = 11	# is november (this trigger is 0-based, 11 is december)
			}
		}

		###########################
		# STARTUP EFFECTS GO HERE #
		###########################

		#ruler optimization
		update_ruler_racial_flag = yes
		update_heir_racial_flag = yes
		update_consort_racial_flag = yes

		if = {
			limit = {
				NOT = {
					ruler_has_personality = mortal_personality
					ruler_has_personality = immortal_personality
				}
			}
			apply_hidden_mortality_personalities = yes
		}
		if = {
			limit = {
				has_heir = yes
				heir_long_lived_race = yes
			}
			make_heir_immortal = yes
		}
		if = {
			limit = {
				has_consort = yes
				consort_long_lived_race = yes
			}
			make_consort_immortal = yes
		}


		if = {
			limit = {
				OR = {
					tag = Z15
					tag = Z08
				}
			}
			country_event = { id = ebonsteel_events.2 }
		}

		if = {
			limit = {
				OR = {
					was_tag = Y20
					tag = Y20
				}
			}
			save_global_event_target_as = feiten_or_was_feiten_target
		}

		if = {
			limit = { tag = REB }
			emperor = {
				save_global_event_target_as = Emperor
			}
		}

		if = {
			limit = { is_emperor_of_china = yes }
			save_global_event_target_as = EmperorOfChina
		}
	
		if = {
			limit = {
				religion = aakhetist
				has_country_flag = current_aakhet_host
			}
			save_global_event_target_as = aakhet_host
		}

		if = {
			limit = {
				tag = A06
			}
			A06 = { country_event = { id = gnomish.4 days = 1830 } }
		}

		if = {
			limit = {
				tag = S70
			}
			A06 = { country_event = { id = shadow.1 } }
		}

		if = {
			limit = {
				ai = no
				capital_scope = {
					superregion = ynn_superregion
				}
			}
			country_event = { id = ynn_events.991 days = 30 }
		}

		if = {
			limit = {
				tag = G26
			}
			country_event = { id = flavour_amacimst.0 days = 15 }
		}

		country_event = {
			id = anbennar_setup.20
			days = 32
		}

		##aakhetist starting tags minus aramoole
		if = {
			limit = { 
				tag = F70 #Mattabo 
			}
			country_event = { id = aakhetist.04 }
		}

		if = {
			limit = {
				has_country_flag = has_caste_estates
			}
			#Introduction to the castes
			country_event = {
				id = estate_castes_events.0
				days = 15
			}
		}

		# Add wine to Wine Lords
		if = {
			limit = {
				OR = {
					has_reform = wine_lord_reform
					has_reform = roilsard_elective
					has_reform = wineport_merchants
				}
			}
			every_owned_province = {
				limit = {
					trade_goods = wine
				}
				add_province_modifier = {
					name = wine_lord_wine
					duration = -1
					hidden = yes
				}
			}
		}

		# Add sugar bonus to Keyolion (From Gov Reform)
		if = {
			limit = {
				has_reform = G58_agronomers_association_reform
			}
			every_owned_province = {
				limit = {
					trade_goods = sugar
				}
				add_province_modifier = {
					name = G58_sugar_province_goods
					duration = -1
					hidden = yes
				}
			}
		}

		# Frontier Republics
		if = {
			limit = {
				has_reform = frontier_republic_reform
			}
			every_owned_province = {
				limit = {
					trade_goods = livestock
				}
				add_province_modifier = {
					name = livestock_boost_frontier
					duration = -1
					hidden = yes
				}
			}
			every_owned_province = {
				limit = {
					has_terrain = steppe
				}
				add_province_modifier = {
					name = frontier_republic_steppe_expansion
					duration = -1
					hidden = yes
				}
			}
		}

		#Mulen goblin setup
		if = {
			limit = { tag = F50 }
			country_event = {
				id = flavour_mulen.3
				days = 3650
			}
		}

		#company of thorns high stability
		if = {
			limit = { tag = B11 }
			country_event = {
				id = flavor_luciande.54
				days = 30
			}
		}

		if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = escann_superregion
						region = forlorn_vale_region
					}
					NOT = {
						region = dostanor_region
						region = ourdia_region
						region = daravans_folly_region
					}
				}
				NOT = {
					culture_group = orcish
					culture_group = goblin
				}
				NOT = { tag = A32 }	#Dont let Ibevar, Silent Repose, and Orda Aldresia get this
				NOT = { tag = A83 }
				NOT = { tag = A77 }
			}
			country_event = { id = greentide.0 days = 1 }
		}

		if = {
			limit = {
				tag = G40 # Tehanek
			}
			country_event = { id = damestear.4 days = 14600 random = 3650 }
		}


		if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = escann_superregion
						region = forlorn_vale_region
					}
					NOT = { region = dostanor_region region = ourdia_region }
				}
				OR = {
					culture_group = orcish
					culture_group = goblin
				}
			}
			country_event = { id = greentide.1 days = 1 }
		}

		if = {
			limit = {
				tag = Z18
			}
			country_event = { id = greentide.2 days = 1 }
		}

		if = {
			limit = {
				culture = white_reachman
			}
			country_event = { id = greentide.3 days = 1 }
		}
	
		if = {
			limit = {
				capital_scope = { superregion = deepwoods_superregion }
				religion = great_dookan
			}
			country_event = { id = greentide.4 days = 1 }
		}
		
		if = {
			limit = {
				tag = A32
				NOT = { has_country_flag = ibevar_reformation_flag }
			}
			every_owned_province = {
				limit = { has_province_modifier = ibevar_old_tradition }
				set_variable = { which = ibReform value = 100 }
			}
			set_country_flag = ibevar_reformation_flag
		}
	
		if = {
			limit = {
				tag = Y58
			}
			country_event = { id = lotdekkhang.4 days = 3 } #Lot Dekkhang intro event and setting up hobgoblin tolerance
		}
	
		if = {
			limit = {
				owns_core_province = 4565
			}
			country_event = { id = bim_lau_flavour.4 days = 1 } #Bim Lau Necropolis Setup
    	}
	
    	if = {
			limit = {
				tag = Y09
			}
			country_event = {
				id = bianfang.7 	#tyrant system setup
				days = 1
			}
		}

		if = {
			limit = {
				tag = A13
			}
			country_event = {
				id = flavor_gawed.4 			#Derek Deland
				days = 10
			}
		}
	
		#Khom civil war events START
		if = {
			limit = {
				tag = Y67	#Ma Hoang
			}
			country_event = {
				id = khom_civilwar.1
			}
		}
		if = {
			limit = {
				tag = Y66	#Hon Sai
			}
			country_event = {
				id = khom_civilwar.2
			}
		}
		if = {
			limit = {
				tag = Y71	#Kudet Kai
			}
			country_event = {
				id = khom_civilwar.3
			}
		}
		if = {
			limit = {
				tag = Y72	#Chien Binhrung
			}
			country_event = {
				id = khom_civilwar.4
			}
		}
		if = {
			limit = {
				tag = Y63	#Verkal Ozovar
			}
			country_event = {
				id = khom_civilwar.10
				days = 20
				random = 20
			}
		}
		if = {
			limit = {
				tag = Y76	#Jaya Raya
			}
			country_event = {
				id = khom_civilwar.15
				days = 20
				random = 20
			}
		}
		if = {
			limit = {
				tag = Y73	#Sirtan
			}
			country_event = {
				id = khom_civilwar.20
				days = 40
				random = 40
			}
		}
		if = {
			limit = {
				tag = Y67	#Ma Hoang
			}
			country_event = {
				id = khom_civilwar.26
				days = 270
				random = 90
			}
		}
		#Khom civil war events END

		if = {
			limit = {
				has_dlc = "Cradle of Civilization"
				has_country_modifier = tur_janissary
			}
			remove_country_modifier = tur_janissary
		}

		anb_initialize_schools_effect = yes

		if = {
			limit = { OR = { tag = J06 tag = J07 } }
			country_event = { id = lake.42 } #Explain Ultakal Decree
		}
		#Mother Akasik event cycle start
		if = {
			limit = {
				NOT = { has_global_flag = akasik_cycle_timer }
			}
			set_global_flag = akasik_cycle_timer
			random_country = {
				country_event = {
					id = mother_akasik.4
					days = 1315
				}
			}
		}
		set_global_flag = mother_akasik_2

		#Mother akasik mountain count start
		if = {
			limit = { tag = REB }
			country_event = { id = mother_akasik.0 }
		}
	
		if = {
			limit = { tag = R51 NOT = { check_variable = { diplomaticAnnexations = 1 } } }
			set_variable = { diplomaticAnnexations = 0 }
		}
	
		ynnic_setup_effect = yes
		#Ynn Worship event cycle start
		if = {
			limit = {
				NOT = { has_global_flag = ynn_cycle_timer }
			}
			set_global_flag = ynn_cycle_timer
			random_country = {
				country_event = {
					id = ynn_zodiac.1
					days = 1145
				}
			}
		}
		set_global_flag = ynn_zodiac_7
	
		if = {
			limit = {
				tag = G33
			}
			country_event = { id = flavour_bosancovac.010 }
		}
	
		update_magic_study_experience_modifier = {}
	
		# Expedition
		if = {
			limit = { tag = REB }
			country_event = { id = diggy_expedition.0 }
		}
	
		if = { #Starts Azjakuma - Command Truce | sets event to give aikogeoke to owner of akhortosal 70 years after start
			limit = {
				tag = Y01
				NOT = { has_country_flag = oni_truce_happened } #because it happens 15 days after game start
				#prevents happening multiple times if you reload before then
			}
			country_event = {
				id = flavor_azjakuma.15
				days = 15
			}
			set_country_flag = oni_truce_happened #cleared when event is fired, it has fire_only_once
		}
	
		#Remnant colonist removal
		if = {
			limit = {
				has_country_flag = dwarovar_remnant
				NOT = { has_country_flag = remnant_stagnation_disaster_end }
				NOT = { has_country_modifier = remnant_legacy }
			}
			add_country_modifier = { name = remnant_legacy duration = 31 hidden = yes }
		}
	
		if = { #sets dev cost reduction in capital area on game start, might move to history files once all governments are in
			limit = {
				has_government_attribute = lower_dev_cost_in_capital_state
				NOT = { capital_scope = { has_province_modifier = lower_dev_cost_in_capital_state_modifier } }
			}
			capital_scope = {
				area = {
					add_province_modifier = {
						name = lower_dev_cost_in_capital_state_modifier
						duration = -1
						hidden = yes
					}
				}
			}
		}
		if = { #sets gov cost reduction in capital region on game start, might move to history files once all governments are in
			limit = {
				has_government_attribute = lower_gov_cost_in_home_region
				NOT = { capital_scope = { has_province_modifier = lower_gov_cost_in_home_region_modifier } }
			}
			capital_scope = {
				region = {
					add_province_modifier = {
						name = lower_gov_cost_in_home_region_modifier
						duration = -1
						hidden = yes
					}
				}
			}
		}
	
		# Yinquan
		if = {
			limit = { tag = Y26 NOT = { check_variable = { yinquanBattlesWon = 1 } } }
			set_variable = { yinquanBattlesWon = 0 }
		}
	
		# Nekheis less LD
		if = {
			limit = {
				OR = {
					tag = G53
					tag = G54
					tag = G55		
					tag = G57
					tag = G58
				}
				overlord = {
					ai = yes
				}
			}
			add_country_modifier = {
				name = nekheis_less_LD
				duration = 7300
				hidden = yes
			}
		}
		
		#Effelai Worship Startup Events
		if = {
			limit = {
				religion = chahinanito
				NOT = {
					num_of_cities = 2
				}
			}
			country_event = {
				id = effelai_worship.2
			}
		}
		if = {
			limit = {
				religion = tswohvwohii
				NOT = {
					num_of_cities = 2
				}
			}
			country_event = {
				id = effelai_worship.402
			}
		}
		if = {
			limit = {
				religion = senanset
				NOT = {
					num_of_cities = 2
				}
			}
			country_event = {
				id = effelai_worship.302
			}
		}

		#dwarovar reclaimer
		if = { limit = { capital_scope = { continent = serpentspine } }
			add_country_modifier = { name = reclaiming_dwarovar duration = -1 }
		}

		# fotg setup
		if = {
			limit = { 
				religion = feast_of_the_gods
			}
			set_variable = {
				which = fotg_war_wins
				value = 0
			}
		}

		if = {
			limit = { NOT = { has_global_flag = rending_setup } }
			set_global_flag = rending_setup
			4871 = {
				set_variable = {
					value = 60
					which = globalWardStrength
				}
			}
		}

		#rending ma appeasement pillage counter
		if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = rahen_superregion
						superregion = yanshen_superregion
						superregion = south_haless_superregion
					}
				}
			}
			set_variable = {
				which = rending_pillage_counter_variable
				value = 0
			}
		}

		#cardesti starup
		if = {
			limit = {
				tag = REB
			}
			country_event = { id = cardesti_events.21 days = 2 }
		}

		if = { #dakinshi warlord startup
			limit = {
				OR = {
					primary_culture = dakinshi
					tag = L63
				}
			}
			country_event = {
				id = dakinshi.13
			}
		}

		#Deyeion set variable
		if = {
			limit = {
				tag = G56
			}
			set_variable = {
				which = G56_beat_natives_variable
				value = 0
			}
		}

		#AI needs this mission event early to stop it from releasing stuff
		if = {
			limit = {
				tag = A30
				ai = yes
			}
			country_event = { id = flavor_wex.2 }
		}
	}
}
