shadow_pact_random_portent = {
	random_list = {
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = sorcerer }
			}
			add_church_aspect = shadow_pact_sorcerer_$type$
			set_country_flag = shadow_pact_last_set_sorcerer
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = wraith }
			}
			add_church_aspect = shadow_pact_wraith_$type$
			set_country_flag = shadow_pact_last_set_wraith
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = three_urns }
			}
			add_church_aspect = shadow_pact_three_urns_$type$
			set_country_flag = shadow_pact_last_set_three_urns
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = silat }
			}
			add_church_aspect = shadow_pact_silat_$type$
			set_country_flag = shadow_pact_last_set_silat
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = tree }
			}
			add_church_aspect = shadow_pact_tree_$type$
			set_country_flag = shadow_pact_last_set_tree
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = flame }
			}
			add_church_aspect = shadow_pact_flame_$type$
			set_country_flag = shadow_pact_last_set_flame
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = flayed_man }
			}
			add_church_aspect = shadow_pact_flayed_man_$type$
			set_country_flag = shadow_pact_last_set_flayed_man
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = meteor }
			}
			add_church_aspect = shadow_pact_meteor_$type$
			set_country_flag = shadow_pact_last_set_meteor
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = tyrant }
			}
			add_church_aspect = shadow_pact_tyrant_$type$
			set_country_flag = shadow_pact_last_set_tyrant
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = sleeper }
			}
			add_church_aspect = shadow_pact_sleeper_$type$
			set_country_flag = shadow_pact_last_set_sleeper
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = burden }
			}
			add_church_aspect = shadow_pact_burden_$type$
			set_country_flag = shadow_pact_last_set_burden
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = time }
				NOT = { has_ruler_flag = shadow_pact_time_effect }
			}
			add_church_aspect = shadow_pact_time_$type$
			set_country_flag = shadow_pact_last_set_time
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = defiant }
			}
			add_church_aspect = shadow_pact_defiant_$type$
			set_country_flag = shadow_pact_last_set_defiant
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = madness }
			}
			add_church_aspect = shadow_pact_madness_$type$
			set_country_flag = shadow_pact_last_set_madness
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = golem }
			}
			add_church_aspect = shadow_pact_golem_$type$
			set_country_flag = shadow_pact_last_set_golem
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = vulture }
			}
			add_church_aspect = shadow_pact_vulture_$type$
			set_country_flag = shadow_pact_last_set_vulture
		}
		1 = {
			trigger = {
				shadow_pact_random_portent_check = { portent = mother }
			}
			add_church_aspect = shadow_pact_mother_$type$
			set_country_flag = shadow_pact_last_set_mother
		}
	}
}

shadow_pact_remove_last_set = {
	clr_country_flag = shadow_pact_last_set_sorcerer
	clr_country_flag = shadow_pact_last_set_wraith
	clr_country_flag = shadow_pact_last_set_three_urns
	clr_country_flag = shadow_pact_last_set_silat
	clr_country_flag = shadow_pact_last_set_tree
	clr_country_flag = shadow_pact_last_set_flame
	clr_country_flag = shadow_pact_last_set_flayed_man
	clr_country_flag = shadow_pact_last_set_meteor
	clr_country_flag = shadow_pact_last_set_tyrant
	clr_country_flag = shadow_pact_last_set_sleeper
	clr_country_flag = shadow_pact_last_set_burden
	clr_country_flag = shadow_pact_last_set_time
	clr_country_flag = shadow_pact_last_set_defiant
	clr_country_flag = shadow_pact_last_set_madness
	clr_country_flag = shadow_pact_last_set_golem
	clr_country_flag = shadow_pact_last_set_vulture
	clr_country_flag = shadow_pact_last_set_mother
}

shadow_pact_remove_portent_flags = {
	clr_country_flag = shadow_pact_sorcerer_active
	clr_country_flag = shadow_pact_wraith_active
	clr_country_flag = shadow_pact_three_urns_active
	clr_country_flag = shadow_pact_silat_active
	clr_country_flag = shadow_pact_tree_active
	clr_country_flag = shadow_pact_flame_active
	clr_country_flag = shadow_pact_flayed_man_active
	clr_country_flag = shadow_pact_meteor_active
	clr_country_flag = shadow_pact_tyrant_active
	clr_country_flag = shadow_pact_sleeper_active
	clr_country_flag = shadow_pact_burden_active
	clr_country_flag = shadow_pact_time_active
	clr_country_flag = shadow_pact_defiant_active
	clr_country_flag = shadow_pact_madness_active
	clr_country_flag = shadow_pact_golem_active
	clr_country_flag = shadow_pact_vulture_active
	clr_country_flag = shadow_pact_mother_active
}

shadow_pact_reset_portents_count = {
	clr_country_flag = shadow_pact_first_portent
	clr_country_flag = shadow_pact_second_portent
	clr_country_flag = shadow_pact_third_portent
}

shadow_pact_remove_all_portents = {
	shadow_pact_remove_one_portent_type = { type = adm }
	shadow_pact_remove_one_portent_type = { type = dip }
	shadow_pact_remove_one_portent_type = { type = mil }
}

shadow_pact_remove_one_portent_type = {
	if = {
		limit = { has_church_aspect = shadow_pact_sorcerer_$type$ }
		remove_church_aspect = shadow_pact_sorcerer_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_wraith_$type$ }
		remove_church_aspect = shadow_pact_wraith_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_three_urns_$type$ }
		remove_church_aspect = shadow_pact_three_urns_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_silat_$type$ }
		remove_church_aspect = shadow_pact_silat_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_tree_$type$ }
		remove_church_aspect = shadow_pact_tree_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_flame_$type$ }
		remove_church_aspect = shadow_pact_flame_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_flayed_man_$type$ }
		remove_church_aspect = shadow_pact_flayed_man_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_meteor_$type$ }
		remove_church_aspect = shadow_pact_meteor_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_tyrant_$type$ }
		remove_church_aspect = shadow_pact_tyrant_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_sleeper_$type$ }
		remove_church_aspect = shadow_pact_sleeper_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_burden_$type$ }
		remove_church_aspect = shadow_pact_burden_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_time_$type$ }
		remove_church_aspect = shadow_pact_time_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_defiant_$type$ }
		remove_church_aspect = shadow_pact_defiant_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_madness_$type$ }
		remove_church_aspect = shadow_pact_madness_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_golem_$type$ }
		remove_church_aspect = shadow_pact_golem_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_vulture_$type$ }
		remove_church_aspect = shadow_pact_vulture_$type$
	}
	else_if = {
		limit = { has_church_aspect = shadow_pact_mother_$type$ }
		remove_church_aspect = shadow_pact_mother_$type$
	}
}

shadow_pact_re_roll_last_portent = {
	if = {
		limit = {
			NOT = {
				shadow_pact_portents_dip = yes
				shadow_pact_portents_mil = yes
			}
		}
		remove_church_aspect = shadow_pact_$portent$_adm
		shadow_pact_random_portent = { type = adm }
	}
	else_if = {
		limit = {
			NOT = {
				shadow_pact_portents_mil = yes
			}
		}
		remove_church_aspect = shadow_pact_$portent$_dip
		shadow_pact_random_portent = { type = dip }
	}
	else = {
		remove_church_aspect = shadow_pact_$portent$_mil
		shadow_pact_random_portent = { type = mil }
	}
}

shadow_pact_three_urns_effect = {
	export_to_variable = {
		which = shadow_pact_development
		value = total_development
	}
	divide_variable = {
		which = shadow_pact_development
		value = 100
	}
	if = {
		limit = {
			check_variable = {
				which = shadow_pact_development
				value = 1
			}
		}
		while = {
			limit = {
				check_variable = {
					which = shadow_pact_development
					value = 1
				}
			}
			random_owned_province = {
				limit = {
					NOT = { has_province_flag = buffed_by_three_urns }
				}
				add_base_manpower = 1
				add_base_production = 1
				add_base_tax = 1
				set_province_flag = buffed_by_three_urns
			}
			subtract_variable = {
				which = shadow_pact_development
				value = 1
			}
		}
		every_owned_province = {
			limit = {
				has_province_flag = buffed_by_three_urns
			}
			clr_country_flag = buffed_by_three_urns
		}
	}
}

shadow_pact_tree_effect = {
	random_owned_province = {
		limit = {
			has_fort_building_trigger = yes
			NOT = { has_building = fort_18th }
		}
		if = {
			limit = { has_building = fort_17th }
			add_building = fort_18th
		}
		if = {
			limit = { has_building = fort_16th }
			add_building = fort_17th
		}
		if = {
			limit = { has_building = fort_15th }
			add_building = fort_16th
		}
	}
}