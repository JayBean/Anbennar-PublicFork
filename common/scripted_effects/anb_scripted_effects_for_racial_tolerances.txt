
# These are the effects used to lower/increase different tolerances
# These are here to make it easier for the devs to mod events (also allows smaller adjustment of event effects)
# All of these either increase or decrease the current tolerance by 5, 10, 15 or 20.

reset_racial_military_via_administration = {
	if = {
		limit = {
			has_country_modifier = orcish_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = orcish_military
			duration = -1
		}
		if = {
			limit = {
				OR = {
					capital_scope = {
						continent = serpentspine
					}
					dwarovar_orc_culture_primary = yes
					AND = {
						dwarovar_orc_culture_accepted = yes
						NOT = { culture_group = orcish }
					}
				}
			}
			change_unit_type = tech_black_orcish
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = {
						continent = asia
						NOT = { superregion = forbidden_lands_superregion }
					}
					primary_culture = brown_orc
					AND = {
						accepted_culture = brown_orc
						NOT = { culture_group = orcish }
					}
				}
			}
			change_unit_type = tech_east_orcish
		}
		else = {
			change_unit_type = tech_orcish
		}
	}
	else_if = {
		limit = {
			has_country_modifier = human_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = human_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				capital_scope = { superregion = bulwar_superregion }
			}
			change_unit_type = tech_bulwari
		}
		else_if = {
			limit = {
				capital_scope = { superregion = north_salahad_superregion }
			}
			change_unit_type = tech_salahadesi
		}
		else_if = {
			limit = {
				capital_scope = { superregion = south_salahad_superregion }
			}
			change_unit_type = tech_salahadesi
		}
		else_if = {
			limit = {
				capital_scope = { superregion = tanib_dajek_superregion }
			}
			change_unit_type = tech_west_sarhaly
		}
		else_if = {
			limit = {
				capital_scope = { superregion = east_sarhal_superregion }
			}
			if = {
				limit = { 
					OR = {
						accepted_culture = tanizu
						accepted_culture = antmvura
						accepted_culture = kombedak
						accepted_culture = umsozidak
						accepted_culture = wakoodak
					}
					NOT = { culture_group = inyaswarosa }
				}
				change_unit_type = tech_inyaswarosa
			}
			else = { change_unit_type = tech_east_sarhaly }
		}
		else_if = {
			limit = {
				capital_scope = { 
					OR = { 
						superregion = djinnakah_superregion
						superregion = taneyas_superregion
					}
				}
			}
			if = {
				limit = { 
					OR = {
						accepted_culture = suhratbi
						accepted_culture = dhebiji
						accepted_culture = guryadagga
						accepted_culture = ashamadi
					}
					NOT = { culture_group = baashidi }
				}
				change_unit_type = tech_baashidi
			}
			else = { change_unit_type = tech_south_sarhaly }
		}
		else_if = {
			limit = {
				capital_scope = { superregion = rahen_superregion }
			}
			change_unit_type = tech_raheni
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
				}
			}
			change_unit_type = tech_halessi
		}
		else_if = {
			limit = {
				capital_scope = { superregion = north_haless_superregion }
			}
			if = {
				limit = {
					primary_culture = shuvuush
				}
				change_unit_type = tech_shuvuush
			}
			else = {
				change_unit_type = tech_wastelander
			}
		}
		else_if = {
			limit = {
				capital_scope = { superregion = forbidden_lands_superregion }
			}
			change_unit_type = tech_triunic
		}
		else_if = {
			limit = {
				capital_scope = { superregion = gerudia_superregion }
			}
			change_unit_type = tech_gerudian
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = broken_lands_superregion }
					capital_scope = { superregion = eordand_superregion }
					capital_scope = { superregion = ynn_superregion }
				}
			}
			change_unit_type = tech_ynnsmen
		}
		else = {
			change_unit_type = tech_cannorian
		}
	}
	else_if = {
		limit = {
			has_country_modifier = elven_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = elven_military
			duration = -1
			hidden = yes
		}
		if = { limit = { NOT = { has_dlc = "Cradle of Civilization" } }
			add_country_modifier = { 
				name = elven_military_no_dlc
				duration = -1  
			}
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = deepwoods_superregion }
					primary_culture = wood_elf
					AND = {
						accepted_culture = wood_elf
						NOT = { culture_group = elven }
					}
				}
			}
			change_unit_type = tech_wood_elf
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { continent = asia }
					capital_scope = { continent = africa }
					AND = {
						OR = {
							capital_scope = { continent = north_america }
							capital_scope = { continent = south_america }
						}
						religion_group = bulwari
					}
					primary_culture = sun_elf
					primary_culture = dawn_elf
					primary_culture = desert_elf
					primary_culture = sunrise_elf
					primary_culture = sunset_elf
					AND = {
						accepted_culture = sun_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = dawn_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = desert_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = sunrise_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = sunset_elf
						NOT = { culture_group = elven }
					}
				}
			}
			change_unit_type = tech_east_elven
		}
		else = {
			change_unit_type = tech_elven
		}
	}
	else_if = {
		limit = {
			has_country_modifier = half_elven_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = half_elven_military
			duration = -1
			hidden = yes
		}
		change_unit_type = tech_cannorian
	}

	else_if = {
		limit = {
			has_country_modifier = half_orcish_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = half_orcish_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = gerudia_superregion }
					primary_culture = grombar_half_orc
					primary_culture = grombar_orc
					primary_culture = gray_orc
					AND = {
						accepted_culture = grombar_half_orc
						NOT = { culture_is_half_orcish = yes }
					}
					AND = {
						accepted_culture = grombar_orc
						NOT = { culture_is_half_orcish = yes }
					}
					AND = {
						accepted_culture = gray_orc
						NOT = { culture_is_half_orcish = yes }
					}
				}
			}
			change_unit_type = tech_gerudian
		}
		else = {
			change_unit_type = tech_cannorian
		}
	}
	else_if = {
		limit = {
			has_country_modifier = troll_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = troll_military
			duration = -1
			hidden = yes
		}
		if = {
            limit = {
                OR = {
                    capital_scope = { region = yezel_mora_region }
                    primary_culture = swamp_troll
                    AND = {
                        accepted_culture = swamp_troll
                        NOT = { culture_group = giantkind }
                    }
                }
            }
            change_unit_type = tech_swamp_troll
        }
        else_if = {
        	limit = {
        		OR = {
        			capital_scope = { continent = asia NOT = { superregion = forbidden_plains_superregion } }
        			primary_culture = hill_troll
        			AND = {
        				accepted_culture = hill_troll
        				NOT = { culture_group = giantkind }
        			}
        		}
        	}
        	change_unit_type = tech_hill_troll
        }
        else = {
            change_unit_type = tech_northern_troll    #may need custom one
        }
	}
	else_if = {
		limit = {
			has_country_modifier = gnollish_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = gnollish_military
			duration = -1
		}
		change_unit_type = tech_gnollish
		if = {
			limit = { is_tribal = no }
			set_country_flag = gnoll_reformed_mil_flag
		}
	}
	else_if = {
		limit = {
			has_country_modifier = goblin_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = goblin_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { continent = serpentspine }
					dwarovar_goblin_culture_primary = yes
					AND = {
						dwarovar_goblin_culture_accepted = yes
						NOT = { culture_group = goblin }
					}
				}
			}
			change_unit_type = tech_cave_goblin
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = bulwar_superregion }
					primary_culture = exodus_goblin
					AND = {
						accepted_culture = exodus_goblin
						NOT = { culture_group = goblin }
					}
				}
			}
			change_unit_type = tech_exodus_goblin
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = deepwoods_superregion }
					primary_culture = forest_goblin
					AND = {
						accepted_culture = forest_goblin
						NOT = { culture_group = goblin }
					}
				}
			}
			change_unit_type = tech_forest_goblin
		}
		else = {
			change_unit_type = tech_goblin
		}
	}
	else_if = {
		limit = {
			has_country_modifier = gnomish_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = gnomish_military
			duration = -1
			hidden = yes
		}
		add_country_modifier = {
			name = gnomish_military_artificer_buff
			duration = -1
			hidden = yes
		}
		change_unit_type = tech_gnomish
	}
	else_if = {
		limit = {
			has_country_modifier = dwarven_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = dwarven_military
			duration = -1
			hidden = yes
		}
		change_unit_type = tech_dwarven
	}
	else_if = {
		limit = {
			has_country_modifier = kobold_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = kobold_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					capital_scope = { superregion = rahen_superregion }
					primary_culture = goldscale_kobold
					primary_culture = dragonfire_kobold
					AND = {
						accepted_culture = goldscale_kobold
						NOT = { culture_group = kobold }
					}
					AND = {
						accepted_culture = dragonfire_kobold
						NOT = { culture_group = kobold }
					}
				}
			}
			change_unit_type = tech_east_kobold
		}
		else_if = {
			limit = {
				capital_scope = { continent = serpentspine }
			}
			change_unit_type = tech_darkscale_kobold
		}
		else = {
			change_unit_type = tech_kobold
		}
	}
	else_if = {
		limit = {
			has_country_modifier = ruinborn_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = ruinborn_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = ynn_superregion }
					capital_scope = { region = forest_of_the_cursed_ones_region }
				}
			}
			change_unit_type = tech_ynnic
		}
		else_if = {
			limit = {
				capital_scope = { superregion = eordand_superregion }
			}
			change_unit_type = tech_eordand
		}
		else_if = {
			limit = {
				capital_scope = { superregion = kheionai_superregion }
			}
			if = {
				limit = {
					OR = {
						culture_group = eltibhari_ruinborn_elf
						culture_group = devandi_ruinborn_elf
					}
				}
				change_unit_type = tech_bharbhen
			}
			else = {
				change_unit_type = tech_kheionai
			}
		}
		else_if = {
			limit = {
				capital_scope = { superregion = taychend_superregion }
			}
			if = {
				limit = {
					OR = {
						culture_group = eltibhari_ruinborn_elf
						culture_group = devandi_ruinborn_elf
						capital_scope = { region = chendhya_region }
					}
				}
				change_unit_type = tech_bharbhen
			}
			else = {
				change_unit_type = tech_taychendi
			}
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { region = haraf_region }
					capital_scope = { region = tor_nayyi_region }
				}
			}
			change_unit_type = tech_harafic
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = broken_lands_superregion }
					capital_scope = { superregion = ruin_proper_superregion }
				}
			}
			change_unit_type = tech_noruin
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = effelai_superregion }
					capital_scope = { region = amadia_region }
				}
			}
			if = {
				limit = {
					OR = {
						culture_group = eltibhari_ruinborn_elf
						culture_group = devandi_ruinborn_elf
					}
				}
				change_unit_type = tech_bharbhen
			}
			else = {
				change_unit_type = tech_south_aelantiri
			}
		}
		else = {
			change_unit_type = tech_noruin
		}
	}
	else_if = {
		limit = {
			has_country_modifier = harpy_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = harpy_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					primary_culture = pezarangi_harpy
					primary_culture = reishao_harpy
					AND = {
						accepted_culture = pezarangi_harpy
						NOT = { culture_group = harpy }
					}
					AND = {
						accepted_culture = reishao_harpy
						NOT = { culture_group = harpy }
					}
				}
			}
			change_unit_type = tech_pezarangi_harpy
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = north_salahad_superregion }
					capital_scope = { superregion = tanib_dajek_superregion }
					capital_scope = { superregion = fangaula_superregion }
					primary_culture = nzeri_harpy
					AND = {
						accepted_culture = nzeri_harpy
						NOT = { culture_group = harpy }
					}
				}
			}
			change_unit_type = tech_nzeri_harpy
		}
		else = {
			change_unit_type = tech_firanyan_harpy
		}
	}
	else_if = {
		limit = {
			has_country_modifier = halfling_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = halfling_military
			duration = -1
			hidden = yes
		}
        if = {
            limit = {
                OR = {
                    capital_scope = {
						superregion = tanib_dajek_superregion
					}
					is_vyzemby_primary_culture = yes
                    AND = {
						OR = {
							accepted_culture = amezatany
							accepted_culture = mboala
							accepted_culture = mazava
							accepted_culture = fomarati
							accepted_culture = vyoronsi
							accepted_culture = zohebidi
						}
                        NOT = { is_vyzemby_primary_culture = yes }
                    }
                }
            }
            change_unit_type = tech_vyzemby
        }
        else = {
            change_unit_type = tech_halfling    #may need custom one
        }
	}
	else_if = {
		limit = {
			has_country_modifier = ogre_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = ogre_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					capital_scope = { superregion = rahen_superregion }
					primary_culture = horned_ogre
					AND = {
						accepted_culture = horned_ogre
						NOT = { culture_group = ogre }
					}
				}
			}
			change_unit_type = tech_eastern_ogre
		}
		else = {
			change_unit_type = tech_ogre	#may need custom one
		}
	}
	else_if = {
		limit = {
			has_country_modifier = centaur_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = centaur_military
			duration = -1
			hidden = yes
		}
		change_unit_type = tech_centaur
	}
	else_if = {
		limit = {
			has_country_modifier = harimari_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = harimari_military
			duration = -1
			hidden = yes
		}
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					primary_culture = serene_harimari
					primary_culture = roaming_harimari
					AND = {
						accepted_culture = serene_harimari
						NOT = { culture_group = harimari }
					}
					AND = {
						accepted_culture = roaming_harimari
						NOT = { culture_group = harimari }
					}
				}
			}
			change_unit_type = tech_east_harimari
		}
		else = {
			change_unit_type = tech_west_harimari
		}
	}
	else_if = {
		limit = {
			has_country_modifier = hobgoblin_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = hobgoblin_military
			duration = -1
			hidden = yes
		}
		if = { limit = { NOT = { has_dlc = "Cradle of Civilization" } }
			add_country_modifier = { 
				name = hobgoblin_military_no_dlc
				duration = -1  
			}
		}
		if = {
			limit = { capital_scope = { superregion = north_haless_superregion } }
			change_unit_type = tech_eagle_hobgoblin
		}
		else = {
			change_unit_type = tech_hobgoblin
		}
	}
	else_if = {
		limit = {
			has_country_modifier = lizardfolk_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = lizardfolk_military
			duration = -1
			hidden = yes
		}
		change_unit_type = tech_lizardfolk
	}
	else_if = {
		limit = {
			has_country_modifier = mechanim_administration
		}
		add_country_modifier = {
			name = restructuring_military
			duration = 3650
		}
		add_country_modifier = {
			name = mechanim_military
			duration = -1
			hidden = yes
		}
		change_unit_type = tech_mechanim
	}
}

clear_racial_administration = {
	remove_country_modifier = elven_administration
	remove_country_modifier = dwarven_administration
	remove_country_modifier = gnomish_administration
	remove_country_modifier = half_orcish_administration
	remove_country_modifier = half_elven_administration
	remove_country_modifier = kobold_administration
	remove_country_modifier = troll_administration
	remove_country_modifier = halfling_administration
	remove_country_modifier = harpy_administration
	remove_country_modifier = human_administration
	remove_country_modifier = orcish_administration
	remove_country_modifier = goblin_administration
	remove_country_modifier = gnollish_administration
	remove_country_modifier = ruinborn_administration
	remove_country_modifier = centaur_administration
	remove_country_modifier = harimari_administration
	remove_country_modifier = ogre_administration
	remove_country_modifier = hobgoblin_administration
	remove_country_modifier = lizardfolk_administration
	remove_country_modifier = mechanim_administration
}

clear_racial_military = {
	remove_country_modifier = elven_military
	remove_country_modifier = dwarven_military
	remove_country_modifier = gnomish_military
	remove_country_modifier = gnomish_military_artificer_buff
	remove_country_modifier = half_orcish_military
	remove_country_modifier = half_elven_military
	remove_country_modifier = kobold_military
	remove_country_modifier = troll_military
	remove_country_modifier = halfling_military
	remove_country_modifier = harpy_military
	remove_country_modifier = human_military
	remove_country_modifier = orcish_military
	remove_country_modifier = goblin_military
	remove_country_modifier = gnollish_military
	remove_country_modifier = ruinborn_military
	remove_country_modifier = centaur_military
	remove_country_modifier = harimari_military
	remove_country_modifier = ogre_military
	remove_country_modifier = hobgoblin_military
	remove_country_modifier = lizardfolk_military
	remove_country_modifier = mechanim_military
	
	#modifiers if no Cradle of Civ dlc
	remove_country_modifier = hobgoblin_military_no_dlc
	remove_country_modifier = elven_military_no_dlc

	# Disband your undead army
	if = {
		limit = { has_country_modifier = undead_military }
		custom_tooltip = tooltip_undead_army_destroy_all_armies

		hidden_effect = {
			every_owned_province = {
				kill_units = {
					who = owner
					type = infantry
				}
				kill_units = {
					who = owner
					type = cavalry
				}
			}
		}
		remove_country_modifier = undead_military
	}

	if = {
		limit = { has_country_modifier = spirit_military }

		hidden_effect = {
			remove_country_modifier = spirit_mil_1
			remove_country_modifier = spirit_mil_2
			remove_country_modifier = spirit_mil_3
			remove_country_modifier = spirit_mil_4
			remove_country_modifier = spirit_mil_5
		}
		remove_country_modifier = spirit_military
	}
}

clear_racial_pop_migration_flags = {
	clr_country_flag = racial_pop_migrate_adjacent
	clr_country_flag = racial_pop_migrate_within_country
	clr_country_flag = racial_pop_migrate_outside_country

	clr_country_flag = racial_pop_migrate_colony

}

clear_racial_pop_tolerance_chance_flags = {
	clr_country_flag = racial_pop_small_increase
	clr_country_flag = racial_pop_medium_increase
	clr_country_flag = racial_pop_large_increase
	clr_country_flag = racial_pop_largest_increase

	clr_country_flag = racial_pop_small_decrease
	clr_country_flag = racial_pop_medium_decrease
	clr_country_flag = racial_pop_large_decrease
	clr_country_flag = racial_pop_largest_decrease
}

save_primary_culture = {
	ROOT = {
		export_to_variable = {
			value = primary_culture
			which = my_primary_culture
			#who = ROOT
		}
	}
}

lock_racial_admin = {
    if = { 
        limit = { 
            end_game_tags_blocked = yes 
        }
        custom_tooltip = locked_racial_administration_tt
        hidden_effect = {
            save_primary_culture = yes
            set_country_flag = locked_racial_administration
        }
    }
}

startup_minority_count_and_flags = {

	if = {
		limit = {
			NOT = { has_province_flag = elven_present }
			has_elven_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = elven_present
		owner = { increment_racial_pop_count = { race = elven } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = dwarven_present }
			has_dwarven_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = dwarven_present
		owner = { increment_racial_pop_count = { race = dwarven } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = halfling_present }
			has_halfling_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = halfling_present
		owner = { increment_racial_pop_count = { race = halfling } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = gnomish_present }
			has_gnomish_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = gnomish_present
		owner = { increment_racial_pop_count = { race = gnomish } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = kobold_present }
			has_kobold_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = kobold_present
		owner = { increment_racial_pop_count = { race = kobold } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = orcish_present }
			has_orcish_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = orcish_present
		owner = { increment_racial_pop_count = { race = orcish } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = half_orcish_present }
			has_half_orcish_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = half_orcish_present
		owner = { increment_racial_pop_count = { race = half_orcish } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = human_present }
			has_human_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = human_present
		owner = { increment_racial_pop_count = { race = human } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = gnollish_present }
			has_gnollish_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = gnollish_present
		owner = { increment_racial_pop_count = { race = gnollish } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = ruinborn_present }
			has_ruinborn_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = ruinborn_present
		owner = { increment_racial_pop_count = { race = ruinborn } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = goblin_present }
			has_goblin_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = goblin_present
		owner = { increment_racial_pop_count = { race = goblin } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = harpy_present }
			has_harpy_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = harpy_present
		owner = { increment_racial_pop_count = { race = harpy } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = troll_present }
			has_troll_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = troll_present
		owner = { increment_racial_pop_count = { race = troll } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = half_elven_present }
			has_half_elven_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = half_elven_present
		owner = { increment_racial_pop_count = { race = half_elven } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = harimari_present }
			has_harimari_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = harimari_present
		owner = { increment_racial_pop_count = { race = harimari } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = hobgoblin_present }
			has_hobgoblin_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = hobgoblin_present
		owner = { increment_racial_pop_count = { race = hobgoblin } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = centaur_present }
			has_centaur_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = centaur_present
		owner = { increment_racial_pop_count = { race = centaur } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = ogre_present }
			has_ogre_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = ogre_present
		owner = { increment_racial_pop_count = { race = ogre } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = lizardfolk_present }
			has_lizardfolk_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = lizardfolk_present
		owner = { increment_racial_pop_count = { race = lizardfolk } }
	}

	if = {
		limit = {
			NOT = { has_province_flag = mechanim_present }
			has_mechanim_minority_trigger = yes
		}
		# add <race>_present and increase race count if minorities are in the prov
		set_province_flag = mechanim_present
		owner = { increment_racial_pop_count = { race = mechanim } }
	}
			
}

increment_racial_pop_count = {
	hidden_effect = {
		change_variable = {
			which = $race$_count
			value = 1
		}
	}
}

decrement_racial_pop_count = {
	hidden_effect = {
		subtract_variable = {
			which = $race$_count
			value = 1
		}
	}
}

remove_racial_minority_of_size = {
	remove_province_modifier = $race$_minority_oppressed_$size$
	remove_province_modifier = $race$_minority_coexisting_$size$
	remove_province_modifier = $race$_minority_integrated_$size$

	if = {
		limit = { has_province_flag = $race$_present NOT = { has_any_$race$_pop_trigger = yes } }
		owner = { decrement_racial_pop_count = { race = $race$ } }
		clr_province_flag = $race$_present
	}
	# note you need to check both whether there are no more of the pops, and whether there were any to begin with
	# as you can use this effect on a province with no minorities at all
}

remove_racial_minority_any_size = {
	remove_racial_minority_of_size = { race = $race$ size = small }
	remove_racial_minority_of_size = { race = $race$ size = large }
	
	if = {
		limit = { has_province_flag = $race$_present NOT = { has_$race$_majority_trigger = yes } }
		owner = { decrement_racial_pop_count = { race = $race$ } }
		clr_province_flag = $race$_present
	}
	# note you need to check both whether there are no more of the pops, and whether there were any to begin with
	# as you can use this effect on a province with no minorities at all
}

remove_racial_minority_any_size_with_tolerance = {
	remove_province_modifier = $race$_minority_$tolerance$_small
	remove_province_modifier = $race$_minority_$tolerance$_large
	
	if = {
		limit = { has_province_flag = $race$_present NOT = { has_any_$race$_pop_trigger = yes } }
		owner = { decrement_racial_pop_count = { race = $race$ } }
		clr_province_flag = $race$_present
	}
	# note you need to check both whether there are no more of the pops, and whether there were any to begin with
	# as you can use this effect on a province with no minorities at all
}

###############################################
#DO NOT USE THIS OUTSIDE OF THE RACIAL SYSTEM
#racial majority should always match culture
remove_racial_majority = {
	remove_province_modifier = $race$_majority_oppressed
	remove_province_modifier = $race$_majority_coexisting
	remove_province_modifier = $race$_majority_integrated
	remove_province_modifier = $race$_majority_primary

	if = {
		limit = { has_province_flag = $race$_present NOT = { has_$race$_minority_trigger = yes } }
		owner = { decrement_racial_pop_count = { race = $race$ } }
		clr_province_flag = $race$_present
	}
	# note you need to check both whether there are no more of the pops, and whether there were any to begin with
	# as you can use this effect on a province with no minorities at all
}
###############################################

generic_add_race_minority_size_effect = {
	custom_tooltip = add_$race$_minority_size_effect_tooltip
	hidden_effect = {
	
		# Do nothing if the province has a majority or a large minority already
		if = {
			limit = {
				has_$race$_majority_trigger = no
				has_large_$race$_minority_trigger = no
			}
	
			if = {
				limit = { NOT = { has_province_flag = $race$_present } }
				set_province_flag = $race$_present
				owner = { increment_racial_pop_count = { race = $race$ } }
			}
	
			#Impact Oppressed
			if = {
				limit = {
					has_province_modifier = $race$_minority_oppressed_small
				}
				remove_province_modifier = $race$_minority_oppressed_small
				add_permanent_province_modifier = {
					name = $race$_minority_oppressed_large
					duration = -1
				}
			}

			#Impact Coexisting
			else_if = {
				limit = {
					has_province_modifier = $race$_minority_coexisting_small
				}
				remove_province_modifier = $race$_minority_coexisting_small
				add_permanent_province_modifier = {
					name = $race$_minority_coexisting_large
					duration = -1
				}
			}

			#Impact Integrated
			else_if = {
				limit = {
					has_province_modifier = $race$_minority_integrated_small
				}
				remove_province_modifier = $race$_minority_integrated_small
				add_permanent_province_modifier = {
					name = $race$_minority_integrated_large
					duration = -1
				}
			}

			# Add the minority with the right tolerance if they have none
	
			#Impact Oppressed
			else_if = {
				limit = {
					owner = { low_tolerance_$race$_race_trigger = yes }
				}
				add_permanent_province_modifier = {
					name = $race$_minority_oppressed_small
					duration = -1
				}
			}
	
			#Impact Coexisting
			else_if = {
				limit = {
					owner = { medium_tolerance_$race$_race_trigger = yes }
				}
				add_permanent_province_modifier = {
					name = $race$_minority_coexisting_small
					duration = -1
				}
			}

			#Impact Integrated
			else_if = {
				limit = {
					owner = { high_tolerance_$race$_race_trigger = yes }
				}
				add_permanent_province_modifier = {
					name = $race$_minority_integrated_small
					duration = -1
				}
			}
		}
	}
}

generic_remove_race_minority_size_effect = {
	custom_tooltip = remove_$race$_minority_size_effect_tooltip
	hidden_effect = {
		#Impact Oppressed
		if = {
			limit = {
				has_province_modifier = $race$_minority_oppressed_small
			}
			remove_province_modifier = $race$_minority_oppressed_small
			owner = { decrement_racial_pop_count = { race = $race$ } }
			clr_province_flag = $race$_present
		}
		else_if = {
			limit = {
				has_province_modifier = $race$_minority_oppressed_large
			}
			remove_province_modifier = $race$_minority_oppressed_large
			add_permanent_province_modifier = {
				name = $race$_minority_oppressed_small
				duration = -1
			}
		}

		#Impact Coexisting
		else_if = {
			limit = {
				has_province_modifier = $race$_minority_coexisting_small
			}
			remove_province_modifier = $race$_minority_coexisting_small
			owner = { decrement_racial_pop_count = { race = $race$ } }
			clr_province_flag = $race$_present
		}
		else_if = {
			limit = {
				has_province_modifier = $race$_minority_coexisting_large
			}
			remove_province_modifier = $race$_minority_coexisting_large
			add_permanent_province_modifier = {
				name = $race$_minority_coexisting_small
				duration = -1
			}
		}

		#Impact Integrated
		else_if = {
			limit = {
				has_province_modifier = $race$_minority_integrated_small
			}
			remove_province_modifier = $race$_minority_integrated_small
			owner = { decrement_racial_pop_count = { race = $race$ } }
			clr_province_flag = $race$_present
		}
		else_if = {
			limit = {
				has_province_modifier = $race$_minority_integrated_large
			}
			remove_province_modifier = $race$_minority_integrated_large
			add_permanent_province_modifier = {
				name = $race$_minority_integrated_small
				duration = -1
			}
		}
	}
	
}



generic_increase_of_racial_tolerance_effect = {
	custom_tooltip = tolerance_of_$race$_info_tooltip
	[[small]
	custom_tooltip = small_increase_in_$race$_tolerance_tooltip
	if = {
		limit = {
			low_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 26 }
		}
		custom_tooltip = increase_tolerance_coexisting_tooltip
	}
	else_if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 65}
		}
		custom_tooltip = increase_tolerance_integrated_tooltip
	}
	hidden_effect = {
		# Increases by 5
		change_variable = {
			which = $race$_race_tolerance
			value = 5
		}
	}
	]
	[[medium]
	custom_tooltip = medium_increase_in_$race$_tolerance_tooltip
	if = {
		limit = {
			low_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 21 }
		}
		custom_tooltip = increase_tolerance_coexisting_tooltip
	}
	else_if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 60}
		}
		custom_tooltip = increase_tolerance_integrated_tooltip
	}
	hidden_effect = {
		# Increases by 10
		change_variable = {
			which = $race$_race_tolerance
			value = 10
		}
	}
	]
	[[large]
	custom_tooltip = large_increase_in_$race$_tolerance_tooltip
	if = {
		limit = {
			low_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 16 }
		}
		custom_tooltip = increase_tolerance_coexisting_tooltip
	}
	else_if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 55}
		}
		custom_tooltip = increase_tolerance_integrated_tooltip
	}
	hidden_effect = {
		# Increases by 15
		change_variable = {
			which = $race$_race_tolerance
			value = 15
		}
	}
	]
	[[largest]
	custom_tooltip = largest_increase_in_$race$_tolerance_tooltip
	if = {
		limit = {
			low_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 11 }
		}
		custom_tooltip = increase_tolerance_coexisting_tooltip
	}
	else_if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			check_variable = { which = $race$_race_tolerance value = 50 }
		}
		custom_tooltip = increase_tolerance_integrated_tooltip
	}
	hidden_effect = {
		# Increases by 20
		change_variable = {
			which = $race$_race_tolerance
			value = 20
		}
	}
	]

	
	hidden_effect = {
		if = {	# If it ends up above the max it puts it at the highest point (never above 100)
			limit = {
				check_variable = {
					which = $race$_race_tolerance
					which = max_race_tolerance
				}
			}
			set_variable = {
				which = $race$_race_tolerance
				which = max_race_tolerance
			}
		}
		#every_owned_province = {
			# if you are wondering why this produces 1 is_empty scope error per iteration
			# it's because for some reason every_owned_province in scripted effects produces one invalid scope at the end of iteration
			# or at least i think it's only in scripted effects
		#	update_specific_racial_province_modifier_tolerance = { race = $race$ }
		#}
		# so do it in a country event instead
		# (this also generates only num_of_races instances of that giant effect rather than num_of_races*8)
		country_event = { id = racial_pop_events_$race$.99 }
	}
}
# when adding a new race, need to define tooltips for small/medium/large/largest_increase_in_<race>_tolerance

generic_decrease_of_racial_tolerance_effect = {
	if = {
		limit = {
			NOT = { has_country_flag = racial_pop_menu_opened }
		}
		custom_tooltip = tolerance_of_$race$_info_tooltip
	}
	[[small]
	custom_tooltip = small_decrease_in_$race$_tolerance_tooltip
	if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			NOT = { check_variable = { which = $race$_race_tolerance value = 36 } }
		}
		custom_tooltip = decrease_tolerance_oppressed_tooltip
	}
	else_if = {
		limit = {
			culture_is_$race$ = no
			check_variable = { which = $race$_race_tolerance value = 70 }
			NOT = { check_variable = { which = $race$_race_tolerance value = 75 } }
		}
		custom_tooltip = decrease_tolerance_coexisting_tooltip
	}
	hidden_effect = {
		# Decreases by 5
		subtract_variable = {
			which = $race$_race_tolerance
			value = 5
		}
	}
	]
	[[medium]
	if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			NOT = { check_variable = { which = $race$_race_tolerance value = 41 } }
		}
		custom_tooltip = decrease_tolerance_oppressed_tooltip
	}
	else_if = {
		limit = {
			culture_is_$race$ = no
			check_variable = { which = $race$_race_tolerance value = 70 }
			NOT = { check_variable = { which = $race$_race_tolerance value = 80 } }
		}
		custom_tooltip = decrease_tolerance_coexisting_tooltip
	}
	custom_tooltip = medium_decrease_in_$race$_tolerance_tooltip
	hidden_effect = {
		# Decreases by 10
		subtract_variable = {
			which = $race$_race_tolerance
			value = 10
		}
	}
	]
	[[large]
	if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			NOT = { check_variable = { which = $race$_race_tolerance value = 46 } }
		}
		custom_tooltip = decrease_tolerance_oppressed_tooltip
	}
	else_if = {
		limit = {
			culture_is_$race$ = no
			check_variable = { which = $race$_race_tolerance value = 70 }
			NOT = { check_variable = { which = $race$_race_tolerance value = 85 } }
		}
		custom_tooltip = decrease_tolerance_coexisting_tooltip
	}
	custom_tooltip = large_decrease_in_$race$_tolerance_tooltip
	hidden_effect = {
		# Decreases by 15
		subtract_variable = {
			which = $race$_race_tolerance
			value = 15
		}
	}
	]
	[[largest]
	custom_tooltip = largest_decrease_in_$race$_tolerance_tooltip
	if = {
		limit = {
			medium_tolerance_$race$_race_trigger = yes
			NOT = { check_variable = { which = $race$_race_tolerance value = 51 } }
		}
		custom_tooltip = decrease_tolerance_oppressed_tooltip
	}
	else_if = {
		limit = {
			culture_is_$race$ = no
			check_variable = { which = $race$_race_tolerance value = 70 }
			NOT = { check_variable = { which = $race$_race_tolerance value = 90 } }
		}
		custom_tooltip = decrease_tolerance_coexisting_tooltip
	}
	hidden_effect = {
		# Decreases by 20
		subtract_variable = {
			which = $race$_race_tolerance
			value = 20
		}
	}
	]
	
	
	hidden_effect = {
		if = {	# If it ends up below 0 it adds back up to 1
			limit = {
				NOT = {
					check_variable = {
						which = $race$_race_tolerance
						value = 1
					}
				}
			}
			set_variable = {
				which = $race$_race_tolerance
				value = 1
			}
		}
		#every_owned_province = {
			# if you are wondering why this produces 1 is_empty scope error per iteration
			# it's because for some reason every_owned_province in scripted effects produces one invalid scope at the end of iteration
			# or at least i think it's only in scripted effects
		#	update_specific_racial_province_modifier_tolerance = { race = $race$ }
		#}
		# so do it in a country event instead
		# (this also generates only num_of_races instances of that giant effect rather than num_of_races*8)
		country_event = { id = racial_pop_events_$race$.99 }

	}
}
# when adding a new race, need to define tooltips for small/medium/large/largest_decrease_in_<race>_tolerance

#example:
#generic_increase_of_racial_tolerance_effect = { race = elven small = yes }

#okman note: I could replace all the scripted effects completely,
#i.e. turn all small_increase_of_dwarven_tolerance_effect into generic_increase_of_racial_tolerance_effect = { race = dwarven small = yes }
#but people are very used to these and will keep trying to use the old effects, plus it could cause a ton of merge conflicts since they're everyhwere
#so for now the outer effects have been left

# Dwarven
small_increase_of_dwarven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = dwarven small = yes }
}

medium_increase_of_dwarven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = dwarven medium = yes }
}

large_increase_of_dwarven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = dwarven large = yes }
}

largest_increase_of_dwarven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = dwarven largest = yes }
}

small_decrease_of_dwarven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = dwarven small = yes }
}

medium_decrease_of_dwarven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = dwarven medium = yes }
}

large_decrease_of_dwarven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = dwarven large = yes }
}

largest_decrease_of_dwarven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = dwarven largest = yes }
}

add_dwarven_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = dwarven }
}

remove_dwarven_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = dwarven }
}


# Gnomish
small_increase_of_gnomish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnomish small = yes }
}

medium_increase_of_gnomish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnomish medium = yes }
}

large_increase_of_gnomish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnomish large = yes }
}

largest_increase_of_gnomish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnomish largest = yes }
}

small_decrease_of_gnomish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnomish small = yes }
}

medium_decrease_of_gnomish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnomish medium = yes }
}

large_decrease_of_gnomish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnomish large = yes }
}

largest_decrease_of_gnomish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnomish largest = yes }
}

add_gnomish_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = gnomish }
}

remove_gnomish_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = gnomish }
	if = {
		limit = {
			has_any_gnomish_pop_trigger = no
		}
	
		# remove all gommo/gnome headquarters if there are no gnomes left
		remove_province_modifier = gnomish_institute_gommo
		remove_province_modifier = aqatbar_gnome_quarter
		remove_province_modifier = rayavhashapal_gnome_quarter
		remove_province_modifier = port_jaher_gnome_quarter
		remove_province_modifier = feiten_gnome_quarter
		remove_province_modifier = kherka_gnome_quarter
		remove_province_modifier = camsinh_gnome_quarter
		remove_province_modifier = arawkelin_gnome_quarter
		remove_province_modifier = tianlou_gnome_quarter
		remove_province_modifier = sarisung_gnome_quarter
		remove_province_modifier = maoji_gnome_quarter
	}
}

# Elven
small_increase_of_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = elven small = yes }
}

medium_increase_of_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = elven medium = yes }
}

large_increase_of_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = elven large = yes }
}

largest_increase_of_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = elven largest = yes }
}

small_decrease_of_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = elven small = yes }
}

medium_decrease_of_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = elven medium = yes }
}

large_decrease_of_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = elven large = yes }
}

largest_decrease_of_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = elven largest = yes }
}

add_elven_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = elven }
}

remove_elven_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = elven }
}

# Half-Orcish
small_increase_of_half_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_orcish small = yes }
}

medium_increase_of_half_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_orcish medium = yes }
}

large_increase_of_half_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_orcish large = yes }
}

largest_increase_of_half_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_orcish largest = yes }
}

small_decrease_of_half_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_orcish small = yes }
}

medium_decrease_of_half_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_orcish medium = yes }
}

large_decrease_of_half_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_orcish large = yes }
}

largest_decrease_of_half_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_orcish largest = yes }
}

add_half_orcish_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = half_orcish }
}

remove_half_orcish_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = half_orcish }
}


# Kobold
small_increase_of_kobold_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = kobold small = yes }
}

medium_increase_of_kobold_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = kobold medium = yes }
}

large_increase_of_kobold_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = kobold large = yes }
}

largest_increase_of_kobold_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = kobold largest = yes }
}

small_decrease_of_kobold_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = kobold small = yes }
}

medium_decrease_of_kobold_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = kobold medium = yes }
}

large_decrease_of_kobold_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = kobold large = yes }
}

largest_decrease_of_kobold_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = kobold largest = yes }
}

add_kobold_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = kobold }
}

remove_kobold_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = kobold }
}

# Gnollish
small_increase_of_gnollish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnollish small = yes }
}

medium_increase_of_gnollish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnollish medium = yes }
}

large_increase_of_gnollish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnollish large = yes }
}

largest_increase_of_gnollish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = gnollish largest = yes }
}

small_decrease_of_gnollish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnollish small = yes }
}

medium_decrease_of_gnollish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnollish medium = yes }
}

large_decrease_of_gnollish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnollish large = yes }
}

largest_decrease_of_gnollish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = gnollish largest = yes }
}

add_gnollish_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = gnollish }
}

remove_gnollish_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = gnollish }
}

# Orcish
small_increase_of_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = orcish small = yes }
}

medium_increase_of_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = orcish medium = yes }
}

large_increase_of_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = orcish large = yes }
}

largest_increase_of_orcish_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = orcish largest = yes }
}

small_decrease_of_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = orcish small = yes }
}

medium_decrease_of_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = orcish medium = yes }
}

large_decrease_of_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = orcish large = yes }
}

largest_decrease_of_orcish_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = orcish largest = yes }
}

add_orcish_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = orcish }
}

remove_orcish_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = orcish }
}

# Halfling
small_increase_of_halfling_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = halfling small = yes }
}

medium_increase_of_halfling_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = halfling medium = yes }
}

large_increase_of_halfling_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = halfling large = yes }
}

largest_increase_of_halfling_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = halfling largest = yes }
}

small_decrease_of_halfling_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = halfling small = yes }
}

medium_decrease_of_halfling_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = halfling medium = yes }
}

large_decrease_of_halfling_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = halfling large = yes }
}

largest_decrease_of_halfling_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = halfling largest = yes }
}

add_halfling_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = halfling }
}

remove_halfling_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = halfling }
}

# Human
small_increase_of_human_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = human small = yes }
}

medium_increase_of_human_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = human medium = yes }
}

large_increase_of_human_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = human large = yes }
}

largest_increase_of_human_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = human largest = yes }
}

small_decrease_of_human_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = human small = yes }
}

medium_decrease_of_human_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = human medium = yes }
}

large_decrease_of_human_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = human large = yes }
}

largest_decrease_of_human_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = human largest = yes }
}

add_human_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = human }
}

remove_human_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = human }
}

# Half-Elven
small_increase_of_half_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_elven small = yes }
}

medium_increase_of_half_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_elven medium = yes }
}

large_increase_of_half_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_elven large = yes }
}

largest_increase_of_half_elven_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = half_elven largest = yes }
}

small_decrease_of_half_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_elven small = yes }
}

medium_decrease_of_half_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_elven medium = yes }
}

large_decrease_of_half_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_elven large = yes }
}

largest_decrease_of_half_elven_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = half_elven largest = yes }
}

add_half_elven_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = half_elven }
}

remove_half_elven_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = half_elven }
}

# Ruinborn
small_increase_of_ruinborn_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ruinborn small = yes }
}

medium_increase_of_ruinborn_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ruinborn medium = yes }
}

large_increase_of_ruinborn_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ruinborn large = yes }
}

largest_increase_of_ruinborn_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ruinborn largest = yes }
}

small_decrease_of_ruinborn_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ruinborn small = yes }
}

medium_decrease_of_ruinborn_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ruinborn medium = yes }
}

large_decrease_of_ruinborn_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ruinborn large = yes }
}

largest_decrease_of_ruinborn_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ruinborn largest = yes }
}

add_ruinborn_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = ruinborn }
}

remove_ruinborn_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = ruinborn }
}

# Goblin
small_increase_of_goblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = goblin small = yes }
}

medium_increase_of_goblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = goblin medium = yes }
}

large_increase_of_goblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = goblin large = yes }
}

largest_increase_of_goblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = goblin largest = yes }
}

small_decrease_of_goblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = goblin small = yes }
}

medium_decrease_of_goblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = goblin medium = yes }
}

large_decrease_of_goblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = goblin large = yes }
}

largest_decrease_of_goblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = goblin largest = yes }
}

add_goblin_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = goblin }
}

remove_goblin_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = goblin }
}

# Harpy
small_increase_of_harpy_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harpy small = yes }
}

medium_increase_of_harpy_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harpy medium = yes }
}

large_increase_of_harpy_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harpy large = yes }
}

largest_increase_of_harpy_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harpy largest = yes }
}

small_decrease_of_harpy_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harpy small = yes }
}

medium_decrease_of_harpy_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harpy medium = yes }
}

large_decrease_of_harpy_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harpy large = yes }
}

largest_decrease_of_harpy_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harpy largest = yes }
}

add_harpy_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = harpy }
}

remove_harpy_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = harpy }
}

# Troll
small_increase_of_troll_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = troll small = yes }
}

medium_increase_of_troll_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = troll medium = yes }
}

large_increase_of_troll_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = troll large = yes }
}

largest_increase_of_troll_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = troll largest = yes }
}

small_decrease_of_troll_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = troll small = yes }
}

medium_decrease_of_troll_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = troll medium = yes }
}

large_decrease_of_troll_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = troll large = yes }
}

largest_decrease_of_troll_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = troll largest = yes }
}

add_troll_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = troll }
}

remove_troll_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = troll }
}

# Ogre
small_increase_of_ogre_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ogre small = yes }
}

medium_increase_of_ogre_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ogre medium = yes }
}

large_increase_of_ogre_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ogre large = yes }
}

largest_increase_of_ogre_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = ogre largest = yes }
}

small_decrease_of_ogre_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ogre small = yes }
}

medium_decrease_of_ogre_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ogre medium = yes }
}

large_decrease_of_ogre_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ogre large = yes }
}

largest_decrease_of_ogre_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = ogre largest = yes }
}

add_ogre_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = ogre }
}

remove_ogre_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = ogre }
}

# Harimari
small_increase_of_harimari_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harimari small = yes }
}

medium_increase_of_harimari_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harimari medium = yes }
}

large_increase_of_harimari_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harimari large = yes }
}

largest_increase_of_harimari_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = harimari largest = yes }
}

small_decrease_of_harimari_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harimari small = yes }
}

medium_decrease_of_harimari_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harimari medium = yes }
}

large_decrease_of_harimari_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harimari large = yes }
}

largest_decrease_of_harimari_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = harimari largest = yes }
}

add_harimari_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = harimari }
}

remove_harimari_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = harimari }
}

# Centaur
small_increase_of_centaur_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = centaur small = yes }
}

medium_increase_of_centaur_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = centaur medium = yes }
}

large_increase_of_centaur_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = centaur large = yes }
}

largest_increase_of_centaur_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = centaur largest = yes }
}

small_decrease_of_centaur_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = centaur small = yes }
}

medium_decrease_of_centaur_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = centaur medium = yes }
}

large_decrease_of_centaur_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = centaur large = yes }
}

largest_decrease_of_centaur_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = centaur largest = yes }
}

add_centaur_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = centaur }
}

remove_centaur_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = centaur }
}

# Hobgoblin
small_increase_of_hobgoblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = hobgoblin small = yes }
}

medium_increase_of_hobgoblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = hobgoblin medium = yes }
}

large_increase_of_hobgoblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = hobgoblin large = yes }
}

largest_increase_of_hobgoblin_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = hobgoblin largest = yes }
}

small_decrease_of_hobgoblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = hobgoblin small = yes }
}

medium_decrease_of_hobgoblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = hobgoblin medium = yes }
}

large_decrease_of_hobgoblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = hobgoblin large = yes }
}

largest_decrease_of_hobgoblin_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = hobgoblin largest = yes }
}

add_hobgoblin_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = hobgoblin }
}

remove_hobgoblin_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = hobgoblin }
}

# Lizardfolk
small_increase_of_lizardfolk_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = lizardfolk small = yes }
}

medium_increase_of_lizardfolk_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = lizardfolk medium = yes }
}

large_increase_of_lizardfolk_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = lizardfolk large = yes }
}

largest_increase_of_lizardfolk_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = lizardfolk largest = yes }
}

small_decrease_of_lizardfolk_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = lizardfolk small = yes }
}

medium_decrease_of_lizardfolk_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = lizardfolk medium = yes }
}

large_decrease_of_lizardfolk_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = lizardfolk large = yes }
}

largest_decrease_of_lizardfolk_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = lizardfolk largest = yes }
}

add_lizardfolk_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = lizardfolk }
}

remove_lizardfolk_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = lizardfolk }
}

# Mechanim
small_increase_of_mechanim_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = mechanim small = yes }
}

medium_increase_of_mechanim_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = mechanim medium = yes }
}

large_increase_of_mechanim_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = mechanim large = yes }
}

largest_increase_of_mechanim_tolerance_effect = {
	generic_increase_of_racial_tolerance_effect = { race = mechanim largest = yes }
}

small_decrease_of_mechanim_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = mechanim small = yes }
}

medium_decrease_of_mechanim_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = mechanim medium = yes }
}

large_decrease_of_mechanim_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = mechanim large = yes }
}

largest_decrease_of_mechanim_tolerance_effect = {
	generic_decrease_of_racial_tolerance_effect = { race = mechanim largest = yes }
}

add_mechanim_minority_size_effect = {
	generic_add_race_minority_size_effect = { race = mechanim }
}

remove_mechanim_minority_size_effect = {
	generic_remove_race_minority_size_effect = { race = mechanim }
}


# adds majority of specific race with the correct tolerance
add_majority_with_correct_tolerance = {

	if = {
		limit = { NOT = { has_province_flag = $race$_present } }
		set_province_flag = $race$_present
		owner = { increment_racial_pop_count = { race = $race$ } }
	}
	
	if = {
		limit = {
			OR = {
				is_empty = yes
				owner = { has_country_modifier = $race$_administration }
			} 
		}
		# if they have the administration, it's primary
		# special case: this is an uncolonised province, then they're also primary
		add_permanent_province_modifier = {
			name = $race$_majority_primary
			duration = -1
		}
	}
	
	else_if = {
		limit = { owner = { high_tolerance_$race$_race_trigger = yes } }
		add_permanent_province_modifier = {
			name = $race$_majority_integrated
			duration = -1
		}
	}
	
	else_if = {
		limit = { owner = { medium_tolerance_$race$_race_trigger = yes } }
		add_permanent_province_modifier = {
			name = $race$_majority_coexisting
			duration = -1
		}
	}

	else = {
		# low tolerance
		add_permanent_province_modifier = {
			name = $race$_majority_oppressed
			duration = -1
		}
	}
}

# adds small/large minority of specific race with the correct tolerance
add_minority_with_correct_tolerance = {

	if = {
		limit = { NOT = { has_province_flag = $race$_present } }
		set_province_flag = $race$_present
		owner = { increment_racial_pop_count = { race = $race$ } }
	}

	if = {
		limit = { owner = { high_tolerance_$race$_race_trigger = yes } }
		add_permanent_province_modifier = {
			name = $race$_minority_integrated_$size$
			duration = -1
		}
	}

	else_if = {
		limit = { owner = { medium_tolerance_$race$_race_trigger = yes } }
		add_permanent_province_modifier = {
			name = $race$_minority_coexisting_$size$
			duration = -1
		}
	}

	else = {
		# low tolerance
		add_permanent_province_modifier = {
			name = $race$_minority_oppressed_$size$
			duration = -1
		}
	}
}

add_majority_of_current_culture = {
	#AddNewRaceHere

	#elven
	if = {
		limit = {
			NOT = { has_elven_majority_trigger = yes }
			culture_is_elven = yes
		}
		add_majority_with_correct_tolerance = { race = elven }
	}
	
	#dwarven
	else_if = {
		limit = {
			NOT = { has_dwarven_majority_trigger = yes }
			culture_is_dwarven = yes
		}
		add_majority_with_correct_tolerance = { race = dwarven }
	}
	
	#halfling
	else_if = {
		limit = {
			NOT = { has_halfling_majority_trigger = yes }
			culture_is_halfling = yes
		}
		add_majority_with_correct_tolerance = { race = halfling }
	}
	
	#gnomish
	else_if = {
		limit = {
			NOT = { has_gnomish_majority_trigger = yes }
			culture_is_gnomish = yes
		}
		add_majority_with_correct_tolerance = { race = gnomish }
	}
	
	#half_orcish
	else_if = {
		limit = {
			NOT = { has_half_orcish_majority_trigger = yes }
			culture_is_half_orcish = yes
		}
		add_majority_with_correct_tolerance = { race = half_orcish }
	}
	
	#kobold
	else_if = {
		limit = {
			NOT = { has_kobold_majority_trigger = yes }
			culture_is_kobold = yes
		}
		add_majority_with_correct_tolerance = { race = kobold }
	}
	
	#orcish
	else_if = {
		limit = {
			NOT = { has_orcish_majority_trigger = yes }
			culture_is_orcish = yes
		}
		add_majority_with_correct_tolerance = { race = orcish }
	}
	
	#human
	else_if = {
		limit = {
			NOT = { has_human_majority_trigger = yes }
			culture_is_human = yes
		}
		add_majority_with_correct_tolerance = { race = human }
	}
	
	#gnollish
	else_if = {
		limit = {
			NOT = { has_gnollish_majority_trigger = yes }
			culture_is_gnollish = yes
		}
		add_majority_with_correct_tolerance = { race = gnollish }
	}
	
	#ruinborn
	else_if = {
		limit = {
			NOT = { has_ruinborn_majority_trigger = yes }
			culture_is_ruinborn = yes
		}
		add_majority_with_correct_tolerance = { race = ruinborn }
	}
	
	#goblin
	else_if = {
		limit = {
			NOT = { has_goblin_majority_trigger = yes }
			culture_is_goblin = yes
		}
		add_majority_with_correct_tolerance = { race = goblin }
	}
	
	#harpy
	else_if = {
		limit = {
			NOT = { has_harpy_majority_trigger = yes }
			culture_is_harpy = yes
		}
		add_majority_with_correct_tolerance = { race = harpy }
	}
	
	#troll
	else_if = {
		limit = {
			NOT = { has_troll_majority_trigger = yes }
			culture_is_troll = yes
		}
		add_majority_with_correct_tolerance = { race = troll }
	}
	
	#half_elven
	else_if = {
		limit = {
			NOT = { has_half_elven_majority_trigger = yes }
			culture_is_half_elven = yes
		}
		add_majority_with_correct_tolerance = { race = half_elven }
	}
	
	#harimari
	else_if = {
		limit = {
			NOT = { has_harimari_majority_trigger = yes }
			culture_is_harimari = yes
		}
		add_majority_with_correct_tolerance = { race = harimari }
	}
	
	#hobgoblin
	else_if = {
		limit = {
			NOT = { has_hobgoblin_majority_trigger = yes }
			culture_is_hobgoblin = yes
		}
		add_majority_with_correct_tolerance = { race = hobgoblin }
	}
	
	#centaur
	else_if = {
		limit = {
			NOT = { has_centaur_majority_trigger = yes }
			culture_is_centaur = yes
		}
		add_majority_with_correct_tolerance = { race = centaur }
	}
	
	#ogre
	else_if = {
		limit = {
			NOT = { has_ogre_majority_trigger = yes }
			culture_is_ogre = yes
		}
		add_majority_with_correct_tolerance = { race = ogre }
	}
	
	#lizardfolk
	else_if = {
		limit = {
			NOT = { has_lizardfolk_majority_trigger = yes }
			culture_is_lizardfolk = yes
		}
		add_majority_with_correct_tolerance = { race = lizardfolk }
	}

	#mechanim
	else_if = {
		limit = {
			NOT = { has_mechanim_majority_trigger = yes }
			culture_is_mechanim = yes
		}
		add_majority_with_correct_tolerance = { race = mechanim }
	}
}

convert_majority_to_minority = {
	#AddNewRaceHere

	#elven
	if = {
		limit = {
			has_elven_majority_trigger = yes
			NOT = { culture_is_elven = yes }
		}
		add_minority_with_correct_tolerance = { race = elven size = $size$ }
	
		remove_racial_majority = { race = elven }	
	}

	#dwarven
	else_if = {
		limit = {
			has_dwarven_majority_trigger = yes
			NOT = { culture_is_dwarven = yes }
		}
		add_minority_with_correct_tolerance = { race = dwarven size = $size$ }
	
		remove_racial_majority = { race = dwarven }	
	}

	#halfling
	else_if = {
		limit = {
			has_halfling_majority_trigger = yes
			NOT = { culture_is_halfling = yes }
		}
		add_minority_with_correct_tolerance = { race = halfling size = $size$ }

		remove_racial_majority = { race = halfling }
	}

	#gnomish
	else_if = {
		limit = {
			has_gnomish_majority_trigger = yes
			NOT = { culture_is_gnomish = yes }
		}
		add_minority_with_correct_tolerance = { race = gnomish size = $size$ }

		remove_racial_majority = { race = gnomish }
	}

	#half_orcish
	else_if = {
		limit = {
			has_half_orcish_majority_trigger = yes
			NOT = { culture_is_half_orcish = yes }
		}
		add_minority_with_correct_tolerance = { race = half_orcish size = $size$ }

		remove_racial_majority = { race = half_orcish }
	}

	#orcish
	else_if = {
		limit = {
			has_orcish_majority_trigger = yes
			NOT = { culture_is_orcish = yes }
		}
		add_minority_with_correct_tolerance = { race = orcish size = $size$ }
	
		remove_racial_majority = { race = orcish }	
	}

	#human
	else_if = {
		limit = {
			has_human_majority_trigger = yes
			NOT = { culture_is_human = yes }
		}
		add_minority_with_correct_tolerance = { race = human size = $size$ }

		remove_racial_majority = { race = human }
	}

	#gnollish
	else_if = {
		limit = {
			has_gnollish_majority_trigger = yes
			NOT = { culture_is_gnollish = yes }
		}
		add_minority_with_correct_tolerance = { race = gnollish size = $size$ }

		remove_racial_majority = { race = gnollish }
	}

	#ruinborn
	else_if = {
		limit = {
			has_ruinborn_majority_trigger = yes
			NOT = { culture_is_ruinborn = yes }
		}
		add_minority_with_correct_tolerance = { race = ruinborn size = $size$ }
	
		remove_racial_majority = { race = ruinborn }		
	}

	#goblin
	else_if = {
		limit = {
			has_goblin_majority_trigger = yes
			NOT = { culture_is_goblin = yes }
		}
		add_minority_with_correct_tolerance = { race = goblin size = $size$ }

		remove_racial_majority = { race = goblin }
	}

	#harpy
	else_if = {
		limit = {
			has_harpy_majority_trigger = yes
			NOT = { culture_is_harpy = yes }
		}
		add_minority_with_correct_tolerance = { race = harpy size = $size$ }

		remove_racial_majority = { race = harpy }
	}

	#troll
	else_if = {
		limit = {
			has_troll_majority_trigger = yes
			NOT = { culture_is_troll = yes }
		}
		add_minority_with_correct_tolerance = { race = troll size = $size$ }

		remove_racial_majority = { race = troll }
	}

	#half_elven
	else_if = {
		limit = {
			has_half_elven_majority_trigger = yes
			NOT = { culture_is_half_elven = yes }
		}
		add_minority_with_correct_tolerance = { race = half_elven size = $size$ }

		remove_racial_majority = { race = half_elven }
	}

	#kobold
	else_if = {
		limit = {
			has_kobold_majority_trigger = yes
			NOT = { culture_is_kobold = yes }
		}
		add_minority_with_correct_tolerance = { race = kobold size = $size$ }

		remove_racial_majority = { race = kobold }
	}

	#harimari
	else_if = {
		limit = {
			has_harimari_majority_trigger = yes
			NOT = { culture_is_harimari = yes }
		}
		add_minority_with_correct_tolerance = { race = harimari size = $size$ }

		remove_racial_majority = { race = harimari }
	}

	#hobgoblin
	else_if = {
		limit = {
			has_hobgoblin_majority_trigger = yes
			NOT = { culture_is_hobgoblin = yes }
		}
		add_minority_with_correct_tolerance = { race = hobgoblin size = $size$ }

		remove_racial_majority = { race = hobgoblin }
	}

	#centaur
	else_if = {
		limit = {
			has_centaur_majority_trigger = yes
			NOT = { culture_is_centaur = yes }
		}
		add_minority_with_correct_tolerance = { race = centaur size = $size$ }

		remove_racial_majority = { race = centaur }
	}

	#ogre
	else_if = {
		limit = {
			has_ogre_majority_trigger = yes
			NOT = { culture_is_ogre = yes }
		}
		add_minority_with_correct_tolerance = { race = ogre size = $size$ }

		remove_racial_majority = { race = ogre }
	}

	#lizardfolk
	else_if = {
		limit = {
			has_lizardfolk_majority_trigger = yes
			NOT = { culture_is_lizardfolk = yes }
		}
		add_minority_with_correct_tolerance = { race = lizardfolk size = $size$ }

		remove_racial_majority = { race = lizardfolk }
	}

	#mechanim
	else_if = {
		limit = {
			has_mechanim_majority_trigger = yes
			NOT = { culture_is_mechanim = yes }
		}
		add_minority_with_correct_tolerance = { race = mechanim size = $size$ }

		remove_racial_majority = { race = mechanim }
	}
}


#This should be use in a province scope
update_racial_province_modifier_tolerance = {
	#AddNewRaceHere
	
	#Elven
	update_specific_racial_province_modifier_tolerance = { race = elven }

	#Dwarven
	update_specific_racial_province_modifier_tolerance = { race = dwarven }

	#Halfling
	update_specific_racial_province_modifier_tolerance = { race = halfling }

	#Gnomish
	update_specific_racial_province_modifier_tolerance = { race = gnomish }

	#Kobold
	update_specific_racial_province_modifier_tolerance = { race = kobold }

	#Orcish
	update_specific_racial_province_modifier_tolerance = { race = orcish }

	#Half-Orcish
	update_specific_racial_province_modifier_tolerance = { race = half_orcish }

	#Human
	update_specific_racial_province_modifier_tolerance = { race = human }

	#Gnollish
	update_specific_racial_province_modifier_tolerance = { race = gnollish }

	#Ruinborn
	update_specific_racial_province_modifier_tolerance = { race = ruinborn }

	#Goblin
	update_specific_racial_province_modifier_tolerance = { race = goblin }

	#Harpy
	update_specific_racial_province_modifier_tolerance = { race = harpy }

	#Troll
	update_specific_racial_province_modifier_tolerance = { race = troll }

	#Half-elven
	update_specific_racial_province_modifier_tolerance = { race = half_elven }

	#Harimari
	update_specific_racial_province_modifier_tolerance = { race = harimari }

	#Hobgoblin
	update_specific_racial_province_modifier_tolerance = { race = hobgoblin }

	#Centaur
	update_specific_racial_province_modifier_tolerance = { race = centaur }

	#Ogre
	update_specific_racial_province_modifier_tolerance = { race = ogre }

	#Lizardfolk
	update_specific_racial_province_modifier_tolerance = { race = lizardfolk }

	#Mechanim
	update_specific_racial_province_modifier_tolerance = { race = mechanim }
}

update_racial_province_modifier_tolerance_and_count = {
	#AddNewRaceHere
	
	#elven
	if = {
		limit = { has_province_flag = elven_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = elven } }
		FROM = { decrement_racial_pop_count = { race = elven } }
		update_specific_racial_province_modifier_tolerance = { race = elven }
	}
	

	#dwarven
	if = {
		limit = { has_province_flag = dwarven_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = dwarven } }
		FROM = { decrement_racial_pop_count = { race = dwarven } }
		update_specific_racial_province_modifier_tolerance = { race = dwarven }
	}
	

	#halfling
	if = {
		limit = { has_province_flag = halfling_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = halfling } }
		FROM = { decrement_racial_pop_count = { race = halfling } }
		update_specific_racial_province_modifier_tolerance = { race = halfling }
	}
	

	#gnomish
	if = {
		limit = { has_province_flag = gnomish_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = gnomish } }
		FROM = { decrement_racial_pop_count = { race = gnomish } }
		update_specific_racial_province_modifier_tolerance = { race = gnomish }
	}
	

	#kobold
	if = {
		limit = { has_province_flag = kobold_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = kobold } }
		FROM = { decrement_racial_pop_count = { race = kobold } }
		update_specific_racial_province_modifier_tolerance = { race = kobold }
	}
	

	#orcish
	if = {
		limit = { has_province_flag = orcish_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = orcish } }
		FROM = { decrement_racial_pop_count = { race = orcish } }
		update_specific_racial_province_modifier_tolerance = { race = orcish }
	}
	

	#half_orcish
	if = {
		limit = { has_province_flag = half_orcish_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = half_orcish } }
		FROM = { decrement_racial_pop_count = { race = half_orcish } }
		update_specific_racial_province_modifier_tolerance = { race = half_orcish }
	}
	

	#human
	if = {
		limit = { has_province_flag = human_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = human } }
		FROM = { decrement_racial_pop_count = { race = human } }
		update_specific_racial_province_modifier_tolerance = { race = human }
	}
	

	#gnollish
	if = {
		limit = { has_province_flag = gnollish_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = gnollish } }
		FROM = { decrement_racial_pop_count = { race = gnollish } }
		update_specific_racial_province_modifier_tolerance = { race = gnollish }
	}
	

	#ruinborn
	if = {
		limit = { has_province_flag = ruinborn_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = ruinborn } }
		FROM = { decrement_racial_pop_count = { race = ruinborn } }
		update_specific_racial_province_modifier_tolerance = { race = ruinborn }
	}
	

	#goblin
	if = {
		limit = { has_province_flag = goblin_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = goblin } }
		FROM = { decrement_racial_pop_count = { race = goblin } }
		update_specific_racial_province_modifier_tolerance = { race = goblin }
	}
	

	#harpy
	if = {
		limit = { has_province_flag = harpy_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = harpy } }
		FROM = { decrement_racial_pop_count = { race = harpy } }
		update_specific_racial_province_modifier_tolerance = { race = harpy }
	}
	

	#troll
	if = {
		limit = { has_province_flag = troll_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = troll } }
		FROM = { decrement_racial_pop_count = { race = troll } }
		update_specific_racial_province_modifier_tolerance = { race = troll }
	}
	

	#half_elven
	if = {
		limit = { has_province_flag = half_elven_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = half_elven } }
		FROM = { decrement_racial_pop_count = { race = half_elven } }
		update_specific_racial_province_modifier_tolerance = { race = half_elven }
	}
	

	#harimari
	if = {
		limit = { has_province_flag = harimari_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = harimari } }
		FROM = { decrement_racial_pop_count = { race = harimari } }
		update_specific_racial_province_modifier_tolerance = { race = harimari }
	}
	

	#hobgoblin
	if = {
		limit = { has_province_flag = hobgoblin_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = hobgoblin } }
		FROM = { decrement_racial_pop_count = { race = hobgoblin } }
		update_specific_racial_province_modifier_tolerance = { race = hobgoblin }
	}
	

	#centaur
	if = {
		limit = { has_province_flag = centaur_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = centaur } }
		FROM = { decrement_racial_pop_count = { race = centaur } }
		update_specific_racial_province_modifier_tolerance = { race = centaur }
	}
	

	#ogre
	if = {
		limit = { has_province_flag = ogre_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = ogre } }
		FROM = { decrement_racial_pop_count = { race = ogre } }
		update_specific_racial_province_modifier_tolerance = { race = ogre }
	}
	

	#lizardfolk
	if = {
		limit = { has_province_flag = lizardfolk_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = lizardfolk } }
		FROM = { decrement_racial_pop_count = { race = lizardfolk } }
		update_specific_racial_province_modifier_tolerance = { race = lizardfolk }
	}

	#mechanim
	if = {
		limit = { has_province_flag = mechanim_present }
		# update tolerance counts for previous owner (FROM) and current owner
		
		owner = { increment_racial_pop_count = { race = mechanim } }
		FROM = { decrement_racial_pop_count = { race = mechanim } }
		update_specific_racial_province_modifier_tolerance = { race = mechanim }
	}
}

#This should be use in a province scope
update_specific_racial_province_modifier_tolerance = { #$race$ = the race you're checking for

	# REB = { change_variable = { specificRacialTolerance = 1 } }
	
	if = {
		limit = {
			has_province_flag = $race$_present
			OR = {
				is_empty = yes # special case, newly emptied provinces need to be checked regardless of their "owners" "tolerance"
				has_unmatching_race_tolerance_trigger = { race = $race$ } # it may actually be faster to not check this at all and always do this given how many things this checks..
			}
		}

		#High Tolerance - Integrated
		if = {
			limit = {
				OR = {
					owner = { high_tolerance_$race$_race_trigger = yes }
					is_empty = yes
					# edge case, empty provinces will always have primary majority
				}
			}
			#High Tolerance - Small Minority
			if = {
				limit = {
					has_small_$race$_minority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_minority_integrated_small
					duration = -1
				}
				remove_province_modifier = $race$_minority_oppressed_small
				remove_province_modifier = $race$_minority_coexisting_small
			}
			#High Tolerance - Large Minority
			else_if = {
				limit = {
					has_large_$race$_minority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_minority_integrated_large
					duration = -1
				}
				remove_province_modifier = $race$_minority_oppressed_large
				remove_province_modifier = $race$_minority_coexisting_large
			}
			#High Tolerance - Majority
			else_if = {
				limit = {
					has_$race$_majority_trigger = yes
				}
				if = {
					limit = {
						OR = {
							is_empty = yes
							owner = { has_country_modifier = $race$_administration }
						}
					}
					# regardless of tolerance, if you have that races administration the majority is primary.
					# though you can have low tolerance of your own primary race,
					# the high_tolerance trigger will always be true if its your primary regardless of actual tolerance
					# additionally, if this is an empty province (i.e. uncolonised) the majority is primary
					add_permanent_province_modifier = {
						name = $race$_majority_primary
						duration = -1
					}
					remove_province_modifier = $race$_majority_integrated
				}
				else = {
					add_permanent_province_modifier = {
						name = $race$_majority_integrated
						duration = -1
					}
					remove_province_modifier = $race$_majority_primary
				}
				remove_province_modifier = $race$_majority_oppressed
				remove_province_modifier = $race$_majority_coexisting
			}
		}
		#Medium Tolerance - Coexisting
		else_if = {
			limit = { owner = { medium_tolerance_$race$_race_trigger = yes } }
			#Medium Tolerance - Small Minority
			if = {
				limit = {
					has_small_$race$_minority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_minority_coexisting_small
					duration = -1
				}
				remove_province_modifier = $race$_minority_oppressed_small
				remove_province_modifier = $race$_minority_integrated_small
			}
			#Medium Tolerance - Large Minority
			else_if = {
				limit = {
					has_large_$race$_minority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_minority_coexisting_large
					duration = -1
				}
				remove_province_modifier = $race$_minority_oppressed_large
				remove_province_modifier = $race$_minority_integrated_large
			}
			#Medium Tolerance - Majority
			else_if = {
				limit = {
					has_$race$_majority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_majority_coexisting
					duration = -1
				}
				remove_province_modifier = $race$_majority_primary
				remove_province_modifier = $race$_majority_oppressed
				remove_province_modifier = $race$_majority_integrated
			}
		}
		#Low Tolerance - Oppressed
		else_if = {
			limit = { owner = { low_tolerance_$race$_race_trigger = yes } }
			#Low Tolerance - Small Minority
			if = {
				limit = {
					has_small_$race$_minority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_minority_oppressed_small
					duration = -1
				}
				remove_province_modifier = $race$_minority_integrated_small
				remove_province_modifier = $race$_minority_coexisting_small
			}
			#Low Tolerance - Majority
			else_if = {
				limit = {
					has_large_$race$_minority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_minority_oppressed_large
					duration = -1
				}
				remove_province_modifier = $race$_minority_integrated_large
				remove_province_modifier = $race$_minority_coexisting_large
			}
			#Low Tolerance - Majority
			else_if = {
				limit = {
					has_$race$_majority_trigger = yes
				}
				add_permanent_province_modifier = {
					name = $race$_majority_oppressed
					duration = -1
				}
				remove_province_modifier = $race$_majority_primary
				remove_province_modifier = $race$_majority_coexisting
				remove_province_modifier = $race$_majority_integrated
			}
		}
	}
}

update_racial_province_majority = {

	if = {
		limit = {
			OR = {
				is_colony = no
				is_capital = yes
				# stupid edge case - losing all your provs except a colony makes the province both the capital and a colony in on_capital_moved, and it doesn't trigger on_colony_finished
			}
		} # leave the old majority in new colonies until the colony is complete

		#Culture Conversion Removal Squad - turns the old majority into a large minority
		convert_majority_to_minority = { size = large }

		#Remove Purging and Expelling majority modifiers
		if = {
			limit = { has_province_modifier = purging_majority }
			remove_province_modifier = purging_majority
		}
		if = {
			limit = { has_province_modifier = expelling_majority }
			remove_province_modifier = expelling_majority
		}


		#Add Majorities to province
		add_majority_of_current_culture = yes
		
		#Grant the minority->majority bonus if they were a minority before
		cleanup_racial_province_minority_into_majority = yes
	}
}

cleanup_racial_province_minority_into_majority = {


	#AddNewRaceHere

	#dwarven
	if = {
		limit = {
			has_dwarven_minority_trigger = yes
			culture_is_dwarven = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_dwarven_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = dwarven }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#elven
	else_if = {
		limit = {
			has_elven_minority_trigger = yes
			culture_is_elven = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_elven_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = elven }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#halfling
	else_if = {
		limit = {
			has_halfling_minority_trigger = yes
			culture_is_halfling = yes	
		}
		
		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_halfling_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}
		
		remove_racial_minority_any_size = { race = halfling }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#gnomish
	else_if = {
		limit = {
			has_gnomish_minority_trigger = yes
			culture_is_gnomish = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_gnomish_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = gnomish }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#half_orcish
	else_if = {
		limit = {
			has_half_orcish_minority_trigger = yes
			culture_is_half_orcish = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_half_orcish_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = half_orcish }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#kobold
	else_if = {
		limit = {
			has_kobold_minority_trigger = yes
			culture_is_kobold = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_kobold_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = kobold }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#orcish
	else_if = {
		limit = {
			has_orcish_minority_trigger = yes
			culture_is_orcish = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_orcish_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = orcish }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#human
	else_if = {
		limit = {
			has_human_minority_trigger = yes
			culture_is_human = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_human_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = human }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#gnollish
	else_if = {
		limit = {
			has_gnollish_minority_trigger = yes
			culture_is_gnollish = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_gnollish_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = gnollish }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#ruinborn
	else_if = {
		limit = {
			has_ruinborn_minority_trigger = yes
			culture_is_ruinborn = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_ruinborn_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = ruinborn }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#goblin
	else_if = {
		limit = {
			has_goblin_minority_trigger = yes
			culture_is_goblin = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_goblin_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = goblin }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#harpy
	else_if = {
		limit = {
			has_harpy_minority_trigger = yes
			culture_is_harpy = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_harpy_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = harpy }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#troll
	else_if = {
		limit = {
			has_troll_minority_trigger = yes
			culture_is_troll = yes
		}
		
		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_troll_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}	
	
		remove_racial_minority_any_size = { race = troll }	

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#half_elven
	else_if = {
		limit = {
			has_half_elven_minority_trigger = yes
			culture_is_half_elven = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_half_elven_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = half_elven }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#harimari
	else_if = {
		limit = {
			has_harimari_minority_trigger = yes
			culture_is_harimari = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_harimari_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = harimari }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#hobgoblin
	else_if = {
		limit = {
			has_hobgoblin_minority_trigger = yes
			culture_is_hobgoblin = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_hobgoblin_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = hobgoblin }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#centaur
	else_if = {
		limit = {
			has_centaur_minority_trigger = yes
			culture_is_centaur = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_centaur_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = centaur }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#ogre
	else_if = {
		limit = {
			has_ogre_minority_trigger = yes
			culture_is_ogre = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_ogre_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = ogre }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#lizardfolk
	else_if = {
		limit = {
			has_lizardfolk_minority_trigger = yes
			culture_is_lizardfolk = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_lizardfolk_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = lizardfolk }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}

	#mechanim
	else_if = {
		limit = {
			has_mechanim_minority_trigger = yes
			culture_is_mechanim = yes
		}

		if = {
			limit = { owner = { has_country_flag = save_minorities_for_migration } }
			# save whether it was large or small to restore later - yes this has to be done in a country flag because we have to keep the define to clear province flags on empty
			if = {
				limit = { has_small_mechanim_minority_trigger = yes }
				owner = { set_country_flag = migratory_small_minority }
			}
			else = {
				owner = { set_country_flag = migratory_large_minority }
			}
		}

		remove_racial_minority_any_size = { race = mechanim }

		add_province_modifier = {
			name = minority_into_majority
			duration = 3650	#10 years
		}
	}
}

make_majority_primary = {
	#AddNewRaceHere

	#dwarven
	if = {
		limit = {
			has_province_modifier = dwarven_majority_integrated
			owner = { has_country_modifier = dwarven_administration }
		}
		remove_province_modifier = dwarven_majority_integrated

		add_permanent_province_modifier = {
			name = dwarven_majority_primary
			duration = -1
		}
	}

	#elven
	else_if = {
		limit = {
			has_province_modifier = elven_majority_integrated
			owner = { has_country_modifier = elven_administration }
		}
		remove_province_modifier = elven_majority_integrated

		add_permanent_province_modifier = {
			name = elven_majority_primary
			duration = -1
		}
	}

	#halfling
	else_if = {
		limit = {
			has_province_modifier = halfling_majority_integrated
			owner = { has_country_modifier = halfling_administration }
		}
		remove_province_modifier = halfling_majority_integrated

		add_permanent_province_modifier = {
			name = halfling_majority_primary
			duration = -1
		}
	}

	#gnomish
	else_if = {
		limit = {
			has_province_modifier = gnomish_majority_integrated
			owner = { has_country_modifier = gnomish_administration }
		}
		remove_province_modifier = gnomish_majority_integrated

		add_permanent_province_modifier = {
			name = gnomish_majority_primary
			duration = -1
		}
	}

	#half_orcish
	else_if = {
		limit = {
			has_province_modifier = half_orcish_majority_integrated
			owner = { has_country_modifier = half_orcish_administration }
		}
		remove_province_modifier = half_orcish_majority_integrated

		add_permanent_province_modifier = {
			name = half_orcish_majority_primary
			duration = -1
		}
	}

	#kobold
	else_if = {
		limit = {
			has_province_modifier = kobold_majority_integrated
			owner = { has_country_modifier = kobold_administration }
		}
		remove_province_modifier = kobold_majority_integrated

		add_permanent_province_modifier = {
			name = kobold_majority_primary
			duration = -1
		}
	}

	#orcish
	else_if = {
		limit = {
			has_province_modifier = orcish_majority_integrated
			owner = { has_country_modifier = orcish_administration }
		}
		remove_province_modifier = orcish_majority_integrated

		add_permanent_province_modifier = {
			name = orcish_majority_primary
			duration = -1
		}
	}

	#human
	else_if = {
		limit = {
			has_province_modifier = human_majority_integrated
			owner = { has_country_modifier = human_administration }
		}
		remove_province_modifier = human_majority_integrated

		add_permanent_province_modifier = {
			name = human_majority_primary
			duration = -1
		}
	}

	#gnollish
	else_if = {
		limit = {
			has_province_modifier = gnollish_majority_integrated
			owner = { has_country_modifier = gnollish_administration }
		}
		remove_province_modifier = gnollish_majority_integrated

		add_permanent_province_modifier = {
			name = gnollish_majority_primary
			duration = -1
		}
	}

	#ruinborn
	else_if = {
		limit = {
			has_province_modifier = ruinborn_majority_integrated
			owner = { has_country_modifier = ruinborn_administration }
		}
		remove_province_modifier = ruinborn_majority_integrated

		add_permanent_province_modifier = {
			name = ruinborn_majority_primary
			duration = -1
		}
	}

	#goblin
	else_if = {
		limit = {
			has_province_modifier = goblin_majority_integrated
			owner = { has_country_modifier = goblin_administration }
		}
		remove_province_modifier = goblin_majority_integrated

		add_permanent_province_modifier = {
			name = goblin_majority_primary
			duration = -1
		}
	}

	#harpy
	else_if = {
		limit = {
			has_province_modifier = harpy_majority_integrated
			owner = { has_country_modifier = harpy_administration }
		}
		remove_province_modifier = harpy_majority_integrated

		add_permanent_province_modifier = {
			name = harpy_majority_primary
			duration = -1
		}
	}

	#troll
	else_if = {
		limit = {
			has_province_modifier = troll_majority_integrated
			owner = { has_country_modifier = troll_administration }
		}
		remove_province_modifier = troll_majority_integrated

		add_permanent_province_modifier = {
			name = troll_majority_primary
			duration = -1
		}
	}

	#half_elven
	else_if = {
		limit = {
			has_province_modifier = half_elven_majority_integrated
			owner = { has_country_modifier = half_elven_administration }
		}
		remove_province_modifier = half_elven_majority_integrated

		add_permanent_province_modifier = {
			name = half_elven_majority_primary
			duration = -1
		}
	}

	#harimari
	else_if = {
		limit = {
			has_province_modifier = harimari_majority_integrated
			owner = { has_country_modifier = harimari_administration }
		}
		remove_province_modifier = harimari_majority_integrated

		add_permanent_province_modifier = {
			name = harimari_majority_primary
			duration = -1
		}
	}

	#hobgoblin
	else_if = {
		limit = {
			has_province_modifier = hobgoblin_majority_integrated
			owner = { has_country_modifier = hobgoblin_administration }
		}
		remove_province_modifier = hobgoblin_majority_integrated

		add_permanent_province_modifier = {
			name = hobgoblin_majority_primary
			duration = -1
		}
	}

	#centaur
	else_if = {
		limit = {
			has_province_modifier = centaur_majority_integrated
			owner = { has_country_modifier = centaur_administration }
		}
		remove_province_modifier = centaur_majority_integrated

		add_permanent_province_modifier = {
			name = centaur_majority_primary
			duration = -1
		}
	}

	#ogre
	else_if = {
		limit = {
			has_province_modifier = ogre_majority_integrated
			owner = { has_country_modifier = ogre_administration }
		}
		remove_province_modifier = ogre_majority_integrated

		add_permanent_province_modifier = {
			name = ogre_majority_primary
			duration = -1
		}
	}

	#lizardfolk
	else_if = {
		limit = {
			has_province_modifier = lizardfolk_majority_integrated
			owner = { has_country_modifier = lizardfolk_administration }
		}
		remove_province_modifier = lizardfolk_majority_integrated

		add_permanent_province_modifier = {
			name = lizardfolk_majority_primary
			duration = -1
		}
	}

	#mechanim
	else_if = {
		limit = {
			has_province_modifier = mechanim_majority_integrated
			owner = { has_country_modifier = mechanim_administration }
		}
		remove_province_modifier = mechanim_majority_integrated

		add_permanent_province_modifier = {
			name = mechanim_majority_primary
			duration = -1
		}
	}
}

#Check so tolerance values are not over max
check_tolerance_values = {
	if = {
		limit = {
			check_variable = {
				which = $race$_race_tolerance
				which = max_race_tolerance
			}
		}
		set_variable = {
			which = $race$_race_tolerance
			which = max_race_tolerance
		}
	}
	country_event = { id = racial_pop_events_$race$.99 }
}

#For increasing the tolerance values of all races that exists in any owned provinces.
increase_all_existing_tolerances = {
	custom_tooltip = $size$_increase_in_all_existing_tolerances_tooltip
	hidden_effect = {
		if = {
			limit = {
				any_owned_province = { has_any_centaur_pop_trigger = yes }
			}
			$size$_increase_of_centaur_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_dwarven_pop_trigger = yes }
			}
			$size$_increase_of_dwarven_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_elven_pop_trigger = yes }
			}
			$size$_increase_of_elven_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_gnollish_pop_trigger = yes }
			}
			$size$_increase_of_gnollish_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_gnomish_pop_trigger = yes }
			}
			$size$_increase_of_gnomish_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_goblin_pop_trigger = yes }
			}
			$size$_increase_of_goblin_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_halfling_pop_trigger = yes }
			}
			$size$_increase_of_halfling_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_half_elven_pop_trigger = yes }
			}
			$size$_increase_of_half_elven_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_half_orcish_pop_trigger = yes }
			}
			$size$_increase_of_half_orcish_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_harimari_pop_trigger = yes }
			}
			$size$_increase_of_harimari_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_harpy_pop_trigger = yes }
			}
			$size$_increase_of_harpy_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_hobgoblin_pop_trigger = yes }
			}
			$size$_increase_of_hobgoblin_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_human_pop_trigger = yes }
			}
			$size$_increase_of_human_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_kobold_pop_trigger = yes }
			}
			$size$_increase_of_kobold_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_lizardfolk_pop_trigger = yes }
			}
			$size$_increase_of_lizardfolk_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_mechanim_pop_trigger = yes }
			}
			$size$_increase_of_mechanim_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_ogre_pop_trigger = yes }
			}
			$size$_increase_of_ogre_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_orcish_pop_trigger = yes }
			}
			$size$_increase_of_orcish_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_ruinborn_pop_trigger = yes }
			}
			$size$_increase_of_ruinborn_tolerance_effect = yes
		}
		if = {
			limit = {
				any_owned_province = { has_any_troll_pop_trigger = yes }
			}
			$size$_increase_of_troll_tolerance_effect = yes
		}
	}
}

#For increasing the tolerance values of all races.
increase_all_tolerances = {
	custom_tooltip = $size$_increase_in_all_tolerances_tooltip
	hidden_effect = {
		$size$_increase_of_centaur_tolerance_effect = yes
		$size$_increase_of_dwarven_tolerance_effect = yes
		$size$_increase_of_elven_tolerance_effect = yes
		$size$_increase_of_gnollish_tolerance_effect = yes
		$size$_increase_of_gnomish_tolerance_effect = yes
		$size$_increase_of_goblin_tolerance_effect = yes
		$size$_increase_of_halfling_tolerance_effect = yes
		$size$_increase_of_half_elven_tolerance_effect = yes
		$size$_increase_of_half_orcish_tolerance_effect = yes
		$size$_increase_of_harimari_tolerance_effect = yes
		$size$_increase_of_harpy_tolerance_effect = yes
		$size$_increase_of_hobgoblin_tolerance_effect = yes
		$size$_increase_of_human_tolerance_effect = yes
		$size$_increase_of_kobold_tolerance_effect = yes
		$size$_increase_of_lizardfolk_tolerance_effect = yes
		$size$_increase_of_mechanim_tolerance_effect = yes
		$size$_increase_of_ogre_tolerance_effect = yes
		$size$_increase_of_orcish_tolerance_effect = yes
		$size$_increase_of_ruinborn_tolerance_effect = yes
		$size$_increase_of_troll_tolerance_effect = yes
	}
}

#Increase the size of every present minority (province scope)
add_minority_size_if_present = {

	custom_tooltip = increase_every_minority_size_if_present_tt

	if = {
		limit = {
			has_any_centaur_pop_trigger = yes					
		}
		add_centaur_minority_size_effect = yes
	}

	if = {
		limit = { 
			has_any_dwarven_pop_trigger = yes					
		}
		add_dwarven_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_elven_pop_trigger = yes
		}
		add_elven_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_gnollish_pop_trigger = yes					
		}
		add_gnollish_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_gnomish_pop_trigger = yes					
		}
		add_gnomish_minority_size_effect = yes
	}

	if = {
		limit = { 
			has_any_goblin_pop_trigger = yes					
		}
		add_goblin_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_half_elven_pop_trigger = yes					
		}
		add_half_elven_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_half_orcish_pop_trigger = yes					
		}
		add_half_orcish_minority_size_effect = yes
	}

	if = {
		limit = { 
			has_any_halfling_pop_trigger = yes					
		}
		add_halfling_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_harimari_pop_trigger = yes					
		}
		add_harimari_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_harpy_pop_trigger = yes					
		}
		add_harpy_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_hobgoblin_pop_trigger = yes					
		}
		add_hobgoblin_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_human_pop_trigger = yes					
		}
		add_human_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_kobold_pop_trigger = yes					
		}
		add_kobold_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_lizardfolk_pop_trigger = yes					
		}
		add_lizardfolk_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_mechanim_pop_trigger = yes					
		}
		add_mechanim_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_ogre_pop_trigger = yes					
		}
		add_ogre_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_orcish_pop_trigger = yes					
		}
		add_orcish_minority_size_effect = yes
	}

	if = {
		limit = { 
			has_any_ruinborn_pop_trigger = yes					
		}
		add_ruinborn_minority_size_effect = yes
	}

	if = {
		limit = {
			has_any_troll_pop_trigger = yes					
		}
		add_troll_minority_size_effect = yes
	}
}

#Increase the size of your primary race (province scope)
add_primary_race_minority_size_effect = {	#Adding this for ruinborn_tolerance_events.6, could add primary race size reduction as well if people want me to
	if = {
		limit = { culture_is_elven = yes }
		add_elven_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_dwarven = yes }
		add_dwarven_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_gnollish = yes }
		add_gnollish_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_gnomish = yes }
		add_gnomish_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_goblin = yes }
		add_goblin_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_half_elven = yes }
		add_half_elven_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_half_orcish = yes }
		add_half_orcish_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_halfling = yes }
		add_halfling_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_harpy = yes }
		add_harpy_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_human = yes }
		add_human_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_kobold = yes }
		add_kobold_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_orcish = yes }
		add_orcish_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_ruinborn = yes }
		add_ruinborn_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_troll = yes }
		add_troll_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_harimari = yes }
		add_harimari_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_hobgoblin = yes }
		add_hobgoblin_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_centaur = yes }
		add_centaur_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_ogre = yes }
		add_ogre_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_lizardfolk = yes }
		add_lizardfolk_minority_size_effect = yes
	}
	else_if = {
		limit = { culture_is_mechanim = yes }
		add_mechanim_minority_size_effect = yes
	}
}

#----# Scripted effects for pop menu #----#
pop_menu_main_setup = {
	pop_menu_calculations = yes
	set_variable = { which = centaurRanking value = 1 }
	set_variable = { which = dwarvenRanking value = 2 }
	set_variable = { which = elvenRanking value = 3 }
	set_variable = { which = gnollishRanking value = 4 }
	set_variable = { which = gnomishRanking value = 5 }
	set_variable = { which = goblinRanking value = 6 }
	set_variable = { which = halflingRanking value = 7 }
	set_variable = { which = half_elvenRanking value = 8 }
	set_variable = { which = half_orcishRanking value = 9 }
	set_variable = { which = harimariRanking value = 10 }
	set_variable = { which = harpyRanking value = 11 }
	set_variable = { which = hobgoblinRanking value = 12 }
	set_variable = { which = humanRanking value = 13 }
	set_variable = { which = koboldRanking value = 14 }
	set_variable = { which = lizardfolkRanking value = 15 }
	set_variable = { which = mechanimRanking value = 16 }
	set_variable = { which = ogreRanking value = 17 }
	set_variable = { which = orcishRanking value = 18 }
	set_variable = { which = ruinbornRanking value = 19 }
	set_variable = { which = trollRanking value = 20 }
	pop_menu_main_sorting_effect = yes
}

pop_menu_calculations = {
	set_variable = { which = nbcentaurMajority value = 0 }
	set_variable = { which = nbcentaurMinority value = 0 }
	set_variable = { which = nbcentaurDev value = 0 }
	set_variable = { which = nbdwarvenMajority value = 0 }
	set_variable = { which = nbdwarvenMinority value = 0 }
	set_variable = { which = nbdwarvenDev value = 0 }
	set_variable = { which = nbelvenMajority value = 0 }
	set_variable = { which = nbelvenMinority value = 0 }
	set_variable = { which = nbelvenDev value = 0 }
	set_variable = { which = nbgnollishMajority value = 0 }
	set_variable = { which = nbgnollishMinority value = 0 }
	set_variable = { which = nbgnollishDev value = 0 }
	set_variable = { which = nbgnomishMajority value = 0 }
	set_variable = { which = nbgnomishMinority value = 0 }
	set_variable = { which = nbgnomishDev value = 0 }
	set_variable = { which = nbgoblinMajority value = 0 }
	set_variable = { which = nbgoblinMinority value = 0 }
	set_variable = { which = nbgoblinDev value = 0 }
	set_variable = { which = nbhalflingMajority value = 0 }
	set_variable = { which = nbhalflingMinority value = 0 }
	set_variable = { which = nbhalflingDev value = 0 }
	set_variable = { which = nbhalf_elvenMajority value = 0 }
	set_variable = { which = nbhalf_elvenMinority value = 0 }
	set_variable = { which = nbhalf_elvenDev value = 0 }
	set_variable = { which = nbhalf_orcishMajority value = 0 }
	set_variable = { which = nbhalf_orcishMinority value = 0 }
	set_variable = { which = nbhalf_orcishDev value = 0 }
	set_variable = { which = nbharimariMajority value = 0 }
	set_variable = { which = nbharimariMinority value = 0 }
	set_variable = { which = nbharimariDev value = 0 }
	set_variable = { which = nbharpyMajority value = 0 }
	set_variable = { which = nbharpyMinority value = 0 }
	set_variable = { which = nbharpyDev value = 0 }
	set_variable = { which = nbhobgoblinMajority value = 0 }
	set_variable = { which = nbhobgoblinMinority value = 0 }
	set_variable = { which = nbhobgoblinDev value = 0 }
	set_variable = { which = nbhumanMajority value = 0 }
	set_variable = { which = nbhumanMinority value = 0 }
	set_variable = { which = nbhumanDev value = 0 }
	set_variable = { which = nbkoboldMajority value = 0 }
	set_variable = { which = nbkoboldMinority value = 0 }
	set_variable = { which = nbkoboldDev value = 0 }
	set_variable = { which = nblizardfolkMajority value = 0 }
	set_variable = { which = nblizardfolkMinority value = 0 }
	set_variable = { which = nblizardfolkDev value = 0 }
	set_variable = { which = nbmechanimMajority value = 0 }
	set_variable = { which = nbmechanimMinority value = 0 }
	set_variable = { which = nbmechanimDev value = 0 }
	set_variable = { which = nbogreMajority value = 0 }
	set_variable = { which = nbogreMinority value = 0 }
	set_variable = { which = nbogreDev value = 0 }
	set_variable = { which = nborcishMajority value = 0 }
	set_variable = { which = nborcishMinority value = 0 }
	set_variable = { which = nborcishDev value = 0 }
	set_variable = { which = nbruinbornMajority value = 0 }
	set_variable = { which = nbruinbornMinority value = 0 }
	set_variable = { which = nbruinbornDev value = 0 }
	set_variable = { which = nbtrollMajority value = 0 }
	set_variable = { which = nbtrollMinority value = 0 }
	set_variable = { which = nbttrollDev value = 0 }

	#every_owned_province = {
	#	[[cored]
	#		limit = {
	#			is_state = yes
	#			is_state_core = ROOT
	#		}
	#	]
	#} #closing bracket so vscode doesn't get angry
	# 1.35 TODO - originally every_owned_province,
	# this errors (but not as badly as the other scripted effect - see below)
	# (yes, they broke every_owned_province again)
	every_core_province = {
		limit = {
			owned_by = ROOT
			[[cored]
			is_state = yes
			is_state_core = ROOT
			]
		}
		calculate_province_race_values = { RACE = centaur }
		calculate_province_race_values = { RACE = dwarven }
		calculate_province_race_values = { RACE = elven }
		calculate_province_race_values = { RACE = gnollish }
		calculate_province_race_values = { RACE = gnomish }
		calculate_province_race_values = { RACE = goblin }
		calculate_province_race_values = { RACE = halfling }
		calculate_province_race_values = { RACE = half_elven }
		calculate_province_race_values = { RACE = half_orcish }
		calculate_province_race_values = { RACE = harimari }
		calculate_province_race_values = { RACE = harpy }
		calculate_province_race_values = { RACE = hobgoblin }
		calculate_province_race_values = { RACE = human }
		calculate_province_race_values = { RACE = kobold }
		calculate_province_race_values = { RACE = lizardfolk }
		calculate_province_race_values = { RACE = mechanim }
		calculate_province_race_values = { RACE = ogre }
		calculate_province_race_values = { RACE = orcish }
		calculate_province_race_values = { RACE = ruinborn }
		calculate_province_race_values = { RACE = troll }
	}

	set_variable = { which = nbTotalDev which = nbcentaurDev }
	change_variable = { which = nbTotalDev which = nbdwarvenDev }
	change_variable = { which = nbTotalDev which = nbelvenDev }
	change_variable = { which = nbTotalDev which = nbgoblinDev }
	change_variable = { which = nbTotalDev which = nbgnollishDev }
	change_variable = { which = nbTotalDev which = nbgnomishDev }
	change_variable = { which = nbTotalDev which = nbhalflingDev }
	change_variable = { which = nbTotalDev which = nbhalf_elvenDev }
	change_variable = { which = nbTotalDev which = nbhalf_orcishDev }
	change_variable = { which = nbTotalDev which = nbharimariDev }
	change_variable = { which = nbTotalDev which = nbharpyDev }
	change_variable = { which = nbTotalDev which = nbhobgoblinDev }
	change_variable = { which = nbTotalDev which = nbhumanDev }
	change_variable = { which = nbTotalDev which = nbkoboldDev }
	change_variable = { which = nbTotalDev which = nblizardfolkDev }
	change_variable = { which = nbTotalDev which = nbmechanimDev }
	change_variable = { which = nbTotalDev which = nbogreDev }
	change_variable = { which = nbTotalDev which = nborcishDev }
	change_variable = { which = nbTotalDev which = nbruinbornDev }
	change_variable = { which = nbTotalDev which = nbtrollDev }

	pop_menu_round_and_percent = { which = nbcentaurDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbdwarvenDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbelvenDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbgnollishDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbgnomishDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbgoblinDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbhalflingDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbhalf_elvenDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbhalf_orcishDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbharimariDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbharpyDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbhobgoblinDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbhumanDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbkoboldDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nblizardfolkDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbmechanimDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nborcishDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbogreDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbruinbornDev total = nbTotalDev }
	pop_menu_round_and_percent = { which = nbtrollDev total = nbTotalDev }
}

calculate_province_race_values = {
	if = { limit = { has_$RACE$_majority_trigger = yes }
		export_to_variable = { which = nb$RACE$Dev value = development }
		ROOT = {
			change_variable = { which = nb$RACE$Dev which = PREV }
			change_variable = { which = nb$RACE$Majority value = 1 }
		}
	}
	else_if = { limit = { has_small_$RACE$_minority_trigger = yes }
		export_to_variable = { which = nb$RACE$Dev value = development }
		multiply_variable = { which = nb$RACE$Dev value = 0.05 }
		ROOT = {
			change_variable = { which = nb$RACE$Dev which = PREV }
   			change_variable = { which = nb$RACE$Minority value = 1 }
		}
	}
	else_if = { limit = { has_large_$RACE$_minority_trigger = yes }
		export_to_variable = { which = nb$RACE$Dev value = development }
		multiply_variable = { which = nb$RACE$Dev value = 0.1 }
		ROOT = {
			change_variable = { which = nb$RACE$Dev which = PREV }
   			change_variable = { which = nb$RACE$Minority value = 1 }
		}
	}
}

pop_menu_round_and_percent = {
	divide_variable = { which = $which$ which = $total$ }
	if = { limit = { check_variable = { which = $which$ value = 0.01 } }
		set_variable = { which = temp which = $which$ }
		multiply_variable = { which = temp value = 100 }
		divide_variable = { which = $which$ value = 10 }
		multiply_variable = { which = $which$ value = 1000 }
		subtract_variable = { which = temp which = $which$ }
		if = { limit = { check_variable = { which = temp value = 0.5 } }
			change_variable = { which = $which$ value = 1 }
		}
	}
	else = {
		multiply_variable = { which = $which$ value = 100 }
	}
}

pop_menu_main_sorting_effect = {
	20 = { set_variable = { which = nbcentaurDev which = PREV } set_variable = { which = nbRaceDev which = nbcentaurDev } set_province_flag = not_sorted }
	19 = { set_variable = { which = nbdwarvenDev which = PREV } set_variable = { which = nbRaceDev which = nbdwarvenDev } set_province_flag = not_sorted }
	18 = { set_variable = { which = nbelvenDev which = PREV } set_variable = { which = nbRaceDev which = nbelvenDev } set_province_flag = not_sorted }
	17 = { set_variable = { which = nbgnollishDev which = PREV } set_variable = { which = nbRaceDev which = nbgnollishDev } set_province_flag = not_sorted }
	16 = { set_variable = { which = nbgnomishDev which = PREV } set_variable = { which = nbRaceDev which = nbgnomishDev } set_province_flag = not_sorted }
	15 = { set_variable = { which = nbgoblinDev which = PREV } set_variable = { which = nbRaceDev which = nbgoblinDev } set_province_flag = not_sorted }
	14 = { set_variable = { which = nbhalf_elvenDev which = PREV } set_variable = { which = nbRaceDev which = nbhalf_elvenDev } set_province_flag = not_sorted }
	13 = { set_variable = { which = nbhalf_orcishDev which = PREV } set_variable = { which = nbRaceDev which = nbhalf_orcishDev } set_province_flag = not_sorted }
	12 = { set_variable = { which = nbhalflingDev which = PREV } set_variable = { which = nbRaceDev which = nbhalflingDev } set_province_flag = not_sorted }
	11 = { set_variable = { which = nbharimariDev which = PREV } set_variable = { which = nbRaceDev which = nbharimariDev } set_province_flag = not_sorted }
	10 = { set_variable = { which = nbharpyDev which = PREV } set_variable = { which = nbRaceDev which = nbharpyDev } set_province_flag = not_sorted }
	9 = { set_variable = { which = nbhobgoblinDev which = PREV } set_variable = { which = nbRaceDev which = nbhobgoblinDev } set_province_flag = not_sorted }
	8 = { set_variable = { which = nbhumanDev which = PREV } set_variable = { which = nbRaceDev which = nbhumanDev } set_province_flag = not_sorted }
	7 = { set_variable = { which = nbkoboldDev which = PREV } set_variable = { which = nbRaceDev which = nbkoboldDev } set_province_flag = not_sorted }
	6 = { set_variable = { which = nblizardfolkDev which = PREV } set_variable = { which = nbRaceDev which = nblizardfolkDev } set_province_flag = not_sorted }
	5 = { set_variable = { which = nbmechanimDev which = PREV } set_variable = { which = nbRaceDev which = nbmechanimDev } set_province_flag = not_sorted }
	4 = { set_variable = { which = nbogreDev which = PREV } set_variable = { which = nbRaceDev which = nbogreDev } set_province_flag = not_sorted }
	3 = { set_variable = { which = nborcishDev which = PREV } set_variable = { which = nbRaceDev which = nborcishDev } set_province_flag = not_sorted }
	2 = { set_variable = { which = nbruinbornDev which = PREV } set_variable = { which = nbRaceDev which = nbruinbornDev } set_province_flag = not_sorted }
	1 = { set_variable = { which = nbtrollDev which = PREV } set_variable = { which = nbRaceDev which = nbtrollDev } set_province_flag = not_sorted }

	set_variable = { which = raceRanking value = 0 }
	2 = { save_event_target_as = most_represented_race }

	while = { limit = { NOT = { check_variable = { which = raceRanking value = 20 } } }	#20 = nb of races
		change_variable = { which = raceRanking value = 1 }
		pop_menu_variables = {	#province group that has all the provinces with stored variables
			limit = {
				has_province_flag = not_sorted
				check_variable = { which = nbRaceDev which = event_target:most_represented_race }
			}
			save_event_target_as = most_represented_race
		}
		event_target:most_represented_race = {
			clr_province_flag = not_sorted
			pop_ranking_conversion = yes
			set_variable = { which = nbRaceDev value = 0 }
		}
	}
}

pop_ranking_conversion = {
	if = { limit = { province_id = 20 } ROOT = { set_variable = { which = centaurRanking which = raceRanking } } }
	else_if = { limit = { province_id = 19 } ROOT = { set_variable = { which = dwarvenRanking which = raceRanking } } }
	else_if = { limit = { province_id = 18 } ROOT = { set_variable = { which = elvenRanking which = raceRanking } } }
	else_if = { limit = { province_id = 17 } ROOT = { set_variable = { which = gnollishRanking which = raceRanking } } }
	else_if = { limit = { province_id = 16 } ROOT = { set_variable = { which = gnomishRanking which = raceRanking } } }
	else_if = { limit = { province_id = 15 } ROOT = { set_variable = { which = goblinRanking which = raceRanking } } }
	else_if = { limit = { province_id = 14 } ROOT = { set_variable = { which = half_elvenRanking which = raceRanking } } }
	else_if = { limit = { province_id = 13 } ROOT = { set_variable = { which = half_orcishRanking which = raceRanking } } }
	else_if = { limit = { province_id = 12 } ROOT = { set_variable = { which = halflingRanking which = raceRanking } } }
	else_if = { limit = { province_id = 11 } ROOT = { set_variable = { which = harimariRanking which = raceRanking } } }
	else_if = { limit = { province_id = 10 } ROOT = { set_variable = { which = harpyRanking which = raceRanking } } }
	else_if = { limit = { province_id = 9 } ROOT = { set_variable = { which = hobgoblinRanking which = raceRanking } } }
	else_if = { limit = { province_id = 8 } ROOT = { set_variable = { which = humanRanking which = raceRanking } } }
	else_if = { limit = { province_id = 7 } ROOT = { set_variable = { which = koboldRanking which = raceRanking } } }
	else_if = { limit = { province_id = 6 } ROOT = { set_variable = { which = lizardfolkRanking which = raceRanking } } }
	else_if = { limit = { province_id = 5 } ROOT = { set_variable = { which = mechanimRanking which = raceRanking } } }
	else_if = { limit = { province_id = 4 } ROOT = { set_variable = { which = ogreRanking which = raceRanking } } }
	else_if = { limit = { province_id = 3 } ROOT = { set_variable = { which = orcishRanking which = raceRanking } } }
	else_if = { limit = { province_id = 2 } ROOT = { set_variable = { which = ruinbornRanking which = raceRanking } } }
	else_if = { limit = { province_id = 1 } ROOT = { set_variable = { which = trollRanking which = raceRanking } } }
}

pop_menu_rank_effect = {
	pop_menu_race_selected_effect = { RACE = centaur ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = dwarven ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = elven ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = gnollish ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = gnomish ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = goblin ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = halfling ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = half_elven ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = half_orcish ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = harimari ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = harpy ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = hobgoblin ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = human ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = kobold ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = lizardfolk ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = mechanim ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = ogre ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = orcish ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = ruinborn ORDER = $ORDER$ }
	pop_menu_race_selected_effect = { RACE = troll ORDER = $ORDER$ }
}

pop_menu_race_selected_effect = {
	if = { limit = { is_variable_equal = { which = $RACE$Ranking value = $ORDER$ } }
		custom_tooltip = pop_menu_$RACE$_tt
		hidden_effect = {
			pop_menu_cored_dev_calculations = { RACE = $RACE$ }
			country_event = { id = racial_pop_events_$RACE$.12 }
		}
	}
}

pop_menu_cored_dev_calculations = {
	set_variable = { which = nbRaceCoredDev value = 0 }
	set_variable = { which = nbTotalCoredDev value = 0 }

	# 1.35 TODO - originally every_owned_province,
	# that spams errors incredibly fast and forever while hovering buttons in the province menu
	# easily reaching many megabytes of errors in seconds - thus, this
	# (yes, they broke every_owned_province again)
	every_core_province = {
		limit = {
			owned_by = ROOT
			is_state = yes
			is_state_core = ROOT
		}

		export_to_variable = { which = nbTotalCoredDev value = development }
		export_to_variable = { which = nbRaceCoredDev value = development }

		if = { limit = { has_$RACE$_majority_trigger = yes }
			ROOT = { change_variable = { which = nbRaceCoredDev which = PREV } }
		}
		else_if = { limit = { has_small_$RACE$_minority_trigger = yes }
			multiply_variable = { which = nbRaceCoredDev value = 0.05 }
			ROOT = { change_variable = { which = nbRaceCoredDev which = PREV } }
		}
		else_if = { limit = { has_large_$RACE$_minority_trigger = yes }
			multiply_variable = { which = nbRaceCoredDev value = 0.1 }
			ROOT = { change_variable = { which = nbRaceCoredDev which = PREV } }
		}

		pop_menu_cored_minorities_calculations = yes

		ROOT = {
			change_variable = { which = nbTotalCoredDev which = PREV }
			change_variable = { which = nbTotalCoredDev which = nbMinorityCoredDev }
		}
	}

	pop_menu_round_and_percent = { which = nbRaceCoredDev total = nbTotalCoredDev }
}

pop_menu_cored_minorities_calculations = {
	export_to_variable = { which = nbMinorityCoredDev value = development }
	ROOT = { set_variable = { which = nbMinorityCoredDev value = 0 } }
	if = { limit = { has_small_centaur_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_centaur_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_elven_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_elven_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_dwarven_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_dwarven_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_gnollish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_gnollish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_gnomish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_gnomish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_goblin_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_goblin_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_half_elven_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_half_elven_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_half_orcish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_half_orcish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_halfling_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_halfling_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_harimari_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_harimari_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_harpy_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_harpy_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_hobgoblin_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_hobgoblin_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_human_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_human_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_kobold_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_kobold_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_lizardfolk_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_lizardfolk_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_mechanim_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_mechanim_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_ogre_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_ogre_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_orcish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_orcish_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_ruinborn_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_ruinborn_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	if = { limit = { has_small_troll_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.05 } }
	}
	else_if = { limit = { has_large_troll_minority_trigger = yes }
		ROOT = { change_variable = { which = nbMinorityCoredDev value = 0.10 } }
	}
	ROOT = { multiply_variable = { which = nbMinorityCoredDev which = PREV } }
}

#----# Change military Menu #-----#
pop_menu_military_setup = {
	pop_menu_calculations = { cored = yes }
	set_variable = { which = centaurRanking value = 1 }
	set_variable = { which = dwarvenRanking value = 2 }
	set_variable = { which = elvenRanking value = 3 }
	set_variable = { which = gnollishRanking value = 4 }
	set_variable = { which = gnomishRanking value = 5 }
	set_variable = { which = goblinRanking value = 6 }
	set_variable = { which = halflingRanking value = 7 }
	set_variable = { which = half_elvenRanking value = 8 }
	set_variable = { which = half_orcishRanking value = 9 }
	set_variable = { which = harimariRanking value = 10 }
	set_variable = { which = harpyRanking value = 11 }
	set_variable = { which = hobgoblinRanking value = 12 }
	set_variable = { which = humanRanking value = 13 }
	set_variable = { which = koboldRanking value = 14 }
	set_variable = { which = lizardfolkRanking value = 15 }
	set_variable = { which = mechanimRanking value = 16 }
	set_variable = { which = ogreRanking value = 17 }
	set_variable = { which = orcishRanking value = 18 }
	set_variable = { which = ruinbornRanking value = 19 }
	set_variable = { which = trollRanking value = 20 }
	pop_menu_military_sorting_effect = yes
}

pop_menu_military_sorting_setup = {
	set_variable = { which = nb$RACE$Dev which = PREV }
	set_variable = { which = nbRaceDev which = nb$RACE$Dev }
	if = { limit = { ROOT = { has_country_modifier = $RACE$_military } }
		ROOT = { set_variable = { which = $RACE$Ranking value = 1 } }
	}
	else_if = { limit = { ROOT = { check_variable = { which = nb$RACE$Dev value = 30 } } }
		set_province_flag = available_not_sorted
		save_event_target_as = most_represented_race
	}
	else = {
		set_province_flag = unavailable_not_sorted
		save_event_target_as = most_represented_race
	}
}

pop_menu_military_sorting_effect = {
	20 = { pop_menu_military_sorting_setup = { RACE = centaur } }
	19 = { pop_menu_military_sorting_setup = { RACE = dwarven } }
	18 = { pop_menu_military_sorting_setup = { RACE = elven } }
	17 = { pop_menu_military_sorting_setup = { RACE = gnollish } }
	16 = { pop_menu_military_sorting_setup = { RACE = gnomish } }
	15 = { pop_menu_military_sorting_setup = { RACE = goblin } }
	14 = {
		set_variable = { which = nbRaceDev value = 0 }
		set_variable = { which = raceRanking value = 20 }
		ROOT = { set_variable = { which = half_elvenRanking value = 20 } }
		# pop_menu_military_sorting_setup = { RACE = half_elven }
	}	#half elven military doesn't exist
	13 = { pop_menu_military_sorting_setup = { RACE = half_orcish } }
	12 = { pop_menu_military_sorting_setup = { RACE = halfling } }
	11 = { pop_menu_military_sorting_setup = { RACE = harimari } }
	10 = { pop_menu_military_sorting_setup = { RACE = harpy } }
	9 = { pop_menu_military_sorting_setup = { RACE = hobgoblin } }
	8 = { pop_menu_military_sorting_setup = { RACE = human } }
	7 = { pop_menu_military_sorting_setup = { RACE = kobold } }
	6 = { pop_menu_military_sorting_setup = { RACE = lizardfolk } }
	5 = { pop_menu_military_sorting_setup = { RACE = mechanim } }
	4 = { pop_menu_military_sorting_setup = { RACE = ogre } }
	3 = { pop_menu_military_sorting_setup = { RACE = orcish } }
	2 = { pop_menu_military_sorting_setup = { RACE = ruinborn } }
	1 = { pop_menu_military_sorting_setup = { RACE = troll } }

	set_variable = { which = raceRanking value = 1 }

	while = { limit = { pop_menu_variables = { has_province_flag = available_not_sorted } }
		change_variable = { which = raceRanking value = 1 }
		pop_menu_variables = {	#province group that has all the provinces with stored variables
			limit = {
				has_province_flag = available_not_sorted
				check_variable = { which = nbRaceDev which = event_target:most_represented_race }
			}
			save_event_target_as = most_represented_race
		}
		event_target:most_represented_race = {
			clr_province_flag = available_not_sorted
			pop_ranking_conversion = yes
			set_variable = { which = nbRaceDev value = 0 }
		}
	}
	while = { limit = { pop_menu_variables = { has_province_flag = unavailable_not_sorted } }
		change_variable = { which = raceRanking value = 1 }
		pop_menu_variables = {	#province group that has all the provinces with stored variables
			limit = {
				has_province_flag = unavailable_not_sorted
				check_variable = { which = nbRaceDev which = event_target:most_represented_race }
			}
			save_event_target_as = most_represented_race
		}
		event_target:most_represented_race = {
			clr_province_flag = unavailable_not_sorted
			pop_ranking_conversion = yes
			set_variable = { which = nbRaceDev value = 0 }
		}
	}
}

pop_menu_military_change_mil_effects = {
	pop_menu_military_change_mil_race = { RACE = centaur ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = dwarven ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = gnollish ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = gnomish ORDER = $ORDER$ GNOMISH_ARTIFICERS = yes }
	pop_menu_military_change_mil_race = { RACE = goblin ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = halfling ORDER = $ORDER$ }
	# pop_menu_military_change_mil_race = { RACE = half_elven ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = half_orcish ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = harimari ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = harpy ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = human ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = kobold ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = lizardfolk ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = mechanim ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = ogre ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = orcish ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = ruinborn ORDER = $ORDER$ }
	pop_menu_military_change_mil_race = { RACE = troll ORDER = $ORDER$ }
	
	if = { limit = { has_dlc = "Cradle of Civilization" }
		pop_menu_military_change_mil_race = { RACE = hobgoblin ORDER = $ORDER$ }
		pop_menu_military_change_mil_race = { RACE = elven ORDER = $ORDER$ }
	}
	else = {
		pop_menu_military_change_mil_race = { RACE = hobgoblin ORDER = $ORDER$ NO_DLC_HOBGOBLIN = yes }
		pop_menu_military_change_mil_race = { RACE = elven ORDER = $ORDER$ NO_DLC_ELVEN = yes }
	}
}

pop_menu_military_change_mil_race = {
    if = { limit = { is_variable_equal = { which = $RACE$Ranking value = $ORDER$ } }
        if = { limit = { is_variable_equal = { which = $RACE$Ranking value = 1 } }
            custom_tooltip = pop_military_current_tt
            tooltip = { add_country_modifier = { name = $RACE$_military duration = -1 desc = pop_military_modifier_duration_hidden } }
			if = { limit = { NOT = { has_dlc = "Cradle of Civilization" } }
				if = { limit = { has_country_modifier = hobgoblin_military }
					tooltip = { add_country_modifier = { name = hobgoblin_military_no_dlc duration = -1 desc = pop_military_modifier_duration_hidden } }
				}
				else_if = { limit = { has_country_modifier = elven_military }
					tooltip = { add_country_modifier = { name = elven_military_no_dlc duration = -1 desc = pop_military_modifier_duration_hidden } }
				}
			}
			if = {
				limit = { has_country_modifier = gnomish_military }
				tooltip = { add_country_modifier = { name = gnomish_military_artificer_buff duration = -1 } }
			}
        }
        else_if = {
            limit = {
                mil_power = 200
                high_tolerance_$RACE$_race_trigger = yes
                OR = {
                    check_variable = { which = nb$RACE$Dev value = 30 }
                    AND = {
                        has_country_modifier = $RACE$_administration
                        NOT = { primary_culture = sunrise_elf }
                    }
                }
            }
            add_mil_power = -200
            clear_racial_military = yes

            add_country_modifier = { name = restructuring_military duration = 3650 }
            add_country_modifier = { name = $RACE$_military duration = -1 hidden = yes }
            tooltip = { add_country_modifier = { name = $RACE$_military duration = -1 } }

            if = {
				limit = { has_country_modifier = gnomish_military }
				add_country_modifier = { name = gnomish_military_artificer_buff duration = -1 hidden = yes }
			}
			[[NO_DLC_HOBGOBLIN]
				add_country_modifier = { name = hobgoblin_military_no_dlc duration = -1 }
			]
			[[NO_DLC_ELVEN]
				add_country_modifier = { name = elven_military_no_dlc duration = -1 }
			]
			[[GNOMISH_ARTIFICERS]
				tooltip = { add_country_modifier = { name = gnomish_military_artificer_buff duration = -1 } }
				add_country_modifier = { name = gnomish_military_artificer_buff duration = -1 hidden = yes }
			]
            pop_menu_military_change_tech = { RACE = $RACE$ ORDER = $ORDER$ }
            
            # update sprites to match new military
            custom_tooltip = update_unit_sprites_tooltip
            hidden_effect = { update_unit_sprites_for_racial_mil = yes }
        }
        else = {
            custom_tooltip = pop_military_change_not_possible_tt
            if = { limit = { NOT = { mil_power = 200 } }
                custom_tooltip = pop_military_not_enough_milpower_tt
            }
            if = { limit = { NOT = { high_tolerance_$RACE$_race_trigger = yes } }
                custom_tooltip = pop_military_tolerance_too_low_tt
            }
            if = { limit = { NOT = { check_variable = { which = nb$RACE$Dev value = 30 } } }
                custom_tooltip = pop_military_dev_too_low_tt
            }
            if = {
                limit = {
					has_country_modifier = $RACE$_administration
					primary_culture = sunrise_elf
                }
                custom_tooltip = pop_military_primary_is_sunrise_elf_tt
            }
            custom_tooltip = pop_military_separator_tt
            tooltip = { add_country_modifier = { name = $RACE$_military duration = -1 desc = pop_military_modifier_duration_hidden } }
			[[NO_DLC_HOBGOBLIN]
				tooltip = { add_country_modifier = { name = hobgoblin_military_no_dlc duration = -1 desc = pop_military_modifier_duration_hidden} }
			]
			[[NO_DLC_ELVEN]
				tooltip = { add_country_modifier = { name = elven_military_no_dlc duration = -1 desc = pop_military_modifier_duration_hidden } }
			]
			[[GNOMISH_ARTIFICERS]
				tooltip = { add_country_modifier = { name = gnomish_military_artificer_buff duration = -1 } }
			]
        }
    }
}

pop_menu_military_change_tech = {
	if = {
		limit = { is_variable_equal = { which = elvenRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = deepwoods_superregion }
					primary_culture = wood_elf
					AND = {
						accepted_culture = wood_elf
						NOT = { culture_group = elven }
					}
				}
			}
			change_unit_type = tech_wood_elf
		}
		else_if = {
			limit = {
				OR = {
					primary_culture = sun_elf
					primary_culture = dawn_elf
					primary_culture = desert_elf
					primary_culture = sunrise_elf
					primary_culture = sunset_elf
					capital_scope = { continent = asia }
					capital_scope = { continent = africa }
					AND = {
						religion_group = bulwari
						OR = {
							capital_scope = { continent = north_america }
							capital_scope = { continent = south_america }
						}
					}
					AND = {
						accepted_culture = sun_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = dawn_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = desert_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = sunrise_elf
						NOT = { culture_group = elven }
					}
					AND = {
						accepted_culture = sunset_elf
						NOT = { culture_group = elven }
					}
				}
			}
			change_unit_type = tech_east_elven
		}
		else = {
			change_unit_type = tech_elven
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = half_orcishRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = gerudia_superregion }
					primary_culture = grombar_half_orc
					primary_culture = grombar_orc
					primary_culture = gray_orc
					AND = {
						accepted_culture = grombar_half_orc
						NOT = { culture_is_half_orcish = yes }
					}
					AND = {
						accepted_culture = grombar_orc
						NOT = { culture_is_half_orcish = yes }
					}
					AND = {
						accepted_culture = gray_orc
						NOT = { culture_is_half_orcish = yes }
					}
				}
			}
			change_unit_type = tech_gerudian
		}
		else = {
			change_unit_type = tech_cannorian
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = harimariRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					primary_culture = serene_harimari
					primary_culture = roaming_harimari
					AND = {
						accepted_culture = serene_harimari
						NOT = { culture_group = harimari }
					}
					AND = {
						accepted_culture = roaming_harimari
						NOT = { culture_group = harimari }
					}
				}
			}
			change_unit_type = tech_east_harimari
		}
		else = {
			change_unit_type = tech_west_harimari
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = harpyRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					primary_culture = pezarangi_harpy
					primary_culture = reishao_harpy
					AND = {
						accepted_culture = pezarangi_harpy
						NOT = { culture_group = harpy }
					}
					AND = {
						accepted_culture = reishao_harpy
						NOT = { culture_group = harpy }
					}
				}
			}
			change_unit_type = tech_pezarangi_harpy
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = north_salahad_superregion }
					capital_scope = { superregion = tanib_dajek_superregion }
					capital_scope = { superregion = fangaula_superregion }
					primary_culture = nzeri_harpy
					AND = {
						accepted_culture = nzeri_harpy
						NOT = { culture_group = harpy }
					}
				}
			}
			change_unit_type = tech_nzeri_harpy
		}
		else = {
			change_unit_type = tech_firanyan_harpy
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = humanRanking value = $ORDER$ } }
		if = { limit = { capital_scope = { superregion = bulwar_superregion } }
			change_unit_type = tech_bulwari
		}
		else_if = { limit = { capital_scope = { superregion = north_salahad_superregion } }
			change_unit_type = tech_salahadesi
		}
		else_if = { limit = { capital_scope = { superregion = south_salahad_superregion } }
			change_unit_type = tech_salahadesi
		}
		else_if = { 
			limit = { capital_scope = { superregion = tanib_dajek_superregion } }
		    if = {
				limit = { 
					OR = {
						accepted_culture = tanizu
						accepted_culture = antmvura
						accepted_culture = kombedak
						accepted_culture = umsozidak
						accepted_culture = wakoodak
					}
					NOT = { culture_group = inyaswarosa }
				}
				else = { change_unit_type = tech_inyaswarosa }
			}
			change_unit_type = tech_west_sarhaly
		}
		else_if = { 
			limit = { 
				capital_scope = { 
					OR = { 
						superregion = djinnakah_superregion
						superregion = taneyas_superregion
					}
				}
			}
			if = {
				limit = { 
					OR = {
						accepted_culture = suhratbi
						accepted_culture = dhebiji
						accepted_culture = guryadagga
						accepted_culture = ashamadi
					}
					NOT = { culture_group = baashidi }
				}
				change_unit_type = tech_baashidi
			}
			else = { change_unit_type = tech_south_sarhaly }
		}
		else_if = { limit = { capital_scope = { superregion = east_sarhal_superregion } }	#wingren again
			change_unit_type = tech_east_sarhaly
		}
		else_if = { limit = { capital_scope = { superregion = rahen_superregion } }
			change_unit_type = tech_raheni
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
				}
			}
			change_unit_type = tech_halessi
		}
		else_if = { limit = { capital_scope = { superregion = north_haless_superregion } }
			change_unit_type = tech_shuvuush
		}
		else_if = { limit = { capital_scope = { superregion = forbidden_lands_superregion } }
			change_unit_type = tech_triunic
		}
		else_if = { limit = { capital_scope = { superregion = gerudia_superregion } }
			change_unit_type = tech_gerudian
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = broken_lands_superregion }
					capital_scope = { superregion = eordand_superregion }
					capital_scope = { superregion = ynn_superregion }
				}
			}
			change_unit_type = tech_ynnsmen
		}
		else = {
			change_unit_type = tech_cannorian
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = koboldRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = north_haless_superregion }
					capital_scope = { superregion = rahen_superregion }
					primary_culture = goldscale_kobold
					primary_culture = dragonfire_kobold
					AND = {
						accepted_culture = goldscale_kobold
						NOT = { culture_group = kobold }
					}
					AND = {
						accepted_culture = dragonfire_kobold
						NOT = { culture_group = kobold }
					}
				}
			}
			change_unit_type = tech_east_kobold
		}
		else = {
			change_unit_type = tech_kobold
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = ogreRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = yanshen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = rahen_superregion }
					primary_culture = horned_ogre
					AND = {
						accepted_culture = horned_ogre
						NOT = { culture_group = ogre }
					}
				}
			}
			change_unit_type = tech_eastern_ogre
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = north_haless_superregion }
					AND = {
						accepted_culture = soulseeker_ogre
						NOT = { culture_group = ogre }
					}
				}
			}
		}
		else = {
			change_unit_type = tech_ogre	#may need custom one
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = orcishRanking value = $ORDER$ } }
		if = {
			limit = {
				OR = {
					capital_scope = {
						continent = serpentspine
					}
					dwarovar_orc_culture_primary = yes
					AND = {
						dwarovar_orc_culture_accepted = yes
						NOT = { culture_group = orcish }
					}
				}
			}
			change_unit_type = tech_black_orcish
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = {
						continent = asia
						NOT = { superregion = forbidden_lands_superregion }
					}
					primary_culture = brown_orc
					AND = {
						accepted_culture = brown_orc
						NOT = { culture_group = orcish }
					}
				}
			}
			change_unit_type = tech_east_orcish
		}
		else = {
			change_unit_type = tech_orcish
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = ruinbornRanking value = $ORDER$ } }
		if = { 
			limit = {
				OR = {
					capital_scope = { superregion = ynn_superregion }
					capital_scope = { region = forest_of_the_cursed_ones_region }
				}
			}
			change_unit_type = tech_ynnic
		}
		else_if = { limit = { capital_scope = { superregion = eordand_superregion } }
			change_unit_type = tech_eordand
		}
		else_if = {
			limit = {
				OR = {
					culture_group = devandi_ruinborn_elf
					culture_group = eltibhari_ruinborn_elf
					capital_scope = { region = chendhya_region }
				}
			}
			change_unit_type = tech_bharbhen
		}
		else_if = { limit = { capital_scope = { superregion = kheionai_superregion } }
			change_unit_type = tech_kheionai
		}
		else_if = { limit = { capital_scope = { superregion = taychend_superregion } }
			change_unit_type = tech_taychendi
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { region = haraf_region }
					capital_scope = { region = tor_nayyi_region }
				}
			}
			change_unit_type = tech_harafic
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = broken_lands_superregion  }
					capital_scope = { superregion = ruin_proper_superregion }
				}
			}
			change_unit_type = tech_noruin
		}
		else_if = {
			limit = {
				OR = {
					capital_scope = { superregion = effelai_superregion }
					capital_scope = { region = amadia_region }
				}
			}
			if = {
				limit = {
					OR = {
						culture_group = eltibhari_ruinborn_elf
						culture_group = devandi_ruinborn_elf
					}
				}
				change_unit_type = tech_bharbhen
			}
			else = {
				change_unit_type = tech_south_aelantiri
			}
		}
		else = {
			change_unit_type = tech_noruin
		}
	}
	else_if = {
        limit = { is_variable_equal = { which = trollRanking value = $ORDER$ } }
        if = {
            limit = {
                OR = {
                    capital_scope = { superregion = east_sarhal_superregion }
                    primary_culture = swamp_troll
                    AND = {
                        accepted_culture = swamp_troll
                        NOT = { culture_group = giantkind }
                    }
                }
            }
            change_unit_type = tech_swamp_troll
        }
        else = {
            change_unit_type = tech_northern_troll    #may need custom one
        }
    }
	else_if = {
        limit = { is_variable_equal = { which = halflingRanking value = $ORDER$ } }
        if = {
            limit = {
                OR = {
                    capital_scope = {
						superregion = tanib_dajek_superregion
					}
					is_vyzemby_primary_culture = yes
                    AND = {
						OR = {
							accepted_culture = amezatany
							accepted_culture = mboala
							accepted_culture = mazava
							accepted_culture = fomarati
							accepted_culture = vyoronsi
							accepted_culture = zohebidi
						}
                        NOT = { is_vyzemby_primary_culture = yes }
                    }
                }
            }
            change_unit_type = tech_vyzemby
        }
        else = {
            change_unit_type = tech_halfling    #may need custom one
        }
    }
	else_if = {
        limit = { is_variable_equal = { which = goblinRanking value = $ORDER$ } }
        if = {
			limit = {
				OR = { #Forest Goblin
					capital_scope = { superregion = deepwoods_superregion }
					primary_culture = forest_goblin
					AND = {
						accepted_culture = forest_goblin
						NOT = { culture_group = goblin }
					}
				}
			}
			change_unit_type = tech_forest_goblin
		}
		else_if = {
			limit = {
				OR = { #Exodus Goblin
					capital_scope = { superregion = bulwar_superregion }
					primary_culture = exodus_goblin
					AND = {
						accepted_culture = exodus_goblin
						NOT = { culture_group = goblin }
					}
				}
			}
			change_unit_type = tech_exodus_goblin
		}
		else_if = {
			limit = {
				OR = { #Cave Goblin
					capital_scope = { continent = serpentspine }
					dwarovar_goblin_culture_primary = yes
					AND = {
						dwarovar_goblin_culture_accepted = yes
						NOT = { culture_group = goblin }
					}
				}
			}
			change_unit_type = tech_cave_goblin
		}
		else = { #Common Goblin (Fallback if all other conditions fail)
			change_unit_type = tech_goblin
		}
	}
	else = {
		change_unit_type = tech_$RACE$
	}
	
}

update_unit_sprites_for_racial_mil = {

	if = {
		limit = { has_country_modifier = human_military }
		
		# rahen
		if = {
			limit = { capital_scope = { superregion = rahen_superregion } }
			custom_tooltip = swap_to_human_raheni_sprites_tooltip
			hidden_effect = { apply_sprite_pack = indiangfx_sprite_pack }
		}
		
		# vimdatrong + yanshen
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = south_haless_superregion
						superregion = yanshen_superregion
					}
				}
			}
			custom_tooltip = swap_to_human_yanshen_sprites_tooltip
			hidden_effect = { apply_sprite_pack = asiangfx_sprite_pack }
		}

		# north haless + forbidden plains		
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = north_haless_superregion
						superregion = forbidden_plains_superregion
					}
				}
			}
			custom_tooltip = swap_to_human_triunic_sprites_tooltip
			hidden_effect = { apply_sprite_pack = triunicgfx_sprite_pack }
		}

		# east sarhal + south sarhal
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = east_sarhal_superregion
						superregion = djinnakah_superregion
						superregion = taneyas_superregion
					}
				}
			}
			custom_tooltip = swap_to_human_east_sarhal_sprites_tooltip
			hidden_effect = { apply_sprite_pack = africangfx_sprite_pack }
		}
		
		# west sarhal + north salahad + south_salahad + bulwar
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = fangaula_superregion
						superregion = north_salahad_superregion
						superregion = south_salahad_superregion
						superregion = bulwar_superregion
					}
				}
			}
			custom_tooltip = swap_to_human_bulwar_sprites_tooltip
			hidden_effect = { apply_sprite_pack = muslimgfx_sprite_pack }
		}
		
		# aelantir colonisers
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						continent = north_america
						continent = south_america
					}
				}
			}
			custom_tooltip = swap_to_human_aelantir_sprites_tooltip
			hidden_effect = { apply_sprite_pack = divenhalgfx_sprite_pack }
		}
		
		# cannor and gerudia (default fallback)
		else = {
			custom_tooltip = swap_to_human_cannorian_sprites_tooltip
			hidden_effect = { apply_sprite_pack = westerngfx_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = elven_military }
		
		# wood elf
		if = {
			limit = { capital_scope = { superregion = deepwoods_superregion } }
			custom_tooltip = swap_to_wood_elven_sprites_tooltip
			hidden_effect = { apply_sprite_pack = moon_elf_sprite_pack }
			#TODO update to different sprite packs when other elf sprite packs are made
		}

		# desert elf
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						region = far_salahad_region
						region = far_bulwar_region
					}
				}
			}
			custom_tooltip = swap_to_desert_elven_sprites_tooltip
			hidden_effect = { apply_sprite_pack = moon_elf_sprite_pack }
			#TODO update to different sprite packs when other elf sprite packs are made
		}
		
		# sun elf (and colonizers)
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = bulwar_superregion
						continent = south_america
					}
				}
			}
			custom_tooltip = swap_to_sun_elven_sprites_tooltip
			hidden_effect = { apply_sprite_pack = moon_elf_sprite_pack }
			#TODO update to different sprite packs when other elf sprite packs are made
		}
		
		# moon elf (default fallback)
		else = {
			custom_tooltip = swap_to_moon_elven_sprites_tooltip
			hidden_effect = { apply_sprite_pack = moon_elf_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = dwarven_military }
		custom_tooltip = swap_to_dwarven_sprites_tooltip
		hidden_effect = { apply_sprite_pack = group_dwarves_sprite_pack }
	}
	
	else_if = {
		limit = { has_country_modifier = halfling_military }
		# TODO update if halflings get unique models
		
		# vzyemby
		if = {
			limit = { capital_scope = { region = fahvanosy_region } }
			custom_tooltip = swap_to_vyzemby_halfling_sprites_tooltip
			hidden_effect = { apply_sprite_pack = africangfx_sprite_pack }
		}
		
		# redfoot (default fallback)
		else = {
			custom_tooltip = swap_to_redfoot_halfling_sprites_tooltip
			hidden_effect = { apply_sprite_pack = redfoot_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = gnomish_military }
		# TODO update if gnomes get unique models
		custom_tooltip = swap_to_gnomish_sprites_tooltip
		hidden_effect = { apply_sprite_pack = westerngfx_sprite_pack }
	}

	else_if = {
		limit = { has_country_modifier = kobold_military }

		# greenscale		
		if = {
			limit = { capital_scope = { region = alenic_frontier_region } }
			custom_tooltip = swap_to_greenscale_kobold_sprites_tooltip
			hidden_effect = { apply_sprite_pack = greenscale_sprite_pack }
		}
		
		# goldscale
		else_if = {
			limit = { capital_scope = { continent = asia } }
			custom_tooltip = swap_to_goldscale_kobold_sprites_tooltip
			hidden_effect = { apply_sprite_pack = goldscale_sprite_pack }
		}

		# redscale (default fallback)
		else = {
			custom_tooltip = swap_to_redscale_kobold_sprites_tooltip
			hidden_effect = { apply_sprite_pack = redscale_sprite_pack }
		}
	}

	else_if = { 
		limit = { has_country_modifier = orcish_military }
		# these are reskinned DLC skins, so if you swap to orcish without having the DLC, nothing happens	
	
		# gray orc
		if = {
			limit = { capital_scope = { superregion = gerudia_superregion } }
			custom_tooltip = swap_to_gray_orcish_sprites_tooltip
			hidden_effect = { apply_sprite_pack = gray_orc_sprite_pack }
		}
		
		# black orc
		else_if = {
			limit = { capital_scope = { continent = serpentspine } }
			custom_tooltip = swap_to_black_orcish_sprites_tooltip
			hidden_effect = { apply_sprite_pack = black_orc_sprite_pack }
		}
		
		# brown orc
		else_if = {
			limit = { capital_scope = { continent = asia } }
			custom_tooltip = swap_to_brown_orcish_sprites_tooltip
			hidden_effect = { apply_sprite_pack = brown_orc_sprite_pack }
		}
		
		# green orc (default fallback)	
		else = {
			custom_tooltip = swap_to_green_orcish_sprites_tooltip
			hidden_effect = { apply_sprite_pack = green_orc_sprite_pack }
		}
	}

	else_if = { 
		limit = { has_country_modifier = half_orcish_military }
		# TODO update if half orcs get unique models

		# rahen (command slave states)		
		if = {
			limit = { capital_scope = { continent = asia } }
			custom_tooltip = swap_to_raheni_half_orcish_sprites_tooltip
			hidden_effect = { apply_sprite_pack = indiangfx_sprite_pack }
		}

		# cannor (default fallback)
		else = {
			custom_tooltip = swap_to_cannorian_half_orcish_sprites_tooltip
			hidden_effect = { apply_sprite_pack = westerngfx_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = gnollish_military }
		custom_tooltip = swap_to_gnollish_sprites_tooltip
		hidden_effect = { apply_sprite_pack = gnoll_sprite_pack }
	}

	else_if = {
		limit = { has_country_modifier = ruinborn_military }
		
		# kheionai
		if = {
			limit = { capital_scope = { superregion = kheionai_superregion } }
			custom_tooltip = swap_to_kheionai_ruinborn_sprites_tooltip
			hidden_effect = { apply_sprite_pack = kheionai_cool_units_sprite_pack }
		}
		
		# eordand and taychend
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = eordand_superregion
						superregion = taychend_superregion
					}
				}
			}
			custom_tooltip = swap_to_eordand_ruinborn_sprites_tooltip
			hidden_effect = { apply_sprite_pack = southamericagfx_sprite_pack }
		}
		
		# effelai, ruin proper and torn gates
		else_if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = effelai_superregion
						superregion = ruin_proper_superregion
						superregion = torn_gates_superregion
					}
				}
			}
			custom_tooltip = swap_to_effelai_ruinborn_sprites_tooltip
			hidden_effect = { apply_sprite_pack = northamericagfx_sprite_pack }
		}
		
		# ynnic (default fallback)
		else = {
			custom_tooltip = swap_to_ynnic_ruinborn_sprites_tooltip
			hidden_effect = { apply_sprite_pack = easterngfx_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = goblin_military }
		
		# exodus goblin
		if = {
			limit = { capital_scope = { superregion = bulwar_superregion } }
			custom_tooltip = swap_to_exodus_goblin_sprites_tooltip
			hidden_effect = { apply_sprite_pack = exodus_goblin_sprite_pack }
		}
		
		# forest goblin
		else_if = {
			limit = { capital_scope = { superregion = deepwoods_superregion } }
			custom_tooltip = swap_to_forest_goblin_ruinborn_sprites_tooltip
			hidden_effect = { apply_sprite_pack = forest_goblin_sprite_pack }
		}
		
		# cave goblin
		else_if = {
			limit = { capital_scope = { continent = serpentspine } }
			custom_tooltip = swap_to_cave_goblin_sprites_tooltip
			hidden_effect = { apply_sprite_pack = cave_goblin_sprite_pack }
		}
		
		# common goblin (default fallback)
		else = {
			custom_tooltip = swap_to_common_goblin_sprites_tooltip
			hidden_effect = { apply_sprite_pack = common_goblin_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = harpy_military }
		custom_tooltip = swap_to_harpy_sprites_tooltip
		hidden_effect = { apply_sprite_pack = harpy_sprite_pack }
	}

	else_if = {
		limit = { has_country_modifier = troll_military }
		# TODO update if trolls get unique models
		
		# swamp trolls
		if = {
			limit = { capital_scope = { region = yezel_mora_region } }
			custom_tooltip = swap_to_swamp_troll_sprites_tooltip
			hidden_effect = { apply_sprite_pack = africangfx_sprite_pack }
		}
		
		# gerudian trolls (default fallback)
		else = {
			custom_tooltip = swap_to_gerudian_troll_sprites_tooltip
			hidden_effect = { apply_sprite_pack = westerngfx_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = half_elven_military }
		# TODO update if half elves get unique models
		
		# bulwar + far salahad
		if = {
			limit = {
				capital_scope = {
					OR = {
						superregion = bulwar_superregion
						superregion = far_salahad_superregion
					}
				}
			}
			custom_tooltip = swap_to_bulwari_half_elven_sprites_tooltip
			hidden_effect = { apply_sprite_pack = muslimgfx_sprite_pack }
		}
		
		# cannor (default fallback)
		else = {
			custom_tooltip = swap_to_cannorian_half_elven_sprites_tooltip
			hidden_effect = { apply_sprite_pack = westerngfx_sprite_pack }
		}
	}

	else_if = {
		limit = { has_country_modifier = harimari_military }
		custom_tooltip = swap_to_harimari_sprites_tooltip
		hidden_effect = { apply_sprite_pack = harimari_sprite_pack }
	}
    
	else_if = {
		limit = { has_country_modifier = hobgoblin_military }
		custom_tooltip = swap_to_hobgoblin_sprites_tooltip
		hidden_effect = { apply_sprite_pack = hobgoblin_sprite_pack }
	}
    
	else_if = {
		limit = { has_country_modifier = centaur_military }
		custom_tooltip = swap_to_centaur_sprites_tooltip
		hidden_effect = { apply_sprite_pack = centaur_sprite_pack }
	}
    
	else_if = {
		limit = { has_country_modifier = ogre_military }
		# TODO update if ogres get unique models
		
		# oni
		if = {
			limit = { capital_scope = { region = demon_hills_region } }
			custom_tooltip = swap_to_oni_sprites_tooltip
			hidden_effect = { apply_sprite_pack = asiangfx_sprite_pack }
		}
		
		# forbidden plains/miremaw ogres (default fallback)
		else = {
			custom_tooltip = swap_to_ogre_sprites_tooltip
			hidden_effect = { apply_sprite_pack = westerngfx_sprite_pack }
		}
	}
    
	else_if = {
		limit = { has_country_modifier = lizardfolk_military }
		# TODO update if lizardfolk get unique models
		custom_tooltip = swap_to_lizardfolk_sprites_tooltip
		hidden_effect = { apply_sprite_pack = muslimgfx_sprite_pack }
	}

	else_if = {
		limit = { has_country_modifier = mechanim_military }
		# TODO update if mechanim get unique models
		custom_tooltip = swap_to_mechanim_sprites_tooltip
		hidden_effect = { apply_sprite_pack = asiangfx_sprite_pack }
	}
}

grant_unlimited_state_action = {
	custom_tooltip = $action$_free_tt
	set_country_flag = unlimited_$action$
	while = {
		limit = {
			NOT = { check_variable = { which = remaining_free_$action$ value = 1 } }
		}
		generic_decrease_state_action_malus = { action = $action$ }
	}
}
increase_free_state_action = {
	custom_tooltip = increase_free_$action$_tt
	hidden_effect = { generic_decrease_state_action_malus = { action = $action$ } }
}
generic_increase_state_action_malus = { #this can be called to take away free state actions
	if = {
		limit = { has_country_flag = unlimited_$action$ }
		custom_tooltip = $action$_free_tt
	}
	else_if = {
		limit = { check_variable = { which = remaining_free_$action$ value = 1 } }
		custom_tooltip = $action$_below_limit_tt
	}
	else = {
		custom_tooltip = $action$_limit_tt
	}
	hidden_effect = { change_variable = { which = remaining_free_$action$ value = -1 } } #starts at 1 for all nations by default
	if = {
		limit = {
			OR = {
				AND = {
					check_variable = { which = remaining_free_$action$ value = 0 }
					NOT = { check_variable = { which = remaining_free_$action$ value = 1 } }
					ai = no
				}
				AND = { #ai are a little dumb and need the extra buffer
					check_variable = { which = remaining_free_$action$ value = -1 }
					NOT = { check_variable = { which = remaining_free_$action$ value = 0 } }
					ai = yes
				}
			}
		}
		hidden_effect = { add_country_modifier = { name = $action$_diplomats_0 duration = -1 hidden = yes } }
	}
	else = {
		trigger_switch = {
			on_trigger = has_country_modifier
			$action$_diplomats_0 = { remove_country_modifier = $action$_diplomats_0 add_country_modifier = { name = $action$_diplomats_1 duration = -1 desc = while_policy_active } }
			$action$_diplomats_1 = { remove_country_modifier = $action$_diplomats_1 add_country_modifier = { name = $action$_diplomats_2 duration = -1 desc = while_policy_active } }
			$action$_diplomats_2 = { remove_country_modifier = $action$_diplomats_2 add_country_modifier = { name = $action$_diplomats_3 duration = -1 desc = while_policy_active } }
			$action$_diplomats_3 = { remove_country_modifier = $action$_diplomats_3 add_country_modifier = { name = $action$_diplomats_4 duration = -1 desc = while_policy_active } }
			$action$_diplomats_4 = { remove_country_modifier = $action$_diplomats_4 add_country_modifier = { name = $action$_diplomats_5 duration = -1 desc = while_policy_active } }
			$action$_diplomats_5 = { remove_country_modifier = $action$_diplomats_5 add_country_modifier = { name = $action$_diplomats_6 duration = -1 desc = while_policy_active } }
			$action$_diplomats_6 = { remove_country_modifier = $action$_diplomats_6 add_country_modifier = { name = $action$_diplomats_7 duration = -1 desc = while_policy_active } }
			$action$_diplomats_7 = { remove_country_modifier = $action$_diplomats_7 add_country_modifier = { name = $action$_diplomats_8 duration = -1 desc = while_policy_active } }
			$action$_diplomats_8 = { remove_country_modifier = $action$_diplomats_8 add_country_modifier = { name = $action$_diplomats_9 duration = -1 desc = while_policy_active } }
			$action$_diplomats_9 = { remove_country_modifier = $action$_diplomats_9 add_country_modifier = { name = $action$_diplomats_10 duration = -1 desc = while_policy_active } }
		}
	}
}
generic_decrease_state_action_malus = { #this can be called to give free state actions: gives the player more buffer before maluses hit
	if = {
		limit = { has_country_flag = unlimited_$action$ }
		custom_tooltip = $action$_free_tt
	}
	else_if = {
		limit = { check_variable = { which = remaining_free_$action$ value = 0 } }
		custom_tooltip = $action$_below_limit_tt
	}
	else = {
		custom_tooltip = $action$_limit_tt
	}
	hidden_effect = { change_variable = { which = remaining_free_$action$ value = 1 } }
	trigger_switch = {
		on_trigger = has_country_modifier
		$action$_diplomats_0 = { remove_country_modifier = $action$_diplomats_0 }
		$action$_diplomats_1 = { remove_country_modifier = $action$_diplomats_1 add_country_modifier = { name = $action$_diplomats_0 duration = -1 desc = while_policy_active } }
		$action$_diplomats_2 = { remove_country_modifier = $action$_diplomats_2 add_country_modifier = { name = $action$_diplomats_1 duration = -1 desc = while_policy_active } }
		$action$_diplomats_3 = { remove_country_modifier = $action$_diplomats_3 add_country_modifier = { name = $action$_diplomats_2 duration = -1 desc = while_policy_active } }
		$action$_diplomats_4 = { remove_country_modifier = $action$_diplomats_4 add_country_modifier = { name = $action$_diplomats_3 duration = -1 desc = while_policy_active } }
		$action$_diplomats_5 = { remove_country_modifier = $action$_diplomats_5 add_country_modifier = { name = $action$_diplomats_4 duration = -1 desc = while_policy_active } }
		$action$_diplomats_6 = { remove_country_modifier = $action$_diplomats_6 add_country_modifier = { name = $action$_diplomats_5 duration = -1 desc = while_policy_active } }
		$action$_diplomats_7 = { remove_country_modifier = $action$_diplomats_7 add_country_modifier = { name = $action$_diplomats_6 duration = -1 desc = while_policy_active } }
		$action$_diplomats_8 = { remove_country_modifier = $action$_diplomats_8 add_country_modifier = { name = $action$_diplomats_7 duration = -1 desc = while_policy_active } }
		$action$_diplomats_9 = { remove_country_modifier = $action$_diplomats_9 add_country_modifier = { name = $action$_diplomats_8 duration = -1 desc = while_policy_active } }
		$action$_diplomats_10 = { remove_country_modifier = $action$_diplomats_10 add_country_modifier = { name = $action$_diplomats_9 duration = -1 desc = while_policy_active } }
	}
}
generic_start_purge = {
	[[free]
		custom_tooltip = racial_policy_free
		set_country_flag = free_$race$_purge
		if = {
			limit = { has_country_modifier = racial_pop_$race$_purge }
			hidden_effect = { generic_decrease_state_action_malus = { action = genocide } }
		}
	]
	if = {
		limit = { NOT = { has_country_modifier = racial_pop_$race$_purge } }
		if = {
			limit = { NOT = { has_country_flag = free_$race$_purge } }
			generic_increase_state_action_malus = { action = genocide }
		}
		add_country_modifier = {
			name = racial_pop_$race$_purge
			duration = -1
			desc = while_policy_active
		}
		generic_decrease_of_racial_tolerance_effect = { race = $race$ largest = yes }
		custom_tooltip = racial_pop_events_debug.3.tooltip
		custom_tooltip = pop_menu_purge_effect_unrest_tt
		hidden_effect = {
			if = {
				limit = { ai = yes }
				country_event = { id = racial_pop_events_$race$.14 days = 1 }
			}
			if = {
				limit = { ai = no }
				country_event = { id = race_setup_events.9 days = 1 }
			}
			every_owned_province = {
				limit = { has_small_$race$_minority_trigger = yes }
				add_unrest = 5
			}
			every_owned_province = {
				limit = { has_large_$race$_minority_trigger = yes }
				add_unrest = 7
			}
			every_owned_province = {
				limit = { has_$race$_majority_trigger = yes }
				add_unrest = 15
			}
		}
	}
}
generic_start_expulsion = {
	[[free]
		custom_tooltip = racial_policy_free
		set_country_flag = free_$race$_expulsion
		if = {
			limit = { has_country_modifier = racial_pop_$race$_expulsion }
			hidden_effect = { generic_decrease_state_action_malus = { action = genocide } }
		}
	]
	if = {
		limit = { NOT = { has_country_modifier = racial_pop_$race$_expulsion } }
		if = {
			limit = { NOT = { has_country_flag = free_$race$_expulsion } }
			generic_increase_state_action_malus = { action = genocide }
		}
		add_country_modifier = {
			name = racial_pop_$race$_expulsion
			duration = -1
			desc = while_policy_active
		}
		generic_decrease_of_racial_tolerance_effect = { race = $race$ large = yes }
		custom_tooltip = racial_pop_events_debug.2.tooltip
		custom_tooltip = pop_menu_expel_effect_unrest_tt
		hidden_effect = {
			if = {
				limit = { ai = yes }
				country_event = { id = racial_pop_events_$race$.13 days = 1 }
			}
			if = {
				limit = { ai = no }
				country_event = { id = race_setup_events.9 days = 1 }
			}
			every_owned_province = {
				limit = { has_small_$race$_minority_trigger = yes }
				add_unrest = 2
			}
			every_owned_province = {
				limit = { has_large_$race$_minority_trigger = yes }
				add_unrest = 5
			}
			every_owned_province = {
				limit = { has_$race$_majority_trigger = yes }
				add_unrest = 10
			}
		}
	}
}
generic_start_focus = {
	if = {
		limit = { NOT = { has_country_modifier = racial_focus_$race$ } }
		generic_increase_state_action_malus = { action = focus }
		add_country_modifier = {
			name = racial_focus_$race$
			duration = -1
			desc = while_policy_active
		}
	}
}
generic_end_purge = {
	if = {
		limit = { has_country_modifier = racial_pop_$race$_purge }
		generic_decrease_state_action_malus = { action = genocide }
		remove_country_modifier = racial_pop_$race$_purge
		hidden_effect = {
			if = {
				limit = { ai = yes }
				country_event = { id = racial_pop_events_$race$.16 days = 1 }
			}
			if = {
				limit = { ai = no }
				country_event = { id = race_setup_events.9 days = 1 }
			}
		}
	}
}
generic_end_expulsion = {
	if = {
		limit = { has_country_modifier = racial_pop_$race$_expulsion }
		generic_decrease_state_action_malus = { action = genocide }
		remove_country_modifier = racial_pop_$race$_expulsion
		hidden_effect = {
			if = {
				limit = { ai = yes }
				country_event = { id = racial_pop_events_$race$.15 days = 1 }
			}
			if = {
				limit = { ai = no }
				country_event = { id = race_setup_events.9 days = 1 }
			}
		}
	}
}
generic_end_focus = {
	if = {
		limit = { has_country_modifier = racial_focus_$race$ }
		generic_decrease_state_action_malus = { action = focus }
		remove_country_modifier = racial_focus_$race$
	}
}


generic_purge_expel_opinion_setup = {

	if = {
		limit = {
			ROOT = { has_country_modifier = racial_pop_$race$_expulsion }
			has_country_modifier = $race$_administration
			NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_expelling_race } }
		}
		add_opinion = { who = ROOT modifier = opinion_expelling_race }
		remove_opinion = { who = ROOT modifier = opinion_persecuted_race }
	}
	if = {
		limit = {
			has_opinion_modifier = { who = ROOT modifier = opinion_expelling_race }
			has_country_modifier = $race$_administration
			ROOT = { NOT = { has_country_modifier = racial_pop_$race$_expulsion } }
		}
		remove_opinion = { who = ROOT modifier = opinion_expelling_race }
		add_opinion = { who = ROOT modifier = opinion_persecuted_race }
	}
	# NOTE: this was originally an if-else, but the add_opinion for opinion_persecuted_race failed when done like this (bruh)

	if = {
		limit = {
			ROOT = { has_country_modifier = racial_pop_$race$_purge }
			has_country_modifier = $race$_administration
			NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_purging_race } }
		}
		add_opinion = { who = ROOT modifier = opinion_purging_race }
		remove_opinion = { who = ROOT modifier = opinion_persecuted_race }
	}
	if = {
		limit = {
			has_opinion_modifier = { who = ROOT modifier = opinion_purging_race }
			has_country_modifier = $race$_administration
			ROOT = { NOT = { has_country_modifier = racial_pop_$race$_purge } }
		}
		remove_opinion = { who = ROOT modifier = opinion_purging_race }
		add_opinion = { who = ROOT modifier = opinion_persecuted_race }
	}
	# NOTE: this was originally an if-else, but the add_opinion for opinion_persecuted_race failed when done like this (bruh)

}

# for newly spawned nations - no point doing the persecuted check here because
# with how it currently works a newly spawned nation would never have one of the two modifiers, so would never get persecuted
generic_purge_expel_opinion_setup_reverse = {

	reverse_remove_opinion = { who = ROOT modifier = opinion_purging_race }
	reverse_remove_opinion = { who = ROOT modifier = opinion_expelling_race }
	if = {
		limit = {
			ROOT = { has_country_modifier = $race$_administration }
		}

		if = {
			limit = { has_country_modifier = racial_pop_$race$_expulsion }
			reverse_add_opinion = { who = ROOT modifier = opinion_expelling_race }
		}

		if = {
			limit = { has_country_modifier = racial_pop_$race$_purge }
			reverse_add_opinion = { who = ROOT modifier = opinion_purging_race }
		}
	}
}

racial_purge_disabled_tt =  {
    custom_tooltip = pop_menu_unavailable_tt
    if = { limit = { has_country_modifier = forced_to_end_$RACE$_purge }
		custom_tooltip = pop_menu_cannot_purge_forced_tt
    }
    if = { limit = { has_country_modifier = racial_pop_$RACE$_expulsion }
		custom_tooltip = pop_menu_cannot_purge_while_expelling_tt
    }
    if = { limit = { has_country_modifier = $RACE$_administration }
		custom_tooltip = pop_menu_cannot_purge_own_race_tt
    }
    if = { limit = { has_country_modifier = $RACE$_military }
		custom_tooltip = pop_menu_cannot_purge_military_race_tt
    }
    if = { limit = { ruler_is_$RACE$ = yes }
		custom_tooltip = pop_menu_cannot_purge_ruler_race_tt
    }
	if = {
		limit = {
			has_country_flag = has_caste_estates
			is_race_in_any_caste = { race = $RACE$ }
		}
		custom_tooltip = pop_menu_cannot_purge_castes_tt
	}
	if = { limit = { NOT = { can_afford_state_action_diplomat_malus = { action = genocide } } }
		custom_tooltip = pop_menu_need_a_diplomat_tt
	}
    if = { limit = { NOT = { adm_power = 100 } }
		custom_tooltip = pop_menu_cannot_purge_not_enough_adm_tt
    }
	if = { limit = { OR = { has_government_attribute = disabled_purging has_government_attribute = disabled_purging_$RACE$ } }
		custom_tooltip = pop_menu_cannot_purge_government_attribute_tt
	}
    hidden_effect = {
		country_event = { id = racial_pop_events_$RACE$.24 }
    }
}

racial_expel_disabled_tt = {
	custom_tooltip = pop_menu_unavailable_tt
	if = { limit = { has_country_modifier = racial_pop_$RACE$_purge }
		custom_tooltip = pop_menu_cannot_expel_while_purging_tt
	}
	if = { limit = { has_country_modifier = $RACE$_administration }
		custom_tooltip = pop_menu_cannot_expel_own_race_tt
	}
	if = { limit = { has_country_modifier = $RACE$_military }
		custom_tooltip = pop_menu_cannot_expel_military_race_tt
	}
	if = { limit = { ruler_is_$RACE$ = yes }
		custom_tooltip = pop_menu_cannot_expel_ruler_race_tt
	}
	if = {
		limit = {
			has_country_flag = has_caste_estates
			is_race_in_any_caste = { race = $RACE$ }
		}
		custom_tooltip = pop_menu_cannot_purge_castes_tt
	}
	if = { limit = { NOT = { can_afford_state_action_diplomat_malus = { action = genocide } } }
		custom_tooltip = pop_menu_need_a_diplomat_tt
	}
	if = { limit = { NOT = { adm_power = 50 } }
		custom_tooltip = pop_menu_cannot_expel_not_enough_adm_tt
	}
	if = { limit = { OR = { has_government_attribute = disabled_expelling has_government_attribute = disabled_expelling_$RACE$ } }
		custom_tooltip = pop_menu_cannot_expel_government_attribute_tt
	}
	hidden_effect = {
		country_event = { id = racial_pop_events_$RACE$.24 }
    }
}

racial_focus_disabled_tt = {
	custom_tooltip = pop_menu_unavailable_tt
	if = { limit = { NOT = { can_afford_state_action_diplomat_malus = { action = focus } } }
		custom_tooltip = pop_menu_need_a_diplomat_tt
	}
	if = { limit = { NOT = { dip_power = 50 } }
		custom_tooltip = pop_menu_cannot_focus_not_enough_dip_tt
	}
}

remove_all_racial_majority = {
	remove_racial_majority = { race = centaur }
	remove_racial_majority = { race = dwarven }
	remove_racial_majority = { race = elven }
	remove_racial_majority = { race = gnollish }
	remove_racial_majority = { race = gnomish }
	remove_racial_majority = { race = goblin }
	remove_racial_majority = { race = halfling }
	remove_racial_majority = { race = half_elven }
	remove_racial_majority = { race = half_orcish }
	remove_racial_majority = { race = harimari }
	remove_racial_majority = { race = harpy }
	remove_racial_majority = { race = hobgoblin }
	remove_racial_majority = { race = human }
	remove_racial_majority = { race = kobold }
	remove_racial_majority = { race = lizardfolk }
	remove_racial_majority = { race = mechanim }
	remove_racial_majority = { race = ogre }
	remove_racial_majority = { race = orcish }
	remove_racial_majority = { race = ruinborn }
	remove_racial_majority = { race = troll }
}

update_ruler_racial_flag = {
	if = {
		limit = {
			ruler_is_half_elven = yes
		}
		set_ruler_flag = half_elven_ruler
	}
	else_if = {
		limit = {
			ruler_is_elven = yes
		}
		set_ruler_flag = elven_ruler
	}
	else_if = {
		limit = {
			ruler_is_dwarven = yes
		}
		set_ruler_flag = dwarven_ruler
	}
	else_if = {
		limit = {
			ruler_is_gnomish = yes
		}
		set_ruler_flag = gnomish_ruler
	}
	else_if = {
		limit = {
			ruler_is_human = yes
		}
		set_ruler_flag = human_ruler
	}
	else_if = {
		limit = {
			ruler_is_half_orcish = yes
		}
		set_ruler_flag = half_orcish_ruler
	}
	else_if = {
		limit = {
			ruler_is_orcish = yes
		}
		set_ruler_flag = orcish_ruler
	}
	else_if = {
		limit = {
			ruler_is_goblin = yes
		}
		set_ruler_flag = goblin_ruler
	}
	else_if = {
		limit = {
			ruler_is_gnollish = yes
		}
		set_ruler_flag = gnollish_ruler
	}
	else_if = {
		limit = {
			ruler_is_kobold = yes
		}
		set_ruler_flag = kobold_ruler
	}
	else_if = {
		limit = {
			ruler_is_lizardfolk = yes
		}
		set_ruler_flag = lizardfolk_ruler
	}
	else_if = {
		limit = {
			ruler_is_mechanim = yes
		}
		set_ruler_flag = mechanim_ruler
	}
	else_if = {
		limit = {
			ruler_is_halfling = yes
		}
		set_ruler_flag = halfling_ruler
	}
	else_if = {
		limit = {
			ruler_is_harimari = yes
		}
		set_ruler_flag = harimari_ruler
	}
	else_if = {
		limit = {
			ruler_is_hobgoblin = yes
		}
		set_ruler_flag = hobgoblin_ruler
	}
	else_if = {
		limit = {
			ruler_is_troll = yes
		}
		set_ruler_flag = troll_ruler
	}
	else_if = {
		limit = {
			ruler_is_ogre = yes
		}
		set_ruler_flag = ogre_ruler
	}
	else_if = {
		limit = {
			ruler_is_harpy = yes
		}
		set_ruler_flag = harpy_ruler
	}
	else_if = {
		limit = {
			ruler_is_centaur = yes
		}
		set_ruler_flag = centaur_ruler
	}
	else_if = {
		limit = {
			ruler_is_ruinborn = yes
		}
		set_ruler_flag = ruinborn_ruler
	}
}

update_heir_racial_flag = {
	if = {
		limit = {
			heir_is_half_elven = yes
		}
		set_heir_flag = half_elven_heir
	}
	else_if = {
		limit = {
			heir_is_elven = yes
		}
		set_heir_flag = elven_heir
	}
	else_if = {
		limit = {
			heir_is_dwarven = yes
		}
		set_heir_flag = dwarven_heir
	}
	else_if = {
		limit = {
			heir_is_gnomish = yes
		}
		set_heir_flag = gnomish_heir
	}
	else_if = {
		limit = {
			heir_is_human = yes
		}
		set_heir_flag = human_heir
	}
	else_if = {
		limit = {
			heir_is_half_orcish = yes
		}
		set_heir_flag = half_orcish_heir
	}
	else_if = {
		limit = {
			heir_is_orcish = yes
		}
		set_heir_flag = orcish_heir
	}
	else_if = {
		limit = {
			heir_is_goblin = yes
		}
		set_heir_flag = goblin_heir
	}
	else_if = {
		limit = {
			heir_is_gnollish = yes
		}
		set_heir_flag = gnollish_heir
	}
	else_if = {
		limit = {
			heir_is_kobold = yes
		}
		set_heir_flag = kobold_heir
	}
	else_if = {
		limit = {
			heir_is_lizardfolk = yes
		}
		set_heir_flag = lizardfolk_heir
	}
	else_if = {
		limit = {
			heir_is_mechanim = yes
		}
		set_heir_flag = mechanim_heir
	}
	else_if = {
		limit = {
			heir_is_halfling = yes
		}
		set_heir_flag = halfling_heir
	}
	else_if = {
		limit = {
			heir_is_harimari = yes
		}
		set_heir_flag = harimari_heir
	}
	else_if = {
		limit = {
			heir_is_hobgoblin = yes
		}
		set_heir_flag = hobgoblin_heir
	}
	else_if = {
		limit = {
			heir_is_troll = yes
		}
		set_heir_flag = troll_heir
	}
	else_if = {
		limit = {
			heir_is_ogre = yes
		}
		set_heir_flag = ogre_heir
	}
	else_if = {
		limit = {
			heir_is_harpy = yes
		}
		set_heir_flag = harpy_heir
	}
	else_if = {
		limit = {
			heir_is_centaur = yes
		}
		set_heir_flag = centaur_heir
	}
	else_if = {
		limit = {
			heir_is_ruinborn = yes
		}
		set_heir_flag = ruinborn_heir
	}
}

update_consort_racial_flag = {
	if = {
		limit = {
			consort_is_half_elven = yes
		}
		set_consort_flag = half_elven_consort
	}
	else_if = {
		limit = {
			consort_is_elven = yes
		}
		set_consort_flag = elven_consort
	}
	else_if = {
		limit = {
			consort_is_dwarven = yes
		}
		set_consort_flag = dwarven_consort
	}
	else_if = {
		limit = {
			consort_is_gnomish = yes
		}
		set_consort_flag = gnomish_consort
	}
	else_if = {
		limit = {
			consort_is_human = yes
		}
		set_consort_flag = human_consort
	}
	else_if = {
		limit = {
			consort_is_half_orcish = yes
		}
		set_consort_flag = half_orcish_consort
	}
	else_if = {
		limit = {
			consort_is_orcish = yes
		}
		set_consort_flag = orcish_consort
	}
	else_if = {
		limit = {
			consort_is_goblin = yes
		}
		set_consort_flag = goblin_consort
	}
	else_if = {
		limit = {
			consort_is_gnollish = yes
		}
		set_consort_flag = gnollish_consort
	}
	else_if = {
		limit = {
			consort_is_kobold = yes
		}
		set_consort_flag = kobold_consort
	}
	else_if = {
		limit = {
			consort_is_lizardfolk = yes
		}
		set_consort_flag = lizardfolk_consort
	}
	else_if = {
		limit = {
			consort_is_mechanim = yes
		}
		set_consort_flag = mechanim_consort
	}
	else_if = {
		limit = {
			consort_is_halfling = yes
		}
		set_consort_flag = halfling_consort
	}
	else_if = {
		limit = {
			consort_is_harimari = yes
		}
		set_consort_flag = harimari_consort
	}
	else_if = {
		limit = {
			consort_is_hobgoblin = yes
		}
		set_consort_flag = hobgoblin_consort
	}
	else_if = {
		limit = {
			consort_is_troll = yes
		}
		set_consort_flag = troll_consort
	}
	else_if = {
		limit = {
			consort_is_ogre = yes
		}
		set_consort_flag = ogre_consort
	}
	else_if = {
		limit = {
			consort_is_harpy = yes
		}
		set_consort_flag = harpy_consort
	}
	else_if = {
		limit = {
			consort_is_centaur = yes
		}
		set_consort_flag = centaur_consort
	}
	else_if = {
		limit = {
			consort_is_ruinborn = yes
		}
		set_consort_flag = ruinborn_consort
	}
}
racial_pop_migration_random_leave = {
	if = {
		limit = { ai = no }
		custom_tooltip = racial_pop_migration_random_leave_tt
	}
	hidden_effect = {
		random_list = {
			1 = { event_target:origin_province = { racial_pop_migration_leave = { race = $race$ } } }
			1 = {}
		}
	}
}
racial_pop_migration_leave = {
	if = {
		limit = { has_$race$_majority_trigger = yes }
		add_province_modifier = {
			name = $race$_migration_cooldown
			duration = 9125
			hidden = yes
		}
		random_list = {
			3 = {}
			1 = { add_base_tax = -1 }
			1 = { add_base_production = -1 }
			1 = { add_base_manpower = -1 }
		}
	}
	else = {
		generic_remove_race_minority_size_effect = { race = $race$ }
	}
}
racial_pop_migration_arrive = {
	if = {
		limit = {
			has_$race$_majority_trigger = no
			has_large_$race$_minority_trigger = no
		}
		generic_add_race_minority_size_effect = { race = $race$ }
	}
	else = {
		random_list = {
			3 = {
				trigger = { owner = { ai = yes } }
			}
			1 = { add_base_tax = 1 }
			1 = { add_base_production = 1 }
			1 = { add_base_manpower = 1 }
		}
	}
	add_local_autonomy = 10
}
choose_pop_destination_province = {
	random_list = {
		1 = {
			trigger = {
				any_owned_province = {
					preferred_terrain = { $race$ = yes }
					has_any_blorc_camp = no
				}
			}
			random_owned_province = {
				limit = { preferred_terrain = { $race$ = yes } has_any_blorc_camp = no }
				save_event_target_as = destination_province
			}
		}
		1 = {
			trigger = {
				any_owned_province = {
					development = 20
					has_any_blorc_camp = no
				}
			}
			random_owned_province = {
				limit = { development = 20 has_any_blorc_camp = no }
				save_event_target_as = destination_province
			}
		}
		1 = {
			trigger = {
				any_owned_province = {
					NOT = { fast_has_pop_of_race = { race = $race$ } }
				}
			}
			random_owned_province = {
				limit = { NOT = { fast_has_pop_of_race = { race = $race$ } } }
				save_event_target_as = destination_province
			}
		}
		1 = {
			modifier = {
				factor = 3
				fast_owns_num_pops_of_race = { race = $race$ amount = 20 }
			}
			random_owned_province = {
				limit = { has_any_blorc_camp = no }
				save_event_target_as = destination_province
			}
		}
	}
}
choose_pop_internal_destination_province = {
	random_list = {
		6 = {
			random_owned_province = {
				limit = { NOT = { province_id = event_target:origin_province } has_any_blorc_camp = no }
				save_event_target_as = destination_province
			}
		}
		1 = {
			trigger = {
				any_owned_province = {
					preferred_terrain = { $race$ = yes }
					NOT = { province_id = event_target:origin_province }
					has_any_blorc_camp = no
				}
			}
			random_owned_province = {
				limit = { preferred_terrain = { $race$ = yes } NOT = { province_id = event_target:origin_province } has_any_blorc_camp = no }
				save_event_target_as = destination_province
			}
		}
		1 = {
			trigger = {
				any_owned_province = {
					development = 20
					NOT = { province_id = event_target:origin_province }
					has_any_blorc_camp = no
				}
			}
			random_owned_province = {
				limit = { development = 20 NOT = { province_id = event_target:origin_province } has_any_blorc_camp = no }
				save_event_target_as = destination_province
			}
		}
		1 = {
			trigger = {
				any_owned_province = {
					NOT = { fast_has_pop_of_race = { race = $race$ } }
				}
			}
			random_owned_province = {
				limit = { NOT = { fast_has_pop_of_race = { race = $race$ } province_id = event_target:origin_province } }
				save_event_target_as = destination_province
			}
		}
	}
}
choose_pop_origin_province = { #for use inside of a country scope, while ROOT refers back to another country (probably the player)
	if = {
		limit = {
			OR = {
				has_country_modifier = racial_pop_$race$_purge
				has_country_modifier = racial_pop_$race$_expulsion
				AND = {
					low_tolerance_$race$_race_trigger = yes
					ROOT = { 
						OR = {
							low_tolerance_$race$_race_trigger = no
							has_country_modifier = racial_focus_$race$
						}
					}
				}
			}
		}
		random_owned_province = {
			limit = {
				fast_has_pop_of_race = { race = $race$ }
				NOT = { has_province_modifier = $race$_migration_cooldown}
			}
			save_event_target_as = origin_province
		}
	}
	else = {
		random_owned_province = {
			limit = {
				fast_has_pop_of_race = { race = $race$ }
				NOT = { has_province_modifier = $race$_migration_cooldown }
				OR = {
					devastation = 25
					unrest = 10
					NOT = { development = 10 owner = { fast_owns_num_pops_of_race = { race = $race$ amount = 20 } } }
					AND = {
						ROOT = {
							has_country_modifier = racial_focus_$race$
						}
						NOT = { preferred_terrain = { $race$ = yes } }
					}
				}
			}
			save_event_target_as = origin_province
		}
	}
}
choose_pop_internal_origin_province = {
	random_owned_province = {
		limit = {
			has_$race$_minority_trigger = yes
			OR = {
				devastation = 25
				unrest = 10
				NOT = { development = 10 owner = { fast_owns_num_pops_of_race = { race = $race$ amount = 20 } } }
				NOT = { preferred_terrain = { $race$ = yes } }
			}
		}
		save_event_target_as = origin_province
	}
}
ai_pop_migration_arrive = { #for use inside a country scope
	random_list = {
		6 = {
			random_owned_province = {
				racial_pop_migration_arrive = { race = $race$ }
			}
		}
		1 = {
			trigger = { any_owned_province = { preferred_terrain = { $race$ = yes } } }
			random_owned_province = {
				limit = { preferred_terrain = { $race$ = yes } }
				racial_pop_migration_arrive = { race = $race$ }
			}
		}
		1 = {
			trigger = { any_owned_province = { development = 20 } }
			random_owned_province = {
				limit = { development = 20 }
				racial_pop_migration_arrive = { race = $race$ }
			}
		}
		1 = {
			trigger = { any_owned_province = { NOT = { fast_has_pop_of_race = { race = $race$ } } } }
			random_owned_province = {
				limit = { NOT = { fast_has_pop_of_race = { race = $race$ } } }
				racial_pop_migration_arrive = { race = $race$ }
			}
		}
	}
}
ai_pop_migration_leave = {
	random_owned_province = {
		limit = {
			fast_has_pop_of_race = { race = $race$ }
			NOT = { has_province_modifier = $race$_migration_cooldown }
			OR = {
				devastation = 25
				unrest = 10
				has_oppressed_$race$_pop_trigger = yes
				NOT = { development = 10 owner = { fast_owns_num_pops_of_race = { race = $race$ amount = 20 } } }
				NOT = { preferred_terrain = { $race$ = yes } }
			}
		}
		save_event_target_as = origin_province
	}
	racial_pop_migration_random_leave = { race = $race$ }
	random_list = {
		1 = {
			random_neighbor_country = {
				limit = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
				}
				ai_pop_migration_arrive = { race = $race$ }
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					OR = {
						medium_tolerance_$race$_race_trigger = yes
						high_tolerance_$race$_race_trigger = yes
					}
				}
			}
			random_neighbor_country = {
				limit = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					OR = {
						medium_tolerance_$race$_race_trigger = yes
						high_tolerance_$race$_race_trigger = yes
					}
				}
				ai_pop_migration_arrive = { race = $race$ }
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					high_tolerance_$race$_race_trigger = yes
				}
			}
			random_neighbor_country = {
				limit = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					high_tolerance_$race$_race_trigger = yes
				}
				ai_pop_migration_arrive = { race = $race$ }
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					culture_is_$race$ = yes
				}
			}
			random_neighbor_country = {
				limit = {
					ai = yes
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					culture_is_$race$ = yes
				}
				ai_pop_migration_arrive = { race = $race$ }
			}
		}
	}
	#random_list = {
		#3 = {}
		#1 = {
		#	random_neighbor_country = {
		#		limit = { ai = yes }
		#		ai_pop_migration_arrive = { race = $race$ }
		#	}
		#}
		#1 = {
		#	trigger = { is_subject = yes }
		#	overlord = {
		#		limit = { ai = yes }
		#		ai_pop_migration_arrive = { race = $race$ }
		#	}
		#}
		#1 = {
		#	trigger = { num_of_subjects = 1 }
		#	random_subject_country = {
		#		limit = { ai = yes }
		#		ai_pop_migration_arrive = { race = $race$ }
		#	}
		#}
	#}
}
choose_refugee_country_target = {
	random_list = {
		1 = {
			random_neighbor_country = {
				limit = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
				}
				save_event_target_as = racial_pop_migration_country
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					OR = {
						medium_tolerance_$race$_race_trigger = yes
						high_tolerance_$race$_race_trigger = yes
					}
				}
			}
			random_neighbor_country = {
				limit = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					OR = {
						medium_tolerance_$race$_race_trigger = yes
						high_tolerance_$race$_race_trigger = yes
					}
				}
				save_event_target_as = racial_pop_migration_country
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					high_tolerance_$race$_race_trigger = yes
				}
			}
			random_neighbor_country = {
				limit = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					high_tolerance_$race$_race_trigger = yes
				}
				save_event_target_as = racial_pop_migration_country
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					culture_is_$race$ = yes
				}
			}
			random_neighbor_country = {
				limit = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					culture_is_$race$ = yes
				}
				save_event_target_as = racial_pop_migration_country
			}
		}
		2 = {
			trigger = {
				any_neighbor_country = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					has_country_modifier = racial_focus_$race$
				}
			}
			random_neighbor_country = {
				limit = {
					NOT = {
						has_country_modifier = racial_pop_$race$_purge
						has_country_modifier = racial_pop_$race$_expulsion
					}
					has_country_modifier = racial_focus_$race$
				}
				save_event_target_as = racial_pop_migration_country
			}
		}
	}
}

calculate_refugee_exploit_rewards = {
	event_target:racial_pop_province_origin = {
		export_to_variable = { #setup for calculating the ducats gained
			which = ducats_gained_on_exploit
			value = base_production
		}
		export_to_variable = {
			which = base_tax_var
			value = base_tax
		}
		export_to_variable = { #we only need a single variable for this so no base_manpower_var
			which = manpower_gained_on_exploit
			value = base_manpower
		}
		change_variable = {
			which = ducats_gained_on_exploit
			which = base_tax_var
		}
		multiply_variable = { #you get 1.2 ducats per tax/production development
			which = ducats_gained_on_exploit
			value = 1.2
		}
		multiply_variable = { #you get 250 manpower per manpower development
			which = manpower_gained_on_exploit
			value = 0.25
		}
		if = { #the sanity checkyou will never go below 10 ducats and 1000 manpower from a 0 devastation province
			limit = {
				NOT = {
					check_variable = {
						which = ducats_gained_on_exploit
						value = 10
					}
				}
			}
			set_variable = {
				which = ducats_gained_on_exploit
				value = 10
			}
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = manpower_gained_on_exploit
						value = 1
					}
				}
			}
			set_variable = {
				which = manpower_gained_on_exploit
				value = 1
			}
		}
		if = { #now we scale with devastation
			limit = { devastation = 80 }
			multiply_variable = {
				which = ducats_gained_on_exploit
				value = 0.2
			}
			multiply_variable = {
				which = manpower_gained_on_exploit
				value = 0.2
			}
		}
		else_if = {
			limit = { devastation = 60 }
			multiply_variable = {
				which = ducats_gained_on_exploit
				value = 0.4
			}
			multiply_variable = {
				which = manpower_gained_on_exploit
				value = 0.4
			}
		}
		else_if = {
			limit = { devastation = 40 }
			multiply_variable = {
				which = ducats_gained_on_exploit
				value = 0.6
			}
			multiply_variable = {
				which = manpower_gained_on_exploit
				value = 0.6
			}
		}
		else_if = {
			limit = { devastation = 20 }
			multiply_variable = {
				which = ducats_gained_on_exploit
				value = 0.8
			}
			multiply_variable = {
				which = manpower_gained_on_exploit
				value = 0.8
			}
		}
		ROOT = { #now we scope back to the nation that's taking in the refugees
			set_variable = {
				which = ducats_gained_on_exploit
				which = PREV
			}
			set_variable = { #now you see why we didn't call it base_manpower_var
				which = manpower_gained_on_exploit
				which = PREV
			}
			set_variable = { #this is for use in tooltip only
				which = manpower_in_ones_gained_on_exploit
				which = manpower_gained_on_exploit
			}
			multiply_variable = {
				which = manpower_in_ones_gained_on_exploit
				value = 1000
			}
		}
	}
}

set_tolerance_to_coexisting_or_higher = {
	hidden_effect = {
		if = {
			limit = {
				AND = { 
					high_tolerance_$race$_race_trigger = no
					medium_tolerance_$race$_race_trigger = no
				}
			}
			set_variable = {
				which = $race$_race_tolerance
				value = 31
			}
		}
		country_event = { id = racial_pop_events_$race$.99 }
	}
}

set_all_tolerance_to_coexisting_or_higher = {
	custom_tooltip = set_all_tolerance_to_coexisting_or_higher_tt
	set_tolerance_to_coexisting_or_higher = { race = elven }
	set_tolerance_to_coexisting_or_higher = { race = dwarven }
	set_tolerance_to_coexisting_or_higher = { race = halfling }
	set_tolerance_to_coexisting_or_higher = { race = gnomish }
	set_tolerance_to_coexisting_or_higher = { race = half_orcish }
	set_tolerance_to_coexisting_or_higher = { race = kobold }
	set_tolerance_to_coexisting_or_higher = { race = orcish }
	set_tolerance_to_coexisting_or_higher = { race = human }
	set_tolerance_to_coexisting_or_higher = { race = gnollish }
	set_tolerance_to_coexisting_or_higher = { race = ruinborn }
	set_tolerance_to_coexisting_or_higher = { race = goblin }
	set_tolerance_to_coexisting_or_higher = { race = harpy }
	set_tolerance_to_coexisting_or_higher = { race = troll }
	set_tolerance_to_coexisting_or_higher = { race = half_elven }
	set_tolerance_to_coexisting_or_higher = { race = harimari }
	set_tolerance_to_coexisting_or_higher = { race = hobgoblin }
	set_tolerance_to_coexisting_or_higher = { race = centaur }
	set_tolerance_to_coexisting_or_higher = { race = ogre }
	set_tolerance_to_coexisting_or_higher = { race = lizardfolk }
	set_tolerance_to_coexisting_or_higher = { race = mechanim }
}

set_tolerance_to_integrated_or_higher = {
	hidden_effect = {
		if = {
			limit = { high_tolerance_$race$_race_trigger = no }
			set_variable = {
				which = $race$_race_tolerance
				value = 70
			}
		}
		country_event = { id = racial_pop_events_$race$.99 }
	}
}

set_all_tolerance_to_integrated_or_higher = {
	custom_tooltip = set_all_tolerance_to_integrated_or_higher_tt
	set_tolerance_to_integrated_or_higher = { race = elven }
    set_tolerance_to_integrated_or_higher = { race = dwarven }
    set_tolerance_to_integrated_or_higher = { race = halfling }
    set_tolerance_to_integrated_or_higher = { race = gnomish }
    set_tolerance_to_integrated_or_higher = { race = half_orcish }
    set_tolerance_to_integrated_or_higher = { race = kobold }
    set_tolerance_to_integrated_or_higher = { race = orcish }
    set_tolerance_to_integrated_or_higher = { race = human }
    set_tolerance_to_integrated_or_higher = { race = gnollish }
    set_tolerance_to_integrated_or_higher = { race = ruinborn }
    set_tolerance_to_integrated_or_higher = { race = goblin }
    set_tolerance_to_integrated_or_higher = { race = harpy }
    set_tolerance_to_integrated_or_higher = { race = troll }
    set_tolerance_to_integrated_or_higher = { race = half_elven }
    set_tolerance_to_integrated_or_higher = { race = harimari }
    set_tolerance_to_integrated_or_higher = { race = hobgoblin }
    set_tolerance_to_integrated_or_higher = { race = centaur }
    set_tolerance_to_integrated_or_higher = { race = ogre }
    set_tolerance_to_integrated_or_higher = { race = lizardfolk }
    set_tolerance_to_integrated_or_higher = { race = mechanim }
}

set_tolerance_below_coexisting = {
	hidden_effect = {
		if = {
			limit = { 
				AND = {
					medium_tolerance_$race$_race_trigger = yes
					high_tolerance_$race$_race_trigger = yes
				} 
			}
			set_variable = {
				which = $race$_race_tolerance
				value = 30
			}
		}
		country_event = { id = racial_pop_events_$race$.99 }
	}
}

set_all_tolerance_below_coexisting = {
	custom_tooltip = set_all_tolerance_below_coexisting_tt
	set_tolerance_below_coexisting = { race = elven }
    set_tolerance_below_coexisting = { race = dwarven }
    set_tolerance_below_coexisting = { race = halfling }
    set_tolerance_below_coexisting = { race = gnomish }
    set_tolerance_below_coexisting = { race = half_orcish }
    set_tolerance_below_coexisting = { race = kobold }
    set_tolerance_below_coexisting = { race = orcish }
    set_tolerance_below_coexisting = { race = human }
    set_tolerance_below_coexisting = { race = gnollish }
    set_tolerance_below_coexisting = { race = ruinborn }
    set_tolerance_below_coexisting = { race = goblin }
    set_tolerance_below_coexisting = { race = harpy }
    set_tolerance_below_coexisting = { race = troll }
    set_tolerance_below_coexisting = { race = half_elven }
    set_tolerance_below_coexisting = { race = harimari }
    set_tolerance_below_coexisting = { race = hobgoblin }
    set_tolerance_below_coexisting = { race = centaur }
    set_tolerance_below_coexisting = { race = ogre }
    set_tolerance_below_coexisting = { race = lizardfolk }
    set_tolerance_below_coexisting = { race = mechanim }
}

set_tolerance_below_integrated = {
	hidden_effect = {
		if = {
			limit = {
				high_tolerance_$race$_race_trigger = yes
			}
			set_variable = {
				which = $race$_race_tolerance
				value = 69 #nice
			}
		}
		country_event = { id = racial_pop_events_$race$.99 }
	}
}

set_all_tolerance_below_integrated = {
	custom_tooltip = set_all_tolerance_below_integrated_tt
	set_tolerance_below_integrated = { race = elven }
    set_tolerance_below_integrated = { race = dwarven }
    set_tolerance_below_integrated = { race = halfling }
    set_tolerance_below_integrated = { race = gnomish }
    set_tolerance_below_integrated = { race = half_orcish }
    set_tolerance_below_integrated = { race = kobold }
    set_tolerance_below_integrated = { race = orcish }
    set_tolerance_below_integrated = { race = human }
    set_tolerance_below_integrated = { race = gnollish }
    set_tolerance_below_integrated = { race = ruinborn }
    set_tolerance_below_integrated = { race = goblin }
    set_tolerance_below_integrated = { race = harpy }
    set_tolerance_below_integrated = { race = troll }
    set_tolerance_below_integrated = { race = half_elven }
    set_tolerance_below_integrated = { race = harimari }
    set_tolerance_below_integrated = { race = hobgoblin }
    set_tolerance_below_integrated = { race = centaur }
    set_tolerance_below_integrated = { race = ogre }
    set_tolerance_below_integrated = { race = lizardfolk }
    set_tolerance_below_integrated = { race = mechanim }
}
