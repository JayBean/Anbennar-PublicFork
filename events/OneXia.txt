
########################################
# one_xia Events                         #
########################################

namespace = one_xia

# The DYNASTYNAME wulin has fallen!
province_event = {
	id = one_xia.1
	title = one_xia.1.t
	picture = COURT_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	desc = {
		trigger = {
			owner = { has_reform = wulin }
			FROM = {
				OR = {
					has_reform = wulin
					has_reform = xiaken
				}
			}
		}
		desc = one_xia.1.da
	}
	
	desc = {
		trigger = {
			owner = { has_reform = wulin }
			FROM = {
				NOT = {
					has_reform = wulin
					has_reform = xiaken
				}
			}
		}
		desc = one_xia.1.db
	}
	
	desc = {
		trigger = {
			owner = {
				NOT = { has_reform = wulin }
			}
		}
		desc = one_xia.1.dc
	}
	
	trigger = {
		# OBS! These checks are also hard coded in WouldBecomeShogunIfTaking() for AI and interface reasons. Change code too if this trigger changes.
		province_id = 4559
		NOT = { has_global_flag = destroyed_wulin }
		#owner = {
		#	OR = {
		#		has_reform = xiaken
		#		has_reform = indep_xiaken
		#	}
		#}
	}
	
	immediate = {
		#Save new owner as wulin if valid
		hidden_effect = {
			owner = {
				if = {
					limit = {
						OR = {
							has_reform = xiaken
							has_reform = indep_xiaken
						}
					}
					add_core = 4559
					set_capital = 4559
					#There was a bug, which made it possible that the new wulin remained a xiaken despite having Kyoto
					#I couldn't replicate it though, so I hope the line below might fix it - in the worst case it does nothing
					grant_independence = yes
					add_government_reform = wulin
					save_event_target_as = new_wulin
					add_legitimacy = 75
				}
			}
		}
		#Handle xiaken transfer
		hidden_effect = {
			#Case - new owner is the new wulin, previous still lives -> all xiakens get transferred from the previous to the new one
			if = {
				limit = {
					FROM = { exists = yes }
					owner = { has_reform = wulin }
					FROM = { has_reform = wulin }
				}
				#Degrade the previous wulin to xiaken level
				FROM = {
					every_subject_country = {
						limit = {
							is_subject_of_type = daimyo_xiaken_vassal
						}
						set_country_flag = tobe_xiaken_of_new_wulin
						grant_independence = yes
					}
					event_target:new_wulin = {
						vassalize = FROM
					}
					set_government_rank = 1
					add_government_reform = xiaken
				}
				#Vassalize all of the former xiakens
				#NOTE: originally, it was intended that xiakens, who are at war with the wulin, should not be vassalized
				every_country = {
					limit = {
						has_country_flag = tobe_xiaken_of_new_wulin
					}
					event_target:new_wulin = {
						vassalize = PREV
					}
				}
				# owner = {
					# country_event = {
						# id = japan.4
						# days = 1
					# }
				# }
			}
			#Case - new owner is not the new wulin, previous still lives -> all xiakens get free
			if = {
				limit = {
					FROM = { exists = yes }
					NOT = { owner = { has_reform = wulin } }
					FROM = { has_reform = wulin }
				}
				FROM = {
					every_subject_country = {
						limit = {
							is_subject_of_type = daimyo_xiaken_vassal
						}
						grant_independence = yes
						if = {
							limit = {
								has_reform = xiaken
							}
							add_government_reform = indep_xiaken
						}
					}
					add_government_reform = indep_xiaken
				}
			}
			#Case - new owner is wulin, previous wulin is dead -> all xiakens become subjects of the new wulin
			if = {
				limit = {
					NOT = {
						FROM = { exists = yes }
					}
					owner = { has_reform = wulin }
				}
				every_country = {
					limit = {
						has_reform = xiaken
						NOT = { war_with = event_target:new_wulin }
					}
					event_target:new_wulin = {
						vassalize = PREV
					}
				}
				every_country = {
					limit = {
						has_reform = xiaken
						war_with = event_target:new_wulin
					}
					add_government_reform = indep_xiaken
				}
				#solution for So Pirates	#we don't have pirates in the Xianjie
				#every_country = {
				#	limit = {
				#		tag = SOO
				#		OR = {
				#			has_reform = pirate_republic_reform
				#			has_reform = pirate_king_reform
				#			has_reform = war_against_the_world_doctrine_reform
				#			has_reform = black_market_consortium_reform
				#		}
				#		NOT = { war_with = event_target:new_wulin }
				#	}
				#	country_event = { id = one_xia.2 }
				#}
			}
			#Case - new owner is not the new wulin, previous one is dead -> all former xiakens become independent xiaken
			if = {
				limit = {
					NOT = {
						FROM = { exists = yes }
					}
					NOT = {
						owner = { has_reform = wulin }
					}
				}
				every_country = {
					limit = { has_reform = xiaken }
					overlord = {
						free_vassal = PREV
					}
					add_government_reform = indep_xiaken
				}
			}
		}
		#Catch all remaining xiakens and let them free
		hidden_effect = {
			if = {
				limit = {
					any_country = {
						is_subject_of_type = daimyo_xiaken_vassal
						NOT = { overlord = { has_reform = wulin } }
					}
				}
				every_country = {
					limit = {
						is_subject_of_type = daimyo_xiaken_vassal
						NOT = { overlord = { has_reform = wulin } }
					}
					overlord = {
						free_vassal = PREV
					}
					if = {
						limit = {
							has_reform = xiaken
						}
						remove_government_reform = xiaken
						add_government_reform = indep_xiaken
					}
				}
			}
		}
	}
	
	option = {
		name = one_xia.1.a
		if = {
			limit = {
				owner = { has_reform = wulin }
			}
			custom_tooltip = claiming_the_wulin_tooltip
		}
		if = {
			limit = {
				NOT = {
					owner = { has_reform = wulin }
				}
			}
			owner = {
				if = {
					limit = { NOT = { has_global_flag = destroyed_wulin } }
					add_prestige = 20
					add_adm_power = 50
					add_dip_power = 50
					add_mil_power = 50
				}
			}
			set_global_flag = destroyed_wulin
		}
	}
}

# I couldn't actually find a way to get this event to fire from the last one, so I assume that the NOT = { exists = FROM } bit is actually unused. But just in case I missed something, it seems better to add this anyway.
# New Shogun - join or not?
country_event = {
	id = one_xia.2
	title = one_xia.2.t
	desc = one_xia.2.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	option = { #be a xiaken
		name = one_xia.2.a

		event_target:new_wulin = {
			create_subject = {
				subject_type = daimyo_xiaken_vassal
				subject = root
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				num_of_cities = 10
			}
		}
	}
	option = { #don't be a xiaken
		name = one_xia.2.b
		
		event_target:new_wulin = {
			add_opinion = {
				who = root
				modifier = opinion_defy_new_shogun
			}
			country_event = { id = one_xia.3 days = 5 }
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { num_of_cities = 10 }
			}
		}
	}
}


# So Defies our Authority
country_event = {
	id = one_xia.3
	title = one_xia.3.t
	desc = one_xia.3.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	option = { #be a xiaken
		name = one_xia.3.a
	}
}

#Hidden startup event for One Xia to define xiaWarsWon and trigger the next event
country_event = {
	id = one_xia.9
	title = one_xia.9.t
	desc = one_xia.9.d
	picture = BUDDHISM_BAD_eventPicture
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	option = {
		name = one_xia.9.a
		every_country = {
			limit = {
				capital_scope = {
					OR = {
						region = xianjie_region
						area = rangadevi_area
					}
				}
				OR = {
					has_reform = indep_xiaken
					has_reform = xiaken
					has_reform = wulin
				}
			}
			set_country_flag = xia_nation
			set_variable = {
				which = xiaWarsWon
				value = 0
			}
			country_event = { id = one_xia.10 }
		}
	}
}

#Startup event for One Xia - gives the Peasants Fleeing + Deserters modifiers
country_event = {
	id = one_xia.10
	title = one_xia.10.t
	desc = one_xia.10.d
	picture = BUDDHISM_BAD_eventPicture

	is_triggered_only = yes

	option = {
		name = one_xia.10.a
		add_country_modifier = {
			name = xia_peasants_fleeing
			duration = 9125
		}
		add_country_modifier = {
			name = xia_soldiers_deserting
			duration = 9125
		}
	}
}

##########XIA MISSION TREE EVENTS##########
#Choose to patronize Sages or Wandering Warriors
country_event = {
	id = one_xia.11
	title = one_xia.11.t
	desc = one_xia.11.d
	picture = MERCHANTS_TALKING_eventPicture
	
	is_triggered_only = yes
	
	option = {					#choose mages
		name = one_xia.11.a
		ai_chance = { factor = 50 }
		
		add_country_modifier = {
			name = xia_patronizing_sages
			duration = -1
		}
	}
	
	option = {					#choose adventurers
		name = one_xia.11.b
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				ruler_has_personality =  mage_personality
			}
		}
		add_country_modifier = {
			name = xia_patronizing_wandering_warriors
			duration = -1
		}
	}
}

#Enlist Renowned Hero
country_event = {
	id = one_xia.12
	title = one_xia.12.t
	desc = one_xia.12.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {									#hire a venerable sage
		name = one_xia.12.a
		trigger = {
			has_country_modifier = xia_patronizing_sages
		}
		define_general = {
			shock = 8
			fire = 1
			manuever = 2
			siege = 3
			trait = war_wizard_personality
		}
		add_prestige = 20
	}
	
	option = {									#hire a masterful strategist
		name = one_xia.12.b
		trigger = {
			has_country_modifier = xia_patronizing_wandering_warriors
		}
		define_general = {
			shock = 5
			fire = 5
			manuever = 5
			siege = 4
			trait = defensive_planner_personality
		}
		add_prestige = 20
	}
	
	option = {									#hire a renowned gladiator
		name = one_xia.12.c
		trigger = {
			has_country_modifier = xia_patronizing_wandering_warriors
		}
		define_general = {
			shock = 6
			fire = 4
			manuever = 4
			siege = 4
			trait = master_of_arms_personality
		}
		add_prestige = 20
	}
	
	option = {									#hire a siege specialist
		name = one_xia.12.dd
		trigger = {
			has_country_modifier = xia_patronizing_wandering_warriors
		}
		define_general = {
			shock = 4
			fire = 4
			manuever = 4
			siege = 6
			trait = siege_specialist_personality
		}
		add_prestige = 20
	}
}

#Choose Martial School
country_event = {
	id = one_xia.13
	title = one_xia.13.t
	desc = one_xia.13.d
	picture = CHINESE_GENERAL_eventPicture
	
	is_triggered_only = yes
	
	option = {					#School of the Charging Bull: +1 leader shock
		name = one_xia.13.a
		add_country_modifier = {
			name = xia_charging_bull
			duration = -1
		}
	}
	
	option = {					#School of Diving Lightning: +1 leader fire
		name = one_xia.13.b
		add_country_modifier = {
			name = xia_divine_lightning
			duration = -1
		}
	}
	
	option = {					#School of the Cunning Fox: +1 leader siege
		name = one_xia.13.c
		add_country_modifier = {
			name = xia_cunning_fox
			duration = -1
		}
	}
}

#Mythical Prowess
country_event = {
	id = one_xia.14
	title = one_xia.14.t
	desc = one_xia.14.d
	picture = MILITARISTICALLY_TALENTED_RULER_eventPicture
	
	is_triggered_only = yes
	
	option = {					#We are the Very Best
		name = one_xia.14.a
		add_country_modifier = {
			name = xia_mythical_prowess
			duration = -1
		}
		add_prestige = 10
	}
}

#Calm Restored - Peasants/Soldiers return
country_event = {
	id = one_xia.15
	title = one_xia.15.t
	desc = one_xia.15.d
	picture = BUDDHISM_GOOD_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Send them to the fields
		name = one_xia.15.a
		add_adm_power = -50
		remove_country_modifier = xia_peasants_fleeing
		remove_country_modifier = xia_soldiers_deserting
		capital_scope = {
			area = {
				limit = { owned_by = ROOT }
				add_base_tax = 2
			}
		}
	}
	
	option = {					#Balance
		name = one_xia.15.b
		add_adm_power = -50
		remove_country_modifier = xia_peasants_fleeing
		remove_country_modifier = xia_soldiers_deserting
		capital_scope = {
			area = {
				limit = { owned_by = ROOT }
				add_base_tax = 1
				add_base_manpower = 1
			}
		}
	}
	
	option = {					#Send them to the barracks
		name = one_xia.15.c
		add_adm_power = -50
		remove_country_modifier = xia_peasants_fleeing
		remove_country_modifier = xia_soldiers_deserting
		capital_scope = {
			area = {
				limit = { owned_by = ROOT }
				add_base_manpower = 2
			}
		}
	}
}

#Leading Position Secured
country_event = {
	id = one_xia.16
	title = one_xia.16.t
	desc = one_xia.16.d
	picture = IMPERIAL_SEAL_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Attempt to convince other states of rightful leadership
		name = one_xia.16.a
		add_dip_power = -100
		add_country_modifier = {
			name = xia_diplomatic_efforts
			duration = 3650
		}
	}
	
	option = {					#Attempt to justify further conquest
		name = one_xia.16.b
		add_dip_power = -100
		add_country_modifier = {
			name = xia_justifying_conquests
			duration = 3650
		}
	}
}

#The Criminal Elements of Sarisung
country_event = {
	id = one_xia.17
	title = one_xia.17.t
	desc = one_xia.17.d
	picture = REFORM_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Purge the corrupt and seize their wealth
		name = one_xia.17.a
		add_mil_power = -100
		sarisung_area = {
			add_base_tax = -2
			add_base_production = -2
			add_base_manpower = -2
		}
		jiezhong_area = {
			add_base_tax = 2
			add_base_production = 2
			add_base_manpower = 2
		}
	}
	
	option = {					#Jail the gangsters and fine the officials
		name = one_xia.17.b
		add_mil_power = -50
		sarisung_area = {
			add_base_tax = -1
			add_base_production = -1
			add_base_manpower = -1
		}
		jiezhong_area = {
			add_base_tax = 1
			add_base_production = 1
			add_base_manpower = 1
		}
	}
	
	option = {					#We can look the other way...for a price
		name = one_xia.17.c
		add_years_of_income = 3
		add_corruption = 5
	}
}

#Fate of the Upper Cities
country_event = {
	id = one_xia.18
	title = one_xia.18.t
	desc = one_xia.18.d
	picture = WOKOU_INCIDENT_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Relieve the nobles of their riches
		name = one_xia.18.a
		add_mil_power = -100
		4826 = {
			add_base_tax = -4
			add_base_production = -4
			add_base_manpower = -2
		}
		4842 = {
			add_base_tax = -4
			add_base_production = -4
			add_base_manpower = -2
		}
		4846 = {
			add_base_tax = -4
			add_base_production = -4
			add_base_manpower = -2
		}
		jiezhong_area = {
			add_base_tax = 3
			add_base_production = 2
		}
	}
	
	option = {					#Leave the citizens be
		name = one_xia.18.b
	}
}

#Fate of the Lower Cities
country_event = {
	id = one_xia.24
	title = one_xia.24.t
	desc = one_xia.24.d
	picture = WOKOU_INCIDENT_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Relieve the nobles of their riches
		name = one_xia.24.a
		add_mil_power = -100
		4859 = {
			add_base_tax = -5
			add_base_production = -5
			add_base_manpower = -2
		}
		4868 = {
			add_base_tax = -5
			add_base_production = -5
			add_base_manpower = -2
		}
		4871 = {
			add_base_tax = -6
			add_base_production = -6
			add_base_manpower = -3
		}
		jiezhong_area = {
			add_base_tax = 4
			add_base_production = 3
		}
	}
	
	option = {					#Leave the citizens be
		name = one_xia.24.b
	}
}

#The Art of School
country_event = {
	id = one_xia.20
	title = one_xia.20.t
	desc = one_xia.20.d
	picture = BIG_BOOK_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Divine Lightning
		name = one_xia.20.a
		trigger = {
			has_country_modifier = xia_divine_lightning
		}
		add_country_modifier = {
			name = xia_art_of_divine_lightning
			duration = -1
		}
	}
	
	option = {					#Cunning Fox
		name = one_xia.20.b
		trigger = {
			has_country_modifier = xia_cunning_fox
		}
		add_country_modifier = {
			name = xia_art_of_cunning_fox
			duration = -1
		}
	}
	
	option = {					#Charging Bull
		name = one_xia.20.c
		trigger = {
			has_country_modifier = xia_charging_bull
		}
		add_country_modifier = {
			name = xia_art_of_charging_bull
			duration = -1
		}
	}
}

#Mastery of School
country_event = {
	id = one_xia.21
	title = one_xia.21.t
	desc = one_xia.21.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Mages
		name = one_xia.21.a
		trigger = {
			has_country_modifier = xia_patronizing_sages
		}
		add_country_modifier = {
			name = xia_battlemage_mastery
			duration = -1
		}
		custom_tooltip = xia_battlemage_mastery_tooltip
	}
	
	option = {					#Adventurers
		name = one_xia.21.b
		trigger = {
			has_country_modifier = xia_patronizing_wandering_warriors
		}
		add_country_modifier = {
			name = xia_adventurer_mastery
			duration = -1
		}
		custom_tooltip = xia_adventurer_mastery_tooltip
	}
}

#A Humble Ultimatum
country_event = {
	id = one_xia.23
	title = one_xia.23.t
	desc = one_xia.23.d
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Send diplomats
		name = one_xia.23.a
		add_dip_power = -100
		Y05 = { country_event = { id = one_xia.26 days = 7 } }
	}
	
	option = {					#Place soldiers on the border
		name = one_xia.23.c
		add_mil_power = -100
		set_country_flag = xia_bluescarves_belligerent
		Y05 = { country_event = { id = one_xia.26 days = 7 } }
	}
	
	option = {					#Fabricate claims
		name = one_xia.23.e
		add_adm_power = -100
		set_country_flag = xia_bluescarves_belligerent
		Y05 = { country_event = { id = one_xia.26 days = 7 } }
	}
}

#Lanjinhui gets the Ultimatum
country_event = { 
	id = one_xia.26
	title = one_xia.26.t
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	
	desc = {
		trigger = {
			NOT = { 
				has_opinion = {
					who = Y99
					value = 150
				}
			}
			NOT = {
				Y99 = {
					has_country_flag = xia_bluescarves_belligerent
				}
			}
		}
		desc = one_xia.26.da
	}
	
	desc = {
		trigger = {
			has_opinion = {
				who = Y99
				value = 150
			}
			NOT = {
				Y99 = {
					has_country_flag = xia_bluescarves_belligerent
				}
			}
		}
		desc = one_xia.26.db
	}
	
	desc = {
		trigger = {
			Y99 = {
				has_country_flag = xia_bluescarves_belligerent
			}
		}
		desc = one_xia.26.dc
	}
	
	option = {					#Accept the offer of vassalization
		name = one_xia.26.a
		Y99 = { country_event = { id = one_xia.30 days = 7 } }
		Y99 = { set_country_flag = xia_bluescarves_gracious }
		ai_chance = { 
			factor = 25 
			modifier = {
				factor = 2
				has_opinion = {
					who = Y99
					value = 150
				}
			}
			modifier = {
				factor = 2
				has_opinion = {
					who = Y99
					value = 200
				}
			}
			modifier = {
				factor = 0
				NOT = {
					has_opinion = {
						who = Y99
						value = 0
					}
				}
			}
			modifier = {
				factor = 0.5
				Y99 = {
					has_country_flag = xia_bluescarves_belligerent
				}
			}
		}
	}
	
	option = {					#Tell the Xia to kick rocks
		name = one_xia.26.b
		trigger =  {
			NOT = {
				Y99 = {
					has_country_flag = xia_bluescarves_belligerent
				}
			}
		}
		Y99 = { country_event = { id = one_xia.30 days = 7 } }
		ai_chance = { 
			factor = 75 
			modifier = {
				factor = 2
				NOT = {
					has_opinion = {
						who = Y99
						value = 150
					}
				}
			}
			modifier = {
				factor = 2
				NOT = {
					has_opinion = {
						who = Y99
						value = 100
					}
				}
			}
			modifier = {
				factor = 3
				NOT = {
					has_opinion = {
						who = Y99
						value = 50
					}
				}
			}
		}
	}
	
	option = {					#Rally the Blue Scarves!
		name = one_xia.26.c
		trigger =  {
			Y99 = {
				has_country_flag = xia_bluescarves_belligerent
			}
		}
		add_country_modifier = {
			name = xia_rally_blue_scarves
			duration = 3650
		}
		Y99 = { country_event = { id = one_xia.30 days = 7 } }
		ai_chance = { 
			factor = 75 
			modifier = {
				factor = 2
				NOT = {
					has_opinion = {
						who = Y99
						value = 150
					}
				}
			}
			modifier = {
				factor = 2
				NOT = {
					has_opinion = {
						who = Y99
						value = 100
					}
				}
			}
			modifier = {
				factor = 3
				NOT = {
					has_opinion = {
						who = Y99
						value = 50
					}
				}
			}
		}
	}
}
	
#Lanjinhui Responds
country_event = {
	id = one_xia.30
	title = one_xia.30.t
	picture = CONQUEST_eventPicture
	
	desc = {
		trigger = {
			has_country_flag = xia_bluescarves_gracious
		}
		desc = one_xia.30.da
	}
	
	desc = {
		trigger = {
			NOT = {
				has_country_flag = xia_bluescarves_gracious
			}
		}
		desc = one_xia.30.db
	}
	
	is_triggered_only = yes
	
	option = {					#Send diplomats (fail)
		name = one_xia.30.a
		trigger = {
			NOT = {
				has_country_flag = xia_bluescarves_gracious
				has_country_flag = xia_bluescarves_belligerent
			}
		}
		add_casus_belli = {
			target = Y05
			type = cb_vassalize_mission
			months = 120
		}
	}
	
	option = {					#Send diplomats (succeed)
		name = one_xia.30.b
		trigger = {
			has_country_flag = xia_bluescarves_gracious
		}
		vassalize = Y05
	}
	
	option = {					#Claims
		name = one_xia.30.c
		trigger = {
			has_country_flag = xia_bluescarves_belligerent
		}
		yanshen_superregion = {
			if = {
				limit = {
					owned_by = Y05
				}
				add_permanent_claim = ROOT
			}
		}
	}
}

#Proclaim Xianxia
country_event = {
	id = one_xia.25
	title = one_xia.25.t
	desc = one_xia.25.d
	picture = IMPERIAL_SEAL_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = one_xia.25.a
		add_country_modifier = {
			name = xia_xianxia
			duration = -1
		}
		override_country_name = XIA_XIANXIA_NAME
	}
}

#Heir Selection - Xiaken - Choose Disciple
country_event = {
	id = one_xia.40
	title = one_xia.40.t
	desc = one_xia.40.da
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_reform = xiaken
			has_reform = indep_xiaken
		}
		NOT = { has_country_flag = in_xia_heir_selection }
		NOT = { has_country_flag = lich_ruler_has_phylactery }
		has_government_attribute = heir
	}
	
	immediate = {
		hidden_effect = {
			add_legitimacy = 100
			set_country_flag = in_xia_heir_selection
			clr_country_flag = xia_heir_natural_leader
			clr_country_flag = xia_heir_skilled_mediator
			clr_country_flag = xia_heir_talented_fighter
			clr_country_flag = xia_heir_promising_sage
			clr_country_flag = xia_heir_retired_wandering_warrior
		}
	}
	
	option = {										#A Natural Leader
		name = one_xia.40.a
		
		set_country_flag = xia_heir_natural_leader	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_adm = 2
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_adm = 2
				dynasty = ROOT
			}
		}
		custom_tooltip = xia_natural_leader_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Skilled Mediator
		name = one_xia.40.b
		
		set_country_flag = xia_heir_skilled_mediator	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_dip = 2
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_dip = 2
				dynasty = ROOT
			}
		}
		custom_tooltip = xia_skilled_mediator_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Talented Fighter
		name = one_xia.40.c
		
		set_country_flag = xia_heir_talented_fighter	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_mil = 2
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_mil = 2
				dynasty = ROOT
			}
		}
		custom_tooltip = xia_talented_fighter_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Promising Sage
		name = one_xia.40.d
		trigger = {
			has_estate = estate_mages
			has_country_modifier = xia_patronizing_sages
		}
		
		highlight = yes
		
		set_country_flag = xia_heir_powerful_sage	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 15
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				hidden = yes
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 15
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				hidden = yes
				dynasty = ROOT
			}
		}
		set_heir_mage_effect = yes
		add_estate_mages_loyalty_effect = yes	
		custom_tooltip = xia_heir_powerful_sage_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Retired Wandering Warrior
		name = one_xia.40.e
		trigger = {
			has_estate = estate_adventurers
			has_country_modifier = xia_patronizing_wandering_warriors
		}
		
		highlight = yes
		
		set_country_flag = xia_heir_wandering_warrior	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 35
				hidden = yes
				female = yes
				max_random_adm = 5
				max_random_dip = 5
				change_mil = 3
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 35
				max_random_adm = 5
				max_random_dip = 5
				hidden = yes
				dynasty = ROOT
				change_mil = 3
			}
		}
		add_estate_adventurers_loyalty_effect = yes
		custom_tooltip = xia_heir_wandering_warrior_tooltip
		clr_country_flag = in_xia_heir_selection
	}
}

#One Xia Succession - Choose First Tournament Participant
country_event = {
	id = one_xia.41
	title = one_xia.41.t
	desc = one_xia.41.da
	picture = IKKO_IKKI_INCIDENT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_reform = one_xia
		NOT = { has_country_flag = in_one_xia_tournament }
		NOT = { has_country_flag = lich_ruler_has_phylactery }
		has_government_attribute = heir
	}
	
	immediate = {
		hidden_effect = {
			set_country_flag = in_one_xia_tournament
		}
	}
	
	option = {										#The Master of Flowing Water
		name = one_xia.41.a
		set_country_flag = one_xia_selected_flowing_water
		custom_tooltip = one_xia_selected_flowing_water_tooltip
		country_event = { id = one_xia.42 }
	}

	option = {										#The Master of the Clear Mind
		name = one_xia.41.b
		set_country_flag = one_xia_selected_deep_fog
		custom_tooltip = one_xia_selected_deep_fog_tooltip
		country_event = { id = one_xia.42 }
	}
	
	option = {										#The Master of the Dancing Breeze
		name = one_xia.41.c
		set_country_flag = one_xia_selected_harpy
		custom_tooltip = one_xia_selected_harpy_tooltip
		country_event = { id = one_xia.42 }
	}

	option = {										#The Master of Open Sky
		name = one_xia.41.d
		set_country_flag = one_xia_selected_open_sky
		custom_tooltip = one_xia_selected_open_sky_tooltip
		country_event = { id = one_xia.42 }
	}
	
	option = {										#The Master of the Keepers
		name = one_xia.41.e
		set_country_flag = one_xia_selected_keeper
		custom_tooltip = one_xia_selected_keeper_tooltip
		country_event = { id = one_xia.42 }
	}
	
	option = {										#The Master of the Crouching Tigers
		name = one_xia.41.f
		set_country_flag = one_xia_selected_crouching_tiger
		custom_tooltip = one_xia_selected_crouching_tiger_tooltip
		country_event = { id = one_xia.42 }
	}
}

#One Xia Succession - Choose Second Tournament Participant
country_event = {
	id = one_xia.42
	title = one_xia.42.t
	desc = one_xia.42.da
	picture = IKKO_IKKI_INCIDENT_eventPicture
	
	is_triggered_only = yes
	
	option = {										#The Master of Flowing Water
		name = one_xia.42.a
		trigger = {
			NOT = {
				has_country_flag = one_xia_selected_flowing_water
			}
		}
		set_country_flag = one_xia_selected_flowing_water
		custom_tooltip = one_xia_selected_flowing_water_tooltip
		country_event = { id = one_xia.43 }
	}

	option = {										#The Master of Deep Fog
		name = one_xia.42.b
		trigger = {
			NOT = {
				has_country_flag = one_xia_selected_deep_fog
			}
		}
		set_country_flag = one_xia_selected_deep_fog
		custom_tooltip = one_xia_selected_deep_fog_tooltip
		country_event = { id = one_xia.43 }
	}
	
	option = {										#The Master of the Dancing Breeze
		name = one_xia.42.c
		trigger = {
			NOT = {
				has_country_flag = one_xia_selected_harpy
			}
		}
		set_country_flag = one_xia_selected_harpy
		custom_tooltip = one_xia_selected_harpy_tooltip
		country_event = { id = one_xia.43 }
	}

	option = {										#The Master of Open Sky
		name = one_xia.42.d
		trigger = {
			NOT = {
				has_country_flag = one_xia_selected_open_sky
			}
		}
		set_country_flag = one_xia_selected_open_sky
		custom_tooltip = one_xia_selected_open_sky_tooltip
		country_event = { id = one_xia.43 }
	}

	option = {										#The Master of the Keepers
		name = one_xia.42.e
		trigger = {
			NOT = {
				has_country_flag = one_xia_selected_keeper
			}
		}
		set_country_flag = one_xia_selected_keeper
		custom_tooltip = one_xia_selected_keeper_tooltip
		country_event = { id = one_xia.43 }
	}
	
	option = {										#The Master of the Crouching Tigers
		name = one_xia.42.f
		trigger = {
			NOT = {
				has_country_flag = one_xia_selected_crouching_tiger
			}
		}
		set_country_flag = one_xia_selected_crouching_tiger
		custom_tooltip = one_xia_selected_crouching_tiger_tooltip
		country_event = { id = one_xia.43 }
	}
}

#One Xia Succession - Tournament Happens, The Winner is...
country_event = {
	id = one_xia.43
	title = one_xia.43.t
	desc = one_xia.43.da
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {										#The Master of Flowing Water
		name = one_xia.43.a
		trigger = {
			has_country_flag = one_xia_selected_flowing_water
		}
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		define_heir = {
			dynasty = "of the School of Flowing Water"
			age = 25
			hide_skills = yes
			max_random_dip = 5
			max_random_mil = 5
			change_adm = 2
			culture = western_yan
			religion = righteous_path
		}
		if = { 
			limit = { culture_is_human = no }
			large_increase_of_human_tolerance_effect = yes
		}
		if = {
			limit = {
				has_country_modifier = xia_patronizing_sages
				NOT = {
					has_country_modifier = xia_battlemage_mastery
				}
			}
			random_list = {
				10 = {
					set_heir_mage_effect = yes
				}
				90 = {
				
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = xia_battlemage_mastery
			}
			random_list = {
				25 = {
					set_heir_mage_effect = yes
				}
				75 = {
				
				}
			}
		}
		clr_country_flag = one_xia_selected_flowing_water
		clr_country_flag = one_xia_selected_deep_fog
		clr_country_flag = one_xia_selected_harpy
		clr_country_flag = one_xia_selected_open_sky
		clr_country_flag = one_xia_selected_keeper
		clr_country_flag = one_xia_selected_crouching_tiger
		clr_country_flag = in_one_xia_tournament
	}
	
	option = {										#The Master of Deep Fog
		name = one_xia.43.b
		trigger = {
			has_country_flag = one_xia_selected_deep_fog
		}
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		define_heir = {
			dynasty = "of the School of Deep Fog"
			age = 25
			hide_skills = yes
			max_random_dip = 5
			max_random_mil = 5
			adm = 2
			culture = rasarhid
			religion = righteous_path
		}
		if = { 
			limit = { culture_is_human = no }
			large_increase_of_human_tolerance_effect = yes
		}
		if = {
			limit = {
				has_country_modifier = xia_patronizing_sages
				NOT = {
					has_country_modifier = xia_battlemage_mastery
				}
			}
			random_list = {
				10 = {
					set_heir_mage_effect = yes
				}
				90 = {
				
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = xia_battlemage_mastery
			}
			random_list = {
				25 = {
					set_heir_mage_effect = yes
				}
				75 = {
				
				}
			}
		}
		clr_country_flag = one_xia_selected_flowing_water
		clr_country_flag = one_xia_selected_deep_fog
		clr_country_flag = one_xia_selected_harpy
		clr_country_flag = one_xia_selected_open_sky
		clr_country_flag = one_xia_selected_keeper
		clr_country_flag = one_xia_selected_crouching_tiger
		clr_country_flag = in_one_xia_tournament
	}
	
	option = {										#The Master of the Dancing Breeze
		name = one_xia.43.c
		trigger = {
			has_country_flag = one_xia_selected_harpy
		}
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		define_heir = {
			dynasty = "of the Way of the Dancing Breeze"
			age = 25
			hide_skills = yes
			change_dip = 2
			max_random_adm = 5
			max_random_mil = 5
			culture = feng_harpy
			female = yes
			religion = righteous_path
		}
		large_increase_of_harpy_tolerance_effect = yes
		if = {
			limit = {
				has_country_modifier = xia_patronizing_sages
				NOT = {
					has_country_modifier = xia_battlemage_mastery
				}
			}
			random_list = {
				10 = {
					set_heir_mage_effect = yes
				}
				90 = {
				
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = xia_battlemage_mastery
			}
			random_list = {
				25 = {
					set_heir_mage_effect = yes
				}
				75 = {
				
				}
			}
		}
		clr_country_flag = one_xia_selected_flowing_water
		clr_country_flag = one_xia_selected_deep_fog
		clr_country_flag = one_xia_selected_harpy
		clr_country_flag = one_xia_selected_open_sky
		clr_country_flag = one_xia_selected_keeper
		clr_country_flag = one_xia_selected_crouching_tiger
		clr_country_flag = in_one_xia_tournament
	}
	
	option = {										#The Master of Open Sky
		name = one_xia.43.d
		trigger = {
			has_country_flag = one_xia_selected_open_sky
		}
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		define_heir = {
			dynasty = "of the School of Open Sky"
			age = 25
			hide_skills = yes
			change_dip = 2
			max_random_adm = 5
			max_random_mil = 5
			culture = western_yan
			religion = righteous_path
		}
		if = { 
			limit = { culture_is_human = no }
			large_increase_of_human_tolerance_effect = yes
		}
		if = {
			limit = {
				has_country_modifier = xia_patronizing_sages
				NOT = {
					has_country_modifier = xia_battlemage_mastery
				}
			}
			random_list = {
				10 = {
					set_heir_mage_effect = yes
				}
				90 = {
				
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = xia_battlemage_mastery
			}
			random_list = {
				25 = {
					set_heir_mage_effect = yes
				}
				75 = {
				
				}
			}
		}
		clr_country_flag = one_xia_selected_flowing_water
		clr_country_flag = one_xia_selected_deep_fog
		clr_country_flag = one_xia_selected_harpy
		clr_country_flag = one_xia_selected_open_sky
		clr_country_flag = one_xia_selected_keeper
		clr_country_flag = one_xia_selected_crouching_tiger
		clr_country_flag = in_one_xia_tournament
	}
	
	option = {										#The Master of the Keepers
		name = one_xia.43.e
		trigger = {
			has_country_flag = one_xia_selected_keeper
		}
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		define_heir = {
			dynasty = "of the Order of Keepers"
			age = 25
			hide_skills = yes
			change_mil = 2
			max_random_adm = 5
			max_random_dip = 5
			culture = western_yan
			religion = righteous_path
		}
		if = { 
			limit = { culture_is_human = no }
			large_increase_of_human_tolerance_effect = yes
		}
		if = {
			limit = {
				has_country_modifier = xia_patronizing_sages
				NOT = {
					has_country_modifier = xia_battlemage_mastery
				}
			}
			random_list = {
				10 = {
					set_heir_mage_effect = yes
				}
				90 = {
				
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = xia_battlemage_mastery
			}
			random_list = {
				25 = {
					set_heir_mage_effect = yes
				}
				75 = {
				
				}
			}
		}
		clr_country_flag = one_xia_selected_flowing_water
		clr_country_flag = one_xia_selected_deep_fog
		clr_country_flag = one_xia_selected_harpy
		clr_country_flag = one_xia_selected_open_sky
		clr_country_flag = one_xia_selected_keeper
		clr_country_flag = one_xia_selected_crouching_tiger
		clr_country_flag = in_one_xia_tournament
	}
	
	option = {										#The Master of the Crouching Tigers
		name = one_xia.43.f
		trigger = {
			has_country_flag = one_xia_selected_crouching_tiger
		}
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		define_heir = {
			dynasty = "of the Path of the Crouching Tiger"
			age = 25
			hide_skills = yes
			change_mil = 2
			max_random_adm = 5
			max_random_dip = 5
			culture = serene_harimari
			religion = righteous_path
		}
		large_increase_of_harimari_tolerance_effect = yes
		if = {
			limit = {
				has_country_modifier = xia_patronizing_sages
				NOT = {
					has_country_modifier = xia_battlemage_mastery
				}
			}
			random_list = {
				10 = {
					set_heir_mage_effect = yes
				}
				90 = {
				
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = xia_battlemage_mastery
			}
			random_list = {
				25 = {
					set_heir_mage_effect = yes
				}
				75 = {
				
				}
			}
		}
		clr_country_flag = one_xia_selected_flowing_water
		clr_country_flag = one_xia_selected_deep_fog
		clr_country_flag = one_xia_selected_harpy
		clr_country_flag = one_xia_selected_open_sky
		clr_country_flag = one_xia_selected_keeper
		clr_country_flag = one_xia_selected_crouching_tiger
		clr_country_flag = in_one_xia_tournament
	}
}

#Normal Heir Training - Xiaken/Wulin version
country_event = {
	id = one_xia.44
	title = one_xia.44.t
	desc = one_xia.44.da
	picture = MIRACLE_MONK_eventPicture
	
	trigger = {
		OR = {
			has_reform = xiaken
			has_reform = wulin
		}
		NOT = {
			has_heir_flag = xia_trained_chosen_disciple
		}
	}
	
	mean_time_to_happen = { 
		months = 60
	}
	
	option = {							#Adm training
		name = one_xia.44.a
		trigger = {
			NOT = {
				has_country_flag = xia_heir_natural_leader
			}
		}
		add_adm_power = -25
		increase_heir_adm_effect = yes
		set_heir_flag = xia_trained_chosen_disciple
	}
	
	option = {							#Dip training
		name = one_xia.44.b
		trigger = {
			NOT = {
				has_country_flag = xia_heir_skilled_mediator
			}
		}
		add_dip_power = -25
		increase_heir_dip_effect = yes
		set_heir_flag = xia_trained_chosen_disciple
	}
	
	option = {							#Mil training
		name = one_xia.44.c
		trigger = {
			NOT = {
				has_country_flag = xia_heir_talented_fighter
			}
		}
		add_mil_power = -25
		increase_heir_mil_effect = yes
		set_heir_flag = xia_trained_chosen_disciple
	}
}

#Normal Heir Training - One Xia version
country_event = {
	id = one_xia.45
	title = one_xia.45.t
	desc = one_xia.45.da
	picture = MIRACLE_MONK_eventPicture
	
	trigger = {
		OR = {
			has_reform = xiaken
			has_reform = wulin
		}
		NOT = {
			has_heir_flag = xia_trained_ascendant_master
		}
	}
	
	mean_time_to_happen = { 
		months = 60
	}
	
	option = {							#Adm training
		name = one_xia.45.a
		add_adm_power = -25
		increase_heir_adm_effect = yes
		set_heir_flag = xia_trained_ascendant_master
	}
	
	option = {							#Dip training
		name = one_xia.45.b
		add_dip_power = -25
		increase_heir_dip_effect = yes
		set_heir_flag = xia_trained_ascendant_master
	}
	
	option = {							#Mil training
		name = one_xia.45.c
		add_mil_power = -25
		increase_heir_mil_effect = yes
		set_heir_flag = xia_trained_ascendant_master
	}
}

#Heir Selection - Wulin - Choose Disciple
country_event = {
	id = one_xia.46
	title = one_xia.40.t
	desc = one_xia.40.da
	picture = MIRACLE_MONK_eventPicture
	
	trigger = {
		has_reform = wulin
		NOT = { has_country_flag = in_xia_heir_selection }
		NOT = { has_country_flag = lich_ruler_has_phylactery }
		has_government_attribute = heir
		has_heir = no
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			set_country_flag = in_xia_heir_selection
			clr_country_flag = xia_heir_natural_leader
			clr_country_flag = xia_heir_skilled_mediator
			clr_country_flag = xia_heir_talented_fighter
			clr_country_flag = xia_heir_promising_sage
			clr_country_flag = xia_heir_retired_wandering_warrior
		}
	}
	
	option = {										#A Natural Leader
		name = one_xia.40.a
		
		set_country_flag = xia_heir_natural_leader	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_adm = 2
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_adm = 2
				dynasty = ROOT
			}
		}
		custom_tooltip = xia_natural_leader_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Skilled Mediator
		name = one_xia.40.b
		
		set_country_flag = xia_heir_skilled_mediator	# USED IN DEVOTION.TXT (is it really though?)
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_dip = 2
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_dip = 2
				dynasty = ROOT
			}
		}
		custom_tooltip = xia_skilled_mediator_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Talented Fighter
		name = one_xia.40.c
		
		set_country_flag = xia_heir_talented_fighter	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_mil = 2
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 20
				hidden = yes
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				change_mil = 2
				dynasty = ROOT
			}
		}
		custom_tooltip = xia_talented_fighter_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Promising Sage
		name = one_xia.40.d
		trigger = {
			has_estate = estate_mages
			has_country_modifier = xia_patronizing_sages
		}
		
		highlight = yes
		
		set_country_flag = xia_heir_powerful_sage	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 15
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				hidden = yes
				female = yes
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 15
				max_random_adm = 5
				max_random_dip = 5
				max_random_mil = 5
				hidden = yes
				dynasty = ROOT
			}
		}
		set_heir_mage_effect = yes
		add_estate_mages_loyalty_effect = yes	
		custom_tooltip = xia_heir_powerful_sage_tooltip
		clr_country_flag = in_xia_heir_selection
	}
	
	option = {										#A Retired Wandering Warrior
		name = one_xia.40.e
		trigger = {
			has_estate = estate_adventurers
			has_country_modifier = xia_patronizing_wandering_warriors
		}
		
		highlight = yes
		
		set_country_flag = xia_heir_wandering_warrior	# USED IN DEVOTION.TXT (is it really though?)
		hidden_effect = {
			country_event = { id = one_xia.54 days = 14 }
		}
		if = {
			limit = {
				OR = {
					culture_group = harpy
					culture_group = gnollish
				}
			}
			define_heir = {
				age = 35
				hidden = yes
				female = yes
				max_random_adm = 5
				max_random_dip = 5
				change_mil = 3
				dynasty = ROOT
			}
		}
		else = {
			define_heir = {
				age = 35
				max_random_adm = 5
				max_random_dip = 5
				hidden = yes
				dynasty = ROOT
				change_mil = 3
			}
		}
		add_estate_adventurers_loyalty_effect = yes
		custom_tooltip = xia_heir_wandering_warrior_tooltip
		clr_country_flag = in_xia_heir_selection
	}
}

#Consulting the Keepers
country_event = {
	id = one_xia.50
	title = one_xia.50.t
	desc = one_xia.50.d
	picture = SWORD_OF_OSMAN_eventPicture
	
	is_triggered_only = yes
	
	option = {					#begin studying Still Ocean Technique
		name = one_xia.50.a
		add_country_modifier = {
			name = xia_studying_still_ocean
			duration = -1
		}
	}
	
	option = {					#Reject Balance
		name = one_xia.50.b
		set_country_flag = xia_rejected_balance
		custom_tooltip = xia_reject_balance_tooltip
	}
}

#A Tranquil Soul
country_event = {
	id = one_xia.51
	title = one_xia.51.t
	desc = one_xia.51.d
	picture = MIRACLE_MONK_eventPicture
	
	trigger = {
		has_country_modifier = xia_studying_still_ocean
	}
	
	mean_time_to_happen = { 
		months = 120
		
		modifier = {
			factor = 0.5
			ruler_age = 30
		}
		modifier = {
			factor = 0.5
			ruler_age = 40
		}
		modifier = {
			factor = 0.5
			has_ruler_modifier = xia_still_ocean_proficiency
		}
	}
	
	option = {					#balans
		name = one_xia.51.a
		remove_country_modifier = xia_studying_still_ocean
		if = {
			limit = {
				NOT = {
					has_country_flag = xia_still_ocean_training_unlocked
				}
			}
			hidden_effect = {
				set_country_flag = xia_still_ocean_training_unlocked
			}
			custom_tooltip = xia_still_ocean_training_unlocked_tooltip
		}
		add_ruler_modifier = { 
			name = xia_tranquil_soul
			duration = -1
		}
	}
}

#The Keepers Take Notice
country_event = {
	id = one_xia.52
	title = one_xia.52.t
	picture = BUDDHISM_LAMA_eventPicture
	
	desc = {
		trigger = {
			has_ruler_modifier = xia_tranquil_soul
		}
		desc = one_xia.52.da
	}
	
	desc = {
		trigger = {
			has_country_flag = xia_rejected_balance
		}
		desc = one_xia.52.db
	}
	
	immediate = {
		hidden_effect = {
			set_country_flag = xia_heir_still_ocean_training_unlocked
		}
	}
	
	is_triggered_only = yes
	
	option = {					#hell yeah balance my heir's shit up too bro
		name = one_xia.52.a
		custom_tooltip = xia_begin_training_heir_still_ocean_tooltip
		set_country_flag = xia_heir_still_ocean_training
	}
	
	option = {					#fuck off (why would you pick this)
		name = one_xia.52.b
	}
}

#A Balanced Soul?
country_event = {
	id = one_xia.53
	title = one_xia.53.t
	picture = BUDDHISM_LAMA_eventPicture
	
	desc = {
		trigger = {
			has_ruler_modifier = xia_tranquil_soul
		}
		desc = one_xia.53.da
	}
	
	desc = {
		trigger = {
			has_country_flag = xia_rejected_balance
		}
		desc = one_xia.53.db
	}
	
	is_triggered_only = yes
	
	option = {					#test me bro
		name = one_xia.53.a
		country_event = { id = one_xia.70 }				#Trial of Balance Begins
		hidden_effect = {
			xia_determine_affinity = yes
		}
	}
	
	option = {					#I'm not ready
		name = one_xia.53.b
		custom_tooltip = xia_not_ready_tooltip
	}
	
	option = {					#fuck balance give me the sword nerds
		name = one_xia.53.c
		add_mil_power = -100
		custom_tooltip = xia_end_the_keepers_tooltip
		add_country_modifier = {
			name = xia_ended_the_keepers
			duration = -1
		}
		clr_country_flag = xia_rejected_balance
		4811 = {
			add_base_tax = -2
			add_base_production = -2
			add_base_manpower = -4
			add_devastation = 75
			add_nationalism = 50
		}
	}
}

#Xia Heir - Balance Training?
country_event = {
	id = one_xia.54
	title = one_xia.54.t
	desc = one_xia.54.d
	picture = MIRACLE_MONK_eventPicture
	
	trigger = {
		has_country_flag = xia_heir_still_ocean_training_unlocked
	}
	
	is_triggered_only = yes
	
	option = {							#I'll train them myself
		name = one_xia.54.a
		trigger = {
			has_ruler_modifier = xia_tranquil_soul
		}
		set_country_flag = xia_heir_still_ocean_training
		
		highlight = yes
	}
	
	option = {							#Hire the Keepers
		name = one_xia.54.b
		add_years_of_income = -0.25
		set_country_flag = xia_heir_still_ocean_training
	}
	
	option = {							#nope
		name = one_xia.54.c
	}
}

#Xia Heir - Heir Practiced Still Ocean Technique triggered on_new_monarch
country_event = {
	id = one_xia.55
	title = one_xia.55.t
	desc = one_xia.55.d
	picture = MIRACLE_MONK_eventPicture
	
	trigger = {
		has_country_flag = xia_heir_still_ocean_training
	}
	
	is_triggered_only = yes
	
	option = {							#cool
		name = one_xia.55.a
		clr_country_flag = xia_heir_still_ocean_training
		add_ruler_modifier = {
			name = xia_still_ocean_proficiency
			duration = -1
			hidden = yes
		}
	}
}

#Xia New Ruler is Keeper, gets to wield kongren triggered on_new_monarch
country_event = {
	id = one_xia.56
	title = one_xia.56.t
	desc = one_xia.56.d
	picture = SWORD_OF_OSMAN_eventPicture
	
	trigger = {
		dynasty = "of the Order of Keepers"
	}
	
	is_triggered_only = yes
	
	option = {							#Bet
		name = one_xia.56.a
		add_ruler_modifier = {
			name = xia_wielding_kongren
			duration = -1
		}
	}
}

#The Secrets of the Oni
country_event = {
	id = one_xia.60
	title = one_xia.60.t
	desc = one_xia.60.d
	picture = IMPERIAL_SEAL_eventPicture
	
	is_triggered_only = yes
	
	option = {					#what could go wrong
		name = one_xia.60.a
		add_adm_power = -100
		custom_tooltip = xia_oni_secrets_tooltip
		hidden_effect = {
			random_list = {
				40 = {
					country_event = { id = one_xia.61 days = 1095 }			#general
				}
				40 = {
					country_event = { id = one_xia.62 days = 1095 }			#advisor
				}
				15 = {		
					country_event = { id = one_xia.63 days = 1095 }			#heir
				}
				5 = {
					country_event = { id = one_xia.64 days = 1095 }			#leader
				}
			}
		}
	}
}

#Demonic Possession - General
country_event = {
	id = one_xia.61
	title = one_xia.61.t
	desc = one_xia.61.d
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = one_xia.61.a
		kill_leader = {
			type = random
		}
	}
}

#Demonic Possession - Advisor
country_event = {
	id = one_xia.62
	title = one_xia.62.t
	desc = one_xia.62.d
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		ROOT = {
			kill_advisor = random
		}
	}
	
	option = {
		name = one_xia.62.a
		hidden_effect = {
			country_event = { id = one_xia.65 days = 730 }
		}
	}
}

#Demonic Possession - Heir
country_event = {
	id = one_xia.63
	title = one_xia.63.t
	desc = one_xia.63.d
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = one_xia.63.a
		kill_heir = {}
		hidden_effect = {
			country_event = { id = one_xia.65 days = 730 }
		}
	}
}

#Demonic Possession - Leader
country_event = {
	id = one_xia.64
	title = one_xia.64.t
	desc = one_xia.64.d
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = one_xia.64.a
		kill_ruler = yes
		hidden_effect = {
			country_event = { id = one_xia.65 days = 730 }
		}
	}
}

#The Secret of Korashi				#Discovery of Korashi, set up workshops in Jiangshengdian
country_event = {
	id = one_xia.65
	title = one_xia.65.t
	desc = one_xia.65.d
	picture = INVENTION_eventPicture
	
	is_triggered_only = yes
	
	option = {						#Big operation - great spy defence version
		name = one_xia.65.a
		add_years_of_income = -2
		trigger = {
			has_global_modifier_value = {
				which = global_spy_defence
				value = 0.4
			}
		}
		4811 = {
			add_province_modifier = {
				name = xia_korashi_workshops
				duration = 54750
			}
		}
	}
	
	option = {						#Big operation - good spy defence version
		name = one_xia.65.a
		add_years_of_income = -2
		trigger = {
			NOT = {
				has_global_modifier_value = {
					which = global_spy_defence
					value = 0.4
				}
			}
			has_global_modifier_value = {
				which = global_spy_defence
				value = 0.2
			}
		}
		4811 = {
			add_province_modifier = {
				name = xia_korashi_workshops
				duration = 36500
			}
		}
	}
	
	option = {						#Big operation - no spy defence version
		name = one_xia.65.a
		add_years_of_income = -2
		trigger = {
			NOT = {
				has_global_modifier_value = {
					which = global_spy_defence
					value = 0.2
				}
			}
		}
		4811 = {
			add_province_modifier = {
				name = xia_korashi_workshops
				duration = 18250
			}
		}
	}
	
	option = {						#Small operation - great spy defence version
		name = one_xia.65.b
		add_years_of_income = -0.5
		trigger = {
			has_global_modifier_value = {
				which = global_spy_defence
				value = 0.4
			}
		}
		4811 = {
			add_province_modifier = {
				name = xia_korashi_workshops
				duration = 27375
			}
		}
	}
	
	option = {						#Small operation - good spy defence version
		name = one_xia.65.b
		add_years_of_income = -0.5
		trigger = {
			NOT = {
				has_global_modifier_value = {
					which = global_spy_defence
					value = 0.4
				}
			}
			has_global_modifier_value = {
				which = global_spy_defence
				value = 0.2
			}
		}
		4811 = {
			add_province_modifier = {
				name = xia_korashi_workshops
				duration = 18250
			}
		}
	}
	
	option = {						#Small operation - no spy defence version
		name = one_xia.65.b
		add_years_of_income = -0.5
		trigger = {
			NOT = {
				has_global_modifier_value = {
					which = global_spy_defence
					value = 0.2
				}
			}
		}
		4811 = {
			add_province_modifier = {
				name = xia_korashi_workshops
				duration = 9125
			}
		}
	}
}

#The Trial of Balance
country_event = {
	id = one_xia.70
	title = one_xia.70.t
	desc = one_xia.70.d
	picture = BUDDHISM_MONASTERY_eventPicture
	
	is_triggered_only = yes
	
	option = {					#Let's Begin
		name = one_xia.70.a
		custom_tooltip = xia_trial_of_balance_begin_tooltip
		hidden_effect = {
			country_event = { id = one_xia.81 }
		}
	}
	
	option = {					#On second thought, I should attain nirvana first
		name = one_xia.70.b
		trigger = {
			has_country_flag = xia_still_ocean_training_unlocked
			NOT = { has_ruler_modifier = xia_tranquil_soul }
		}
		add_country_modifier = {
			name = xia_studying_still_ocean
			duration = -1
		}
		hidden_effect = {
			clr_country_flag = xia_in_trial_of_balance
		}
	}
}

#Trial of Balance First Round		#Enemy
country_event = {
	id = one_xia.71
	title = one_xia.71.t
	desc = one_xia.71.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#Attack
		name = one_xia.71.a
		custom_tooltip = xia_trial_of_balance_fire_metal_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = calm_personality
				ruler_has_personality = careful_personality
				ruler_has_personality = silver_tongue_personality
				ruler_has_personality = fierce_negotiator_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_metal_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
	
	option = {								#Wait and observe
		name = one_xia.71.b
		custom_tooltip = xia_trial_of_balance_water_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = bold_fighter_personality
				ruler_has_personality = silver_tongue_personality
				ruler_has_personality = fierce_negotiator_personality
				ruler_has_personality = naive_personality
			}
		}
		hidden_effect = {
			xia_water_increase = yes
			xia_earth_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
	
	option = {								#Negotiate
		name = one_xia.71.c
		custom_tooltip = xia_trial_of_balance_wood_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = bold_fighter_personality
				ruler_has_personality = naive_personality
				ruler_has_personality = malevolent_personality
			}
		}
		hidden_effect = {
			xia_wood_increase = yes
			xia_earth_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
}

#Trial of Balance First Round		#Neighbor
country_event = {
	id = one_xia.72
	title = one_xia.72.t
	desc = one_xia.72.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#Lend strength
		name = one_xia.72.a
		custom_tooltip = xia_trial_of_balance_fire_wood_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = malevolent_personality
				ruler_has_personality = craven_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_wood_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
	
	option = {								#Wish them luck
		name = one_xia.72.b
		custom_tooltip = xia_trial_of_balance_water_metal_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = kind_hearted_personality
				ruler_has_personality = benevolent_personality
			}
		}
		hidden_effect = {
			xia_metal_increase = yes
			xia_water_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
	
	option = {								#Help them plan
		name = one_xia.72.c
		custom_tooltip = xia_trial_of_balance_wood_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = malevolent_personality
				ruler_has_personality = babbling_buffoon_personality
			}
		}
		hidden_effect = {
			xia_wood_increase = yes
			xia_earth_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
}

#Trial of Balance First Round		#Criminal
country_event = {
	id = one_xia.73
	title = one_xia.73.t
	desc = one_xia.73.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#No time for this
		name = one_xia.73.a
		custom_tooltip = xia_trial_of_balance_fire_water_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = strict_personality
				ruler_has_personality = zealot_personality
				ruler_has_personality = cruel_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_water_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
	
	option = {								#Execute
		name = one_xia.73.b
		custom_tooltip = xia_trial_of_balance_fire_metal_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = kind_hearted_personality
				ruler_has_personality = tolerant_personality
				ruler_has_personality = calm_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_metal_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
	
	option = {								#Let them atone
		name = one_xia.73.c
		custom_tooltip = xia_trial_of_balance_wood_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = strict_personality
				ruler_has_personality = malevolent_personality
				ruler_has_personality = cruel_personality
			}
		}
		hidden_effect = {
			xia_wood_increase = yes
			xia_earth_increase = yes
			country_event = { id = one_xia.82 }
		}
	}
}

#Trial of Balance Second Round		#Deathbed
country_event = {
	id = one_xia.74
	title = one_xia.74.t
	desc = one_xia.74.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#Open mind
		name = one_xia.74.a
		custom_tooltip = xia_trial_of_balance_fire_water_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = kind_hearted_personality
				ruler_has_personality = strict_personality
				ruler_has_personality = zealot_personality
				ruler_has_personality = lawgiver_personality
				ruler_has_personality = obsessive_perfectionist_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_water_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
	
	option = {								#Stay true
		name = one_xia.74.b
		custom_tooltip = xia_trial_of_balance_metal_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = free_thinker_personality
				ruler_has_personality = kind_hearted_personality
				ruler_has_personality = scholar_personality
				ruler_has_personality = tolerant_personality
			}
		}
		hidden_effect = {
			xia_earth_increase = yes
			xia_metal_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
	
	option = {								#Be kind
		name = one_xia.74.c
		custom_tooltip = xia_trial_of_balance_wood_water_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = free_thinker_personality
				ruler_has_personality = strict_personality
				ruler_has_personality = cruel_personality
				ruler_has_personality = malevolent_personality
				ruler_has_personality = lawgiver_personality
			}
		}
		hidden_effect = {
			xia_wood_increase = yes
			xia_water_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
}

#Trial of Balance Second Round		#Flaw in technique
country_event = {
	id = one_xia.75
	title = one_xia.75.t
	desc = one_xia.75.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#Mistaken
		name = one_xia.75.a
		custom_tooltip = xia_trial_of_balance_fire_metal_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = calm_personality
				ruler_has_personality = naive_personality
				ruler_has_personality = pious_personality
				ruler_has_personality = craven_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_metal_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
	
	option = {								#Thanks
		name = one_xia.75.b
		custom_tooltip = xia_trial_of_balance_wood_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = bold_fighter_personality
				ruler_has_personality = malevolent_personality
			}
		}
		hidden_effect = {
			xia_earth_increase = yes
			xia_wood_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
	
	option = {								#Bow in shame
		name = one_xia.75.c
		custom_tooltip = xia_trial_of_balance_water_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = bold_fighter_personality
				ruler_has_personality = free_thinker_personality
				ruler_has_personality = malevolent_personality
			}
		}
		hidden_effect = {
			xia_earth_increase = yes
			xia_water_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
}

#Trial of Balance Second Round		#Counsel
country_event = {
	id = one_xia.76
	title = one_xia.76.t
	desc = one_xia.76.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#Eldest
		name = one_xia.76.a
		custom_tooltip = xia_trial_of_balance_wood_metal_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = well_advised_personality
				ruler_has_personality = free_thinker_personality
			}
		}
		hidden_effect = {
			xia_wood_increase = yes
			xia_metal_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
	
	option = {								#Most trusted
		name = one_xia.76.b
		custom_tooltip = xia_trial_of_balance_water_metal_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = babbling_buffoon_personality
				ruler_has_personality = pious_personality
			}
		}
		hidden_effect = {
			xia_water_increase = yes
			xia_metal_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
	
	option = {								#Fuckin everyone
		name = one_xia.76.c
		custom_tooltip = xia_trial_of_balance_fire_earth_tooltip
		trigger = {
			NOT = {
				ruler_has_personality = calm_personality
				ruler_has_personality = careful_personality
				ruler_has_personality = pious_personality
				ruler_has_personality = well_advised_personality
			}
		}
		hidden_effect = {
			xia_fire_increase = yes
			xia_earth_increase = yes
			country_event = { id = one_xia.77 }
		}
	}
}

#Trial of Balance Final Round		#Spirit Animal
country_event = {
	id = one_xia.77
	title = one_xia.77.t
	desc = one_xia.77.da
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	option = {								#Dragon
		name = one_xia.77.a
		custom_tooltip = xia_trial_of_balance_wood_tooltip
		hidden_effect = {
			xia_wood_increase = yes
			country_event = { id = one_xia.78 }
		}
	}
	
	option = {								#Eagle
		name = one_xia.77.b
		custom_tooltip = xia_trial_of_balance_fire_tooltip
		hidden_effect = {
			xia_fire_increase = yes
			country_event = { id = one_xia.78 }
		}
	}
	
	option = {								#Human
		name = one_xia.77.c
		custom_tooltip = xia_trial_of_balance_earth_tooltip
		hidden_effect = {
			xia_earth_increase = yes
			country_event = { id = one_xia.78 }
		}
	}
	
	option = {								#Lion
		name = one_xia.77.d
		custom_tooltip = xia_trial_of_balance_metal_tooltip
		hidden_effect = {
			xia_metal_increase = yes
			country_event = { id = one_xia.78 }
		}
	}
	
	option = {								#Turtle
		name = one_xia.77.e
		custom_tooltip = xia_trial_of_balance_water_tooltip
		hidden_effect = {
			xia_water_increase = yes
			country_event = { id = one_xia.78 }
		}
	}
}

#Trial of Balance Hidden Success Determination
country_event = {
	id = one_xia.78
	title = one_xia.78.t
	desc = one_xia.78.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	
	hidden = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					has_country_flag = xia_too_much_fire
				}
				clr_country_flag = xia_too_much_fire
				set_country_flag = xia_two_fire
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					has_country_flag = xia_too_much_water
				}
				clr_country_flag = xia_too_much_water
				set_country_flag = xia_two_water
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					has_country_flag = xia_too_much_metal
				}
				clr_country_flag = xia_too_much_metal
				set_country_flag = xia_two_metal
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					has_country_flag = xia_too_much_earth
				}
				clr_country_flag = xia_too_much_earth
				set_country_flag = xia_two_earth
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					has_country_flag = xia_too_much_wood
				}
				clr_country_flag = xia_too_much_wood
				set_country_flag = xia_two_wood
			}
			if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					NOT = {
						OR = {
							has_country_flag = xia_affinity_fire
							has_country_flag = xia_two_fire
						}
					}
				}
				set_country_flag = xia_affinity_fire
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					NOT = {
						OR = {
							has_country_flag = xia_affinity_water
							has_country_flag = xia_two_water
						}
					}
				}
				set_country_flag = xia_affinity_water
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					NOT = {
						OR = {
							has_country_flag = xia_affinity_wood
							has_country_flag = xia_two_wood
						}
					}
				}
				set_country_flag = xia_affinity_wood
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					NOT = {
						OR = {
							has_country_flag = xia_affinity_earth
							has_country_flag = xia_two_earth
						}
					}
				}
				set_country_flag = xia_affinity_earth
			}
			else_if = {
				limit = {
					has_ruler_modifier = xia_tranquil_soul
					NOT = {
						OR = {
							has_country_flag = xia_affinity_metal
							has_country_flag = xia_two_metal
						}
					}
				}
				set_country_flag = xia_affinity_metal
			}
		}
	}

	option = {
		name = one_xia.78.a
		if = {
			limit = {
				NOT = {
					OR = {
						has_country_flag = xia_too_much_fire
						has_country_flag = xia_too_much_water
						has_country_flag = xia_too_much_metal
						has_country_flag = xia_too_much_earth
						has_country_flag = xia_too_much_wood
					}
				}
				OR = {
					has_country_flag = xia_affinity_fire
					has_country_flag = xia_two_fire
				}
				OR = {
					has_country_flag = xia_affinity_wood
					has_country_flag = xia_two_wood
				}
				OR = {
					has_country_flag = xia_affinity_earth
					has_country_flag = xia_two_earth
				}
				OR = {
					has_country_flag = xia_affinity_metal
					has_country_flag = xia_two_metal
				}
				OR = {
					has_country_flag = xia_affinity_water
					has_country_flag = xia_two_water
				}
			}
			country_event = { id = one_xia.79 }				#Success event
		}
		else = {
			country_event = { id = one_xia.80 }				#Failure event
		}
	}
}

#Trial of Balance Success
country_event = {
	id = one_xia.79
	title = one_xia.79.t
	desc = one_xia.79.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = one_xia.79.a
		add_ruler_modifier = { 
			name = xia_wielding_kongren
			duration = -1
		}
		add_ruler_modifier = { 
			name = xia_balanced_ruler
			duration = -1
		}
		unlock_merc_company = {
			merc_company = merc_order_of_keepers
			free_merc = yes
		}
		hidden_effect = {
			clr_country_flag = xia_affinity_fire
			clr_country_flag = xia_affinity_water
			clr_country_flag = xia_affinity_wood
			clr_country_flag = xia_affinity_earth
			clr_country_flag = xia_affinity_metal
			clr_country_flag = xia_two_fire
			clr_country_flag = xia_two_water
			clr_country_flag = xia_two_wood
			clr_country_flag = xia_two_earth
			clr_country_flag = xia_two_metal
			clr_country_flag = xia_too_much_fire
			clr_country_flag = xia_too_much_water
			clr_country_flag = xia_too_much_wood
			clr_country_flag = xia_too_much_earth
			clr_country_flag = xia_too_much_metal
			clr_country_flag = xia_in_trial_of_balance
		}
	}
}

#Trial of Balance Failure
country_event = {
	id = one_xia.80
	title = one_xia.80.t
	desc = one_xia.80.d
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = one_xia.80.a
		add_ruler_modifier = { 
			name = xia_failed_trial_of_balance
			duration = -1
		}
		hidden_effect = {
			clr_country_flag = xia_affinity_fire
			clr_country_flag = xia_affinity_water
			clr_country_flag = xia_affinity_wood
			clr_country_flag = xia_affinity_earth
			clr_country_flag = xia_affinity_metal
			clr_country_flag = xia_two_fire
			clr_country_flag = xia_two_water
			clr_country_flag = xia_two_wood
			clr_country_flag = xia_two_earth
			clr_country_flag = xia_two_metal
			clr_country_flag = xia_too_much_fire
			clr_country_flag = xia_too_much_water
			clr_country_flag = xia_too_much_wood
			clr_country_flag = xia_too_much_earth
			clr_country_flag = xia_too_much_metal
			clr_country_flag = xia_in_trial_of_balance
		}
	}
	
	option = {					#fuck balance give me the sword nerds
		name = one_xia.80.b
		add_mil_power = -100
		custom_tooltip = xia_end_the_keepers_tooltip
		add_country_modifier = {
			name = xia_ended_the_keepers
			duration = -1
		}
		clr_country_flag = xia_rejected_balance
		4811 = {
			add_base_tax = -3
			add_base_production = -3
			add_base_manpower = -5
			add_devastation = 75
			add_nationalism = 50
		}
		hidden_effect = {
			clr_country_flag = xia_affinity_fire
			clr_country_flag = xia_affinity_water
			clr_country_flag = xia_affinity_wood
			clr_country_flag = xia_affinity_earth
			clr_country_flag = xia_affinity_metal
			clr_country_flag = xia_two_fire
			clr_country_flag = xia_two_water
			clr_country_flag = xia_two_wood
			clr_country_flag = xia_two_earth
			clr_country_flag = xia_two_metal
			clr_country_flag = xia_too_much_fire
			clr_country_flag = xia_too_much_water
			clr_country_flag = xia_too_much_wood
			clr_country_flag = xia_too_much_earth
			clr_country_flag = xia_too_much_metal
			clr_country_flag = xia_in_trial_of_balance
		}
	}
}

# Trial of Balance RNG Fix Event #1
# Instead of using random_list for RNG, rely on options 
country_event = {

	id = one_xia.81
	title = one_xia.81.t
	desc = one_xia.81.d
	picture = MIRACLE_MONK_eventPicture
	
	hidden = yes

	is_triggered_only = yes

	option = {
		name = one_xia.81.a
		ai_chance = { factor = 33 }
		country_event = { id = one_xia.71 }
	}

	option = {
		name = one_xia.81.b
		ai_chance = { factor = 33 }
		country_event = { id = one_xia.72 }
	}

	option = {
		name = one_xia.81.c
		ai_chance = { factor = 33 }
		country_event = { id = one_xia.73 }
	}

}

# Trial of Balance RNG Fix Event #2
# Instead of using random_list for RNG, rely on options 
country_event = {

	id = one_xia.82
	title = one_xia.82.t
	desc = one_xia.82.d
	picture = MIRACLE_MONK_eventPicture
	
	hidden = yes

	is_triggered_only = yes

	option = {
		name = one_xia.82.a
		ai_chance = { factor = 33 }
		country_event = { id = one_xia.74 }
	}

	option = {
		name = one_xia.82.b
		ai_chance = { factor = 33 }
		country_event = { id = one_xia.75 }
	}

	option = {
		name = one_xia.82.c
		ai_chance = { factor = 33 }
		country_event = { id = one_xia.76 }
	}

}
#Convert new vassals into xiaken
#Moved from on_dependency_gained to prevent crashes
country_event = {
	id = one_xia.3000
	title = one_xia.3000.t
	desc = one_xia.3000.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	option = {
		name = one_xia.3000.a
		ai_chance = { factor = 100 }
		
		overlord = { create_subject = { subject_type = daimyo_xiaken_vassal subject = ROOT } }
		
		# xiaken reform is locked to righteous path
		if = { 
			limit = { NOT = { religion = righteous_path } }
			change_religion = righteous_path
			capital_scope = { change_religion = righteous_path }
			add_opinion = { who = overlord modifier = opinion_forceful_conversion }
			#force_converted = yes
		}
		# if not righteous path, convert country (and capital province) and give force converted malus
		
		if = {
			limit = { NOT = { government = theocracy } }
			change_government = theocracy
		}
		add_government_reform = xiaken
		# now set to theocracy, then to xiaken reform

	}
}

