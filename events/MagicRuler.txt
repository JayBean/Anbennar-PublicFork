
namespace = magic_ruler

#Magic Menu
country_event = {
	id = magic_ruler.0
	title = magic_ruler.0.t	#Have this title mention the target
	picture = MAGIC_MENU_eventPicture
	desc = magic_ruler.0.d

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = { limit = { ai = no }
				set_variable = { which = ruler_study_experience_ratio which = ruler_study_experience }
				divide_variable = { which = ruler_study_experience_ratio which = ruler_study_experience_target }
				ruler_clear_saved_spell_schools = yes
				ruler_save_spell_schools = yes
			}
		}
	}

	option = {
		name = magic_ruler.0.a
		ai_chance = {
			factor = 50
		}
		close_single_menu = yes
	}


	option = {
		name = magic_ruler.0.b
		#trigger = { has_ruler_flag = abjuration_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = abjuration_1 }
			}
			modifier = {
				factor = 2
				is_at_war = yes
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.1 } }
	}
	option = {
		name = magic_ruler.0.c
		#trigger = { has_ruler_flag = conjuration_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = conjuration_1 }
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.2 } }
	}
	option = {
		name = magic_ruler.0.dd
		#trigger = { has_ruler_flag = divination_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = divination_1 }
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.3 } }
	}
	option = {
		name = magic_ruler.0.e
		#trigger = { has_ruler_flag = enchantment_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = enchantment_1 }
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.4 } }
	}
	option = {
		name = magic_ruler.0.f
		#trigger = { has_ruler_flag = evocation_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = evocation_1 }
			}
			modifier = {
				factor = 2
				is_at_war = yes
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.5 } }
	}
	option = {
		name = magic_ruler.0.g
		#trigger = { has_ruler_flag = illusion_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = illusion_1 }
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.6 } }
	}
	option = {
		name = magic_ruler.0.h
		#trigger = { has_ruler_flag = necromancy_1 }
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = necromancy_1 }
			}
			modifier = {
				factor = 2
				is_at_war = yes
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.7 } }
	}
	option = {
		name = magic_ruler.0.i
		#trigger = { has_ruler_flag = transmutation_1 }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_ruler_flag = transmutation_1 }
			}
			modifier = {
				factor = 4	#makes em pick this for the rite of conception
				has_ruler_flag = transmutation_2
				has_heir = no
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.8 } }
	}

	option = {
		name = magic_ruler.0.a
		ai_chance = {
			factor = 0
		}
		close_single_menu = yes
	}
}

#Abjuration - Menu
country_event = {
	id = magic_ruler.1
	title = magic_ruler.1.t
	desc = magic_ruler.1.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			count_provinces_in_capital_area = {
				which = amount_of_capital_area_provinces
			}
		}
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = abjuration_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = abjuration_1
					has_ruler_flag = abjuration_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.1 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_abjuration
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_abjuration }
			OR = {
				has_ruler_flag = abjuration_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = abjuration_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Ward
	option = {	#available
		name = magic_ruler.1.b
		trigger = {
			has_ruler_flag = abjuration_1
			NOT = { has_ruler_flag = abjuration_2 }
			adm_power = 30
			dip_power = 5
			NOT = { has_ruler_modifier = magic_ward_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				is_at_war = yes
				NOT = { war_score = 20 }
			}
		}

		add_adm_power = -30
		add_dip_power = -5

		country_event = { id = magic_ruler.10 }
		custom_tooltip = magic_selected_province_tt
		tooltip = {
			add_province_modifier = {
				name = magic_realm_abjuration_ward
				duration = 9131
			}
		}

		custom_tooltip = magic_ward_desc_tt
	}
	option = {	#unavailable - too low mastery
		name = magic_ruler.1.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = abjuration_2 }
			NOT = { has_ruler_flag = abjuration_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
			custom_tooltip = magic_selected_province_tt
			add_province_modifier = {
				name = magic_realm_abjuration_ward
				duration = 9131
			}
		}
		custom_tooltip = magic_ward_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.1.bx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = abjuration_2 }
			has_ruler_flag = abjuration_1
			OR = {
				NOT = { adm_power = 30 }
				NOT = { dip_power = 5 }
				has_ruler_modifier = magic_ward_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_ward_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 30 } }
			custom_tooltip = magic_need_30_adm_tt
		}
		if = { limit = { NOT = { dip_power = 5 } }
			custom_tooltip = magic_need_5_dip_tt
		}
		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
			custom_tooltip = magic_selected_province_tt
			add_province_modifier = {
				name = magic_realm_abjuration_ward
				duration = 9131
			}
		}
		custom_tooltip = magic_ward_desc_tt
	}

	#2 - Ward II
	option = {	#available
		name = magic_ruler.1.c
		trigger = {
			has_ruler_flag = abjuration_2
			adm_power = 30
			dip_power = 5
			NOT = { has_ruler_modifier = magic_ward_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				is_at_war = yes
				NOT = { war_score = 20 }
			}
		}

		add_adm_power = -30
		add_dip_power = -5
		country_event = { id = magic_ruler.10 }
		custom_tooltip = magic_selected_province_tt
		tooltip = {
			add_province_modifier = {
				name = magic_realm_abjuration_empowered_ward
				duration = 9131
			}
		}

		custom_tooltip = magic_ward_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.1.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = abjuration_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
			custom_tooltip = magic_selected_province_tt
			add_province_modifier = {
				name = magic_realm_abjuration_empowered_ward
				duration = 9131
			}
		}
		custom_tooltip = magic_ward_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.1.cx
		trigger = {
			ai = no
			has_ruler_flag = abjuration_2
			OR = {
				NOT = { adm_power = 30 }
				NOT = { dip_power = 5 }
				has_ruler_modifier = magic_ward_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_ward_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 30 } }
			custom_tooltip = magic_need_30_adm_tt
		}

		if = { limit = { NOT = { dip_power = 5 } }
			custom_tooltip = magic_need_5_dip_tt
		}

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
			custom_tooltip = magic_selected_province_tt
			add_province_modifier = {
				name = magic_realm_abjuration_empowered_ward
				duration = 9131
			}
		}
		custom_tooltip = magic_ward_desc_tt
	}

	#3 - Field of Freedom
	option = {	#available
		name = magic_ruler.1.dd
		trigger = {
			has_ruler_flag = abjuration_3
			NOT = {
				any_owned_province = {
					OR = {
						has_province_modifier = magic_realm_abjuration_field_of_freedom
						has_province_modifier = magic_realm_abjuration_field_of_forbiddance
						has_province_modifier = magic_realm_abjuration_field_of_fortification
					}
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 5
				is_at_war = yes
				NOT = { war_score = 40 }
			}
		}

		hidden_effect = {
			every_owned_province = {
				limit = { is_in_capital_area = yes }
				add_province_modifier = {
					name = magic_realm_abjuration_field_of_freedom
					duration = 1825
				}
			}
		}
		magic_field_adm_cost = yes
		magic_casted_spell = yes
		hidden_effect = {
			every_owned_province = {
				limit = { is_in_capital_area = yes }
				add_province_modifier = {
					name = magic_realm_abjuration_field_of_freedom
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_field_effect_tt
		tooltip = {
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_freedom
				duration = 1825
			}
		}

		set_country_flag = abjuration_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_field_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.1.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = abjuration_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_field_adm_cost = yes
			custom_tooltip = magic_field_effect_tt
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_freedom
				duration = 1825
			}
		}
		custom_tooltip = magic_field_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.1.ddx
		trigger = {
			ai = no
			has_ruler_flag = abjuration_3
			any_owned_province = {
				OR = {
					has_province_modifier = magic_realm_abjuration_field_of_freedom
					has_province_modifier = magic_realm_abjuration_field_of_forbiddance
					has_province_modifier = magic_realm_abjuration_field_of_fortification
				}
			}
		}
		custom_tooltip = province_has_abjuration_field_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_field_adm_cost = yes
			custom_tooltip = magic_field_effect_tt
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_freedom
				duration = 1825
			}
		}
		custom_tooltip = magic_field_desc_tt
	}

	#3 - Field of Forbiddance
	option = {	#available
		name = magic_ruler.1.e
		trigger = {
			has_ruler_flag = abjuration_3
			NOT = {
				any_owned_province = {
					OR = {
						has_province_modifier = magic_realm_abjuration_field_of_freedom
						has_province_modifier = magic_realm_abjuration_field_of_forbiddance
						has_province_modifier = magic_realm_abjuration_field_of_fortification
					}
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 5
				is_at_war = yes
				NOT = { war_score = 40 }
			}
		}

		magic_field_adm_cost = yes
		magic_casted_spell = yes
		hidden_effect = {
			every_owned_province = {
				limit = { is_in_capital_area = yes controlled_by = ROOT }
				# don't apply the effect if you don't control it or it gives you negative movement speed
				add_province_modifier = {
					name = magic_realm_abjuration_field_of_forbiddance
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_field_effect_tt
		tooltip = {
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_forbiddance
				duration = 1825
			}
		}

		set_country_flag = abjuration_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_field_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.1.em
		trigger = {
			ai = no
			NOT = { has_ruler_flag = abjuration_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_field_adm_cost = yes
			custom_tooltip = magic_field_effect_tt
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_forbiddance
				duration = 1825
			}
		}
		custom_tooltip = magic_field_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.1.ex
		trigger = {
			ai = no
			has_ruler_flag = abjuration_3
			any_owned_province = {
				OR = {
					has_province_modifier = magic_realm_abjuration_field_of_freedom
					has_province_modifier = magic_realm_abjuration_field_of_forbiddance
					has_province_modifier = magic_realm_abjuration_field_of_fortification
				}
			}
		}
		custom_tooltip = province_has_abjuration_field_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_field_adm_cost = yes
			custom_tooltip = magic_field_effect_tt
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_forbiddance
				duration = 1825
			}
		}
		custom_tooltip = magic_field_desc_tt
	}

	#3 - Field of Fortification
	option = {	#available
		name = magic_ruler.1.f
		trigger = {
			has_ruler_flag = abjuration_3
			NOT = {
				any_owned_province = {
					OR = {
						has_province_modifier = magic_realm_abjuration_field_of_freedom
						has_province_modifier = magic_realm_abjuration_field_of_forbiddance
						has_province_modifier = magic_realm_abjuration_field_of_fortification
					}
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 5
				is_at_war = yes
				NOT = { war_score = 40 }
			}
		}

		hidden_effect = {
			every_owned_province = {
				limit = { is_in_capital_area = yes }
				add_province_modifier = {
					name = magic_realm_abjuration_field_of_fortification
					duration = 1825
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 1
						length = 1825
					}
				}
			}
		}

		magic_field_adm_cost = yes
		magic_casted_spell = yes
		hidden_effect = {
			every_owned_province = {
				limit = { is_in_capital_area = yes }
				add_province_modifier = {
					name = magic_realm_abjuration_field_of_fortification
					duration = 1825
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 1
						length = 1825
					}
				}
			}
		}
		custom_tooltip = magic_field_effect_tt
		tooltip = {
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_fortification
				duration = 1825
			}
		}

		set_country_flag = abjuration_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_field_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.1.fm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = abjuration_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_field_adm_cost = yes
			custom_tooltip = magic_field_effect_tt
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_fortification
				duration = 1825
			}
		}
		custom_tooltip = magic_field_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.1.fx
		trigger = {
			ai = no
			has_ruler_flag = abjuration_3
			any_owned_province = {
				OR = {
					has_province_modifier = magic_realm_abjuration_field_of_freedom
					has_province_modifier = magic_realm_abjuration_field_of_forbiddance
					has_province_modifier = magic_realm_abjuration_field_of_fortification
				}
			}
		}
		custom_tooltip = province_has_abjuration_field_tt

		set_country_flag = abjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_field_adm_cost = yes
			custom_tooltip = magic_field_effect_tt
			add_province_modifier = {
				name = magic_realm_abjuration_field_of_fortification
				duration = 1825
			}
		}
		custom_tooltip = magic_field_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Conjuration - Menu
country_event = {
	id = magic_ruler.2
	title = magic_ruler.2.t
	desc = magic_ruler.2.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = conjuration_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = conjuration_1
					has_ruler_flag = conjuration_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.4 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_conjuration
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_conjuration }
			OR = {
				has_ruler_flag = conjuration_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = conjuration_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Host Magnificent Feast I
	option = {	#available
		name = magic_ruler.2.b
		trigger = {
			has_ruler_flag = conjuration_1
			dip_power = 15
			NOT = { has_ruler_flag = conjuration_2 }
			NOT = { has_ruler_modifier = magic_feast_cooldown }
			any_ally = { exists = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
			modifier = {
				factor = 2
				NOT = { prestige = 20 }
			}
		}

		add_dip_power = -15
		country_event = { id = magic_ruler.11 }

		custom_tooltip = magic_feast_effect_tt

		custom_tooltip = magic_feast_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.2.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = conjuration_2 }
			NOT = { has_ruler_flag = conjuration_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = { add_dip_power = -15 }
		custom_tooltip = magic_feast_effect_tt
		custom_tooltip = magic_feast_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.2.bx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = conjuration_2 }
			has_ruler_flag = conjuration_1
			OR = {
				NOT = { any_ally = { exists = yes } }
				NOT = { dip_power = 15 }
				has_ruler_modifier = magic_feast_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_feast_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { any_ally = { exists = yes } } }
			custom_tooltip = magic_need_an_ally_tt
		}
		if = { limit = { NOT = { dip_power = 15 } }
			custom_tooltip = magic_need_15_dip_tt
		}

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = { add_dip_power = -15 }
		custom_tooltip = magic_feast_effect_tt
		custom_tooltip = magic_feast_desc_tt
	}

	#1 - Summon Siege Elemental
	option = {
		name = magic_ruler.2.c	#available
		trigger = {
			has_ruler_flag = conjuration_1
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					NOT = { adm_power = 20 }
					NOT = { dip_power = 20 }
					NOT = { mil_power = 20 }
				}
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.2 }
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			add_province_modifier = {
				name = siege_magic_elemental_besieger
				duration = 84
			}
		}
		custom_tooltip = magic_elemental_desc_tt
	}
	option = {
		name = magic_ruler.2.cm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = conjuration_1 }
		}
		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_talented_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			add_province_modifier = {
				name = siege_magic_elemental_besieger
				duration = 84
			}
		}
		custom_tooltip = magic_elemental_desc_tt
	}
	option = {
		name = magic_ruler.2.cx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = conjuration_1
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			add_province_modifier = {
				name = siege_magic_elemental_besieger
				duration = 84
			}
		}
		custom_tooltip = magic_elemental_desc_tt
	}

	#2 - Host Magnificent Feast II
	option = {	#available
		name = magic_ruler.2.dd
		trigger = {
			has_ruler_flag = conjuration_2
			dip_power = 15
			NOT = { has_ruler_modifier = magic_feast_cooldown }
			any_ally = { exists = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
			modifier = {
				factor = 2
				NOT = { prestige = 20 }
			}
		}

		add_dip_power = -15
		country_event = { id = magic_ruler.11 }
		custom_tooltip = magic_greater_feast_effect_tt
		custom_tooltip = magic_feast_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.2.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = conjuration_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = { add_dip_power = -15 }
		custom_tooltip = magic_greater_feast_effect_tt
		custom_tooltip = magic_feast_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.2.ddx
		trigger = {
			ai = no
			has_ruler_flag = conjuration_2
			OR = {
				NOT = { dip_power = 15 }
				NOT = { any_ally = { exists = yes } }
				has_ruler_modifier = magic_feast_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_feast_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { any_ally = { exists = yes } } }
			custom_tooltip = magic_need_an_ally_tt
		}
		if = { limit = { NOT = { dip_power = 15 } }
			custom_tooltip = magic_need_15_dip_tt
		}

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = { add_dip_power = -15 }
		custom_tooltip = magic_greater_feast_effect_tt
		custom_tooltip = magic_feast_desc_tt
	}

	#2 - Thunderstorm
	option = {
		name = magic_ruler.2.e	#available
		trigger = {
			has_ruler_flag = conjuration_2
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					NOT = { adm_power = 20 }
					NOT = { dip_power = 20 }
					NOT = { mil_power = 20 }
				}
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.17 }
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 5
			add_devastation = 5
			add_province_modifier = {
				name = siege_magic_thunderstorm
				duration = 182
			}
		}
		custom_tooltip = magic_thunderstorm_desc_tt
	}
	option = {
		name = magic_ruler.2.em	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = conjuration_2 }
		}
		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_renowned_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 5
			add_devastation = 5
			add_province_modifier = {
				name = siege_magic_thunderstorm
				duration = 182
			}
		}
		custom_tooltip = magic_thunderstorm_desc_tt
	}
	option = {
		name = magic_ruler.2.ex	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = conjuration_2
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 5
			add_devastation = 5
			add_province_modifier = {
				name = siege_magic_thunderstorm
				duration = 182
			}
		}
		custom_tooltip = magic_thunderstorm_desc_tt
	}

	#3 - Conjure Magical Fortress
	option = {	#available
		name = magic_ruler.2.f
		trigger = {
			OR = {
				has_ruler_flag = conjuration_3
				AND = {
					has_ruler_flag = conjuration_2
					has_ruler_flag = ancestor_spirit_patron
				}
			}
			adm_power = 100
			dip_power = 100
			mil_power = 100
			NOT = { has_ruler_modifier = magic_fortress_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				is_at_war = yes
				NOT = { war_score = 20 }
			}
			modifier = {
				factor = 4
				OR = {
					personality = ai_militarist
					personality = ai_capitalist
				}
			}
		}

		add_adm_power = -100
		add_dip_power = -100
		add_mil_power = -100
		country_event = { id = magic_ruler.12 }
		custom_tooltip = magic_fortress_effect_tt
		custom_tooltip = magic_fortress_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.2.fm
		trigger = {
			ai = no
			NOT = {
				OR = {
					has_ruler_flag = conjuration_3
					AND = {
						has_ruler_flag = conjuration_2
						has_ruler_flag = ancestor_spirit_patron
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -100
			add_dip_power = -100
			add_mil_power = -100
		}
		custom_tooltip = magic_selected_province_tt
		custom_tooltip = magic_fortress_effect_tt
		custom_tooltip = magic_fortress_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.2.fx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = conjuration_3
				AND = {
					has_ruler_flag = conjuration_2
					has_ruler_flag = ancestor_spirit_patron
				}
			}
			OR = {
				NOT = { adm_power = 100 }
				NOT = { dip_power = 100 }
				NOT = { mil_power = 100 }
				NOT = { dip_power = 15 }
				has_ruler_modifier = magic_fortress_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_fortress_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 100 } }
			custom_tooltip = magic_need_100_adm_tt
		}
		if = { limit = { NOT = { dip_power = 100 } }
			custom_tooltip = magic_need_100_dip_tt
		}
		if = { limit = { NOT = { mil_power = 100 } }
			custom_tooltip = magic_need_100_mil_tt
		}

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -100
			add_dip_power = -100
			add_mil_power = -100
		}
		custom_tooltip = magic_selected_province_tt
		custom_tooltip = magic_fortress_effect_tt
		custom_tooltip = magic_fortress_desc_tt
	}

	#3 - Summoning Magic Project
	option = {	#available
		name = magic_ruler.2.g
		trigger = {
			capital_scope = { continent = asia }
			OR = {
				has_ruler_flag = conjuration_3
				AND = {
					has_ruler_flag = divination_2
					has_ruler_flag = conjuration_2
				}
			}
			NOT = { has_ruler_flag = magic_project_summoning_complete }
			NOT = { magical_project_in_progress = yes }
			adm_power = 50
			dip_power = 50
			mil_power = 50
		}
		ai_chance = {
			factor = 50
		}

		add_adm_power = -50
		add_dip_power = -50
		add_mil_power = -50
		magic_casted_spell = yes
		set_ruler_flag = magic_project_summoning_started
		custom_tooltip = tooltip_magic_project_start
		hidden_effect = { country_event = { id = magic_project_summoning.1 } }

		set_country_flag = conjuration_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_summoning_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.2.gm
		trigger = {
			ai = no
			capital_scope = { continent = asia }
			NOT = {
				OR = {
					has_ruler_flag = conjuration_3
					AND = {
						has_ruler_flag = divination_2
						has_ruler_flag = conjuration_2
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_enough_summoning_tt

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
			custom_tooltip = tooltip_magic_project_start
		}
		custom_tooltip = magic_summoning_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.2.gx
		trigger = {
			ai = no
			capital_scope = { continent = asia }
			OR = {
				has_ruler_flag = conjuration_3
				AND = {
					has_ruler_flag = divination_2
					has_ruler_flag = conjuration_2
				}
			}
			OR = {
				has_ruler_flag = magic_project_summoning_complete
				magical_project_in_progress = yes
				NOT = { adm_power = 50 }
				NOT = { dip_power = 50 }
				NOT = { mil_power = 50 }
			}
		}
		if = { limit = { has_ruler_flag = magic_project_summoning_complete }
			custom_tooltip = magic_project_already_done_tt
		}
		else = {
			if = { limit = { has_ruler_flag = magic_project_summoning_started }
				custom_tooltip = magic_project_started_tt
			}
			else_if = { limit = { magical_project_in_progress = yes }
				custom_tooltip = magic_other_project_in_progress_tt
			}
			if = { limit = { NOT = { adm_power = 50 } }
				custom_tooltip = magic_need_50_adm_tt
			}
			if = { limit = { NOT = { dip_power = 50 } }
				custom_tooltip = magic_need_50_dip_tt
			}
			if = { limit = { NOT = { mil_power = 50 } }
				custom_tooltip = magic_need_50_mil_tt
			}
		}

		set_country_flag = conjuration_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
			custom_tooltip = tooltip_magic_project_start
		}
		custom_tooltip = magic_summoning_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.0 } }
	}
}

#Divination - Menu
country_event = {
	id = magic_ruler.3
	title = magic_ruler.3.t
	desc = magic_ruler.3.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			count_provinces_owned_by_rivals_effect = { which = amount_of_rival_provinces }
			count_provinces_owned_by_neighbours_effect = { which = amount_of_neighbour_provinces }
			count_provinces_owned_by_country_effect = { which = amount_of_owned_provinces }
			count_provinces_owned_by_war_enemies_effect = { which = amount_of_war_enemy_provinces }
		}
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = divination_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = divination_1
					has_ruler_flag = divination_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.7 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_divination
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_divination }
			OR = {
				has_ruler_flag = divination_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = divination_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Scrying - Spy on Rivals
	option = {	#available
		name = magic_ruler.3.b
		trigger = {
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			adm_power = 25
			dip_power = 25
			any_rival_country  = { exists = yes }
			has_ruler_modifier = magic_realm_divination_scrying_rivals
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 4
				is_great_power = yes
			}
		}

		magic_casted_spell = yes
		magic_scrying_rivals_cost = yes
		if = {
			limit = { has_ruler_flag = ancestor_spirit_patron }
			add_country_modifier = {
				name = magic_realm_divination_scrying_rivals
				duration = 365
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {		# Tughayasa's tier 2 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_1
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_rivals
				duration = 225
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {		# Tughayasa's tier 3 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_2
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_rivals
				duration = 300
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = autumn_gloam_patron
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_rivals
				duration = 180
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else = {
			add_country_modifier = {
				name = magic_realm_divination_scrying_rivals
				duration = 180
			}
		}
		every_rival_country = { remove_fow = 6 }

		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.3.bm
		trigger = {
			ai = no
			AND = {
				NOT = { has_ruler_flag = divination_1 }
				has_ruler_flag = autumn_gloam_patron
			}
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_rivals_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 365
				}
				custom_tooltip = magic_booster_by_patron_tt
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 225
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 300
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 180
				}
			}
		}
		custom_tooltip = magic_scrying_rival_effect_tt

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.3.bx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			OR = {
				NOT = { adm_power = 25 }
				NOT = { dip_power = 25 }
				NOT = { any_rival_country  = { exists = yes } }
				has_ruler_modifier = magic_realm_divination_scrying_rivals
			}
		}
		if = { limit = { has_ruler_modifier = magic_realm_divination_scrying_rivals }
			custom_tooltip = magic_spell_already_active_tt
		}
		if = { limit = { NOT = { adm_power = 25 } }
			custom_tooltip = magic_need_25_adm_tt
		}
		if = { limit = { NOT = { dip_power = 25 } }
			custom_tooltip = magic_need_25_dip_tt
		}
		if = { limit = { NOT = { any_rival_country  = { exists = yes } } }
			custom_tooltip = magic_need_valid_target_tt
		}

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_rivals_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 365
				}
				custom_tooltip = magic_booster_by_patron_tt
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 225
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 300
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_rivals
					duration = 180
				}
			}
		}
		custom_tooltip = magic_scrying_rival_effect_tt

		custom_tooltip = magic_scrying_desc_tt
	}

	#1 - Scrying - Spy on Neighbours
	option = {	#available
		name = magic_ruler.3.c
		trigger = {
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			adm_power = 50
			any_country = { is_neighbor_of = ROOT }
			NOT = { has_ruler_modifier = magic_realm_divination_scrying_neighbours }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 4
				personality = ai_diplomat
			}
		}

		magic_casted_spell = yes
		magic_scrying_neighbours_cost = yes
		if = {
			limit = { has_ruler_flag = ancestor_spirit_patron }
			add_country_modifier = {
				name = magic_realm_divination_scrying_neighbours
				duration = 365
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {		# Tughayasa's tier 2 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_1
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_neighbours
				duration = 225
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {		# Tughayasa's tier 3 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_2
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_neighbours
				duration = 300
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = autumn_gloam_patron
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_neighbours
				duration = 180
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else = {
			add_country_modifier = {
				name = magic_realm_divination_scrying_neighbours
				duration = 180
			}
		}
		every_country = {
			limit = { is_neighbor_of  = ROOT }
			remove_fow = 6
		}

		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.3.cm
		trigger = {
			ai = no
			AND = {
				NOT = { has_ruler_flag = divination_1 }
				NOT = { has_ruler_flag = autumn_gloam_patron }
			}
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_neighbours_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 365
				}
				custom_tooltip = magic_booster_by_patron_tt
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 225
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 300
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 180
				}
			}
		}
		custom_tooltip = magic_scrying_neighbours_effect_tt

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.3.cx
		trigger = {
			ai = no
			OR = {	
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			OR = {
				NOT = { adm_power = 50 }
				NOT = { any_country = { is_neighbor_of = ROOT } }
				has_ruler_modifier = magic_realm_divination_scrying_neighbours
			}
		}
		if = { limit = { has_ruler_modifier = magic_realm_divination_scrying_neighbours }
			custom_tooltip = magic_spell_already_active_tt
		}
		if = { limit = { NOT = { adm_power = 50 } }
			custom_tooltip = magic_need_50_adm_tt
		}
		if = { limit = { NOT = { any_country = { is_neighbor_of = ROOT } } }
			custom_tooltip = magic_need_valid_target_tt
		}

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_neighbours_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 365
				}
				custom_tooltip = magic_booster_by_patron_tt
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 225
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 300
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_neighbours
					duration = 180
				}
			}
		}
		custom_tooltip = magic_scrying_neighbours_effect_tt

		custom_tooltip = magic_scrying_desc_tt
	}

	#1 - Scrying - Dissidents
	option = {	#available
		name = magic_ruler.3.dd
		trigger = {
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			adm_power = 50
			NOT = { has_ruler_modifier = magic_realm_divination_scrying_internal_dissidents }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 4
				average_unrest = 5
			}
			modifier = {
				factor = 4
				NOT = { stability = 1 }
			}
			modifier = {
				factor = 8
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		magic_casted_spell = yes
		magic_scrying_dissidents_cost = yes
		if = {
			limit = { has_ruler_flag = ancestor_spirit_patron }
			add_country_modifier = {
				name = magic_realm_divination_scrying_internal_dissidents
				duration = 2190
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {		# Tughayasa's tier 2 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_1
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_internal_dissidents
				duration = 1375
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {		# Tughayasa's tier 3 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_2
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_internal_dissidents
				duration = 1825
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = autumn_gloam_patron
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_internal_dissidents
				duration = 180
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else = {
			add_country_modifier = {
				name = magic_realm_divination_scrying_internal_dissidents
				duration = 1095
			}
		}

		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.3.ddm
		trigger = {
			ai = no
			AND = {
				NOT = { has_ruler_flag = divination_1 }
				NOT = { has_ruler_flag = autumn_gloam_patron }
			}
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_dissidents_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 2190
				}
				custom_tooltip = magic_booster_by_patron_tt
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 1375
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 1825
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 1095
				}
			}
		}

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.3.ddx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			OR = {
				NOT = { adm_power = 50 }
				has_ruler_modifier = magic_realm_divination_scrying_internal_dissidents
			}
		}
		if = { limit = { has_ruler_modifier = magic_realm_divination_scrying_internal_dissidents }
			custom_tooltip = magic_spell_already_active_tt
		}
		if = { limit = { NOT = { adm_power = 50 } }
			custom_tooltip = magic_need_50_adm_tt
		}

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_dissidents_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 2190
				}
				custom_tooltip = magic_booster_by_patron_tt
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 1375
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 1825
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_internal_dissidents
					duration = 1095
				}
			}
		}

		custom_tooltip = magic_scrying_desc_tt
	}

	#1 - Scrying - Realm affairs
	option = {	#available
		name = magic_ruler.3.e
		trigger = {
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			adm_power = 50
			NOT = { has_ruler_modifier = magic_realm_divination_scrying_affairs }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 8
				OR = {
					adm_power = 200
					dip_power = 200
					mil_power = 200
				}
			}
		}

		magic_casted_spell = yes
		magic_scrying_realm_cost = yes
		if = {
			limit = { has_ruler_flag = ancestor_spirit_patron }
			add_country_modifier = {
				name = magic_realm_divination_scrying_affairs
				duration = 2190
			}
		}
		else_if = {		# Tughayasa's tier 2 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_1
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_affairs
				duration = 1375
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {		# Tughayasa's tier 3 monument reward
			limit = {
				4527 = {
					owned_by = ROOT
					has_province_flag = tughayasa_better_divination_2
				}
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_affairs
				duration = 1825
			}
			custom_tooltip = tughayasa_divination_booster_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = autumn_gloam_patron
			}
			add_country_modifier = {
				name = magic_realm_divination_scrying_affairs
				duration = 180
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else = {
			add_country_modifier = {
				name = magic_realm_divination_scrying_affairs
				duration = 1095
			}
		}

		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.3.em
		trigger = {
			ai = no
			AND = {
				NOT = { has_ruler_flag = divination_1 }
				NOT = { has_ruler_flag = autumn_gloam_patron }
			}
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_realm_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 2190
				}
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 1375
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 1825
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 1095
				}
			}
		}

		custom_tooltip = magic_scrying_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.3.ex
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = divination_1
				has_ruler_flag = autumn_gloam_patron
			}
			OR = {
				NOT = { adm_power = 50 }
				has_ruler_modifier = magic_realm_divination_scrying_affairs
			}
		}
		if = { limit = { has_ruler_modifier = magic_realm_divination_scrying_affairs }
			custom_tooltip = magic_spell_already_active_tt
		}
		if = { limit = { NOT = { adm_power = 50 } }
			custom_tooltip = magic_need_50_adm_tt
		}

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			magic_scrying_realm_cost = yes
			if = {
				limit = { has_ruler_flag = ancestor_spirit_patron }
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 2190
				}
			}
			else_if = {		# Tughayasa's tier 2 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_1
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 1375
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {		# Tughayasa's tier 3 monument reward
				limit = {
					4527 = {
						owned_by = ROOT
						has_province_flag = tughayasa_better_divination_2
					}
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 1825
				}
				custom_tooltip = tughayasa_divination_booster_tt
			}
			else_if = {
				limit = {
					has_ruler_flag = autumn_gloam_patron
				}
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 180
				}
				custom_tooltip = magic_spell_available_by_patron_tt
			}
			else = {
				add_country_modifier = {
					name = magic_realm_divination_scrying_affairs
					duration = 1095
				}
			}
		}

		custom_tooltip = magic_scrying_desc_tt
	}

	#2 - Loreseeker
	option = {	#available
		name = magic_ruler.3.f
		trigger = {
			OR = {
				has_ruler_flag = divination_2
				AND = {
					has_ruler_flag = divination_1
					has_ruler_flag = baku_patron
				}
				AND = {
					has_ruler_flag = unthroned_patron
					has_ruler_flag = spring_old_patron
					has_ruler_flag = divination_1
				}
			}
			ruler_studying_magic = yes
			magic_legend_lore_cost_trigger = yes
			NOT = { has_ruler_modifier = magic_loreseeker_cooldown }
		}
		ai_chance = {
			factor = 50
		}
		magic_casted_spell = yes
		magic_legend_lore_effect = yes
		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_loreseeker_desc_tt
		if = {
			limit = {
				has_ruler_flag = baku_patron
				NOT = { has_ruler_flag = divination_1 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = unthroned_patron
				NOT = { has_ruler_flag = divination_1 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = spring_old_patron
				NOT = { has_ruler_flag = divination_1 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.3.fm
		trigger = {
			ai = no
			NOT = {
				OR = {
					has_ruler_flag = divination_2
					AND = {
						has_ruler_flag = divination_1
						has_ruler_flag = baku_patron
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = { magic_legend_lore_effect = yes }
		custom_tooltip = magic_loreseeker_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.3.fx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = divination_2
				AND = {
					has_ruler_flag = divination_1
					has_ruler_flag = baku_patron
				}
			}
			OR = {
				NOT = { ruler_studying_magic = yes }
				NOT = { magic_legend_lore_cost_trigger = yes }
				has_ruler_modifier = magic_loreseeker_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_loreseeker_cooldown }
			custom_tooltip = magic_1_year_cooldown_tt
		}
		magic_legend_lore_cost_tooltip = yes
		if = { limit = { NOT = { ruler_studying_magic = yes } }
			custom_tooltip = magic_ruler_studying_magic_tt
		}

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = { magic_legend_lore_effect = yes }
		custom_tooltip = magic_loreseeker_desc_tt
	}

	#3 - Foresight
	option = {	#available
		name = magic_ruler.3.g
		trigger = {
			OR = {
				has_ruler_flag = divination_3
				AND = {
					has_ruler_flag = divination_2
					has_ruler_flag = nang_patron
					has_ruler_flag = bladedancer_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			adm_power = 150
			dip_power = 150
			mil_power = 150
			NOT = { has_ruler_modifier = magic_realm_divination_foresight }
			NOT = { has_ruler_modifier = magic_realm_divination_foresight_madness }
			NOT = { has_ruler_modifier = magic_foresight_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				ruler_has_personality = careful_personality
			}
			modifier = {
				factor = 0.25
				is_long_lived_ruler = yes	#long-lived people dont care!
			}
			modifier = {
				factor = 0.5
				OR = {
					has_ruler_flag = foresight_spell_11
					has_ruler_flag = foresight_spell_12
					has_ruler_flag = foresight_spell_13
					has_ruler_flag = foresight_spell_14
					has_ruler_flag = foresight_spell_15
				}
			}
			modifier = {
				factor = 0.25
				OR = {
					has_ruler_flag = foresight_spell_16
					has_ruler_flag = foresight_spell_17
					has_ruler_flag = foresight_spell_18
					has_ruler_flag = foresight_spell_19
					has_ruler_flag = foresight_spell_20
				}
			}
			modifier = {
				factor = 1.5
				ruler_has_personality = naive_personality
			}
		}
		add_adm_power = -150
		add_dip_power = -150
		add_mil_power = -150
		magic_casted_spell = yes
		casted_foresight_spell_flag = yes
		apply_foresight_spell = yes
		if = {
			limit = {
				OR = {
					capital_scope = { superregion = rahen_superregion }
					capital_scope = { superregion = south_haless_superregion }
					capital_scope = { superregion = yanshen_superregion }
				}
				NOT = {
					has_country_flag = tughayasa_quest_foresight_casted
				}
			}
			set_country_flag = tughayasa_quest_foresight_casted
		}
		if = {
			limit = {
				has_ruler_flag = nang_patron
				has_ruler_flag = summer_waves_patron
				NOT = { has_ruler_flag = divination_3 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		add_ruler_modifier = { name = magic_foresight_cooldown duration = 30 hidden = yes }

		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_foresight_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.3.gm
		trigger = {
			ai = no
			NOT = {
				OR = {
					has_ruler_flag = divination_3
					AND = {
						has_ruler_flag = divination_2
						has_ruler_flag = nang_patron
						has_ruler_flag = bladedancer_patron
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			casted_foresight_spell_flag = yes
			apply_foresight_spell = yes
		}
		custom_tooltip = magic_foresight_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.3.gx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = divination_3
				AND = {
					has_ruler_flag = divination_2
					has_ruler_flag = nang_patron
					has_ruler_flag = bladedancer_patron
				}
			}
			OR = {
				NOT = { adm_power = 150 }
				NOT = { dip_power = 150 }
				NOT = { mil_power = 150 }
				has_ruler_modifier = magic_realm_divination_foresight
				has_ruler_modifier = magic_realm_divination_foresight_madness
				has_ruler_modifier = magic_foresight_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_foresight_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { dip_power = 150 } }
			custom_tooltip = magic_need_150_dip_tt
		}
		if = { limit = { NOT = { mil_power = 150 } }
			custom_tooltip = magic_need_150_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_divination_foresight }
			custom_tooltip = magic_spell_already_active_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_divination_foresight_madness }
			custom_tooltip = magic_foresight_madness_tt
		}
		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			casted_foresight_spell_flag = yes
			apply_foresight_spell = yes
		}
		custom_tooltip = magic_foresight_desc_tt
	}

	# 3 - Summoning Magic Project (copy from Conjuration)
	option = {	#available
		name = magic_ruler.2.g
		trigger = {
			capital_scope = { continent = asia }
			OR = {
				has_ruler_flag = divination_3
				AND = {
					has_ruler_flag = divination_2
					has_ruler_flag = conjuration_2
				}
			}
			NOT = { has_ruler_flag = magic_project_summoning_complete }
			NOT = { magical_project_in_progress = yes }
			adm_power = 50
			dip_power = 50
			mil_power = 50
		}
		ai_chance = {
			factor = 50
		}

		add_adm_power = -50
		add_dip_power = -50
		add_mil_power = -50
		magic_casted_spell = yes
		set_ruler_flag = magic_project_summoning_started
		custom_tooltip = tooltip_magic_project_start
		hidden_effect = { country_event = { id = magic_project_summoning.1 } }

		set_country_flag = divination_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_summoning_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.2.gm
		trigger = {
			ai = no
			capital_scope = { continent = asia }
			NOT = {
				OR = {
					has_ruler_flag = divination_3
					AND = {
						has_ruler_flag = divination_2
						has_ruler_flag = conjuration_2
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_enough_summoning_tt

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
			custom_tooltip = tooltip_magic_project_start
		}
		custom_tooltip = magic_summoning_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.2.gx
		trigger = {
			ai = no
			capital_scope = { continent = asia }
			OR = {
				has_ruler_flag = divination_3
				AND = {
					has_ruler_flag = divination_2
					has_ruler_flag = conjuration_2
				}
			}
			OR = {
				has_ruler_flag = magic_project_summoning_complete
				magical_project_in_progress = yes
				NOT = { adm_power = 50 }
				NOT = { dip_power = 50 }
				NOT = { mil_power = 50 }
			}
		}
		if = { limit = { has_ruler_flag = magic_project_summoning_complete }
			custom_tooltip = magic_project_already_done_tt
		}
		else = {
			if = { limit = { has_ruler_flag = magic_project_summoning_started }
				custom_tooltip = magic_project_started_tt
			}
			else_if = { limit = { magical_project_in_progress = yes }
				custom_tooltip = magic_other_project_in_progress_tt
			}
			if = { limit = { NOT = { adm_power = 50 } }
				custom_tooltip = magic_need_50_adm_tt
			}
			if = { limit = { NOT = { dip_power = 50 } }
				custom_tooltip = magic_need_50_dip_tt
			}
			if = { limit = { NOT = { mil_power = 50 } }
				custom_tooltip = magic_need_50_mil_tt
			}
		}

		set_country_flag = divination_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
			custom_tooltip = tooltip_magic_project_start
		}
		custom_tooltip = magic_summoning_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Enchantment - Menu
country_event = {
	id = magic_ruler.4
	title = magic_ruler.4.t
	desc = magic_ruler.4.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = enchantment_1
					has_ruler_flag = enchantment_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.10 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_enchantment
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_enchantment }
			OR = {
				has_ruler_flag = enchantment_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = enchantment_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Charm I - Estates
	option = {	#available
		name = magic_ruler.4.b
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_charm_estates_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					NOT = { estate_loyalty = { estate = estate_church loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nobles loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_burghers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nomadic_tribes loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_mages loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_adventurers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_artificers loyalty = 30 } }
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_charm_estates_cooldown duration = 3650 hidden = yes }
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
				loyalty = 6
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
				loyalty = 3
				duration = 5475
			}
		}
		else = {
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
				loyalty = 3
				duration = 3650
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 6
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.bx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_charm_estates_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_charm_estates_cooldown }
			custom_tooltip = magic_10_year_cooldown_tt
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 6
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_1
					loyalty = 3
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}

	#1 - Charm I - Diplomats
	option = {	#available
		name = magic_ruler.4.c
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.cx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}

	#1 - Charm I - Military
	option = {	#available
		name = magic_ruler.4.dd
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
			modifier = {
				factor = 3
				is_at_war = yes
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_1
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_1
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_1
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ddx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}

	#1 - Charm I - Subjects
	option = {	#available
		name = magic_ruler.4.e
		trigger = {
			has_ruler_flag = enchantment_1
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { num_of_subjects = 1 }
			}
			modifier = {
				factor = 5
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_1
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_1
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_1
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.em
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_flag = enchantment_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ex
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_1
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}

	#2 - Charm II - Estates
	option = {	#available
		name = magic_ruler.4.f
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_charm_estates_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					NOT = { estate_loyalty = { estate = estate_church loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nobles loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_burghers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nomadic_tribes loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_mages loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_adventurers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_artificers loyalty = 30 } }
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_charm_estates_cooldown duration = 3650 hidden = yes }
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
				loyalty = 12
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
				loyalty = 6
				duration = 5475
			}
		}
		else = {
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
				loyalty = 6
				duration = 3650
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.fm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 12
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.fx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_charm_estates_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_charm_estates_cooldown }
			custom_tooltip = magic_10_year_cooldown_tt
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 12
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_2
					loyalty = 6
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}

	#2 - Charm II - Diplomats
	option = {	#available
		name = magic_ruler.4.g
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.gm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.gx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}

	#2 - Charm II - Military
	option = {	#available
		name = magic_ruler.4.h
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
			modifier = {
				factor = 3
				is_at_war = yes
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_2
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_2
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_2
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.hm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.hx
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}

	#2 - Charm II - Subjects
	option = {	#available
		name = magic_ruler.4.i
		trigger = {
			has_ruler_flag = enchantment_2
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_flag = enchantment_3 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { num_of_subjects = 1 }
			}
			modifier = {
				factor = 5
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_2
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_2
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_2
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.im
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ix
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}

	#2 - Modify Memories - Overlook Blunder
	option = {	#available
		name = magic_ruler.4.j
		trigger = {
			has_ruler_flag = enchantment_2
			adm_power = 150
			mil_power = 80
			NOT = { has_ruler_modifier = magic_realm_enchantment_modify_memories_overlook_national_blunders }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				prestige = 1
				NOT = { prestige = 50 }

			}
		}

		add_adm_power = -150
		add_mil_power = -80
		magic_casted_spell = yes
		if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_overlook_national_blunders
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_overlook_national_blunders
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_memories_blunder_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.jm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_blunder_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.jx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { adm_power = 150 }
				NOT = { mil_power = 80 }
				has_ruler_modifier = magic_realm_enchantment_modify_memories_overlook_national_blunders
			}
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { mil_power = 80 } }
			custom_tooltip = magic_need_80_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_enchantment_modify_memories_overlook_national_blunders }
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_overlook_national_blunders
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_blunder_desc_tt
	}

	#2 - Modify Memories - Subservience
	option = {	#available
		name = magic_ruler.4.k
		trigger = {
			has_ruler_flag = enchantment_2
			adm_power = 150
			mil_power = 80
			NOT = { has_ruler_modifier = magic_realm_enchantment_modify_memories_encourage_subservience }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				prestige = 1
				NOT = { prestige = 50 }

			}
		}

		add_adm_power = -150
		add_mil_power = -80
		magic_casted_spell = yes
		if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_encourage_subservience
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_encourage_subservience
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_memories_subservience_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.km
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_subservience_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.kx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { adm_power = 150 }
				NOT = { mil_power = 80 }
				has_ruler_modifier = magic_realm_enchantment_modify_memories_encourage_subservience
			}
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { mil_power = 80 } }
			custom_tooltip = magic_need_80_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_enchantment_modify_memories_encourage_subservience }
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_encourage_subservience
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_subservience_desc_tt
	}

	#2 - Modify Memories - Atrocities
	option = {	#available
		name = magic_ruler.4.l
		trigger = {
			has_ruler_flag = enchantment_2
			adm_power = 150
			mil_power = 80
			NOT = { has_ruler_modifier = magic_realm_enchantment_modify_memories_forget_atrocities }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				prestige = 1
				NOT = { prestige = 50 }

			}
		}

		add_adm_power = -150
		add_mil_power = -80
		magic_casted_spell = yes
		if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_forget_atrocities
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_modify_memories_forget_atrocities
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_memories_atrocities_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.lm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_memories_atrocities_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.lx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_2
			OR = {
				NOT = { adm_power = 150 }
				NOT = { mil_power = 80 }
				has_ruler_modifier = magic_realm_enchantment_modify_memories_forget_atrocities
			}
		}
		if = { limit = { NOT = { adm_power = 150 } }
			custom_tooltip = magic_need_150_adm_tt
		}
		if = { limit = { NOT = { mil_power = 80 } }
			custom_tooltip = magic_need_80_mil_tt
		}
		if = { limit = { has_ruler_modifier = magic_realm_enchantment_modify_memories_forget_atrocities }
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -150
			add_mil_power = -80
			if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_modify_memories_forget_atrocities
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_memories_atrocities_desc_tt
	}

	#3 - Dominate to Surrender
	option = {
		name = magic_ruler.4.m	#available
		trigger = {
			has_ruler_flag = enchantment_3
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					NOT = { adm_power = 20 }
					NOT = { dip_power = 20 }
				}
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.5 }
		if = {
			limit = { has_ruler_flag = baku_patron }
			custom_tooltip = magic_booster_by_patron_tt
		}
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_controller = ROOT
		}
		custom_tooltip = magic_dominate_desc_tt
	}
	option = {
		name = magic_ruler.4.mm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_legendary_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_controller = ROOT
		}
		custom_tooltip = magic_dominate_desc_tt
	}
	option = {
		name = magic_ruler.4.mx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_controller = ROOT
		}
		custom_tooltip = magic_dominate_desc_tt
	}

	#3 - Charm III - Estates
	option = {	#available
		name = magic_ruler.4.n
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_charm_estates_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					NOT = { estate_loyalty = { estate = estate_church loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nobles loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_burghers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_nomadic_tribes loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_mages loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_adventurers loyalty = 30 } }
					NOT = { estate_loyalty = { estate = estate_artificers loyalty = 30 } }
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_charm_estates_cooldown duration = 3650 hidden = yes }
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
				loyalty = 20
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
				loyalty = 10
				duration = 5475
			}
		}
		else = {
			add_estate_loyalty_modifier = {
				estate = all
				desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
				loyalty = 10
				duration = 3650
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.nm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 20
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.nx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_charm_estates_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_charm_estates_cooldown }
			custom_tooltip = magic_10_year_cooldown_tt
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 20
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 5475
				}
			}
			else = {
				add_estate_loyalty_modifier = {
					estate = all
					desc = EST_VAL_REALM_MAGIC_SWAYING_THE_ESTATES_ENCHANTMENT_3
					loyalty = 10
					duration = 3650
				}
			}
		}
		custom_tooltip = magic_charm_estates_desc_tt
	}

	#3 - Charm III - Diplomats
	option = {	#available
		name = magic_ruler.4.o
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.om
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.ox
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
				has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_1
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_2
					has_ruler_modifier = magic_realm_enchantment_charm_impress_foreign_diplomats_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_impress_foreign_diplomats_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_diplomats_desc_tt
	}

	#3 - Charm III - Military
	option = {	#available
		name = magic_ruler.4.p
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
			modifier = {
				factor = 3
				is_at_war = yes
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_3
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_3
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_inspire_military_3
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.pm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
						has_ruler_flag = summer_waves_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.px
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
				has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_1
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_2
					has_ruler_modifier = magic_realm_enchantment_charm_inspire_military_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_inspire_military_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_military_desc_tt
	}

	#3 - Charm III - Subjects
	option = {	#available
		name = magic_ruler.4.q
		trigger = {
			has_ruler_flag = enchantment_3
			dip_power = 30
			mil_power = 10
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2 }
			NOT = { has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3 }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { num_of_subjects = 1 }
			}
			modifier = {
				factor = 5
				any_subject_country = {
					liberty_desire = 50
				}
			}
		}

		add_dip_power = -30
		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
					has_ruler_flag = summer_waves_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_3
				duration = 3650
			}
		}
		else_if = {
			limit = { has_country_flag = Y63_enchantment_upgrade }
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_3
				duration = 2736
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_enchantment_charm_assuage_subjects_3
				duration = 1825
			}
		}

		set_country_flag = enchantment_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.4.qm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = enchantment_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.4.qx
		trigger = {
			ai = no
			has_ruler_flag = enchantment_3
			OR = {
				NOT = { dip_power = 30 }
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
		}
		if = { limit = { NOT = { dip_power = 30 } }
			custom_tooltip = magic_need_30_dip_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_1
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
					has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = enchantment_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -30
			add_mil_power = -10
			if = {
				limit = {
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 3650
				}
			}
			else_if = {
				limit = { has_country_flag = Y63_enchantment_upgrade }
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 2736
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_enchantment_charm_assuage_subjects_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_charm_subject_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Evocation - Menu
country_event = {
	id = magic_ruler.5
	title = magic_ruler.5.t
	desc = magic_ruler.5.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = evocation_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = evocation_1
					has_ruler_flag = evocation_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.13 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_evocation
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_evocation }
			OR = {
				has_ruler_flag = evocation_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = evocation_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - War magic I
	option = {	#available
		name = magic_ruler.5.b
		trigger = {
			has_ruler_flag = evocation_1
			mil_power = 50
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_1 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_2 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_3 }
			NOT = { has_ruler_modifier = patron_green_war_magic_1 }
			NOT = { has_ruler_modifier = patron_green_war_magic_2 }
			NOT = { has_ruler_modifier = patron_green_war_magic_3 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_1 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_2 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_3 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_1 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_2 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_3 }
		}
		ai_chance = {
			factor = 50
		}

		add_mil_power = -50
		magic_casted_spell = yes
		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_green_war_magic_1
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = maiden_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_1
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = bladedancer_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_diranbe_war_magic_1
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = winter_everfrost_patron }
			custom_tooltip =  magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_1
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_evocation_war_magic_1
				duration = 1825
			}
		}

		set_country_flag = evocation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.5.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_1 }
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_1
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.5.bx
		trigger = {
			ai = no
			has_ruler_flag = evocation_1
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
			OR = {
				NOT = { mil_power = 50 }
				has_ruler_modifier = magic_realm_evocation_war_magic_1
				has_ruler_modifier = magic_realm_evocation_war_magic_2
				has_ruler_modifier = magic_realm_evocation_war_magic_3
				has_ruler_modifier = patron_green_war_magic_1
				has_ruler_modifier = patron_green_war_magic_2
				has_ruler_modifier = patron_green_war_magic_3
				has_ruler_modifier = patron_ice_war_magic_1
				has_ruler_modifier = patron_ice_war_magic_2
				has_ruler_modifier = patron_ice_war_magic_3
				has_ruler_modifier = patron_diranbe_war_magic_1
				has_ruler_modifier = patron_diranbe_war_magic_2
				has_ruler_modifier = patron_diranbe_war_magic_3
			}
		}
		if = { limit = { NOT = { mil_power = 50 } }
			custom_tooltip = magic_need_50_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_evocation_war_magic_1
					has_ruler_modifier = magic_realm_evocation_war_magic_2
					has_ruler_modifier = magic_realm_evocation_war_magic_3
					has_ruler_modifier = patron_ice_war_magic_1
					has_ruler_modifier = patron_ice_war_magic_2
					has_ruler_modifier = patron_ice_war_magic_3
					has_ruler_modifier = patron_diranbe_war_magic_1
					has_ruler_modifier = patron_diranbe_war_magic_2
					has_ruler_modifier = patron_diranbe_war_magic_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_1
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_1
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_1
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}

	#1 - #Fireball
	option = {
		name = magic_ruler.5.c	#available
		trigger = {
			has_ruler_flag = evocation_1
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { mil_power = 10 }
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.8 }
		if = {
			limit = {
				OR = {
					has_ruler_flag = rakshasa_patron
					has_ruler_flag = manifestation_of_surael_patron
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {
			limit = { has_ruler_flag = autumn_gloam_patron }
			custom_tooltip = magic_booster_by_patron_tt
		}
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 1
		}
		custom_tooltip = magic_fireball_desc_tt
	}
	option = {
		name = magic_ruler.5.cm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_1 }
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_talented_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 1
		}
		custom_tooltip = magic_fireball_desc_tt
	}
	option = {
		name = magic_ruler.5.cx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = evocation_1
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 1
		}
		custom_tooltip = magic_fireball_desc_tt
	}

	#2 - War magic II
	option = {	#available
		name = magic_ruler.5.dd
		trigger = {
			has_ruler_flag = evocation_2
			mil_power = 50
			NOT = { has_ruler_flag = evocation_3 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_1 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_2 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_3 }
			NOT = { has_ruler_modifier = patron_green_war_magic_1 }
			NOT = { has_ruler_modifier = patron_green_war_magic_2 }
			NOT = { has_ruler_modifier = patron_green_war_magic_3 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_1 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_2 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_3 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_1 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_2 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_3 }
		}
		ai_chance = {
			factor = 50
		}

		add_mil_power = -50
		magic_casted_spell = yes
		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_green_war_magic_2
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = maiden_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_2
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = bladedancer_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_diranbe_war_magic_2
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = winter_everfrost_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_2
				duration = 1825
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_evocation_war_magic_2
				duration = 1825
			}
		}

		set_country_flag = evocation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.5.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_2 }
			NOT = { has_ruler_flag = evocation_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_2
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.5.ddx
		trigger = {
			ai = no
			has_ruler_flag = evocation_2
			NOT = { has_ruler_flag = evocation_3 }
			OR = {
				NOT = { mil_power = 50 }
				has_ruler_modifier = magic_realm_evocation_war_magic_1
				has_ruler_modifier = magic_realm_evocation_war_magic_2
				has_ruler_modifier = magic_realm_evocation_war_magic_3
				has_ruler_modifier = patron_green_war_magic_1
				has_ruler_modifier = patron_green_war_magic_2
				has_ruler_modifier = patron_green_war_magic_3
				has_ruler_modifier = patron_ice_war_magic_1
				has_ruler_modifier = patron_ice_war_magic_2
				has_ruler_modifier = patron_ice_war_magic_3
				has_ruler_modifier = patron_diranbe_war_magic_1
				has_ruler_modifier = patron_diranbe_war_magic_2
				has_ruler_modifier = patron_diranbe_war_magic_3
			}
		}
		if = { limit = { NOT = { mil_power = 50 } }
			custom_tooltip = magic_need_50_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_evocation_war_magic_1
					has_ruler_modifier = magic_realm_evocation_war_magic_2
					has_ruler_modifier = magic_realm_evocation_war_magic_3
					has_ruler_modifier = patron_green_war_magic_1
					has_ruler_modifier = patron_green_war_magic_2
					has_ruler_modifier = patron_green_war_magic_3
					has_ruler_modifier = patron_ice_war_magic_1
					has_ruler_modifier = patron_ice_war_magic_2
					has_ruler_modifier = patron_ice_war_magic_3
					has_ruler_modifier = patron_diranbe_war_magic_1
					has_ruler_modifier = patron_diranbe_war_magic_2
					has_ruler_modifier = patron_diranbe_war_magic_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_2
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_2
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_2
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}

	#2 - #Earthquake
	option = {
		name = magic_ruler.5.e	#available
		trigger = {
			has_ruler_flag = evocation_2
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { adm_power = 20 }
				NOT = { mil_power = 5 }
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.11 }
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
			}
			add_devastation = 10
		}
		custom_tooltip = magic_earthquake_desc_tt
	}
	option = {
		name = magic_ruler.5.em	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_2 }
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_renowned_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
			}
			add_devastation = 10
		}
		custom_tooltip = magic_earthquake_desc_tt
	}
	option = {
		name = magic_ruler.5.ex	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = evocation_2
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
			}
			add_devastation = 10
		}
		custom_tooltip = magic_earthquake_desc_tt
	}

	#3 - War magic III
	option = {	#available
		name = magic_ruler.5.f
		trigger = {
			has_ruler_flag = evocation_3
			mil_power = 50
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_1 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_2 }
			NOT = { has_ruler_modifier = magic_realm_evocation_war_magic_3 }
			NOT = { has_ruler_modifier = patron_green_war_magic_1 }
			NOT = { has_ruler_modifier = patron_green_war_magic_2 }
			NOT = { has_ruler_modifier = patron_green_war_magic_3 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_1 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_2 }
			NOT = { has_ruler_modifier = patron_ice_war_magic_3 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_1 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_2 }
			NOT = { has_ruler_modifier = patron_diranbe_war_magic_3 }
		}
		ai_chance = {
			factor = 50
		}

		add_mil_power = -50
		magic_casted_spell = yes
		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_green_war_magic_3
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = maiden_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_3
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = bladedancer_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_diranbe_war_magic_3
				duration = 1825
			}
		}
		else_if = { limit = { has_ruler_flag = winter_everfrost_patron }
			custom_tooltip = magic_booster_by_patron_tt
			add_ruler_modifier = {
				name = patron_ice_war_magic_3
				duration = 1825
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_evocation_war_magic_3
				duration = 1825
			}
		}

		set_country_flag = evocation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.5.fm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_3
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.5.fx
		trigger = {
			ai = no
			has_ruler_flag = evocation_3
			OR = {
				NOT = { mil_power = 50 }
				has_ruler_modifier = magic_realm_evocation_war_magic_1
				has_ruler_modifier = magic_realm_evocation_war_magic_2
				has_ruler_modifier = magic_realm_evocation_war_magic_3
				has_ruler_modifier = patron_green_war_magic_1
				has_ruler_modifier = patron_green_war_magic_2
				has_ruler_modifier = patron_green_war_magic_3
				has_ruler_modifier = patron_ice_war_magic_1
				has_ruler_modifier = patron_ice_war_magic_2
				has_ruler_modifier = patron_ice_war_magic_3
				has_ruler_modifier = patron_diranbe_war_magic_1
				has_ruler_modifier = patron_diranbe_war_magic_2
				has_ruler_modifier = patron_diranbe_war_magic_3
			}
		}
		if = { limit = { NOT = { mil_power = 50 } }
			custom_tooltip = magic_need_50_mil_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_evocation_war_magic_1
					has_ruler_modifier = magic_realm_evocation_war_magic_2
					has_ruler_modifier = magic_realm_evocation_war_magic_3
					has_ruler_modifier = patron_green_war_magic_1
					has_ruler_modifier = patron_green_war_magic_2
					has_ruler_modifier = patron_green_war_magic_3
					has_ruler_modifier = patron_ice_war_magic_1
					has_ruler_modifier = patron_ice_war_magic_2
					has_ruler_modifier = patron_ice_war_magic_3
					has_ruler_modifier = patron_diranbe_war_magic_1
					has_ruler_modifier = patron_diranbe_war_magic_2
					has_ruler_modifier = patron_diranbe_war_magic_3
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -50
			if = { limit = { has_ruler_flag = hoko_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_green_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = maiden_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_ice_war_magic_3
					duration = 1825
				}
			}
			else_if = { limit = { has_ruler_flag = bladedancer_patron }
				custom_tooltip = magic_booster_by_patron_tt
				add_ruler_modifier = {
					name = patron_diranbe_war_magic_3
					duration = 1825
				}
			}
			else = {
				add_ruler_modifier = {
					name = magic_realm_evocation_war_magic_3
					duration = 1825
				}
			}
		}
		custom_tooltip = magic_war_magic_desc_tt
	}

	#3 - #Meteor Strike
	option = {
		name = magic_ruler.5.g	#available
		trigger = {
			OR = {
				has_ruler_flag = evocation_3
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = rakshasa_patron
				}
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = autumn_gloam_patron
				}
			}
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { mil_power = 50 }
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.14 }
		if = {
			limit = {
				has_ruler_flag = rakshasa_patron
				NOT = { has_ruler_flag = evocation_3 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = autumn_gloam_patron
				NOT = { has_ruler_flag = evocation_3 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 10
			add_devastation = 50
		}
		custom_tooltip = magic_meteor_desc_tt
	}
	option = {
		name = magic_ruler.5.gm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = evocation_3 }
			OR = {
				has_ruler_flag = evocation_3
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = rakshasa_patron
				}
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = autumn_gloam_patron
				}
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_legendary_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 10
			add_devastation = 50
		}
		custom_tooltip = magic_meteor_desc_tt
	}
	option = {
		name = magic_ruler.5.gx	#unavailable - other
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = evocation_3
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = rakshasa_patron
				}
				AND = {
					has_ruler_flag = evocation_2
					has_ruler_flag = autumn_gloam_patron
				}
			}
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = evocation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		tooltip = {
			change_siege = 10
			add_devastation = 50
		}
		custom_tooltip = magic_meteor_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Illusion - Menu
country_event = {
	id = magic_ruler.6
	title = magic_ruler.6.t
	desc = magic_ruler.6.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = illusion_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = illusion_1
					has_ruler_flag = illusion_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.16 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_illusion
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_illusion }
			OR = {
				has_ruler_flag = illusion_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = illusion_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Illusionary Marvels I
	option = {	#available
		name = magic_ruler.6.b
		trigger = {
			has_ruler_flag = illusion_1
			mil_power = 10
			NOT = { has_ruler_modifier = magic_marvels_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				NOT = { prestige = 30 }
			}
		}

		add_mil_power = -10
		magic_casted_spell = yes
		if = {
			limit = {
				has_ruler_flag = rakshasa_patron
			}
			add_prestige = 5
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = unthroned_patron
			}
			add_prestige = 5
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			add_ruler_modifier = { name = magic_marvels_cooldown duration = 30 hidden = yes }
			add_prestige = 2
		}

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_illusionary_marvels_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = illusion_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -10
			add_prestige = 2
		}
		custom_tooltip = magic_illusionary_marvels_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.6.bx
		trigger = {
			ai = no
			has_ruler_flag = illusion_1
			OR = {
				NOT = { mil_power = 10 }
				has_ruler_modifier = magic_marvels_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_marvels_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -10
			add_prestige = 2
		}
		custom_tooltip = magic_illusionary_marvels_desc_tt
	}

	#2 - Illusionary Marvels II
	option = {	#available
		name = magic_ruler.6.c
		trigger = {
			has_ruler_flag = illusion_2
			mil_power = 20
			NOT = { has_ruler_modifier = magic_marvels_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				NOT = { prestige = 30 }
			}
		}

		add_mil_power = -20
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_marvels_cooldown duration = 30 hidden = yes }
		if = {
			limit = {
				has_ruler_flag = rakshasa_patron
			}
			add_prestige = 10
			custom_tooltip = magic_booster_by_patron_tt
		}
		else_if = {
			limit = {
				has_ruler_flag = unthroned_patron
			}
			add_prestige = 10
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			add_ruler_modifier = { name = magic_marvels_cooldown duration = 30 hidden = yes }
			add_prestige = 5
		}

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_illusionary_marvels_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = illusion_2 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -20
			add_prestige = 5
		}
		custom_tooltip = magic_illusionary_marvels_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.6.cx
		trigger = {
			ai = no
			has_ruler_flag = illusion_2
			OR = {
				NOT = { mil_power = 20 }
				has_ruler_modifier = magic_marvels_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_marvels_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -20
			add_prestige = 5
		}
		custom_tooltip = magic_illusionary_marvels_desc_tt
	}

	#2 - Glamour I
	option = {	#available
		name = magic_ruler.6.dd
		trigger = {
			OR = {
				has_ruler_flag = illusion_2
				AND = {
					has_ruler_flag = illusion_1
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
			}
			NOT = {
				AND = {
					has_ruler_flag = enchantment_1
					OR = {
						has_ruler_flag = illusion_2
						AND = {
							has_ruler_flag = illusion_1
							OR = {
								has_ruler_flag = huli_jing_patron
								has_ruler_flag = gumiho_patron
							}
						}
					}
				}
			}
			dip_power = 25
			adm_power = 5
			NOT = { has_ruler_modifier = magic_realm_illusion_glamour }
			NOT = { has_ruler_modifier = magic_realm_illusion_enchanted_glamour }
			NOT = { has_ruler_modifier = magic_realm_illusion_otherworldly_glamour }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				personality = ai_diplomat
			}
		}

		add_dip_power = -25
		add_adm_power = -5
		magic_casted_spell = yes
		add_ruler_modifier = {
			name = magic_realm_illusion_glamour
			duration = 1825
		}

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_glamour_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.ddm
		trigger = {
			ai = no
			NOT = {
				OR = {
					has_ruler_flag = illusion_2
					AND = {
						has_ruler_flag = illusion_1
						OR = {
							has_ruler_flag = huli_jing_patron
							has_ruler_flag = gumiho_patron
						}
					}
				}
			}
			NOT = {
				AND = {
					has_ruler_flag = enchantment_1
					OR = {
						has_ruler_flag = illusion_2
						AND = {
							has_ruler_flag = illusion_1
							OR = {
								has_ruler_flag = huli_jing_patron
								has_ruler_flag = gumiho_patron
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
				}
			}
			custom_tooltip = school_mastery_not_talented_tt
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else = {
			custom_tooltip = school_mastery_not_renowned_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -25
			add_adm_power = -5
			add_ruler_modifier = {
				name = magic_realm_illusion_glamour
				duration = 1825
			}
		}
		custom_tooltip = magic_glamour_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.6.ddx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = illusion_2
				AND = {
					has_ruler_flag = illusion_1
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
			}
			NOT = {
				AND = {
					has_ruler_flag = enchantment_1
					OR = {
						has_ruler_flag = illusion_2
						AND = {
							has_ruler_flag = illusion_1
							OR = {
								has_ruler_flag = huli_jing_patron
								has_ruler_flag = gumiho_patron
							}
						}
					}
				}
			}
			OR = {
				NOT = { dip_power = 25 }
				NOT = { adm_power = 5 }
				has_ruler_modifier = magic_realm_illusion_glamour
				has_ruler_modifier = magic_realm_illusion_enchanted_glamour
				has_ruler_modifier = magic_realm_illusion_otherworldly_glamour
			}
		}
		if = { limit = { NOT = { dip_power = 25 } }
			custom_tooltip = magic_need_25_dip_tt
		}
		if = { limit = { NOT = { adm_power = 5 } }
			custom_tooltip = magic_need_5_adm_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_illusion_glamour
					has_ruler_modifier = magic_realm_illusion_enchanted_glamour
					has_ruler_modifier = magic_realm_illusion_otherworldly_glamour
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -25
			add_adm_power = -5
			add_ruler_modifier = {
				name = magic_realm_illusion_glamour
				duration = 1825
			}
		}
		custom_tooltip = magic_glamour_desc_tt
	}

	#2 - Glamour II
	option = {	#available
		name = magic_ruler.6.e
		trigger = {
			OR = {
				has_ruler_flag = illusion_2
				AND = {
					has_ruler_flag = illusion_1
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
			}
			has_ruler_flag = enchantment_1
			NOT = {
				OR = {
					AND = {
						has_ruler_flag = illusion_3
						has_ruler_flag = enchantment_2
					}
					AND = {
						has_ruler_flag = illusion_2
						has_ruler_flag = enchantment_1
						OR = {
							has_ruler_flag = huli_jing_patron
							has_ruler_flag = gumiho_patron
						}
					}
				}
			}
			dip_power = 25
			adm_power = 5
			NOT = { has_ruler_modifier = magic_realm_illusion_glamour }
			NOT = { has_ruler_modifier = magic_realm_illusion_enchanted_glamour }
			NOT = { has_ruler_modifier = magic_realm_illusion_otherworldly_glamour }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				personality = ai_diplomat
			}
		}
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
				}
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		add_dip_power = -25
		add_adm_power = -5
		magic_casted_spell = yes
		add_ruler_modifier = {
			name = magic_realm_illusion_enchanted_glamour
			duration = 1825
		}

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_glamour_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.em
		trigger = {
			ai = no
			NOT = {
				AND = {
					OR = {
						has_ruler_flag = illusion_2
						AND = {
							has_ruler_flag = illusion_1
							OR = {
								has_ruler_flag = huli_jing_patron
								has_ruler_flag = gumiho_patron
							}
						}
					}
					has_ruler_flag = enchantment_1
				}
			}
			NOT = {
				OR = {
					AND = {
						has_ruler_flag = illusion_3
						has_ruler_flag = enchantment_2
					}
					AND = {
						has_ruler_flag = illusion_2
						has_ruler_flag = enchantment_1
						OR = {
							has_ruler_flag = huli_jing_patron
							has_ruler_flag = gumiho_patron
						}
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
				}
			}
			if = { limit = { NOT = { has_ruler_flag = illusion_1 } }
				custom_tooltip = school_mastery_not_talented_tt
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else_if = { limit = { NOT = { has_ruler_flag = illusion_2 } }
			custom_tooltip = school_mastery_not_renowned_tt
		}
		if = { limit = { NOT = { has_ruler_flag = enchantment_1 } }
			custom_tooltip = school_mastery_enchantment_not_talented_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -25
			add_adm_power = -5
			add_ruler_modifier = {
				name = magic_realm_illusion_enchanted_glamour
				duration = 1825
			}
		}
		custom_tooltip = magic_glamour_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.6.ex
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = illusion_2
				AND = {
					has_ruler_flag = illusion_1
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
			}
			has_ruler_flag = enchantment_1
			NOT = {
				OR = {
					AND = {
						has_ruler_flag = illusion_3
						has_ruler_flag = enchantment_2
					}
					AND = {
						has_ruler_flag = illusion_2
						has_ruler_flag = enchantment_1
						OR = {
							has_ruler_flag = huli_jing_patron
							has_ruler_flag = gumiho_patron
						}
					}
				}
			}
			OR = {
				NOT = { dip_power = 25 }
				NOT = { adm_power = 5 }
				has_ruler_modifier = magic_realm_illusion_glamour
				has_ruler_modifier = magic_realm_illusion_enchanted_glamour
				has_ruler_modifier = magic_realm_illusion_otherworldly_glamour
			}
		}
		if = { limit = { NOT = { dip_power = 25 } }
			custom_tooltip = magic_need_25_dip_tt
		}
		if = { limit = { NOT = { adm_power = 5 } }
			custom_tooltip = magic_need_5_adm_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_illusion_glamour
					has_ruler_modifier = magic_realm_illusion_enchanted_glamour
					has_ruler_modifier = magic_realm_illusion_otherworldly_glamour
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -25
			add_adm_power = -5
			add_ruler_modifier = {
				name = magic_realm_illusion_enchanted_glamour
				duration = 1825
			}
		}
		custom_tooltip = magic_glamour_desc_tt
	}

	#3 - Illusionary Marvels III
	option = {	#available
		name = magic_ruler.6.f
		trigger = {
			has_ruler_flag = illusion_3
			mil_power = 30
			NOT = { has_ruler_modifier = magic_marvels_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				NOT = { prestige = 30 }
			}
		}

		add_mil_power = -30
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_marvels_cooldown duration = 30 hidden = yes }
		add_prestige = 10

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_illusionary_marvels_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.fm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = illusion_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -30
			add_prestige = 10
		}
		custom_tooltip = magic_illusionary_marvels_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.6.fx
		trigger = {
			ai = no
			has_ruler_flag = illusion_3
			OR = {
				NOT = { mil_power = 30 }
				has_ruler_modifier = magic_marvels_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_marvels_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { mil_power = 10 } }
			custom_tooltip = magic_need_10_mil_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_mil_power = -30
			add_prestige = 10
		}
		custom_tooltip = magic_illusionary_marvels_desc_tt
	}

	#3 - Glamour III
	option = {	#available
		name = magic_ruler.6.g
		trigger = {
			OR = {
				AND = {
					has_ruler_flag = illusion_3
					has_ruler_flag = enchantment_2
				}
				AND = {
					has_ruler_flag = illusion_2
					has_ruler_flag = enchantment_1
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
			}
			dip_power = 25
			adm_power = 5
			NOT = { has_ruler_modifier = magic_realm_illusion_glamour }
			NOT = { has_ruler_modifier = magic_realm_illusion_enchanted_glamour }
			NOT = { has_ruler_modifier = magic_realm_illusion_otherworldly_glamour }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				personality = ai_diplomat
			}
		}
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
				}
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		add_dip_power = -25
		add_adm_power = -5
		magic_casted_spell = yes
		add_ruler_modifier = {
			name = magic_realm_illusion_otherworldly_glamour
			duration = 1825
		}

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_glamour_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.gm
		trigger = {
			ai = no
			NOT = {
				OR = {
					AND = {
						has_ruler_flag = illusion_3
						has_ruler_flag = enchantment_2
					}
					NOT = {
						has_ruler_flag = illusion_2
						has_ruler_flag = enchantment_1
						OR = {
							has_ruler_flag = huli_jing_patron
							has_ruler_flag = gumiho_patron
						}
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_ruler_flag = huli_jing_patron
					has_ruler_flag = gumiho_patron
				}
			}
			if = { limit = { NOT = { has_ruler_flag = illusion_2 } }
				custom_tooltip = school_mastery_not_renowned_tt
			}
			if = { limit = { NOT = { has_ruler_flag = enchantment_1 } }
				custom_tooltip = school_mastery_enchantment_not_talented_tt
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}
		else = {
			if = { limit = { NOT = { has_ruler_flag = illusion_3 } }
				custom_tooltip = school_mastery_not_legendary_tt
			}
			if = { limit = { NOT = { has_ruler_flag = enchantment_2 } }
				custom_tooltip = school_mastery_enchantment_not_renowned_tt
			}
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -25
			add_adm_power = -5
			add_ruler_modifier = {
				name = magic_realm_illusion_otherworldly_glamour
				duration = 1825
			}
		}
		custom_tooltip = magic_glamour_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.6.gx
		trigger = {
			ai = no
			OR = {
				AND = {
					has_ruler_flag = illusion_3
					has_ruler_flag = enchantment_2
				}
				AND = {
					has_ruler_flag = illusion_2
					OR = {
						has_ruler_flag = huli_jing_patron
						has_ruler_flag = gumiho_patron
					}
				}
			}
			OR = {
				NOT = { dip_power = 25 }
				NOT = { adm_power = 5 }
				has_ruler_modifier = magic_realm_illusion_glamour
				has_ruler_modifier = magic_realm_illusion_enchanted_glamour
				has_ruler_modifier = magic_realm_illusion_otherworldly_glamour
			}
		}
		if = { limit = { NOT = { dip_power = 25 } }
			custom_tooltip = magic_need_25_dip_tt
		}
		if = { limit = { NOT = { adm_power = 5 } }
			custom_tooltip = magic_need_5_adm_tt
		}
		if = {
			limit = {
				OR = {
					has_ruler_modifier = magic_realm_illusion_glamour
					has_ruler_modifier = magic_realm_illusion_enchanted_glamour
					has_ruler_modifier = magic_realm_illusion_otherworldly_glamour
				}
			}
			custom_tooltip = magic_spell_already_active_tt
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_dip_power = -25
			add_adm_power = -5
			add_ruler_modifier = {
				name = magic_realm_illusion_otherworldly_glamour
				duration = 1825
			}
		}
		custom_tooltip = magic_glamour_desc_tt
	}

	#3 - Simulacrum
	option = {	#available
		name = magic_ruler.6.h
		trigger = {
			has_ruler_flag = illusion_3
			NOT = { magical_project_in_progress = yes }
			NOT = { has_ruler_flag = magic_project_simulacrum_complete }
			adm_power = 50
			dip_power = 50
			mil_power = 50
		}
		ai_chance = {
			factor = 50
		}

		add_adm_power = -50
		add_dip_power = -50
		add_mil_power = -50
		magic_casted_spell = yes
		set_ruler_flag = magic_project_simulacrum_started
		custom_tooltip = tooltip_magic_project_start
		hidden_effect = { country_event = { id = magic_project_simulacrum.1 } }

		set_country_flag = illusion_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_simulacrum_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.6.hm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = illusion_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_simulacrum_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.6.hx
		trigger = {
			ai = no
			has_ruler_flag = illusion_3
			OR = {
				has_ruler_flag = magic_project_simulacrum_complete
				magical_project_in_progress = yes
				NOT = { adm_power = 50 }
				NOT = { dip_power = 50 }
				NOT = { mil_power = 50 }
			}
		}
		if = { limit = { has_ruler_flag = magic_project_simulacrum_complete }
			custom_tooltip = magic_project_already_done_tt
		}
		else = {
			if = { limit = { has_ruler_flag = magic_project_simulacrum_started }
				custom_tooltip = magic_project_started_tt
			}
			else_if = { limit = { magical_project_in_progress = yes }
				custom_tooltip = magic_other_project_in_progress_tt
			}
			if = { limit = { NOT = { adm_power = 50 } }
				custom_tooltip = magic_need_50_adm_tt
			}
			if = { limit = { NOT = { dip_power = 50 } }
				custom_tooltip = magic_need_50_dip_tt
			}
			if = { limit = { NOT = { mil_power = 50 } }
				custom_tooltip = magic_need_50_mil_tt
			}
		}

		set_country_flag = illusion_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_simulacrum_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Necromancy - Menu
country_event = {
	id = magic_ruler.7
	title = magic_ruler.7.t
	desc = magic_ruler.7.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_in_capital_area = yes
				}
				save_event_target_as = undead_army_province
			}
			random_owned_province = {
				limit = {
					is_capital = yes
				}
				save_event_target_as = undead_army_province
			}
			random_owned_province = {
				limit = {
					has_ruler_leader_from = ROOT
				}
				save_event_target_as = undead_army_province
			}
		}
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = necromancy_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = necromancy_1
					has_ruler_flag = necromancy_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		if = {
			limit = { tag = I20 has_reform = krakazol_olzonog }
			custom_tooltip = krakazol_no_necromancy_tooltip
			hidden_effect = { country_event = { id = flavor_krakazol.210 days = 30 random = 30 } }
		}
		country_event = { id = magic_study.19 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_necromancy
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_necromancy }
			OR = {
				has_ruler_flag = necromancy_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = necromancy_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Absorb Life Energy
	option = {	#available
		name = magic_ruler.7.b
		trigger = {
			has_ruler_flag = necromancy_1
			adm_power = 5
			mil_power = 5
			NOT = { has_ruler_modifier = magic_drain_cooldown }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 50
		}

		add_adm_power = -5
		add_mil_power = -5
		custom_tooltip = magic_absorb_life_effect_tt
		country_event = { id = magic_ruler.13 }

		custom_tooltip = magic_absorb_life_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_1 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -5
			add_mil_power = -5
		}
		custom_tooltip = magic_absorb_life_effect_tt

		custom_tooltip = magic_absorb_life_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.7.bx
		trigger = {
			ai = no
			has_ruler_flag = necromancy_1
			OR = {
				NOT = { adm_power = 5 }
				NOT = { mil_power = 5 }
				has_ruler_modifier = magic_drain_cooldown
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_modifier = magic_drain_cooldown }
			custom_tooltip = magic_1_year_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 5 } }
			custom_tooltip = magic_need_5_adm_tt
		}
		if = { limit = { NOT = { mil_power = 5 } }
			custom_tooltip = magic_need_5_mil_tt
		}
		if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
			custom_tooltip = varamhar_unable_to_perform_necromancy_tt
		}
		if = { limit = { has_country_flag = necromancy_disallowed }
			custom_tooltip = tooltip_unable_to_perform_necromancy
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -5
			add_mil_power = -5
		}
		custom_tooltip = magic_absorb_life_effect_tt

		custom_tooltip = magic_absorb_life_desc_tt
	}

	#2 - Summon Undead Army I
	option = {	#available
		name = magic_ruler.7.c
		trigger = {
			has_ruler_flag = necromancy_2
			NOT = { has_ruler_flag = necromancy_3 }
			adm_power = 15
			dip_power = 15
			mil_power = 15
			NOT = { has_ruler_modifier = magic_undead_cooldown }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 4
				is_at_war = yes
			}
			modifier = {
				factor = 0.5
				NOT = { has_ruler_modifier = witch_king_modifier }
			}
			modifier = {
				factor = 0
				OR = {
					ruler_has_personality = benevolent_personality
					ruler_has_personality = careful_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = charismatic_negotiator_personality
					army_size_percentage = 1
				}
			}
		}

		add_adm_power = -15
		add_dip_power = -15
		add_mil_power = -15
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_undead_cooldown duration = 30 hidden = yes }

		event_target:undead_army_province = {
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
		}

		increase_witch_king_points_massive = yes

		if = { limit = { NOT = { has_country_modifier = undead_military } }
			clear_racial_military = yes
			tooltip = { add_country_modifier = { name = undead_military duration = -1 } }
			add_country_modifier = { name = undead_military duration = -1 hidden = yes }
		}
		if = {
			limit = {
				NOT = { unit_type = tech_undead }
				has_any_racial_military = yes
			}
			change_unit_type = tech_undead
		}

		custom_tooltip = magic_undead_army_desc_tt

		set_country_flag = necromancy_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_2 }
			NOT = { has_ruler_flag = necromancy_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.7.cx
		trigger = {
			ai = no
			has_ruler_flag = necromancy_2
			NOT = { has_ruler_flag = necromancy_3 }
			OR = {
				NOT = { adm_power = 15 }
				NOT = { dip_power = 15 }
				NOT = { mil_power = 15 }
				has_ruler_modifier = magic_undead_cooldown
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_modifier = magic_undead_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 15 } }
			custom_tooltip = magic_need_15_adm_tt
		}
		if = { limit = { NOT = { dip_power = 15 } }
			custom_tooltip = magic_need_15_dip_tt
		}
		if = { limit = { NOT = { mil_power = 15 } }
			custom_tooltip = magic_need_15_mil_tt
		}
		if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
			custom_tooltip = varamhar_unable_to_perform_necromancy_tt
		}
		if = { limit = { has_country_flag = necromancy_disallowed }
			custom_tooltip = tooltip_unable_to_perform_necromancy
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}

	#3 - Summon Undead Army II
	option = {	#available
		name = magic_ruler.7.dd
		trigger = {
			has_ruler_flag = necromancy_3
			adm_power = 15
			dip_power = 15
			mil_power = 15
			NOT = { has_ruler_modifier = magic_undead_cooldown }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 4
				is_at_war = yes
			}
			modifier = {
				factor = 0.5
				NOT = { has_ruler_modifier = witch_king_modifier }
			}
			modifier = {
				factor = 0
				OR = {
					ruler_has_personality = benevolent_personality
					ruler_has_personality = careful_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = charismatic_negotiator_personality
					army_size_percentage = 1
				}
			}
		}

		add_adm_power = -15
		add_dip_power = -15
		add_mil_power = -15
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_undead_cooldown duration = 30 hidden = yes }

		event_target:undead_army_province = {
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			infantry = ROOT
			cavalry = ROOT
			cavalry = ROOT
		}

		increase_witch_king_points_massive = yes

		if = { limit = { NOT = { has_country_modifier = undead_military } }
			clear_racial_military = yes
			tooltip = { add_country_modifier = { name = undead_military duration = -1 } }
			add_country_modifier = { name = undead_military duration = -1 hidden = yes }
		}
		if = {
			limit = {
				NOT = { unit_type = tech_undead }
				has_any_racial_military = yes
			}
			change_unit_type = tech_undead
		}

		custom_tooltip = magic_undead_army_desc_tt

		set_country_flag = necromancy_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.ddm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				cavalry = ROOT
				cavalry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.7.ddx
		trigger = {
			ai = no
			has_ruler_flag = necromancy_3
			OR = {
				NOT = { adm_power = 15 }
				NOT = { dip_power = 15 }
				NOT = { mil_power = 15 }
				has_ruler_modifier = magic_undead_cooldown
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_modifier = magic_undead_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 15 } }
			custom_tooltip = magic_need_15_adm_tt
		}
		if = { limit = { NOT = { dip_power = 15 } }
			custom_tooltip = magic_need_15_dip_tt
		}
		if = { limit = { NOT = { mil_power = 15 } }
			custom_tooltip = magic_need_15_mil_tt
		}
		if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
			custom_tooltip = varamhar_unable_to_perform_necromancy_tt
		}
		if = { limit = { has_country_flag = necromancy_disallowed }
			custom_tooltip = tooltip_unable_to_perform_necromancy
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -15
			add_dip_power = -15
			add_mil_power = -15

			event_target:undead_army_province = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				cavalry = ROOT
				cavalry = ROOT
			}

			increase_witch_king_points_massive = yes

			if = { limit = { NOT = { has_country_modifier = undead_military } }
				clear_racial_military = yes
				add_country_modifier = { name = undead_military duration = -1 }
			}
			if = {
				limit = {
					NOT = { unit_type = tech_undead }
					has_any_racial_military = yes
				}
				change_unit_type = tech_undead
			}
		}

		custom_tooltip = magic_undead_army_desc_tt
	}

	#3 - Lichdom
	option = {	#available
		name = magic_ruler.7.e
		trigger = {
			has_ruler_flag = necromancy_3
			NOT = { magical_project_in_progress = yes }
			NOT = { has_ruler_flag = is_a_vampire }
			NOT = { has_ruler_flag = is_a_lich }
			NOT = { has_ruler_flag = xhazob_patron }
			adm_power = 300
			dip_power = 300
			mil_power = 300
			is_lesser_in_union = no
			NOT = { has_country_flag = gemradcurt_immariel_rules }
			NOT = { has_ruler_modifier = varamhar_blessed_of_surael }
			NOT = { has_country_flag = necromancy_disallowed }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				ruler_age = 40
				culture_is_short_lived = yes
			}
			modifier = {
				factor = 0.25
				NOT = { culture_is_short_lived = yes }
			}
		}

		increase_witch_king_points_large = yes
		add_adm_power = -300
		add_dip_power = -300
		add_mil_power = -300
		magic_casted_spell = yes
		set_ruler_flag = magic_project_lichdom_started
		custom_tooltip = tooltip_magic_project_start
		hidden_effect = { country_event = { id = magic_project_lichdom.1 days = 90 } }

		set_country_flag = necromancy_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_lichdom_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.7.em
		trigger = {
			ai = no
			NOT = { has_ruler_flag = necromancy_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			increase_witch_king_points_large = yes
			add_adm_power = -300
			add_dip_power = -300
			add_mil_power = -300
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_lichdom_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.7.ex
		trigger = {
			ai = no
			has_ruler_flag = necromancy_3
			OR = {
				has_ruler_flag = is_a_vampire
				has_ruler_flag = is_a_lich
				magical_project_in_progress = yes
				NOT = { adm_power = 300 }
				NOT = { dip_power = 300 }
				NOT = { mil_power = 300 }
				is_lesser_in_union = yes
				has_country_flag = gemradcurt_immariel_rules
				has_ruler_modifier = varamhar_blessed_of_surael
				has_country_flag = necromancy_disallowed
			}
		}
		if = { limit = { has_ruler_flag = is_a_lich }
			custom_tooltip = magic_project_already_done_tt
		}
		else = {
			if = { limit = { has_ruler_flag = magic_project_lichdom_started }
				custom_tooltip = magic_project_started_tt
			}
			else_if = { limit = { magical_project_in_progress = yes }
				custom_tooltip = magic_other_project_in_progress_tt
			}
			else_if = { limit = { has_ruler_flag = is_a_vampire }
                custom_tooltip = magic_vampires_cant_be_liches_tt
            }
            else_if = { limit = { has_country_flag = gemradcurt_immariel_rules }
                custom_tooltip = immariel_cant_into_lich_tt
            }
			if = { limit = { is_lesser_in_union = yes }
				custom_tooltip = magic_is_not_in_lesser_union_tt
			}
			if = { limit = { NOT = { adm_power = 300 } }
				custom_tooltip = magic_need_300_adm_tt
			}
			if = { limit = { NOT = { dip_power = 300 } }
				custom_tooltip = magic_need_300_dip_tt
			}
			if = { limit = { NOT = { mil_power = 300 } }
				custom_tooltip = magic_need_300_mil_tt
			}
			if = { limit = { has_ruler_modifier = varamhar_blessed_of_surael }
				custom_tooltip = varamhar_unable_to_perform_necromancy_tt
			}
			if = { limit = { has_country_flag = necromancy_disallowed }
				custom_tooltip = tooltip_unable_to_perform_necromancy
			}
		}

		set_country_flag = necromancy_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			increase_witch_king_points_large = yes
			add_adm_power = -300
			add_dip_power = -300
			add_mil_power = -300
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_lichdom_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#Transmutation - Menu
country_event = {
	id = magic_ruler.8
	title = magic_ruler.8.t
	desc = magic_ruler.8.d
	picture = { trigger = { has_ruler_flag = magic_just_casted_spell } picture = SPELL_MENU_ANIMATED_eventPicture }
	picture = { trigger = { NOT = { has_ruler_flag = magic_just_casted_spell } } picture = SPELL_MENU_eventPicture }

	is_triggered_only = yes

	#Go back
	option = {
		name = magic_ruler.1.z
		ai_chance = { factor = 50 }
		if = { limit = { ai = yes }	#makes ai back out of casting completely to prevent spam
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			hidden_effect = { country_event = { id = magic_ruler.0 } }
		}
		clr_ruler_flag = magic_just_casted_spell
	}

	#Study
	option = {
		name = magic_ruler.1.a	#available
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			NOT = { ruler_studying_magic = yes }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.2
				OR = {
					has_ruler_flag = transmutation_1
					has_ruler_flag = transmutation_2
				}
			}
		}
		clr_ruler_flag = magic_just_casted_spell
		country_event = { id = magic_study.22 }
	}
	option = {
		name = magic_ruler.1.as	#stop
		trigger = {
			ai = no
			has_ruler_flag = ruler_studying_transmutation
			NOT = { has_finished_magical_studies = yes }
		}
		magic_study_clear_study_effects = yes
		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}
	option = {
		name = magic_ruler.1.ax	#unavailable
		trigger = {
			ai = no
			NOT = { has_ruler_flag = ruler_studying_transmutation }
			OR = {
				has_ruler_flag = transmutation_3
				ruler_studying_magic = yes
				has_finished_magical_studies = yes
			}
		}
		custom_tooltip = cant_study_magic_tt
		if = { limit = { has_ruler_flag = transmutation_3 }
			custom_tooltip = school_mastery_at_max_tt
		}
		if = { limit = { ruler_studying_magic = yes }
			custom_tooltip = already_studying_magic_tt
		}
		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }
	}

	#1 - Plant Growth I
	option = {	#available
		name = magic_ruler.8.b
		trigger = {
			has_ruler_flag = transmutation_1
			NOT = { has_ruler_flag = transmutation_2 }
			NOT = { has_ruler_flag = transmutation_3 }
			any_owned_province = {
				province_with_farm_goods = yes
				has_no_plant_growth_province_modifiers = yes
			}
			adm_power = 30
			dip_power = 5
			NOT = { has_ruler_modifier = magic_plant_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_capitalist
			}
		}

		add_adm_power = -30
		add_dip_power = -5
		country_event = { id = magic_ruler.17 }
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.bm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = transmutation_1 }
			NOT = { has_ruler_flag = transmutation_2 }
			NOT = { has_ruler_flag = transmutation_3 }
		}
		custom_tooltip = school_mastery_not_talented_tt

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
		}
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.bx
		trigger = {
			ai = no
			has_ruler_flag = transmutation_1
			NOT = { has_ruler_flag = transmutation_2 }
			NOT = { has_ruler_flag = transmutation_3 }
			OR = {
				NOT = {
					any_owned_province = {
						province_with_farm_goods = yes
						has_no_plant_growth_province_modifiers = yes
					}
				}
				NOT = { adm_power = 30 }
				NOT = { dip_power = 5 }
				has_ruler_modifier = magic_plant_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_plant_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 30 } }
			custom_tooltip = magic_need_30_adm_tt
		}
		if = { limit = { NOT = { dip_power = 5 } }
			custom_tooltip = magic_need_5_dip_tt
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						province_with_farm_goods = yes
						has_no_plant_growth_province_modifiers = yes
					}
				}
			}
			custom_tooltip = magic_need_province_with_farms_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
		}
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}

	#2 - Plant Growth II
	option = {	#available
		name = magic_ruler.8.c
		trigger = {
			has_ruler_flag = transmutation_2
			NOT = { has_ruler_flag = transmutation_3 }
			any_owned_province = {
				province_with_farm_goods = yes
				has_no_plant_growth_province_modifiers = yes
			}
			adm_power = 30
			dip_power = 5
			NOT = { has_ruler_modifier = magic_plant_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_capitalist
			}
		}

		add_adm_power = -30
		add_dip_power = -5
		country_event = { id = magic_ruler.17 }
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.cm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = transmutation_2 }
			NOT = { has_ruler_flag = transmutation_3 }
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
		}
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.cx
		trigger = {
			ai = no
			has_ruler_flag = transmutation_2
			NOT = { has_ruler_flag = transmutation_3 }
			OR = {
				NOT = {
					any_owned_province = {
						province_with_farm_goods = yes
						has_no_plant_growth_province_modifiers = yes
					}
				}
				NOT = { adm_power = 30 }
				NOT = { dip_power = 5 }
				has_ruler_modifier = magic_plant_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_plant_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 30 } }
			custom_tooltip = magic_need_30_adm_tt
		}
		if = { limit = { NOT = { dip_power = 5 } }
			custom_tooltip = magic_need_5_dip_tt
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						province_with_farm_goods = yes
						has_no_plant_growth_province_modifiers = yes
					}
				}
			}
			custom_tooltip = magic_need_province_with_farms_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
		}
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}

	#2 - Enhance Ability I
	option = {	#available
		name = magic_ruler.8.dd
		trigger = {
			OR = {
				has_ruler_flag = transmutation_2
				AND = {
					has_ruler_flag = hoko_patron
					has_ruler_flag = transmutation_1
				}
			}
			NOT = {
				OR = {
					has_ruler_flag = transmutation_3
					AND = {
						has_ruler_flag = hoko_patron
						has_ruler_flag = transmutation_2
					}
				}
			}
			NOT = { has_ruler_modifier = magic_enhance_cooldown }
			OR = {
				NOT = { adm = 6 }
				NOT = { dip = 6 }
				NOT = { mil = 6 }
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		if = {
			limit = {
				has_ruler_flag = hoko_patron
				NOT = { has_ruler_flag = transmutation_2 }
			}
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		custom_tooltip = magic_enhance_effect_1_tt
		country_event = { id = magic_ruler.18 }

		custom_tooltip = magic_enhance_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.ddm
		trigger = {
			ai = no
			NOT = {
				OR = {
					has_ruler_flag = transmutation_2
					AND = {
						has_ruler_flag = hoko_patron
						has_ruler_flag = transmutation_1
					}
				}
			}
			NOT = {
				OR = {
					has_ruler_flag = transmutation_3
					AND = {
						has_ruler_flag = hoko_patron
						has_ruler_flag = transmutation_2
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_renowned_tt

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		custom_tooltip = magic_enhance_effect_1_tt

		custom_tooltip = magic_enhance_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.ddx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = transmutation_2
				AND = {
					has_ruler_flag = hoko_patron
					has_ruler_flag = transmutation_1
				}
			}
			NOT = {
				OR = {
					has_ruler_flag = transmutation_3
					AND = {
						has_ruler_flag = hoko_patron
						has_ruler_flag = transmutation_2
					}
				}
			}
			OR = {
				has_ruler_modifier = magic_enhance_cooldown
				AND = {
					adm = 6
					dip = 6
					mil = 6
				}
			}
		}
		if = { limit = { has_ruler_modifier = magic_enhance_cooldown }
			custom_tooltip = magic_5_year_cooldown_tt
		}
		if = {
			limit = {
				adm = 6
				dip = 6
				mil = 6
			}
			custom_tooltip = magic_need_ruler_without_max_skills_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		custom_tooltip = magic_enhance_effect_1_tt

		custom_tooltip = magic_enhance_desc_tt
	}	

	#2 - Rite of Conception I
	option = {	#available
		name = magic_ruler.8.e
		trigger = {
			has_ruler_flag = transmutation_2
			has_ruler_flag = abjuration_1
			NOT = { has_ruler_flag = transmutation_3 }
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
			adm_power = 100
			NOT = { government = theocracy }
			NOT = { has_adventurer_reform = yes }
			has_government_attribute = heir
			is_lesser_in_union = no
			NOT = { ruler_is_immortal = yes }
			NOT = { has_ruler_modifier = magic_conception_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				has_heir = no
			}
			modifier = {
				factor = 2
				has_heir = yes
				NOT = {
					heir_has_mage_personality = yes
					has_heir_flag = heir_consort_mage_personality
				}
			}
		}

		add_adm_power = -100

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_conception_cooldown duration = 30 hidden = yes }

		if = { limit = { has_consort = no }
			set_country_flag = spell_3
			tooltip = {
				random_list = {
					25 = {
						define_heir = {
							dynasty = ROOT
							claim = 20
							no_consort_with_heir = yes
							hidden = yes
						}
						set_heir_mage_effect = yes
					}
					70 = { }
					5 = { kill_ruler = yes }
				}
			}
		}
		else_if = {
			limit = {
				ruler_has_mage_personality = yes
				consort_has_mage_personality = yes
			}
			set_country_flag = spell_1
			tooltip = {
				random_list = {
					50 = {
						define_heir = {
							dynasty = ROOT
							claim = 100
							hidden = yes
						}
						set_heir_mage_effect = yes
					}
					40 = { }
					5 = { kill_ruler = yes }
					5 = { remove_consort_effect = yes }
				}
			}
		}
		else = {
			set_country_flag = spell_2
			tooltip = {
				random_list = {
					25 = {
						define_heir = {
							dynasty = ROOT
							claim = 100
							hidden = yes
						}
						set_heir_mage_effect = yes
					}
					60 = { }
					5 = { kill_ruler = yes }
					10 = { remove_consort_effect = yes }
				}
			}
		}

		hidden_effect = { country_event = { id = magic_ruler.20 } }

		set_country_flag = transmutation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_conception_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.em
		trigger = {
			ai = no
			OR = {
				NOT = { has_ruler_flag = transmutation_2 }
				NOT = { has_ruler_flag = abjuration_1 }
			}
			NOT = {
				AND = {
					has_ruler_flag = transmutation_3
					has_ruler_flag = abjuration_1
				}
			}
		}
		if = { limit = { NOT = { has_ruler_flag = transmutation_2 } }
			custom_tooltip = school_mastery_not_renowned_tt
		}
		if = { limit = { NOT = { has_ruler_flag = abjuration_1 } }
			custom_tooltip = school_mastery_abjuration_not_talented_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -100

			if = { limit = { has_consort = no }
				set_country_flag = spell_3
				tooltip = {
					random_list = {
						25 = {
							define_heir = {
								dynasty = ROOT
								claim = 20
								no_consort_with_heir = yes
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						70 = { }
						5 = { kill_ruler = yes }
					}
				}
			}
			else_if = {
				limit = {
					ruler_has_mage_personality = yes
					consort_has_mage_personality = yes
				}
				set_country_flag = spell_1
				tooltip = {
					random_list = {
						50 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						40 = { }
						5 = { kill_ruler = yes }
						5 = { remove_consort_effect = yes }
					}
				}
			}
			else = {
				set_country_flag = spell_2
				tooltip = {
					random_list = {
						25 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						60 = { }
						5 = { kill_ruler = yes }
						10 = { remove_consort_effect = yes }
					}
				}
			}
		}

		custom_tooltip = magic_conception_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.ex
		trigger = {
			ai = no
			has_ruler_flag = transmutation_3
			has_ruler_flag = abjuration_1
			OR = {
				NOT = { adm_power = 100 }
				government = theocracy
				has_adventurer_reform = yes
				NOT = { has_government_attribute = heir }
				is_lesser_in_union = yes
				ruler_is_immortal = yes
				has_ruler_modifier = magic_conception_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_conception_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 100 } }
			custom_tooltip = magic_need_100_adm_tt
		}
		if = { limit = { government = theocracy }
			custom_tooltip = magic_no_theocracy_tt
		}
		if = { limit = { NOT = { has_government_attribute = heir } }
			custom_tooltip = magic_government_allow_heirs_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = { limit = { ruler_is_immortal = yes }
			custom_tooltip = magic_ruler_is_mortal_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -100

			if = { limit = { has_consort = no }
				set_country_flag = spell_3
				tooltip = {
					random_list = {
						25 = {
							define_heir = {
								dynasty = ROOT
								claim = 20
								no_consort_with_heir = yes
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						70 = { }
						5 = { kill_ruler = yes }
					}
				}
			}
			else_if = {
				limit = {
					ruler_has_mage_personality = yes
					consort_has_mage_personality = yes
				}
				set_country_flag = spell_1
				tooltip = {
					random_list = {
						50 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						40 = { }
						5 = { kill_ruler = yes }
						5 = { remove_consort_effect = yes }
					}
				}
			}
			else = {
				set_country_flag = spell_2
				tooltip = {
					random_list = {
						25 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						60 = { }
						5 = { kill_ruler = yes }
						10 = { remove_consort_effect = yes }
					}
				}
			}
		}

		custom_tooltip = magic_conception_desc_tt
	}

	#2 - Shapechange into a Giant
	option = {
		name = magic_ruler.8.f	#available
		trigger = {
			has_ruler_flag = transmutation_2
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				current_age = age_of_revolutions
			}
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.20 }
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		random_list = {
			30 = {
				tooltip = {
					change_controller = ROOT
					add_devastation = 5
				}
			}
			70 = {
				tooltip = {
					add_province_modifier = {
						name = siege_magic_giant_besieger
						duration = 14
					}
				}
			}
		}
		custom_tooltip = magic_giant_desc_tt
	}
	option = {
		name = magic_ruler.8.fm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = transmutation_2 }
		}
		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_renowned_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		random_list = {
			30 = {
				tooltip = {
					change_controller = ROOT
					add_devastation = 5
				}
			}
			70 = {
				tooltip = {
					add_province_modifier = {
						name = siege_magic_giant_besieger
						duration = 14
					}
				}
			}
		}
		custom_tooltip = magic_giant_desc_tt
	}
	option = {
		name = magic_ruler.8.fx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = transmutation_2
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		random_list = {
			30 = {
				tooltip = {
					change_controller = ROOT
					add_devastation = 5
				}
			}
			70 = {
				tooltip = {
					add_province_modifier = {
						name = siege_magic_giant_besieger
						duration = 14
					}
				}
			}
		}
		custom_tooltip = magic_giant_desc_tt
	}

	#3 - Plant Growth III
	option = {	#available
		name = magic_ruler.8.g
		trigger = {
			has_ruler_flag = transmutation_3
			any_owned_province = {
				province_with_farm_goods = yes
				has_no_plant_growth_province_modifiers = yes
			}
			adm_power = 30
			dip_power = 5
			NOT = { has_ruler_modifier = magic_plant_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_capitalist
			}
		}

		add_adm_power = -30
		add_dip_power = -5
		country_event = { id = magic_ruler.17 }
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_4
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_4
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.gm
		trigger = {
			ai = no
			NOT = { has_ruler_flag = transmutation_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
		}
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_4
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_4
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.gx
		trigger = {
			ai = no
			has_ruler_flag = transmutation_3
			OR = {
				NOT = {
					any_owned_province = {
						province_with_farm_goods = yes
						has_no_plant_growth_province_modifiers = yes
					}
				}
				NOT = { adm_power = 30 }
				NOT = { dip_power = 5 }
				has_ruler_modifier = magic_plant_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_plant_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 30 } }
			custom_tooltip = magic_need_30_adm_tt
		}
		if = { limit = { NOT = { dip_power = 5 } }
			custom_tooltip = magic_need_5_dip_tt
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						province_with_farm_goods = yes
						has_no_plant_growth_province_modifiers = yes
					}
				}
			}
			custom_tooltip = magic_need_province_with_farms_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -30
			add_dip_power = -5
		}
		custom_tooltip = magic_selected_province_tt
		if = {
			limit = { has_ruler_flag = spring_old_patron }
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_4
					duration = 2555
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_4
					duration = 1825
				}
			}
		}

		custom_tooltip = magic_plant_growth_desc_tt
	}

	#3 - Enhance Ability II
	option = {	#available
		name = magic_ruler.8.h
		trigger = {
			OR = {
				has_ruler_flag = transmutation_3
				AND = {
					has_ruler_flag = hoko_patron
					has_ruler_flag = transmutation_2
				}
			}
			NOT = { has_ruler_modifier = magic_enhance_cooldown }
			OR = {
				NOT = { adm = 6 }
				NOT = { dip = 6 }
				NOT = { mil = 6 }
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}

		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		custom_tooltip = magic_enhance_effect_2_tt
		country_event = { id = magic_ruler.18 }

		custom_tooltip = magic_enhance_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.hm
		trigger = {
			ai = no
			NOT = {
				OR = {
					has_ruler_flag = transmutation_3
					AND = {
						has_ruler_flag = hoko_patron
						has_ruler_flag = transmutation_2
					}
				}
			}
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		custom_tooltip = magic_enhance_effect_2_tt

		custom_tooltip = magic_enhance_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.hx
		trigger = {
			ai = no
			OR = {
				has_ruler_flag = transmutation_3
				AND = {
					has_ruler_flag = hoko_patron
					has_ruler_flag = transmutation_2
				}
			}
			OR = {
				has_ruler_modifier = magic_enhance_cooldown
				AND = {
					adm = 6
					dip = 6
					mil = 6
				}
			}
		}
		if = { limit = { has_ruler_modifier = magic_enhance_cooldown }
			custom_tooltip = magic_5_year_cooldown_tt
		}
		if = {
			limit = {
				adm = 6
				dip = 6
				mil = 6
			}
			custom_tooltip = magic_need_ruler_without_max_skills_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		if = { limit = { has_ruler_flag = hoko_patron }
			custom_tooltip = magic_spell_available_by_patron_tt
		}

		custom_tooltip = magic_enhance_effect_2_tt

		custom_tooltip = magic_enhance_desc_tt
	}

	#3 - Rite of Conception II
	option = {	#available
		name = magic_ruler.8.i
		trigger = {
			OR = {
				AND = {
					has_ruler_flag = transmutation_3
					has_ruler_flag = abjuration_1
				}
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
			adm_power = 100
			NOT = { government = theocracy }
			NOT = { has_adventurer_reform = yes }
			has_government_attribute = heir
			is_lesser_in_union = no
			NOT = { ruler_is_immortal = yes }
			NOT = { has_ruler_modifier = magic_conception_cooldown }
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				has_heir = no
			}
			modifier = {
				factor = 2
				has_heir = yes
				NOT = {
					heir_has_mage_personality = yes
					has_heir_flag = heir_consort_mage_personality
				}
			}
		}
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_conception_cooldown duration = 30 hidden = yes }

		add_adm_power = -100

		if = {
			limit = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
			custom_tooltip = magic_estate_rite_of_conception_tooltip_tt
			tooltip = {
				define_heir = {
					dynasty = ROOT
					claim = 100
					no_consort_with_heir = yes
					hidden = yes
				}
				set_heir_mage_effect = yes
			}
		}
		else_if = { limit = { has_consort = no }
			set_country_flag = spell_3
			tooltip = {
				random_list = {
					45 = {
						define_heir = {
							dynasty = ROOT
							claim = 20
							no_consort_with_heir = yes
							hidden = yes
						}
						set_heir_mage_effect = yes
					}
					50 = { }
					5 = { kill_ruler = yes }
				}
			}
		}
		else_if = {
			limit = {
				ruler_has_mage_personality = yes
				consort_has_mage_personality = yes
			}
			set_country_flag = spell_1
			tooltip = {
				random_list = {
					65 = {
						define_heir = {
							dynasty = ROOT
							claim = 100
							hidden = yes
						}
						set_heir_mage_effect = yes
					}
					30 = { }
					5 = { remove_consort_effect = yes }
				}
			}
		}
		else = {
			set_country_flag = spell_2
			tooltip = {
				random_list = {
					50 = {
						define_heir = {
							dynasty = ROOT
							claim = 100
							hidden = yes
						}
						set_heir_mage_effect = yes
					}
					40 = { }
					5 = { kill_ruler = yes }
					5 = { remove_consort_effect = yes }
				}
			}
		}

		hidden_effect = { country_event = { id = magic_ruler.20 } }

		set_country_flag = transmutation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_conception_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.im
		trigger = {
			ai = no
			OR = {
				AND = {
					has_ruler_flag = transmutation_3
					has_ruler_flag = abjuration_1
				}
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		if = { limit = { NOT = { has_ruler_flag = transmutation_3 } }
			custom_tooltip = school_mastery_not_legendary_tt
		}
		if = { limit = { NOT = { has_ruler_flag = abjuration_1 } }
			custom_tooltip = school_mastery_abjuration_not_talented_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -100
			if = {
				limit = {
					OR = {
						has_country_flag = tughayasa_reward_primary
						has_country_flag = tughayasa_reward
					}
				}
				tooltip = {
					define_heir = {
						dynasty = ROOT
						claim = 100
						no_consort_with_heir = yes
						hidden = yes
					}
					set_heir_mage_effect = yes
					}
				}
			else_if = { limit = { has_consort = no }
				set_country_flag = spell_3
				tooltip = {
					random_list = {
						45 = {
							define_heir = {
								dynasty = ROOT
								claim = 20
								no_consort_with_heir = yes
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						50 = { }
						5 = { kill_ruler = yes }
					}
				}
			}
			else_if = {
				limit = {
					ruler_has_mage_personality = yes
					consort_has_mage_personality = yes
				}
				set_country_flag = spell_1
				tooltip = {
					random_list = {
						65 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						30 = { }
						5 = { remove_consort_effect = yes }
					}
				}
			}
			else = {
				set_country_flag = spell_2
				tooltip = {
					random_list = {
						50 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						40 = { }
						5 = { kill_ruler = yes }
						5 = { remove_consort_effect = yes }
					}
				}
			}
		}

		custom_tooltip = magic_conception_desc_tt
	}
	option = {	#unavailable - other
		name = magic_ruler.8.ix
		trigger = {
			ai = no
			OR = {
				AND = {
					has_ruler_flag = transmutation_3
					has_ruler_flag = abjuration_1
				}
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
			OR = {
				NOT = { adm_power = 100 }
				government = theocracy
				has_adventurer_reform = yes
				NOT = { has_government_attribute = heir }
				is_lesser_in_union = yes
				ruler_is_immortal = yes
				has_ruler_modifier = magic_conception_cooldown
			}
		}
		if = { limit = { has_ruler_modifier = magic_conception_cooldown }
			custom_tooltip = magic_1_month_cooldown_tt
		}
		if = { limit = { NOT = { adm_power = 100 } }
			custom_tooltip = magic_need_100_adm_tt
		}
		if = { limit = { government = theocracy }
			custom_tooltip = magic_no_theocracy_tt
		}
		if = { limit = { NOT = { has_government_attribute = heir } }
			custom_tooltip = magic_government_allow_heirs_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = { limit = { ruler_is_immortal = yes }
			custom_tooltip = magic_ruler_is_mortal_tt
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			add_adm_power = -100
			if = {
				limit = {
					OR = {
						has_country_flag = tughayasa_reward_primary
						has_country_flag = tughayasa_reward
					}
				}
				tooltip = {
					define_heir = {
						dynasty = ROOT
						claim = 100
						no_consort_with_heir = yes
						hidden = yes
					}
					set_heir_mage_effect = yes
				}
			}
			else_if = { limit = { has_consort = no }
				set_country_flag = spell_3
				tooltip = {
					random_list = {
						45 = {
							define_heir = {
								dynasty = ROOT
								claim = 20
								no_consort_with_heir = yes
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						50 = { }
						5 = { kill_ruler = yes }
					}
				}
			}
			else_if = {
				limit = {
					ruler_has_mage_personality = yes
					consort_has_mage_personality = yes
				}
				set_country_flag = spell_1
				tooltip = {
					random_list = {
						65 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						30 = { }
						5 = { remove_consort_effect = yes }
					}
				}
			}
			else = {
				set_country_flag = spell_2
				tooltip = {
					random_list = {
						50 = {
							define_heir = {
								dynasty = ROOT
								claim = 100
								hidden = yes
							}
							set_heir_mage_effect = yes
						}
						40 = { }
						5 = { kill_ruler = yes }
						5 = { remove_consort_effect = yes }
					}
				}
			}
		}

		custom_tooltip = magic_conception_desc_tt
	}

	#3 - Shapechange into a Dragon
	option = {
		name = magic_ruler.8.j	#available
		trigger = {
			has_ruler_flag = transmutation_3
			is_at_war = yes
			is_lesser_in_union = no
			any_army = {
				location = {
					fort_level = 1
					sieged_by = ROOT
					unit_has_leader = yes
				}
			}
			NOT = { has_ruler_modifier = magic_siege_cooldown }
		}
		ai_chance = {
			factor = 50
		}

		random_province = {
			limit = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			hidden_effect = {
				save_event_target_as = spell_target_province	#this works yo
			}
		}
		country_event = { id = magic_siege.23 }
		custom_tooltip = magic_if_siege_magic_succeeds_tt
		random_list = {
			30 = {
				tooltip = {
					change_controller = ROOT
					add_devastation = 10
				}
			}
			70 = {
				tooltip = {
					add_province_modifier = {
						name = siege_magic_dragon_besieger
						duration = 14
					}
				}
			}
		}
		custom_tooltip = magic_dragon_desc_tt
	}
	option = {
		name = magic_ruler.8.jm	#unavailable - low mastery
		trigger = {
			ai = no
			NOT = { has_ruler_flag = transmutation_3 }
		}
		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = school_mastery_not_legendary_tt

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		random_list = {
			30 = {
				tooltip = {
					change_controller = ROOT
					add_devastation = 10
				}
			}
			70 = {
				tooltip = {
					add_province_modifier = {
						name = siege_magic_dragon_besieger
						duration = 14
					}
				}
			}
		}
		custom_tooltip = magic_dragon_desc_tt
	}
	option = {
		name = magic_ruler.8.jx	#unavailable - other
		trigger = {
			ai = no
			has_ruler_flag = transmutation_3
			OR = {
				is_at_war = no
				is_lesser_in_union = yes
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
				has_ruler_modifier = magic_siege_cooldown
			}
		}
		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		if = { limit = { has_ruler_modifier = magic_siege_cooldown }
			custom_tooltip = magic_siege_cooldown_tt
		}
		if = { limit = { is_at_war = no }
			custom_tooltip = magic_is_at_war_tt
		}
		if = { limit = { is_lesser_in_union = yes }
			custom_tooltip = magic_is_not_in_lesser_union_tt
		}
		if = {
			limit = {
				NOT = {
					any_army = {
						location = {
							fort_level = 1
							sieged_by = ROOT
							unit_has_leader = yes
						}
					}
				}
			}
			custom_tooltip = magic_leadered_army_sieging_tt
		}

		custom_tooltip = magic_effect_separator_tt

		custom_tooltip = magic_if_siege_magic_succeeds_tt
		random_list = {
			30 = {
				tooltip = {
					change_controller = ROOT
					add_devastation = 10
				}
			}
			70 = {
				tooltip = {
					add_province_modifier = {
						name = siege_magic_dragon_besieger
						duration = 14
					}
				}
			}
		}
		custom_tooltip = magic_dragon_desc_tt
	}

	#3 - Homunculus
	option = {	#available
		name = magic_ruler.8.k
		trigger = {
			has_ruler_flag = transmutation_3
			NOT = { magical_project_in_progress = yes }
			NOT = { has_ruler_flag = magic_project_homunculus_complete }
			adm_power = 50
			dip_power = 50
			mil_power = 50
		}
		ai_chance = {
			factor = 50
		}
		increase_witch_king_points_medium = yes

		add_adm_power = -50
		add_dip_power = -50
		add_mil_power = -50

		magic_casted_spell = yes
		set_ruler_flag = magic_project_homunculus_started

		custom_tooltip = tooltip_magic_project_start

		set_country_flag = transmutation_menu
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_homunculus_desc_tt
	}
	option = {	#unavailable - low mastery
		name = magic_ruler.8.km
		trigger = {
			ai = no
			NOT = { has_ruler_flag = transmutation_3 }
		}
		custom_tooltip = school_mastery_not_legendary_tt

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			increase_witch_king_points_medium = yes

			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_homunculus_desc_tt
	}
	option = {	#unavailable
		name = magic_ruler.8.kx
		trigger = {
			ai = no
			has_ruler_flag = transmutation_3
			OR = {
				magical_project_in_progress = yes
				has_ruler_flag = magic_project_homunculus_complete
				NOT = { adm_power = 50 }
				NOT = { dip_power = 50 }
				NOT = { mil_power = 50 }
			}
		}
		if = { limit = { has_ruler_flag = magic_project_homunculus_complete }
			custom_tooltip = magic_project_already_done_tt
		}
		else = {
			if = { limit = { has_ruler_flag = magic_project_homunculus_started }
				custom_tooltip = magic_project_started_tt
			}
			else_if = { limit = { magical_project_in_progress = yes }
				custom_tooltip = magic_other_project_in_progress_tt
			}
			if = { limit = { NOT = { adm_power = 50 } }
				custom_tooltip = magic_need_50_adm_tt
			}
			if = { limit = { NOT = { dip_power = 50 } }
				custom_tooltip = magic_need_50_dip_tt
			}
			if = { limit = { NOT = { mil_power = 50 } }
				custom_tooltip = magic_need_50_mil_tt
			}
		}

		set_country_flag = transmutation_menu
		clr_ruler_flag = magic_just_casted_spell
		hidden_effect = { country_event = { id = magic_ruler.9 } }

		custom_tooltip = magic_effect_separator_tt

		tooltip = {
			increase_witch_king_points_medium = yes

			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
		}
		custom_tooltip = tooltip_magic_project_start

		custom_tooltip = magic_homunculus_desc_tt
	}

	#Go back
	option = {
		name = magic_ruler.1.z
		trigger = { ai = no }
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		clr_ruler_flag = magic_just_casted_spell
	}
}

#
country_event = {
	id = magic_ruler.9
	title = magic_ruler.9.t
	desc = magic_ruler.9.d
	picture = EMPTY_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_ruler.9.a
		trigger_switch = {
			on_trigger = has_country_flag
			abjuration_menu = { country_event = { id = magic_ruler.1 } clr_country_flag = abjuration_menu }
			conjuration_menu = { country_event = { id = magic_ruler.2 } clr_country_flag = conjuration_menu }
			divination_menu = { country_event = { id = magic_ruler.3 } clr_country_flag = divination_menu }
			enchantment_menu = { country_event = { id = magic_ruler.4 } clr_country_flag = enchantment_menu }
			evocation_menu = { country_event = { id = magic_ruler.5 } clr_country_flag = evocation_menu }
			illusion_menu = { country_event = { id = magic_ruler.6 } clr_country_flag = illusion_menu }
			necromancy_menu = { country_event = { id = magic_ruler.7 } clr_country_flag = necromancy_menu }
			transmutation_menu = { country_event = { id = magic_ruler.8 } clr_country_flag = transmutation_menu }
			siege_magic_menu = { country_event = { id = magic_siege.1 } clr_country_flag = siege_magic_menu }
		}
	}
}


#-----# Abjuration Spells #-----#

#Ward
country_event = {
	id = magic_ruler.10
	title = magic_ruler.10.t
	desc = magic_ruler.10.d
	picture = CIVIL_WAR_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
				}
				save_event_target_as = ward_province_1
			}
			random_owned_province = {	#random province
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
					is_in_capital_area = yes
				}
				save_event_target_as = ward_province_1
			}
			random_owned_province = {
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
				}
				save_event_target_as = ward_province_2
			}
			random_owned_province = {	#province with fort
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
					fort_level = 3
				}
				save_event_target_as = ward_province_2
			}
			random_owned_province = {
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
				}
				save_event_target_as = ward_province_3
			}
			random_owned_province = {	#high dev
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
					development = 12
				}
				save_event_target_as = ward_province_3
			}
			random_owned_province = {
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
				}
				save_event_target_as = ward_province_4
			}
			random_owned_province = {	#ruler general location
				limit = {
					has_no_ward_province_modifiers = yes
					is_city = yes
					has_ruler_leader_from = ROOT
				}
				save_event_target_as = ward_province_4
			}
		}
	}

	option = {	# Create Wards on
		name = magic_ruler.10.a
		ai_chance = { factor = 50 }
		goto = ward_province_1

		trigger = {
			has_saved_event_target = ward_province_1
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_ward_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = abjuration_2 }
			event_target:ward_province_1 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_empowered_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_empowered_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 3
						length = 9131
					}
				}
			}
		}
		else = {
			event_target:ward_province_1 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 2
						length = 9131
					}
				}
			}
		}
	}

	option = {	# Create Wards on
		name = magic_ruler.10.b
		ai_chance = { factor = 50 }
		goto = ward_province_2

		trigger = {
			has_saved_event_target = ward_province_2
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_ward_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = abjuration_2 }
			event_target:ward_province_2 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_empowered_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_empowered_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 3
						length = 9131
					}
				}
			}
		}
		else = {
			event_target:ward_province_2 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 2
						length = 9131
					}
				}
			}
		}
	}

	option = {	# Create Wards on
		name = magic_ruler.10.c
		ai_chance = { factor = 50 }
		goto = ward_province_3

		trigger = {
			has_saved_event_target = ward_province_3
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_ward_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = abjuration_2 }
			event_target:ward_province_3 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_empowered_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_empowered_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 3
						length = 9131
					}
				}
			}
		}
		else = {
			event_target:ward_province_3 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 2
						length = 9131
					}
				}
			}
		}
	}

	option = {	# Create Wards on
		name = magic_ruler.10.e
		ai_chance = { factor = 50 }
		goto = ward_province_4

		trigger = {
			has_saved_event_target = ward_province_4
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_ward_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = abjuration_2 }
			event_target:ward_province_4 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_empowered_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_empowered_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 3
						length = 9131
					}
				}
			}
		}
		else = {
			event_target:ward_province_4 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = maiden_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_patron_abjuration_ward
						duration = 9131
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_abjuration_ward
						duration = 9131
					}
				}
				#Kheionai windward boost
				if = {
					limit = {
						region = alecand_region
					}
					add_temporary_windward_level = {
						level = 2
						length = 9131
					}
				}
			}
		}
	}

	option = {	#Option B: Go back
		name = magic_siege.goback
		ai_chance = {
			factor = 5
		}
		add_adm_power = 30
		add_dip_power = 5
	}

	after = {
		if = {
			limit = {
				ai = yes	#makes ai back out of casting completely to prevent spam
			}
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			country_event = { id = magic_ruler.1 }
		}
	}
}

#Host Magical Feast
country_event = {
	id = magic_ruler.11
	title = magic_ruler.11.t
	desc = magic_ruler.11.d
	picture = KING_DOING_GREAT_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_ally = {
				save_event_target_as = magic_ally_1
			}
			if = {
				limit = { num_of_allies = 2 }
				random_ally = {
					limit = { NOT = { tag = event_target:magic_ally_1 } }
					save_event_target_as = magic_ally_2
				}
			}
			if = {
				limit = { num_of_allies = 3 }
				random_ally = {
					limit = { NOT = { tag = event_target:magic_ally_1 tag = event_target:magic_ally_2 } }
					save_event_target_as = magic_ally_3
				}
			}
			if = {
				limit = { num_of_allies = 4 }
				random_ally = {
					limit = { NOT = { tag = event_target:magic_ally_1 tag = event_target:magic_ally_2 tag = event_target:magic_ally_3 } }
					save_event_target_as = magic_ally_4
				}
			}
		}
	}

	option = {	#Ally 1
		name = magic_ruler.11.a
		trigger = {
			has_ruler_flag = conjuration_1
		}
		ai_chance = {
			factor = 50
		}
		goto = magic_ally_1

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_feast_cooldown duration = 30 hidden = yes }

		if = {
			limit = { has_ruler_flag = conjuration_2 }
			event_target:magic_ally_1 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast_greater
					years = 5
				}
			}
		}
		else = {
			event_target:magic_ally_1 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast
					years = 5
				}
			}
		}
	}

	option = {	#Ally 2
		name = magic_ruler.11.b
		trigger = {
			num_of_allies = 2
		}
		ai_chance = {
			factor = 50
		}
		goto = magic_ally_2

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_feast_cooldown duration = 30 hidden = yes }

		if = {
			limit = { has_ruler_flag = conjuration_2 }
			event_target:magic_ally_2 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast_greater
					years = 5
				}
			}
		}
		else = {
			event_target:magic_ally_2 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast
					years = 5
				}
			}
		}
	}

	option = {	#Ally 3
		name = magic_ruler.11.c
		trigger = {
			num_of_allies = 3
		}
		ai_chance = {
			factor = 50
		}
		goto = magic_ally_3

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_feast_cooldown duration = 30 hidden = yes }

		if = {
			limit = { has_ruler_flag = conjuration_2 }
			event_target:magic_ally_3 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast_greater
					years = 5
				}
			}
		}
		else = {
			event_target:magic_ally_3 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast
					years = 5
				}
			}
		}
	}

	option = {	#Ally 4
		name = magic_ruler.11.e
		trigger = {
			num_of_allies = 4
		}
		ai_chance = {
			factor = 50
		}
		goto = magic_ally_4

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_feast_cooldown duration = 30 hidden = yes }

		if = {
			limit = { has_ruler_flag = conjuration_2 }
			event_target:magic_ally_4 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast_greater
					years = 5
				}
			}
		}
		else = {
			event_target:magic_ally_4 = {
				add_opinion = {
					who = ROOT
					modifier = opinion_magical_feast
					years = 5
				}
			}
		}
	}

	option = {	#Option B: Go back
		name = magic_siege.goback
		ai_chance = {
			factor = 5
		}
		add_dip_power = 15
	}

	after = {
		if = {
			limit = {
				ai = yes	#makes ai back out of casting completely to prevent spam
			}
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			country_event = { id = magic_ruler.2 }
		}
	}
}

#Conjure Magical Fortress
country_event = {
	id = magic_ruler.12
	title = magic_ruler.12.t
	desc = magic_ruler.12.d
	picture = KING_DOING_GREAT_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					NOT = { has_building = fort_magic }
					is_core = ROOT
					is_city = yes
				}
				save_event_target_as = fort_magic_province_1
			}
			random_owned_province = {	#random province
				limit = {
					NOT = { has_building = fort_magic }
					is_core = ROOT
					is_city = yes
					is_in_capital_area = yes
				}
				save_event_target_as = fort_magic_province_1
			}
			random_owned_province = {
				limit = {
					NOT = { has_building = fort_magic }
					is_core = ROOT
					is_city = yes
				}
				save_event_target_as = fort_magic_province_2
			}
			random_owned_province = {	#province with fort
				limit = {
					NOT = { has_building = fort_magic }
					is_core = ROOT
					is_city = yes
					fort_level = 3
				}
				save_event_target_as = fort_magic_province_2
			}
			random_owned_province = {
				limit = {
					NOT = { has_building = fort_magic }
					is_core = ROOT
					is_city = yes
				}
				save_event_target_as = fort_magic_province_3
			}
			random_owned_province = {	#high dev
				limit = {
					NOT = { has_building = fort_magic }
					is_core = ROOT
					is_city = yes
					development = 12
				}
				save_event_target_as = fort_magic_province_3
			}
		}
	}

	#1
	option = {
		name = magic_ruler.12.a
		ai_chance = {
			factor = 50
		}
		goto = fort_magic_province_1

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_fortress_cooldown duration = 30 hidden = yes }

		event_target:fort_magic_province_1 = {
			add_building_construction = {
				building = fort_magic
				speed = 0.5
				cost = 0
			}
		}
	}

	#2
	option = {
		name = magic_ruler.12.b
		ai_chance = {
			factor = 50
		}
		goto = fort_magic_province_2

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_fortress_cooldown duration = 30 hidden = yes }

		event_target:fort_magic_province_2 = {
			add_building_construction = {
				building = fort_magic
				speed = 0.5
				cost = 0
			}
		}
	}

	#3
	option = {
		name = magic_ruler.12.c
		ai_chance = {
			factor = 50
		}
		goto = fort_magic_province_3

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_fortress_cooldown duration = 30 hidden = yes }

		event_target:fort_magic_province_3 = {
			add_building_construction = {
				building = fort_magic
				speed = 0.5
				cost = 0
			}
		}
	}

	option = {	#Option B: Go back
		name = magic_siege.goback
		ai_chance = {
			factor = 5
		}
		add_adm_power = 100
		add_dip_power = 100
		add_mil_power = 100
	}

	after = {
		if = {
			limit = {
				ai = yes	#makes ai back out of casting completely to prevent spam
			}
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			country_event = { id = magic_ruler.2 }
		}
	}
}

# Absorb Life Energy
country_event = {
	id = magic_ruler.13
	title = magic_ruler.13.t
	desc = magic_ruler.13.d
	picture = NEW_HEIR_eventPicture

	is_triggered_only = yes

	option = {	#Absorb Heir
		name = magic_ruler.13.a
		trigger = {
			has_ruler_flag = necromancy_1
			has_heir = yes
			government = monarchy
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				government = monarchy
				OR = {
					heir_adm = 3
					heir_dip = 3
					heir_mil = 3
				}
			}
		}

		#Cost
		reduce_legitimacy_medium_effect = yes

		#Effect
		increase_witch_king_points_small = yes

		add_ruler_modifier = {	#For Witch King mtth
			name = magic_witch_king_drain_life
			duration = 1825
			hidden = yes
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_drain_cooldown duration = 365 hidden = yes }

		set_country_flag = spell_4
		tooltip = {
			random = {
				chance = 25
				kill_heir = { allow_new_heir = no }
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.15 } }

		set_country_flag = spell_1
		if = {
			limit = {
				has_ruler_flag = winter_everfrost_patron
			}
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 40
					}
					1 = {
						add_dip_power = 40
					}
					1 = {
						add_mil_power = 40
					}
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 30
					}
					1 = {
						add_dip_power = 30
					}
					1 = {
						add_mil_power = 30
					}
				}
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.14 } }
	}

	option = {	#Absorb Consort
		name = magic_ruler.13.b
		trigger = {
			has_ruler_flag = necromancy_1
			has_consort = yes
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				OR = {
					consort_adm = 3
					consort_dip = 3
					consort_mil = 3
				}
			}
		}

		#Cost
		reduce_legitimacy_small_effect = yes
		add_prestige = -2

		#Effect
		increase_witch_king_points_small = yes

		add_ruler_modifier = {	#For Witch King mtth
			name = magic_witch_king_drain_life
			duration = 1825
			hidden = yes
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_drain_cooldown duration = 365 hidden = yes }

		set_country_flag = spell_5
		tooltip = {
			random = {
				chance = 25
				remove_consort_effect = yes
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.15 } }

		set_country_flag = spell_2
		if = {
			limit = {
				has_ruler_flag = winter_everfrost_patron
			}
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 30
					}
					1 = {
						add_dip_power = 30
					}
					1 = {
						add_mil_power = 30
					}
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 20
					}
					1 = {
						add_dip_power = 20
					}
					1 = {
						add_mil_power = 20
					}
				}
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.14 } }
	}

	option = {	#Absorb Advisor
		name = magic_ruler.13.c
		trigger = {
			has_ruler_flag = necromancy_1
			has_advisor = yes
		}
		ai_chance = {
			factor = 50
		}

		#Cost
		add_prestige = -5

		#Effect
		increase_witch_king_points_small = yes

		add_ruler_modifier = {	#For Witch King mtth
			name = magic_witch_king_drain_life
			duration = 1825
			hidden = yes
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_drain_cooldown duration = 365 hidden = yes }

		set_country_flag = spell_6
		tooltip = {
			random = {
				chance = 25
				custom_tooltip = kill_random_advisor_tt
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.15 } }

		set_country_flag = spell_2
		if = {
			limit = {
				has_ruler_flag = winter_everfrost_patron
			}
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 30
					}
					1 = {
						add_dip_power = 30
					}
					1 = {
						add_mil_power = 30
					}
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 20
					}
					1 = {
						add_dip_power = 20
					}
					1 = {
						add_mil_power = 20
					}
				}
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.14 } }
	}

	option = {	#Absorb the Populace
		name = magic_ruler.13.e
		trigger = {
			has_ruler_flag = necromancy_1
			any_owned_province = {
				base_tax = 2
				base_production = 2
				base_manpower = 2
				NOT = { devastation = 50 }
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.75
				NOT = { num_of_cities = 20 }
			}
		}

		#Cost

		#Effect
		increase_witch_king_points_medium = yes

		add_ruler_modifier = {	#For Witch King mtth
			name = magic_witch_king_drain_life
			duration = 1825
			hidden = yes
		}

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_drain_cooldown duration = 365 hidden = yes }

		random_owned_province = {
			limit = {
				base_tax = 2
				base_production = 2
				base_manpower = 2
				NOT = { devastation = 50 }
			}
			tooltip = {
				random_list = {
					10 = {
						add_base_tax = -1
					}
					10 = {
						add_base_production = -1
					}
					10 = {
						add_base_manpower = -1
					}
				}
			}
			hidden_effect = { province_event = { id = magic_ruler.16 } }
			add_devastation = 20
		}

		set_country_flag = spell_3
		if = {
			limit = {
				has_ruler_flag = winter_everfrost_patron
			}
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 70
					}
					1 = {
						add_dip_power = 70
					}
					1 = {
						add_mil_power = 70
					}
				}
			}
			custom_tooltip = magic_booster_by_patron_tt
		}
		else = {
			tooltip = {
				random_list = {
					1 = {
						add_adm_power = 50
					}
					1 = {
						add_dip_power = 50
					}
					1 = {
						add_mil_power = 50
					}
				}
			}
		}
		hidden_effect = { country_event = { id = magic_ruler.14 } }
	}

	option = {	#Option B: Go back
		name = magic_siege.goback
		ai_chance = {
			factor = 5
		}
		add_adm_power = 5
		add_mil_power = 5
	}

	after = {
		if = {
			limit = {
				ai = yes	#makes ai back out of casting completely to prevent spam
			}
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			country_event = { id = magic_ruler.7 }
		}
	}
}

#Result Selection for power type
country_event = {
	id = magic_ruler.14
	title = magic_ruler.14.t
	desc = magic_ruler.14.d
	picture = TEMPORAL_RIFT_eventPicture

	hidden = yes
	is_triggered_only = yes

	option = { #Adm
		name = magic_ruler.14.a
		ai_chance = { factor = 33 }
		if = { limit = { has_country_flag = spell_1 }
			add_adm_power = 30
		}
		else_if = { limit = { has_country_flag = spell_2 }
			add_adm_power = 20
		}
		else_if = { limit = { has_country_flag = spell_3 }
			add_adm_power = 50
		}
	}
	option = { #Dip
		name = magic_ruler.14.a
		ai_chance = { factor = 33 }
		if = { limit = { has_country_flag = spell_1 }
			add_dip_power = 30
		}
		else_if = { limit = { has_country_flag = spell_2 }
			add_dip_power = 20
		}
		else_if = { limit = { has_country_flag = spell_3 }
			add_dip_power = 50
		}
	}
	option = { #Mil
		name = magic_ruler.14.a
		ai_chance = { factor = 10 }
		if = { limit = { has_country_flag = spell_1 }
			add_mil_power = 30
		}
		else_if = { limit = { has_country_flag = spell_2 }
			add_mil_power = 20
		}
		else_if = { limit = { has_country_flag = spell_3 }
			add_mil_power = 50
		}
	}

	after = {
		clr_country_flag = spell_1
		clr_country_flag = spell_2
		clr_country_flag = spell_3
	}
}

#Result Selection for drain target death
country_event = {
	id = magic_ruler.15
	title = magic_ruler.14.t
	desc = magic_ruler.14.d
	picture = TEMPORAL_RIFT_eventPicture

	hidden = yes
	is_triggered_only = yes

	option = { #Death
		name = magic_ruler.14.a
		ai_chance = {
			factor = 25
		}
		if = { limit = { has_country_flag = spell_4 }
			kill_heir = { allow_new_heir = no }
		}
		else_if = { limit = { has_country_flag = spell_5 }
			remove_consort_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_6 }
			kill_advisor = random
		}
	}
	option = { #No death
		name = magic_ruler.14.a
		ai_chance = {
			factor = 75
		}
	}
	after = {
		clr_country_flag = spell_4
		clr_country_flag = spell_5
		clr_country_flag = spell_6
	}
}

#Result Selection for prov dev drain
province_event = {
	id = magic_ruler.16
	title = magic_ruler.14.t
	desc = magic_ruler.14.d
	picture = TEMPORAL_RIFT_eventPicture

	hidden = yes
	is_triggered_only = yes

	option = { #Adm
		name = magic_ruler.14.a
		ai_chance = { factor = 33 }
		add_base_tax = -1
	}
	option = { #Dip
		name = magic_ruler.14.a
		ai_chance = { factor = 33 }
		add_base_production = -1
	}
	option = { #Mil
		name = magic_ruler.14.a
		ai_chance = { factor = 33 }
		add_base_manpower = -1
	}
}

# 1 - Encourage Plant Growth
country_event = {
	id = magic_ruler.17
	title = magic_ruler.17.t
	desc = magic_ruler.17.d
	picture = FARMING_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
				}
				save_event_target_as = plant_growth_province_1
			}
			random_owned_province = {	#capital area
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
					is_in_capital_area = yes
				}
				save_event_target_as = plant_growth_province_1
			}
			random_owned_province = {
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
				}
				save_event_target_as = plant_growth_province_2
			}
			random_owned_province = {	#province with workshop or manufactory
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
					OR = {
						has_production_building_trigger = yes
						has_manufactory_trigger = yes
					}
				}
				save_event_target_as = plant_growth_province_2
			}
			random_owned_province = {
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
				}
				save_event_target_as = plant_growth_province_3
			}
			random_owned_province = {	#high production
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
					base_production = 12
				}
				save_event_target_as = plant_growth_province_3
			}
			random_owned_province = {
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
				}
				save_event_target_as = plant_growth_province_4
			}
			random_owned_province = {	#ruler general location
				limit = {
					has_no_plant_growth_province_modifiers = yes
					province_with_farm_goods = yes
					is_city = yes
					has_ruler_leader_from = ROOT
				}
				save_event_target_as = plant_growth_province_4
			}
		}
	}

	option = {	# Province target
		name = magic_ruler.17.a
		trigger = {
			NOT = { has_country_flag = better_plant_growth }
		}
		ai_chance = {
			factor = 50
		}
		goto = plant_growth_province_1

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_plant_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			event_target:plant_growth_province_1 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 1825 #5 years
					}
				}
			}
		}
		else_if = { limit = { has_ruler_flag = transmutation_2 }
			event_target:plant_growth_province_1 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 1825 #5 years
					}
				}
			}
		}
		else = {
			event_target:plant_growth_province_1 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 3650 #5 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 1825 #5 years
					}
				}
			}
		}
	}

	option = {	# Province target
		name = magic_ruler.17.b
		trigger = {
			has_saved_event_target = plant_growth_province_2
			NOT = { has_country_flag = better_plant_growth }
		}
		ai_chance = {
			factor = 50
		}
		goto = plant_growth_province_2

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_plant_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			event_target:plant_growth_province_2 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 1825 #5 years
					}
				}
			}
		}
		else_if = { limit = { has_ruler_flag = transmutation_2 }
			event_target:plant_growth_province_2 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 1825 #5 years
					}
				}
			}
		}
		else = {
			event_target:plant_growth_province_2 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 3650 #5 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 1825 #5 years
					}
				}
			}
		}
	}

	option = {	# Province target
		name = magic_ruler.17.c
		trigger = {
			has_saved_event_target = plant_growth_province_3
			NOT = { has_country_flag = better_plant_growth }
		}
		ai_chance = {
			factor = 50
		}
		goto = plant_growth_province_3

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_plant_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			event_target:plant_growth_province_3 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 1825 #5 years
					}
				}
			}
		}
		else_if = { limit = { has_ruler_flag = transmutation_2 }
			event_target:plant_growth_province_3 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 1825 #5 years
					}
				}
			}
		}
		else = {
			event_target:plant_growth_province_3 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 1825 #5 years
					}
				}
			}
		}
	}

	option = {	# Province target
		name = magic_ruler.17.e
		trigger = {
			has_saved_event_target = plant_growth_province_4
			NOT = { has_country_flag = better_plant_growth }
		}
		ai_chance = {
			factor = 50
		}
		goto = plant_growth_province_4

		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_plant_cooldown duration = 30 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			event_target:plant_growth_province_4 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_4
						duration = 1825 #5 years
					}
				}
			}
		}
		else_if = { limit = { has_ruler_flag = transmutation_2 }
			event_target:plant_growth_province_4 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_3
						duration = 1825 #5 years
					}
				}
			}
		}
		else = {
			event_target:plant_growth_province_4 = {
				if = {
					limit = {
						ROOT = {
							OR = {
								has_ruler_flag = yaksha_patron
								has_ruler_flag = nang_patron
								has_ruler_flag = manifestation_of_surael_patron
							}
						}
					}
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 3650 #10 years
					}
					custom_tooltip = magic_booster_by_patron_tt
				}
				else = {
					add_province_modifier = {
						name = magic_realm_transmutation_plant_growth_2
						duration = 1825 #5 years
					}
				}
			}
		}
	}

	option = {	#Eilisin Exception; targets capital
		name = magic_ruler.17.f
		trigger = {
			capital_scope = {
				province_with_farm_goods = yes
				is_in_capital_area = yes
				NOT = { has_province_modifier = magic_realm_transmutation_plant_growth_1 }
				NOT = { has_province_modifier = magic_realm_transmutation_plant_growth_2 }
				NOT = { has_province_modifier = magic_realm_transmutation_plant_growth_3 }
			}
			has_country_flag = better_plant_growth
		}
		ai_chance = {
			factor = 50
		}

		#Effect
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_plant_cooldown duration = 30 hidden = yes }

		if = {
			limit = { has_ruler_flag = transmutation_3 }
			capital_scope = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_3
					duration = 3650
				}
			}
		}
		else_if = {
			limit = { has_ruler_flag = transmutation_2 }
			capital_scope = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_2
					duration = 3650
				}
			}
		}
		else = {
			capital_scope = {
				add_province_modifier = {
					name = magic_realm_transmutation_plant_growth_1
					duration = 3650
				}
			}
		}
	}

	option = {	#Option B: Go back
		name = magic_siege.goback
		ai_chance = {
			factor = 5
		}
		add_adm_power = 30
		add_dip_power = 5
	}

	after = {
		if = {
			limit = {
				ai = yes	#makes ai back out of casting completely to prevent spam
			}
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			country_event = { id = magic_ruler.8 }
		}
	}
}

# 2 - Enchance Ability (its a temp stat increases) WHAT IF ITS PERMANENT? see notes
country_event = {
	id = magic_ruler.18
	title = magic_ruler.18.t
	desc = magic_ruler.18.d
	picture = BUDDHA_eventPicture

	is_triggered_only = yes

	#Cast Dame's Wisdom (adm)
	option = {	#available
		name = magic_ruler.18.a
		trigger = {
			NOT = { adm = 6 }
			enhance_ability_cost_adm_trigger = yes	#makes it available if country can afford it
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				NOT = { adm = 4 }
			}
		}

		#Cost
		if = {
			limit = {
				OR = {
					NOT = { adm = 3 }
					AND = {
						NOT = { adm = 4 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_adm_power = -100
		}
		else_if = {
			limit = {
				OR = {
					NOT = { adm = 4 }
					AND = {
						NOT = { adm = 5 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_adm_power = -200
		}
		else_if = {
			limit = {
				OR = {
					NOT = { adm = 5 }
					AND = {
						NOT = { adm = 6 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_adm_power = -300
		}
		else_if = {
			limit = {
				OR = {
					NOT = { adm = 6 }
					has_ruler_flag = transmutation_3
				}
			}
			add_adm_power = -400
		}
		else = {
			add_adm_power = -500
		}

		#Effect
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_enhance_cooldown duration = 1825 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			tooltip = {
				random_list = {
					70 = { increase_ruler_adm_effect = yes }
					25 = { }
					5 = { decrease_ruler_adm_effect = yes }
				}
			}
		}
		else = {
			tooltip = {
				random_list = {
					50 = { increase_ruler_adm_effect = yes }
					40 = { }
					10 = { decrease_ruler_adm_effect = yes }
				}
			}
		}

		set_country_flag = spell_1
		hidden_effect = { country_event = { id = magic_ruler.19 } }
	}
	option = {	#unavailable
		name = magic_ruler.18.ax
		trigger = {
			NOT = { enhance_ability_cost_adm_trigger = yes }
			NOT = { adm = 6 }
		}
		if = { limit = { has_ruler_flag = transmutation_3 }
			if = { limit = { adm = 5 }
				custom_tooltip = magic_need_500_adm_tt
			}
			else_if = { limit = { adm = 4 }
				custom_tooltip = magic_need_400_adm_tt
			}
			else_if = { limit = { adm = 3 }
				custom_tooltip = magic_need_300_adm_tt
			}
			else_if = { limit = { adm = 2 }
				custom_tooltip = magic_need_200_adm_tt
			}
			else = {
				custom_tooltip = magic_need_100_adm_tt
			}
		}
		else = {
			if = { limit = { adm = 5 }
				custom_tooltip = magic_need_400_adm_tt
			}
			else_if = { limit = { adm = 4 }
				custom_tooltip = magic_need_300_adm_tt
			}
			else_if = { limit = { adm = 3 }
				custom_tooltip = magic_need_200_adm_tt
			}
			else = {
				custom_tooltip = magic_need_100_adm_tt
			}
		}
	}

	option = {	#Cast Minara's Tongue (dip)
		name = magic_ruler.18.b
		trigger = {
			NOT = { dip = 6 }
			enhance_ability_cost_dip_trigger = yes	#makes it available if country can afford it
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				NOT = { dip = 4 }
			}
		}

		#Cost
		if = {
			limit = {
				OR = {
					NOT = { dip = 3 }
					AND = {
						NOT = { dip = 4 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_dip_power = -100
		}
		else_if = {
			limit = {
				OR = {
					NOT = { dip = 4 }
					AND = {
						NOT = { dip = 5 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_dip_power = -200
		}
		else_if = {
			limit = {
				OR = {
					NOT = { dip = 5 }
					AND = {
						NOT = { dip = 6 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_dip_power = -300
		}
		else_if = {
			limit = {
				OR = {
					NOT = { dip = 6 }
					has_ruler_flag = transmutation_3
				}
			}
			add_dip_power = -400
		}
		else = {
			add_dip_power = -500
		}

		#Effect
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_enhance_cooldown duration = 1825 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			random_list = {
				70 = { increase_ruler_dip_effect = yes }
				25 = { }
				5 = { decrease_ruler_dip_effect = yes }
			}
		}
		else = {
			random_list = {
				50 = { increase_ruler_dip_effect = yes }
				40 = { }
				10 = { decrease_ruler_dip_effect = yes }
			}
		}

		set_country_flag = spell_2
		hidden_effect = { country_event = { id = magic_ruler.19 } }
	}
	option = {	#unavailable
		name = magic_ruler.18.bx
		trigger = {
			NOT = { enhance_ability_cost_dip_trigger = yes }
			NOT = { dip = 6 }
		}
		if = { limit = { has_ruler_flag = transmutation_3 }
			if = { limit = { dip = 5 }
				custom_tooltip = magic_need_500_dip_tt
			}
			else_if = { limit = { dip = 4 }
				custom_tooltip = magic_need_400_dip_tt
			}
			else_if = { limit = { dip = 3 }
				custom_tooltip = magic_need_300_dip_tt
			}
			else_if = { limit = { dip = 2 }
				custom_tooltip = magic_need_200_dip_tt
			}
			else = {
				custom_tooltip = magic_need_100_dip_tt
			}
		}
		else = {
			if = { limit = { dip = 5 }
				custom_tooltip = magic_need_400_dip_tt
			}
			else_if = { limit = { dip = 4 }
				custom_tooltip = magic_need_300_dip_tt
			}
			else_if = { limit = { dip = 3 }
				custom_tooltip = magic_need_200_dip_tt
			}
			else = {
				custom_tooltip = magic_need_100_dip_tt
			}
		}
	}

	option = {	#Cast Adean's Might (mil)
		name = magic_ruler.18.c
		trigger = {
			NOT = { mil = 6 }
			enhance_ability_cost_mil_trigger = yes	#makes it available if country can afford it
		}

		#Cost
		if = {
			limit = {
				OR = {
					NOT = { mil = 3 }
					AND = {
						NOT = { mil = 4 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_mil_power = -100
		}
		else_if = {
			limit = {
				OR = {
					NOT = { mil = 4 }
					AND = {
						NOT = { mil = 5 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_mil_power = -200
		}
		else_if = {
			limit = {
				OR = {
					NOT = { mil = 5 }
					AND = {
						NOT = { mil = 6 }
						has_ruler_flag = transmutation_3
					}
				}
			}
			add_mil_power = -300
		}
		else_if = {
			limit = {
				OR = {
					NOT = { mil = 6 }
					has_ruler_flag = transmutation_3
				}
			}
			add_mil_power = -400
		}
		else = {
			add_mil_power = -500
		}

		#Effect
		magic_casted_spell = yes
		add_ruler_modifier = { name = magic_enhance_cooldown duration = 1825 hidden = yes }

		if = { limit = { has_ruler_flag = transmutation_3 }
			random_list = {
				70 = { increase_ruler_mil_effect = yes }
				25 = { }
				5 = { decrease_ruler_mil_effect = yes }
			}
		}
		else = {
			random_list = {
				50 = { increase_ruler_mil_effect = yes }
				40 = { }
				10 = { decrease_ruler_mil_effect = yes }
			}
		}

		set_country_flag = spell_3
		hidden_effect = { country_event = { id = magic_ruler.19 } }
	}
	option = {	#unavailable
		name = magic_ruler.18.cx
		trigger = {
			NOT = { enhance_ability_cost_mil_trigger = yes }
			NOT = { mil = 6 }
		}
		if = { limit = { has_ruler_flag = transmutation_3 }
			if = { limit = { mil = 5 }
				custom_tooltip = magic_need_500_mil_tt
			}
			else_if = { limit = { mil = 4 }
				custom_tooltip = magic_need_400_mil_tt
			}
			else_if = { limit = { mil = 3 }
				custom_tooltip = magic_need_300_mil_tt
			}
			else_if = { limit = { mil = 2 }
				custom_tooltip = magic_need_200_mil_tt
			}
			else = {
				custom_tooltip = magic_need_100_mil_tt
			}
		}
		else = {
			if = { limit = { mil = 5 }
				custom_tooltip = magic_need_400_mil_tt
			}
			else_if = { limit = { mil = 4 }
				custom_tooltip = magic_need_300_mil_tt
			}
			else_if = { limit = { mil = 3 }
				custom_tooltip = magic_need_200_mil_tt
			}
			else = {
				custom_tooltip = magic_need_100_mil_tt
			}
		}
	}

	option = {	#Option B: Go back
		name = magic_siege.goback
		ai_chance = {
			factor = 5
		}
	}

	after = {
		if = {
			limit = {
				ai = yes	#makes ai back out of casting completely to prevent spam
			}
			add_ruler_modifier = {
				name = magic_realm_menu_cooldown
				duration = 1825	#prevents them casting for 5 years
				hidden = yes
			}
			close_single_menu = yes
		}
		else = {
			country_event = { id = magic_ruler.8 }
		}
	}
}

#Result Selection for Enchance Ability Mil
country_event = {
	id = magic_ruler.19
	title = magic_ruler.14.t
	desc = magic_ruler.14.d
	picture = TEMPORAL_RIFT_eventPicture

	hidden = yes
	is_triggered_only = yes

	option = {
		name = magic_ruler.14.a	#Success
		trigger = { has_ruler_flag = transmutation_3 }
		ai_chance = {
			factor = 70
		}
		if = { limit = { has_country_flag = spell_1 }
			increase_ruler_adm_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_2 }
			increase_ruler_dip_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_3 }
			increase_ruler_mil_effect = yes
		}
	}
	option = {
		name = magic_ruler.14.a	#Success
		trigger = { NOT = { has_ruler_flag = transmutation_3 } }
		ai_chance = {
			factor = 50
		}
		if = { limit = { has_country_flag = spell_1 }
			increase_ruler_adm_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_2 }
			increase_ruler_dip_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_3 }
			increase_ruler_mil_effect = yes
		}
	}

	option = {	#Failure - no consequences
		name = magic_ruler.14.a
		trigger = { has_ruler_flag = transmutation_3 }
		ai_chance = {
			factor = 25
		}
	}
	option = {	#Failure - no consequences
		name = magic_ruler.14.a
		trigger = { NOT = { has_ruler_flag = transmutation_3 } }
		ai_chance = {
			factor = 40
		}
	}

	option = {	#Failure - with consequences
		name = magic_ruler.14.a
		trigger = { has_ruler_flag = transmutation_3 }
		ai_chance = {
			factor = 5
		}
		if = { limit = { has_country_flag = spell_1 }
			decrease_ruler_adm_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_2 }
			decrease_ruler_dip_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_3 }
			decrease_ruler_mil_effect = yes
		}
	}
	option = {	#Failure - with consequences
		name = magic_ruler.14.a
		trigger = { NOT = { has_ruler_flag = transmutation_3 } }
		ai_chance = {
			factor = 10
		}
		if = { limit = { has_country_flag = spell_1 }
			decrease_ruler_adm_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_2 }
			decrease_ruler_dip_effect = yes
		}
		else_if = { limit = { has_country_flag = spell_3 }
			decrease_ruler_mil_effect = yes
		}
	}

	after = {
		clr_country_flag = spell_1
		clr_country_flag = spell_2
		clr_country_flag = spell_3
	}
}

#Result Selection for Rite of Conception Mistress
country_event = {
	id = magic_ruler.20
	title = magic_ruler.14.t
	desc = magic_ruler.14.d
	picture = TEMPORAL_RIFT_eventPicture

	hidden = yes
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_list = {
				50 = {
					trigger = {
						NOT = {
							ruler_is_harpy = yes
							consort_is_harpy = yes
						}
					}
					set_ruler_flag = boy_child
				}
				50 = { set_ruler_flag = girl_child }
			}
		}
	}

	#Success
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_1
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 65
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_1
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 50
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_2
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 50
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_2
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 25
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_3
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 45
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_3
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 25
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			OR = {
				has_country_flag = tughayasa_reward_primary
				has_country_flag = tughayasa_reward
			}
		}
		ai_chance = {
			factor = 25
		}

		if = { limit = { has_ruler_flag = boy_child }
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				dynasty = ROOT
				claim = 100
				no_consort_with_heir = yes
				hidden = yes
				female = yes
			}
		}
		set_heir_mage_effect = yes
	}

	#Failure
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_1
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_1
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 40
		}
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_2
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 40
		}
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_2
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 60
		}
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_3
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 50
		}
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_3
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 70
		}
	}

	#Failure + Ruler Death
	option = {
		name = magic_ruler.14.a
		trigger = {
			has_ruler_flag = transmutation_3
			has_country_flag = spell_1
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 0
		}
		kill_ruler = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = {
				AND = {
					has_ruler_flag = transmutation_3
					has_country_flag = spell_1
				}
			}
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 5
		}
		kill_ruler = yes
	}

	#Failure - consort death
	option = {
		name = magic_ruler.14.a
		trigger = {
			OR = {
				has_ruler_flag = transmutation_3
				has_country_flag = spell_1
			}
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 5
		}
		remove_consort_effect = yes
	}
	option = {
		name = magic_ruler.14.a
		trigger = {
			NOT = { has_ruler_flag = transmutation_3 }
			has_country_flag = spell_2
			NOT = {
				OR = {
					has_country_flag = tughayasa_reward_primary
					has_country_flag = tughayasa_reward
				}
			}
		}
		ai_chance = {
			factor = 10
		}
		remove_consort_effect = yes
	}

	after = {
		clr_ruler_flag = girl_child
		clr_ruler_flag = boy_child
		clear_spell_flags = yes
	}
}

# 3 - Simulacrum (activated when studying)
country_event = {
	id = magic_ruler.21
	title = magic_ruler.21.t
	desc = magic_ruler.21.d
	picture = wihgfx_FEMALES_eventPicture

	is_triggered_only = yes

	trigger = {
		has_ruler_flag = magic_project_simulacrum_complete
		has_ruler_modifier = ruler_studying_magic
		NOT = { has_ruler_modifier = ruler_cooldown_10yr }
	}

	option = {	#Summon Simulacrum
		name = magic_ruler.21.a
		trigger = {
			has_ruler_flag = illusion_3
			has_ruler_flag = magic_project_simulacrum_complete
			has_ruler_modifier = ruler_studying_magic
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { adm_power = 20 }
				NOT = { dip_power = 20 }
			}
		}

		#Cost
		add_adm_power = -20
		add_dip_power = -20

		#Effect
		magic_casted_spell = yes

		if = { limit = { has_ruler_flag = magic_realm_simulacrum_exposed }
			add_ruler_modifier = {
				name = magic_realm_illusion_simulacrum_exposed
				duration = 3650
			}
		}
		else = {
			add_ruler_modifier = {
				name = magic_realm_illusion_simulacrum
				duration = 3650
			}
		}
	}

	option = {	#No thanks
		name = magic_ruler.21.b
		ai_chance = {
			factor = 10
		}

		add_ruler_modifier = {
			name = ruler_cooldown_10yr
			duration = 3650
			hidden = yes
		}
	}
}

#---------------------------------------------#

country_event = {
	id = magic_ruler.100
	title = magic_ruler.100.t
	desc = magic_ruler.100.d
	picture = BIG_BOOK_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		if = {
			limit = {
				mil = 0
				NOT = { mil = 1 }
			}
			define_ruler_to_general = {
				fire = 1
				shock = 6
				manuever = 0
				siege = 1
				trait = war_wizard_personality
			}
		}
		else_if = {
			limit = {
				mil = 1
				NOT = { mil = 2 }
			}
			define_ruler_to_general = {
				fire = 1
				shock = 7
				manuever = 0
				siege = 2
				trait = war_wizard_personality
			}
		}
		else_if = {
			limit = {
				mil = 2
				NOT = { mil = 3 }
			}
			define_ruler_to_general = {
				fire = 2
				shock = 7
				manuever = 1
				siege = 3
				trait = war_wizard_personality
			}
		}
		else_if = {
			limit = {
				mil = 3
				NOT = { mil = 4 }
			}
			define_ruler_to_general = {
				fire = 2
				shock = 8
				manuever = 1
				siege = 4
				trait = war_wizard_personality
			}
		}
		else_if = {
			limit = {
				mil = 4
				NOT = { mil = 5 }
			}
			define_ruler_to_general = {
				fire = 2
				shock = 9
				manuever = 2
				siege = 5
				trait = war_wizard_personality
			}
		}
		else_if = {
			limit = {
				mil = 5
				NOT = { mil = 6 }
			}
			define_ruler_to_general = {
				fire = 3
				shock = 10
				manuever = 3
				siege = 6
				trait = war_wizard_personality
			}
		}
		else_if = {
			limit = {
				mil = 6
			}
			define_ruler_to_general = {
				fire = 3
				shock = 11
				manuever = 4
				siege = 7
				trait = war_wizard_personality
			}
		}
		else = {
			convert_ruler_to_general = yes
		}
	}
}

# Turning ruler into general
country_event = {
	id =  magic_ruler.101
	title =  magic_ruler.101.t
	desc =  magic_ruler.101.d
	picture = WAR_OF_THE_ROSES_eventPicture

	#fire_only_once = yes
	#is_triggered_only = yes

	hidden = yes

	trigger = {
		always = no #It's now handled via decision
		ruler_has_mage_personality = yes
		is_monarch_leader = no
		has_consort_regency = no
		has_regency = no
		NOT = { has_ruler_flag = mage_ruler_general }
		NOT = { has_country_flag = vf_mitrenya_in_power_flg }
	}

	immediate = {
		hidden_effect = {
			# randomize_leader_pips_magical_effect = {
				# which = rulerFIRE
			# }
			randomize_leader_pips_magical_effect = {
				which = rulermil
			}
			# randomize_leader_pips_nonmagical_effect = {
				# which = rulerSHOCK
			# }
			# randomize_leader_pips_nonmagical_effect = {
				# which = rulerMNVR
			# }
		}

		set_saved_name = {
			key = ruler_name
			type = advisor
		}

		set_ruler_flag = mage_ruler_general
	}

	option = {
		name = " magic_ruler.101.a"

		# if = {
		#	limit = {
		#		is_female = yes
		#	}
		#	convert_female_ruler_to_general = yes
		# }
		if = {
			limit = {
				mil = 0
				NOT = { mil = 1 }
			}
			define_ruler_to_general = {
				fire = 1
				shock = 6
				manuever = 0
				siege = 3
				#
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else_if = {
			limit = {
				mil = 1
				NOT = { mil = 2 }
			}
			define_ruler_to_general = {
				fire = 2
				shock = 7
				manuever = 0
				siege = 3
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else_if = {
			limit = {
				mil = 2
				NOT = { mil = 3 }
			}
			define_ruler_to_general = {
				fire = 2
				shock = 7
				manuever = 1
				siege = 4
				#
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else_if = {
			limit = {
				mil = 3
				NOT = { mil = 4 }
			}
			define_ruler_to_general = {
				fire = 2
				shock = 8
				manuever = 1
				siege = 5
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else_if = {
			limit = {
				mil = 4
				NOT = { mil = 5 }
			}
			define_ruler_to_general = {
				fire = 3
				shock = 9
				manuever = 1
				siege = 6
				#
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else_if = {
			limit = {
				mil = 5
				NOT = { mil = 6 }
			}
			define_ruler_to_general = {
				fire = 3
				shock = 10
				manuever = 2
				siege = 7
				#
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else_if = {
			limit = {
				mil = 6
			}
			define_ruler_to_general = {
				fire = 4
				shock = 11
				manuever = 3
				siege = 8
			}
			if = {
				limit = {
					is_female = yes
					NOT = { is_monarch_leader = yes }
				}
				convert_female_ruler_to_general = yes
			}
		}
		else = {
			convert_ruler_to_general = yes
			convert_female_ruler_to_general = yes
		}
		# else_if = {
			# limit = {
				# check_variable = { which = rulermil value = 10 }
				# NOT = { check_variable = { which = rulermil value = 11 } }
			# }
			# define_ruler_to_general = {
				# fire = 3
				# shock = 11
				# manuever = 2
				# siege = 8
				# #
			# }
		# }
		# else = {
			# define_ruler_to_general = {
				# fire = 0
				# shock = 5
				# manuever = 0
				# siege = 3
				# #
			# }
		# }
	}
}

#Initialize magic schools
country_event = {
	id = magic_ruler.102
	title = magic_ruler.102.t
	desc =  magic_ruler.102.d
	picture = WAR_OF_THE_ROSES_eventPicture

	hidden = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_ruler_flag = heir_consort_mage_personality
			ruler_has_personality = mage_personality
		}
	}

	option = {
		name = magic_ruler.102.a
		if = {
			limit = {
				has_ruler_flag = heir_consort_mage_personality
			}
			add_ruler_personality = mage_personality
			clr_ruler_flag = heir_consort_mage_personality
		}
		if = {
			limit = {
				NOT = { has_ruler_flag = initialized_magic_flags }
			}
			magic_ruler_initialize_schools = yes
		}
	}
}

# Powerful Mage Heir
country_event = {
	id =  magic_ruler.103
	title =  magic_ruler.103.t
	desc =  magic_ruler.103.d
	picture = NEW_HEIR_eventPicture

	trigger = {
		OR = {
			ruler_has_mage_personality = yes
			consort_has_mage_personality = yes
		}
		has_heir = no
		has_regency = no
		OR = {
			government = monarchy
			is_tribal = yes
		}
		is_lesser_in_union = no
		has_government_attribute = heir
		has_consort = yes
		NOT = { ruler_is_immortal = yes }
		NOT = { ruler_age = 60 }
		NOT = { has_country_flag = command_slave_state_flag } # Hopefully should block brorcs from getting mage rulers
		NOT = { has_country_flag = disabled_heir_events }
		NOT = { has_country_flag = anti_homunculus_cheese } #Anti homunculus cheese with magical heir
	}

	mean_time_to_happen = {
		months = 500
		modifier = {
			factor = 0.1
			has_global_flag = crimson_deluge
			is_year = 1560
			capital_scope = { superregion = escann_superregion }
		}
		modifier = {
			factor = 0.5
			has_reform = magical_elite_reform
		}
		modifier = {
			factor = 0.2
			AND = {
				ruler_has_mage_personality = yes
				consort_has_mage_personality = yes
			}
		}
	}

	immediate = { #Anti homunculus cheese with magical heir
		hidden_effect = {
			set_country_flag = anti_homunculus_cheese
		}
	}

	option = {
		name = magic_ruler.103.a

		if = { limit = { ruler_is_harpy = yes }
			define_heir = {
				age = 0
				dynasty = ROOT
				female = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				age = 0
				dynasty = ROOT
				hidden = yes
			}
		}
		set_heir_mage_effect = yes
	}
	
	after = { #Anti homunculus cheese with magical heir
		hidden_effect = {
			clr_country_flag = anti_homunculus_cheese
		}
	}
}

# Powerful Mage Bastard - child
country_event = {
	id =  magic_ruler.104
	title =  magic_ruler.104.t
	desc =  magic_ruler.104.d
	picture = NEW_HEIR_eventPicture

	trigger = {
		OR = {
			ruler_has_mage_personality = yes
			has_reform = magical_elite_reform
		}
		has_heir = yes
		has_regency = no
		has_government_attribute = heir
		OR = {
			government = monarchy
			is_tribal = yes
		}
		is_lesser_in_union = no
		NOT = {
			heir_has_mage_personality = yes
			has_heir_flag = heir_consort_mage_personality
		}

		NOT = { ruler_age = 60 }

		NOT = { ruler_has_personality = incorruptible_personality }
		NOT = { ruler_has_personality = kind_hearted_personality }
		NOT = { has_country_flag = anti_homunculus_cheese } #Anti homunculus cheese with magical heir
		NOT = { has_country_flag = command_slave_state_flag } # Hopefully should block brorcs from getting mage rulers
		NOT = { has_country_flag = disabled_heir_events }
	}

	mean_time_to_happen = {
		months = 1000
		modifier = {
			factor = 0.5
			has_reform = magical_elite_reform
		}
		modifier = {
			factor = 0.25
			ruler_has_mage_personality = yes
		}
		modifier = {
			factor = 0.75
			OR = {
				ruler_has_personality = drunkard_personality
				ruler_has_personality = naive_personality
				ruler_has_personality = silver_tongue_personality
			}
		}
	}

	immediate = { #Anti homunculus cheese with magical heir
		hidden_effect = {
			set_country_flag = anti_homunculus_cheese
		}
	}

	option = {
		name = magic_ruler.104.a
		ai_chance = {
			factor = 75
		}

		remove_heir = {  }

		reduce_legitimacy_large_effect = yes

		if = { limit = { ruler_is_harpy = yes }
			define_heir = {
				age = 0
				dynasty = ROOT
				no_consort_with_heir = yes
				female = yes
				hidden = yes
			}
		}
		else = {
			define_heir = {
				age = 0
				dynasty = ROOT
				no_consort_with_heir = yes
				hidden = yes
			}
		}
		set_heir_mage_effect = yes
	}

	option = {
		name = magic_ruler.104.b
		ai_chance = {
			factor = 25
		}

		increase_legitimacy_medium_effect = yes
	}

	after = { #Anti homunculus cheese with magical heir
		hidden_effect = {
			clr_country_flag = anti_homunculus_cheese
		}
	}
}

# Powerful Mage Pretender - disabled until I can figure out how to make the ruler you get a powerful mage
# country_event = {
	# id =  magic_ruler.105
	# title =  magic_ruler.105.t
	# desc =  magic_ruler.105.d
	# picture = CIVIL_WAR_eventPicture

	# trigger = {
		# has_reform = magical_elite_reform
		# government = monarchy
		# OR = {
			# overextension_percentage = 0.5
			# NOT = { stability = 1 }
		# }

		# NOT = { ruler_has_mage_personality = yes }
	# }

	# mean_time_to_happen = {
		# months = 1500
		# modifier = {
			# factor = 0.75
			# OR = {
				# NOT = { adm = 3 }
				# NOT = { dip = 3 }
				# NOT = { mil = 3 }
			# }
		# }
	# }

	# option = {
		# name = magic_ruler.105.a

		# random_owned_province = {
			# limit = {
				# is_core = ROOT
				# is_capital = no
			# }
			# spawn_rebels = {
				# type = 	pretender_rebels
				# religion = ROOT
				# size = 2
				# win = yes
			# }
		# }
		# set_country_flag = mage_pretender_revolt
	# }
# }

# Evocation Death - Early Game
country_event = {
	id =  magic_ruler.106
	title =  magic_ruler.106.t
	desc =  magic_ruler.106.d
	picture = COMET_SIGHTED_eventPicture

	trigger = {
		is_at_war = yes
		NOT = { current_age = age_of_discovery }
		ruler_has_mage_personality = yes
		OR = {
			has_ruler_modifier = magic_realm_evocation_war_magic_1
			has_ruler_modifier = magic_realm_evocation_war_magic_2
			has_ruler_modifier = magic_realm_evocation_war_magic_3
		}
	}

	mean_time_to_happen = {
		months = 730

		modifier = {
			factor = 1.25
			war_score = 10
		}
		modifier = {
			factor = 0.5
			current_age = age_of_absolutism
		}
		modifier = {
			factor = 0.1
			current_age = age_of_revolutions
		}
	}

	option = {	#Die
		name = magic_ruler.106.a

		kill_ruler = yes
	}

	option = {	#Abjuration 1
		name = magic_ruler.106.b
		trigger = {
			is_abjuration_1 = yes
		}

		add_mil_power = -50

		random_list = {
			75 = {

			}
			25 = {
				kill_ruler = yes
			}
		}

		custom_tooltip = tooltip_option_abjuration_1
	}

	option = {	#Abjuration 2
		name = magic_ruler.106.c
		trigger = {
			is_abjuration_2 = yes
		}
		add_mil_power = -50

		random_list = {
			80 = {

			}
			20 = {
				kill_ruler = yes
			}
		}

		custom_tooltip = tooltip_option_abjuration_2
	}

	option = {	#Abjuration 3
		name = magic_ruler.106.dd
		trigger = {
			is_abjuration_3 = yes
		}
		add_mil_power = -50

		random_list = {
			90 = {

			}
			10 = {
				kill_ruler = yes
			}
		}

		custom_tooltip = tooltip_option_abjuration_3
	}
}

# Evocation Death - Black Damestear
country_event = {
	id =  magic_ruler.107
	title =  magic_ruler.107.t
	desc =  magic_ruler.107.d
	picture = COMET_SIGHTED_eventPicture

	trigger = {
		ruler_has_mage_personality = yes

		OR = {
			has_ruler_modifier = magic_realm_evocation_war_magic_1
			has_ruler_modifier = magic_realm_evocation_war_magic_2
			has_ruler_modifier = magic_realm_evocation_war_magic_3
		}

		is_at_war = yes

		current_age = age_of_revolutions
	}

	mean_time_to_happen = {
		months = 365

		modifier = {
			factor = 1.25
			war_score = 10
		}

	}

	option = {	#Die
		name = magic_ruler.107.a

		kill_ruler = yes
	}


	option = {	#Abjuration 3
		name = magic_ruler.107.b
		trigger = {
			is_abjuration_3 = yes
		}
		add_mil_power = -50

		random_list = {
			50 = {

			}
			50 = {
				kill_ruler = yes
			}
		}

		custom_tooltip = tooltip_option_abjuration_3
	}
}

# Young Heir turns to be a promising mage
country_event = {
	id =  magic_ruler.108
	title =  magic_ruler.108.t
	desc = {
		trigger = {
			OR = {
				NOT = { capital_scope = { superregion = escann_superregion } }
				NOT = { has_global_flag = crimson_deluge }
			}
		}
		desc =  magic_ruler.108.d
	}
	desc = {
		trigger = {
			capital_scope = { superregion = escann_superregion }
			has_global_flag = crimson_deluge
		}
		desc =  magic_ruler.108.da
	}
	picture = COMET_eventPicture

	trigger = {
		has_heir = yes
		has_government_attribute = heir
		OR = {
			government = monarchy
			is_tribal = yes
		}
		NOT = {
			heir_has_mage_personality = yes
			has_heir_flag = heir_consort_mage_personality
		}

		NOT = { heir_age = 16 }
		NOT = { has_country_flag = anti_homunculus_cheese } #Anti homunculus cheese with magical heir
		NOT = { has_country_flag = command_slave_state_flag } # Hopefully should block brorcs from getting mage rulers
		# NOT = { has_country_flag = banned_magic } # not sure about this one
	}

	mean_time_to_happen = {
		months = 7300
		modifier = {
			factor = 0.01
			capital_scope = { superregion = escann_superregion }
			has_global_flag = crimson_deluge
			is_year = 1580
			NOT = { current_age = age_of_revolutions }
		}
		modifier = {
			factor = 0.2
			OR = {
				ruler_has_mage_personality = yes
				consort_has_mage_personality = yes
			}
		}
		modifier = {
			factor = 0.5
			has_reform = magical_elite_reform
		}
		modifier = {
			factor = 0.5
			current_age = age_of_absolutism
		}
		modifier = {
			factor = 0.9
			is_emperor_of_china = yes
			empire_of_china_reform_passed = taste_magic_reform
		}
	}

	immediate = { #Anti homunculus cheese with magical heir
		hidden_effect = {
			set_country_flag = anti_homunculus_cheese
		}
	}

	option = {
		name = magic_ruler.108.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 100
				current_age = age_of_absolutism
			}
		}

		set_heir_mage_effect = yes
	}

	# floodborn
	option = {
		name = magic_ruler.108.b
		trigger = {
			capital_scope = { superregion = escann_superregion }
			has_global_flag = crimson_deluge
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				has_country_flag = banned_magic
			}
			modifier = {
				factor = 5
				current_age = age_of_revolutions
			}
		}

		remove_heir = {  }
	}

	# not floodborn
	option = {
		name = magic_ruler.108.c
		trigger = {
			OR = {
				NOT = { capital_scope = { superregion = escann_superregion } }
				NOT = { has_global_flag = crimson_deluge }
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				has_country_flag = banned_magic
			}
			modifier = {
				factor = 5
				current_age = age_of_revolutions
			}
		}

		remove_heir = {  }
	}

	after = { #Anti homunculus cheese with magical heir
		hidden_effect = {
			clr_country_flag = anti_homunculus_cheese
		}
	}
}

##################
#### Background and Debug Events
##################

country_event = {
	id = magic_ruler.110
	title = magic_ruler.110.t
	desc =  magic_ruler.110.d
	picture = WAR_OF_THE_ROSES_eventPicture

	hidden = yes

	trigger = {
		has_government_attribute = always_mage
		NOT = { ruler_has_mage_personality = yes }
	}
	# fired from the on_new_monarch on_action
	is_triggered_only = yes

	option = {
		name = magic_ruler.110.a
		add_ruler_personality = mage_personality
		country_event = { id = magic_ruler.102 } # set up schools
	}
}
