
###########################################################
# Events for the Ahati Estate
###########################################################

namespace = ahati_events

####
#1-29 base system/estate required stuff
#30-99 random flavor
#100+ disaster



#Establishing the Ahati
country_event = {
	id = ahati_events.1
	title = ahati_events.1.t
	desc = ahati_events.1.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		is_emperor_of_china = yes
	}

	option = {
		name = ahati_events.1.a
		if = {
			limit = { religion_group = khetist }
			set_estate_privilege = estate_ahati_khetist_recruitment
		}
		else = { set_estate_privilege = estate_ahati_non_khet_steward }
		466 = {
			#so it doesn't look stupid if its already aakhetist
			if = {
				limit = { religion = aakhetist }
				hidden_effect = { change_religion = aakhetist_ahati }
			}
			else = { change_religion = aakhetist_ahati }
			add_province_modifier = { name = ahati_aakheta_base duration = -1 }
		}
		
		change_estate_land_share = { estate = estate_ahati share = 10 }
	}
}



###########################################################
# Flavor Events
###########################################################
#an ahati distinguishes himself
country_event = {
	id = ahati_events.30
	title = ahati_events.30.t
	desc = ahati_events.30.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes

	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		estate_loyalty = { estate = estate_ahati loyalty = 30 }
	}

	#he will make a fine addition
	option = {
		name = ahati_events.30.a
		random_list = {
			33 = { 
				define_advisor = {
					type = army_organiser
					skill = 3
					discount = yes
					culture = hapremiti
					religion = aakhetist
				}
			}
			33 = { 
				define_advisor = {
					type = trader
					skill = 3
					discount = yes
					culture = hapremiti
					religion = aakhetist
				}
			}
			33 = { 
				define_advisor = {
					type = army_reformer
					skill = 3
					discount = yes
					culture = hapremiti
					religion = aakhetist
				}
			}
		}
	}
}

#ahati and governor are in conflict
country_event = {
	id = ahati_events.31
	title = ahati_events.31.t
	desc = ahati_events.31.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes

	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		dip_power = 80
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { region = kheterata_region }
				save_event_target_as = event_province
			}
		}
	}
	goto = event_province

	#fix the issue
	option = {
		name = ahati_events.31.a
		add_dip_power = -100
		add_mandate = 2
	}

	#idc
	option = {
		name = ahati_events.31.b
		event_target:event_province = {
			add_unrest = 5
			add_local_autonomy = 35
		}
		add_mandate = -2
	}
}

#ahati kills drunk noble
country_event = {
	id = ahati_events.32
	title = ahati_events.32.t
	desc = ahati_events.32.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes

	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		has_estate = estate_nobles
	}

	#arrest the Ahati
	option = {
		name = ahati_events.32.a
		add_mil_power = -25
		add_estate_loyalty = { estate = estate_ahati loyalty = -10 }
	}

	#compensate the nobles
	option = {
		name = ahati_events.32.b
		add_dip_power = -25
		add_years_of_income = -1
	}

	#the noble deserved it
	option = {
		name = ahati_events.32.c
		add_estate_loyalty = { estate = estate_nobles loyalty = -15 }
	}
}

#corrupt ahati selling out caravans to bandits
country_event = {
	id = ahati_events.33
	title = ahati_events.33.t
	desc = ahati_events.33.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		any_owned_province = {
			region = kheterata_region 
			province_has_center_of_trade_of_level = 1
			NOT = { has_province_modifier = ahati_corrupt_trade_route }
		}
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { 
					region = kheterata_region 
					province_has_center_of_trade_of_level = 1
					NOT = { has_province_modifier = ahati_corrupt_trade_route }
				}
				save_event_target_as = event_province
			}
		}
	}
	goto = event_province

	#arrest him
	option = {
		name = ahati_events.33.a
		add_estate_loyalty = { estate = estate_ahati loyalty = -5 }
		if = {
			limit = { has_estate = estate_burghers }
			add_estate_loyalty = { estate = estate_burghers loyalty = 5 }
		}
		add_mandate = 2
	}

	#let me in on this
	option = {
		name = ahati_events.33.b
		add_years_of_income = 1
		add_corruption = 1
		if = {
			limit = { ruler_has_max_personalities = no NOT = { ruler_has_personality = greedy_personality } }
			random_list = {
				30 = { add_ruler_personality = greedy_personality }
				70 = {}
			}
		}
		event_target:event_province = { add_province_modifier = { name = ahati_corrupt_trade_route duration = 1825 } }
	}
}

#ahati garrison a fort
country_event = {
	id = ahati_events.34
	title = ahati_events.34.t
	desc = ahati_events.34.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		estate_loyalty = { estate = estate_ahati loyalty = 40 }
		any_owned_province = {
			is_capital = no
			has_fort_building_trigger = yes
			OR = {
				region = kheterata_region
				region = gol_region
				region = khetapera_region
			}
			NOT = { has_province_modifier = ahati_fort_garrison }
		}
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { 
					is_capital = no
					has_fort_building_trigger = yes
					OR = {
						region = kheterata_region
						region = gol_region
						region = khetapera_region
					}
					NOT = { has_province_modifier = ahati_fort_garrison }
				}
				save_event_target_as = event_province
			}
		}
	}
	goto = event_province

	#allow it
	option = {
		name = ahati_events.34.a
		event_target:event_province = {
			add_province_modifier = { name = ahati_fort_garrison duration = -1 }
			add_local_autonomy = 50
		}
	}

	#no
	option = {
		name = ahati_events.34.b
		add_estate_loyalty = { estate = estate_ahati loyalty = -10 }
	}
}

#ahati build a barracks
country_event = {
	id = ahati_events.35
	title = ahati_events.35.t
	desc = ahati_events.35.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		estate_loyalty = { estate = estate_ahati loyalty = 40 }
		any_owned_province = {
			is_capital = no
			has_manpower_building_trigger = no
			OR = {
				region = kheterata_region
				region = gol_region
				region = khetapera_region
			}
			NOT = { has_province_flag = ahati_barracks }
		}
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { 
					is_capital = no
					has_manpower_building_trigger = no
					OR = {
						region = kheterata_region
						region = gol_region
						region = khetapera_region
					}
					NOT = { has_province_flag = ahati_barracks }
				}
				save_event_target_as = event_province
			}
		}
	}
	goto = event_province

	#allow it
	option = {
		name = ahati_events.35.a
		event_target:event_province = { add_building_construction = { building = barracks cost = 0.5 speed = 1 } set_province_flag = ahati_barracks }
		add_prestige = -10
	}

	#no
	option = {
		name = ahati_events.35.b
		add_estate_loyalty = { estate = estate_ahati loyalty = -10 }
	}
}

#ahati establish themselves in a CoT
country_event = {
	id = ahati_events.36
	title = ahati_events.36.t
	desc = ahati_events.36.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
	trigger = {
		is_emperor_of_china = yes
		has_estate = estate_ahati
		estate_loyalty = { estate = estate_ahati loyalty = 40 }
		any_owned_province = {
			is_capital = no
			province_has_center_of_trade_of_level = 1
			OR = {
				region = kheterata_region
				region = gol_region
				region = khetapera_region
			}
			NOT = { has_province_modifier = ahati_cot }
		}
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { 
					is_capital = no
					province_has_center_of_trade_of_level = 1
					OR = {
						region = kheterata_region
						region = gol_region
						region = khetapera_region
					}
					NOT = { has_province_modifier = ahati_cot }
				}
				save_event_target_as = event_province
			}
		}
	}
	goto = event_province

	#allow it
	option = {
		name = ahati_events.36.a
		event_target:event_province = { 
			add_province_modifier = { name = ahati_cot duration = -1 } 
			add_local_autonomy = 15
		}
		add_years_of_income = -0.3
	}

	#no
	option = {
		name = ahati_events.36.b
		add_estate_loyalty = { estate = estate_ahati loyalty = -10 }
	}
}