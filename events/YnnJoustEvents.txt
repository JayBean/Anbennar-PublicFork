
namespace = ynn_joust_events

#Joust Start
country_event = {
	id = ynn_joust_events.1
	title = ynn_joust_events.1.t
	desc = ynn_joust_events.1.d
	picture = TOURNAMENT_eventPicture

	is_triggered_only = yes

	trigger = {
		has_regency = no
	}

	immediate = {
		hidden_effect = {
			event_target:ynn_joust_opponent_1 = {
				country_event = {
					id = ynn_joust_events.13
				}
			}
		}
		if = {
			limit = {
				has_ruler_flag = G26_partaking_joust
			}
			set_country_flag = G26_joust_participant_flag # This is for their monarch dying
			event_target:ynn_joust_opponent_1 = {
				set_country_flag = G26_joust_participant_flag # This is for their monarch dying
			}
		}
	}

	option = {
		name = ynn_joust_events.1.a
		ai_chance = {
			factor = 1
		}

	}

	after = {
		country_event = {
			id = ynn_joust_events.2
			days = 2
		}
	}
}

country_event = {
	id = ynn_joust_events.13
	title = ynn_joust_events.1.t
	desc = ynn_joust_events.13.d
	picture = TOURNAMENT_eventPicture

	is_triggered_only = yes

	option = {
		name = ynn_joust_events.1.a
		ai_chance = {
			factor = 1
		}
	}
}

#Power is set, hidden event doing stuff
country_event = {
	id = ynn_joust_events.2
	title = ynn_joust_events.2.t
	desc = ynn_joust_events.2.d
	picture = TOURNAMENT_eventPicture

	is_triggered_only = yes
	hidden = yes

	trigger = {
		has_regency = no
	}

	option = {
		name = ynn_joust_events.2.a
		ai_chance = {
			factor = 1
		}
		
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_ruler_flag = tilts_begun
					}
				}
				set_variable = {
					which = firstJoustPower
					value = 0
				}
		
				set_variable = {
					which = secondJoustPower
					value = 0
				}
				
				###	participant Joust Power	###
				
				if = { limit = { mil = 6 } change_variable = { which = firstJoustPower value = 10 } }
				else_if = {	limit = { mil = 5 }	change_variable = {	which = firstJoustPower	value = 8 }	}
				else_if = {	limit = { mil = 4 }	change_variable = {	which = firstJoustPower	value = 6 }	}
				else_if = {	limit = { mil = 3 } change_variable = {	which = firstJoustPower	value = 2 }	}
				else_if = {	limit = { mil = 2 } subtract_variable = { which = firstJoustPower value = 2	} }
				else_if = {	limit = { mil = 1 } subtract_variable = { which = firstJoustPower value = 4 } }
				else_if = {	limit = { mil = 0 }	subtract_variable = { which = firstJoustPower value = 6	} }
			
				if = { limit = { ruler_age = 60	} subtract_variable = {	which = firstJoustPower	value = 3 }	}
				else_if = {	limit = { ruler_age = 50 } subtract_variable = { which = firstJoustPower value = 2 } }
				else_if = {	limit = { ruler_age = 40 } subtract_variable = { which = firstJoustPower value = 1 } }
			
				if = { limit = { ruler_has_personality = bold_fighter_personality }	change_variable = {	which = firstJoustPower	value = 4 } }
				if = { limit = { ruler_has_personality = strict_personality } change_variable = { which = firstJoustPower value = 4	} }
				if = { limit = { ruler_has_personality = martial_educator_personality }	change_variable = {	which = firstJoustPower	value = 4 }	}
				if = { limit = { ruler_has_personality = tactical_genius_personality } change_variable = { which = firstJoustPower value = 4 } }
				if = { limit = { ruler_has_mage_personality = yes } change_variable = {	which = firstJoustPower	value = 5 }	}
				if = { limit = { ruler_has_personality = great_conqueror_personality } change_variable = { which = firstJoustPower value = 7 } }
				if = { limit = { ruler_has_personality = mythical_conqueror_personality } change_variable = { which = firstJoustPower value = 10 } }
				if = { limit = { ruler_has_personality = conqueror_personality } change_variable = { which = firstJoustPower value = 4 } }
				if = { limit = { ruler_has_personality = craven_personality } subtract_variable = {	which = firstJoustPower	value = 4 }	}
				if = { limit = { has_ruler_flag = G26_exp_1 } change_variable = { which = firstJoustPower value = 2 } }
				else_if = { limit = { has_ruler_flag = G26_exp_2 } change_variable = { which = firstJoustPower value = 4 } }
				else_if = { limit = { has_ruler_flag = G26_exp_3 } change_variable = { which = firstJoustPower value = 6 } }
				else_if = { limit = { has_ruler_flag = G26_exp_4 } change_variable = { which = firstJoustPower value = 8 } }
				else_if = { limit = { has_ruler_flag = G26_exp_5 } change_variable = { which = firstJoustPower value = 10 } }
				else_if = { limit = { has_ruler_flag = G26_exp_6 } change_variable = { which = firstJoustPower value = 12 } }
				else_if = { limit = { has_ruler_flag = G26_exp_7 } change_variable = { which = firstJoustPower value = 14 } }
				else_if = { limit = { has_ruler_flag = G26_exp_8 } change_variable = { which = firstJoustPower value = 16 } }
				else_if = { limit = { has_ruler_flag = G26_exp_9 } change_variable = { which = firstJoustPower value = 18 } }
				else_if = { limit = { has_ruler_flag = G26_exp_10 } change_variable = { which = firstJoustPower value = 20 } }

				if = { limit = { OR = {	tag = G35 was_tag = G35	} }	
					if = { 
						limit = {
							OR = {	#Scaled on the battle modifiers each lance gives
								has_country_modifier = G35_lance_1_1
								has_country_modifier = G35_lance_1_3
							}
						}
						change_variable = {
							which = firstJoustPower
							value = 1
						}
					}
					else_if = {
						limit = {
							OR = {
								has_country_modifier = G35_lance_2_1
								has_country_modifier = G35_lance_2_3
								has_country_modifier = G35_lance_1_2
							}
						}
						change_variable = {
							which = firstJoustPower
							value = 2
						}
					}
					else_if = {
						limit = {
							OR = {
								has_country_modifier = G35_lance_3_1
								has_country_modifier = G35_lance_3_3
								has_country_modifier = G35_lance_2_2
								has_country_modifier = G35_lance_3_2
							}
						}
						change_variable = {
							which = firstJoustPower
							value = 3
						}
					}
					else_if = {
						limit = {
							OR = {
								has_country_modifier = G35_lance_4_1
								has_country_modifier = G35_lance_4_3
							}
						}
						change_variable = {
							which = firstJoustPower
							value = 4
						}
					}
					else_if = {
						limit = {
							has_country_modifier = G35_lance_4_2
						}
						change_variable = {
							which = firstJoustPower
							value = 5
						}
					}
				}
			
				event_target:ynn_joust_opponent_1 = {
					
					###	participant Joust Power	###
					
					if = { limit = { mil = 6 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 10 } } }
					else_if = {	limit = { mil = 5 }	event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 8 } } }
					else_if = {	limit = { mil = 4 }	event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 6 } } }
					else_if = {	limit = { mil = 3 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 2 } } }
					else_if = {	limit = { mil = 2 } event_target:ynn_joust_opponent_2 = { subtract_variable = { which = secondJoustPower value = 2 } } }
					else_if = {	limit = { mil = 1 } event_target:ynn_joust_opponent_2 = { subtract_variable = { which = secondJoustPower value = 4 } } }
					else_if = {	limit = { mil = 0 }	event_target:ynn_joust_opponent_2 = { subtract_variable = { which = secondJoustPower value = 6 } } }
				
					if = { limit = { ruler_age = 60	} event_target:ynn_joust_opponent_2 = { subtract_variable = { which = secondJoustPower value = 3 } }	}
					else_if = {	limit = { ruler_age = 50 } event_target:ynn_joust_opponent_2 = { subtract_variable = { which = secondJoustPower value = 2 } } }
					else_if = {	limit = { ruler_age = 40 } event_target:ynn_joust_opponent_2 = { subtract_variable = { which = secondJoustPower value = 1 } } }
				
					if = { limit = { ruler_has_personality = bold_fighter_personality }	event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 4	} } }
					if = { limit = { ruler_has_personality = strict_personality } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 4	} } }
					if = { limit = { ruler_has_personality = martial_educator_personality }	event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 4	} } }
					if = { limit = { ruler_has_personality = tactical_genius_personality } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 4	} } }
					if = { limit = { ruler_has_mage_personality = yes } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 5	} } }
					if = { limit = { ruler_has_personality = great_conqueror_personality } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 7	} } }
					if = { limit = { ruler_has_personality = mythical_conqueror_personality } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 10	} } }
					if = { limit = { ruler_has_personality = conqueror_personality } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 4 } } }
					if = { limit = { ruler_has_personality = craven_personality } event_target:ynn_joust_opponent_2 = { subtract_variable = {	which = secondJoustPower	value = 4 }	} }
					if = { limit = { has_ruler_flag = G26_exp_1 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 2 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_2 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 4 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_3 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 6 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_4 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 8 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_5 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 10 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_6 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 12 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_7 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 14 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_8 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 16 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_9 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 18 } } }
					else_if = { limit = { has_ruler_flag = G26_exp_10 } event_target:ynn_joust_opponent_2 = { change_variable = { which = secondJoustPower value = 20 } } }

					if = { limit = { OR = {	tag = G35 was_tag = G35	} }	
						if = { 
							limit = {
								OR = {	#Scaled on the battle modifiers each lance gives
									has_country_modifier = G35_lance_1_1
									has_country_modifier = G35_lance_1_3
								}
							}
							event_target:ynn_joust_opponent_2 = {
								change_variable = {
									which = secondJoustPower
									value = 1
								}
							}
						}
						else_if = {
							limit = {
								OR = {
									has_country_modifier = G35_lance_2_1
									has_country_modifier = G35_lance_2_3
									has_country_modifier = G35_lance_1_2
								}
							}
							event_target:ynn_joust_opponent_2 = {
								change_variable = {
									which = secondJoustPower
									value = 2
								}
							}
						}
						else_if = {
							limit = {
								OR = {
									has_country_modifier = G35_lance_3_1
									has_country_modifier = G35_lance_3_3
									has_country_modifier = G35_lance_2_2
									has_country_modifier = G35_lance_3_2
								}
							}
							event_target:ynn_joust_opponent_2 = {
								change_variable = {
									which = secondJoustPower
									value = 3
								}
							}
						}
						else_if = {
							limit = {
								OR = {
									has_country_modifier = G35_lance_4_1
									has_country_modifier = G35_lance_4_3
								}
							}
							event_target:ynn_joust_opponent_2 = {
								change_variable = {
									which = secondJoustPower
									value = 4
								}
							}
						}
						else_if = {
							limit = {
								has_country_modifier = G35_lance_4_2
							}
							event_target:ynn_joust_opponent_2 = {
								change_variable = {
									which = secondJoustPower
									value = 5
								}
							}
						}
					}
				}
			}
	
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = firstJoustPower
							value = 1
						}
					}
					check_variable = {
						which = secondJoustPower
						value = 1
					}
				}
				event_target:ynn_joust_opponent_1 = {
					save_global_event_target_as = ynn_joust_winner
				}
				event_target:ynn_joust_opponent_2 = {
					save_global_event_target_as = ynn_joust_loser
					country_event = {
						id = ynn_joust_events.4
						days = 2
					}
				}
			}
			else_if = {
				limit = {
					NOT = {
						check_variable = {
							which = secondJoustPower
							value = 1
						}
					}
					check_variable = {
						which = firstJoustPower
						value = 1
					}
				}
				event_target:ynn_joust_opponent_2 = {
					save_global_event_target_as = ynn_joust_winner
				}
				event_target:ynn_joust_opponent_1 = {
					save_global_event_target_as = ynn_joust_loser
					country_event = {
						id = ynn_joust_events.4
						days = 2
					}
				}
			}
			else_if = {
				limit = {
					NOT = {
						AND = {
							check_variable = {
								which = firstJoustPower
								value = 1
							}
							check_variable = {
								which = secondJoustPower
								value = 1
							}
						}
					}
				}
				random_list = {
					1 = {
						event_target:ynn_joust_opponent_2 = {
							save_global_event_target_as = ynn_joust_winner
						}
						event_target:ynn_joust_opponent_1 = {
							save_global_event_target_as = ynn_joust_loser
							country_event = {
								id = ynn_joust_events.4
								days = 2
							}
						}
					}
					1 = {
						event_target:ynn_joust_opponent_1 = {
							save_global_event_target_as = ynn_joust_winner
						}
						event_target:ynn_joust_opponent_2 = {
							save_global_event_target_as = ynn_joust_loser
							country_event = {
								id = ynn_joust_events.4
								days = 2
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = firstJoustPower
						value = 1
					}
					check_variable = {
						which = secondJoustPower
						value = 1
					}
				}
				event_target:ynn_joust_opponent_1 = {
					country_event = {
						id = ynn_joust_events.3
						days = 1
					}
				}
				event_target:ynn_joust_opponent_2 = {
					country_event = {
						id = ynn_joust_events.3
						days = 3
					}
				}
			}
			else = {
				if = {
					limit = {
						has_country_flag = amacimst_hosting_joust
					}
					country_event = {
						id = flavour_amacimst.69
					}
				}
				else = {
					random_known_country = {
						limit = {
							has_country_flag = amacimst_hosting_joust
						}
						country_event = {
							id = flavour_amacimst.69
						}
					}
				}
			}
		}
	}
}

#CHAAAAARGE?
country_event = {
	id = ynn_joust_events.3
	title = ynn_joust_events.3.t
	desc = {
		trigger = {
			NOT = {
				has_ruler_flag = tilts_begun
			}
		}
		desc = ynn_joust_events.3.d1
	}
	desc = {
		trigger = {
			has_ruler_flag = tilts_begun
		}
		desc = ynn_joust_events.3.d2
	}
	picture = TOURNAMENT_eventPicture

	is_triggered_only = yes

	trigger = {
		has_regency = no
	}

	option = {	# Full force ahead
		name = ynn_joust_events.3.a
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				ruler_has_personality = bold_fighter_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = righteous_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = fertile_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = zealot_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = entrepreneur_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = industrious_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = expansionist_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = conqueror_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = strict_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = inspiring_leader_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = martial_educator_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = fierce_negotiator_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = embezzler_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = sinner_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = greedy_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = cruel_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = naive_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = malevolent_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = great_conqueror_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = mythical_conqueror_personality
			}
			modifier = {
				factor = 0.3
				NOT = {
					ruler_has_personality = bold_fighter_personality
					ruler_has_personality = righteous_personality
					ruler_has_personality = fertile_personality
					ruler_has_personality = zealot_personality
					ruler_has_personality = entrepreneur_personality
					ruler_has_personality = industrious_personality
					ruler_has_personality = expansionist_personality
					ruler_has_personality = conqueror_personality
					ruler_has_personality = strict_personality
					ruler_has_personality = inspiring_leader_personality
					ruler_has_personality = martial_educator_personality
					ruler_has_personality = fierce_negotiator_personality
					ruler_has_personality = embezzler_personality
					ruler_has_personality = sinner_personality
					ruler_has_personality = greedy_personality
					ruler_has_personality = cruel_personality
					ruler_has_personality = naive_personality
					ruler_has_personality = malevolent_personality
					ruler_has_personality = great_conqueror_personality
					ruler_has_personality = mythical_conqueror_personality
				}
			}
		}
		custom_tooltip = ynn_joust_v2_tt
		if = {
			limit = {
				OR = {
					ruler_has_personality = bold_fighter_personality
					ruler_has_personality = righteous_personality
					ruler_has_personality = fertile_personality
					ruler_has_personality = zealot_personality
					ruler_has_personality = entrepreneur_personality
					ruler_has_personality = industrious_personality
					ruler_has_personality = expansionist_personality
					ruler_has_personality = conqueror_personality
					ruler_has_personality = strict_personality
					ruler_has_personality = inspiring_leader_personality
					ruler_has_personality = martial_educator_personality
					ruler_has_personality = fierce_negotiator_personality
					ruler_has_personality = embezzler_personality
					ruler_has_personality = sinner_personality
					ruler_has_personality = greedy_personality
					ruler_has_personality = cruel_personality
					ruler_has_personality = naive_personality
					ruler_has_personality = malevolent_personality
					ruler_has_personality = great_conqueror_personality
					ruler_has_personality = mythical_conqueror_personality
				}
			}
			custom_tooltip = ynn_joust_ruler_affinity_tt
		}
		if = {
			limit = {
				tag = event_target:ynn_joust_opponent_1
			}
			if = {
				limit = {
					event_target:ynn_joust_opponent_2 = {
						OR = {
							ruler_has_personality = bold_fighter_personality
							ruler_has_personality = righteous_personality
							ruler_has_personality = fertile_personality
							ruler_has_personality = zealot_personality
							ruler_has_personality = entrepreneur_personality
							ruler_has_personality = industrious_personality
							ruler_has_personality = expansionist_personality
							ruler_has_personality = conqueror_personality
							ruler_has_personality = strict_personality
							ruler_has_personality = inspiring_leader_personality
							ruler_has_personality = martial_educator_personality
							ruler_has_personality = fierce_negotiator_personality
							ruler_has_personality = embezzler_personality
							ruler_has_personality = sinner_personality
							ruler_has_personality = greedy_personality
							ruler_has_personality = cruel_personality
							ruler_has_personality = naive_personality
							ruler_has_personality = malevolent_personality
							ruler_has_personality = great_conqueror_personality
							ruler_has_personality = mythical_conqueror_personality
						}
					}
				}
				custom_tooltip = ynn_joust_enemy_ruler_affinity_tt
			}
		}
		else_if = {
			limit = {
				tag = event_target:ynn_joust_opponent_2
			}
			if = {
				limit = {
					event_target:ynn_joust_opponent_1 = {
						OR = {
							ruler_has_personality = bold_fighter_personality
							ruler_has_personality = righteous_personality
							ruler_has_personality = fertile_personality
							ruler_has_personality = zealot_personality
							ruler_has_personality = entrepreneur_personality
							ruler_has_personality = industrious_personality
							ruler_has_personality = expansionist_personality
							ruler_has_personality = conqueror_personality
							ruler_has_personality = strict_personality
							ruler_has_personality = inspiring_leader_personality
							ruler_has_personality = martial_educator_personality
							ruler_has_personality = fierce_negotiator_personality
							ruler_has_personality = embezzler_personality
							ruler_has_personality = sinner_personality
							ruler_has_personality = greedy_personality
							ruler_has_personality = cruel_personality
							ruler_has_personality = naive_personality
							ruler_has_personality = malevolent_personality
							ruler_has_personality = great_conqueror_personality
							ruler_has_personality = mythical_conqueror_personality
						}
					}
				}
				custom_tooltip = ynn_joust_enemy_ruler_affinity_tt
			}
		}
		hidden_effect = {
			clear_joust_flags_effect = yes
			if = {
				limit = {
					OR = {
						ruler_has_personality = bold_fighter_personality
						ruler_has_personality = righteous_personality
						ruler_has_personality = fertile_personality
						ruler_has_personality = zealot_personality
						ruler_has_personality = entrepreneur_personality
						ruler_has_personality = industrious_personality
						ruler_has_personality = expansionist_personality
						ruler_has_personality = conqueror_personality
						ruler_has_personality = strict_personality
						ruler_has_personality = inspiring_leader_personality
						ruler_has_personality = martial_educator_personality
						ruler_has_personality = fierce_negotiator_personality
						ruler_has_personality = embezzler_personality
						ruler_has_personality = sinner_personality
						ruler_has_personality = greedy_personality
						ruler_has_personality = cruel_personality
						ruler_has_personality = naive_personality
						ruler_has_personality = malevolent_personality
						ruler_has_personality = great_conqueror_personality
						ruler_has_personality = mythical_conqueror_personality
					}
				}
				if = {
					limit = {
						tag = event_target:ynn_joust_opponent_1
					}
					event_target:ynn_joust_opponent_2 = {
						change_variable = {
							which = secondJoustPower
							value = 2
						}
					}
				}
				else_if = {
					limit = {
						tag = event_target:ynn_joust_opponent_2
					}
					custom_tooltip = ynn_joust_ruler_affinity_tt
					change_variable = {
						which = firstJoustPower
						value = 2
					}
				}
			}
			set_ruler_flag = ynn_joust_attack
		}
	}

	option = {	#Let's be a bit careful
		name = ynn_joust_events.3.b
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				ruler_has_personality = just_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = tolerant_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = kind_hearted_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = calm_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = careful_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = secretive_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = benevolent_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = pious_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = lawgiver_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = incorruptible_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = navigator_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = infertile_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = craven_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = obsessive_perfectionist_personality
			}
			modifier = {
				factor = 0.3
				NOT = {
					ruler_has_personality = just_personality
					ruler_has_personality = obsessive_perfectionist_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = infertile_personality
					ruler_has_personality = navigator_personality
					ruler_has_personality = incorruptible_personality
					ruler_has_personality = lawgiver_personality
					ruler_has_personality = pious_personality
					ruler_has_personality = benevolent_personality
					ruler_has_personality = secretive_personality
					ruler_has_personality = careful_personality
					ruler_has_personality = calm_personality
					ruler_has_personality = kind_hearted_personality
					ruler_has_personality = tolerant_personality
				}
			}
		}
		custom_tooltip = ynn_joust_v2_tt
		if = {
			limit = {
				OR = {
					ruler_has_personality = just_personality
					ruler_has_personality = tolerant_personality
					ruler_has_personality = kind_hearted_personality
					ruler_has_personality = calm_personality
					ruler_has_personality = careful_personality
					ruler_has_personality = secretive_personality
					ruler_has_personality = benevolent_personality
					ruler_has_personality = pious_personality
					ruler_has_personality = lawgiver_personality
					ruler_has_personality = incorruptible_personality
					ruler_has_personality = navigator_personality
					ruler_has_personality = infertile_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = obsessive_perfectionist_personality
				}
			}
			custom_tooltip = ynn_joust_ruler_affinity_tt
		}
		if = {
			limit = {
				tag = event_target:ynn_joust_opponent_1
			}
			if = {
				limit = {
					event_target:ynn_joust_opponent_2 = {
						OR = {
							ruler_has_personality = just_personality
							ruler_has_personality = tolerant_personality
							ruler_has_personality = kind_hearted_personality
							ruler_has_personality = calm_personality
							ruler_has_personality = careful_personality
							ruler_has_personality = secretive_personality
							ruler_has_personality = benevolent_personality
							ruler_has_personality = pious_personality
							ruler_has_personality = lawgiver_personality
							ruler_has_personality = incorruptible_personality
							ruler_has_personality = navigator_personality
							ruler_has_personality = infertile_personality
							ruler_has_personality = craven_personality
							ruler_has_personality = obsessive_perfectionist_personality
						}
					}
				}
				custom_tooltip = ynn_joust_enemy_ruler_affinity_tt
			}
		}
		else_if = {
			limit = {
				tag = event_target:ynn_joust_opponent_2
			}
			if = {
				limit = {
					event_target:ynn_joust_opponent_1 = {
						OR = {
							ruler_has_personality = just_personality
							ruler_has_personality = tolerant_personality
							ruler_has_personality = kind_hearted_personality
							ruler_has_personality = calm_personality
							ruler_has_personality = careful_personality
							ruler_has_personality = secretive_personality
							ruler_has_personality = benevolent_personality
							ruler_has_personality = pious_personality
							ruler_has_personality = lawgiver_personality
							ruler_has_personality = incorruptible_personality
							ruler_has_personality = navigator_personality
							ruler_has_personality = infertile_personality
							ruler_has_personality = craven_personality
							ruler_has_personality = obsessive_perfectionist_personality
						}
					}
				}
				custom_tooltip = ynn_joust_enemy_ruler_affinity_tt
			}
		}
		hidden_effect = {
			clear_joust_flags_effect = yes
			if = {
				limit = {
					OR = {
						ruler_has_personality = just_personality
						ruler_has_personality = tolerant_personality
						ruler_has_personality = kind_hearted_personality
						ruler_has_personality = calm_personality
						ruler_has_personality = careful_personality
						ruler_has_personality = secretive_personality
						ruler_has_personality = benevolent_personality
						ruler_has_personality = pious_personality
						ruler_has_personality = lawgiver_personality
						ruler_has_personality = incorruptible_personality
						ruler_has_personality = navigator_personality
						ruler_has_personality = infertile_personality
						ruler_has_personality = craven_personality
						ruler_has_personality = obsessive_perfectionist_personality
					}
				}
				if = {
					limit = {
						tag = event_target:ynn_joust_opponent_1
					}
					custom_tooltip = ynn_joust_ruler_affinity_tt
					event_target:ynn_joust_opponent_2 = {
						change_variable = {
							which = secondJoustPower
							value = 2
						}
					}
				}
				else_if = {
					limit = {
						tag = event_target:ynn_joust_opponent_2
					}
					custom_tooltip = ynn_joust_ruler_affinity_tt
					change_variable = {
						which = firstJoustPower
						value = 2
					}
				}
			}
			set_ruler_flag = ynn_joust_defend
		}
	}

	option = {	#Try something wacky
		name = ynn_joust_events.3.c
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				ruler_has_personality = free_thinker_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = well_connected_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = intricate_web_weaver_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = well_advised_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = midas_touched_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = scholar_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = architectural_visionary_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = charismatic_negotiator_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = silver_tongue_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = tactical_genius_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = babbling_buffoon_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = drunkard_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = loose_lips_personality
			}
			modifier = {
				factor = 2
				ruler_has_personality = reformist_personality
			}
			modifier = {
				factor = 0.3
				NOT = {
					ruler_has_personality = free_thinker_personality
					ruler_has_personality = well_connected_personality
					ruler_has_personality = intricate_web_weaver_personality
					ruler_has_personality = well_advised_personality
					ruler_has_personality = midas_touched_personality
					ruler_has_personality = scholar_personality
					ruler_has_personality = architectural_visionary_personality
					ruler_has_personality = charismatic_negotiator_personality
					ruler_has_personality = silver_tongue_personality
					ruler_has_personality = tactical_genius_personality
					ruler_has_personality = babbling_buffoon_personality
					ruler_has_personality = drunkard_personality
					ruler_has_personality = loose_lips_personality
					ruler_has_personality = reformist_personality
				}
			}
		}
		custom_tooltip = ynn_joust_v2_tt
		if = {
			limit = {
				OR = {
					ruler_has_personality = free_thinker_personality
					ruler_has_personality = well_connected_personality
					ruler_has_personality = intricate_web_weaver_personality
					ruler_has_personality = well_advised_personality
					ruler_has_personality = midas_touched_personality
					ruler_has_personality = scholar_personality
					ruler_has_personality = architectural_visionary_personality
					ruler_has_personality = charismatic_negotiator_personality
					ruler_has_personality = silver_tongue_personality
					ruler_has_personality = tactical_genius_personality
					ruler_has_personality = babbling_buffoon_personality
					ruler_has_personality = drunkard_personality
					ruler_has_personality = loose_lips_personality
					ruler_has_personality = reformist_personality
				}
			}
			custom_tooltip = ynn_joust_ruler_affinity_tt
		}
		if = {
			limit = {
				tag = event_target:ynn_joust_opponent_1
			}
			if = {
				limit = {
					event_target:ynn_joust_opponent_2 = {
						OR = {
							ruler_has_personality = free_thinker_personality
							ruler_has_personality = well_connected_personality
							ruler_has_personality = intricate_web_weaver_personality
							ruler_has_personality = well_advised_personality
							ruler_has_personality = midas_touched_personality
							ruler_has_personality = scholar_personality
							ruler_has_personality = architectural_visionary_personality
							ruler_has_personality = charismatic_negotiator_personality
							ruler_has_personality = silver_tongue_personality
							ruler_has_personality = tactical_genius_personality
							ruler_has_personality = babbling_buffoon_personality
							ruler_has_personality = drunkard_personality
							ruler_has_personality = loose_lips_personality
							ruler_has_personality = reformist_personality
						}
					}
				}
				custom_tooltip = ynn_joust_enemy_ruler_affinity_tt
			}
		}
		else_if = {
			limit = {
				tag = event_target:ynn_joust_opponent_2
			}
			if = {
				limit = {
					event_target:ynn_joust_opponent_1 = {
						OR = {
							ruler_has_personality = free_thinker_personality
							ruler_has_personality = well_connected_personality
							ruler_has_personality = intricate_web_weaver_personality
							ruler_has_personality = well_advised_personality
							ruler_has_personality = midas_touched_personality
							ruler_has_personality = scholar_personality
							ruler_has_personality = architectural_visionary_personality
							ruler_has_personality = charismatic_negotiator_personality
							ruler_has_personality = silver_tongue_personality
							ruler_has_personality = tactical_genius_personality
							ruler_has_personality = babbling_buffoon_personality
							ruler_has_personality = drunkard_personality
							ruler_has_personality = loose_lips_personality
							ruler_has_personality = reformist_personality
						}
					}
				}
				custom_tooltip = ynn_joust_enemy_ruler_affinity_tt
			}
		}
		hidden_effect = {
			clear_joust_flags_effect = yes
			if = {
				limit = {
					OR = {
						ruler_has_personality = free_thinker_personality
						ruler_has_personality = well_connected_personality
						ruler_has_personality = intricate_web_weaver_personality
						ruler_has_personality = well_advised_personality
						ruler_has_personality = midas_touched_personality
						ruler_has_personality = scholar_personality
						ruler_has_personality = architectural_visionary_personality
						ruler_has_personality = charismatic_negotiator_personality
						ruler_has_personality = silver_tongue_personality
						ruler_has_personality = tactical_genius_personality
						ruler_has_personality = babbling_buffoon_personality
						ruler_has_personality = drunkard_personality
						ruler_has_personality = loose_lips_personality
						ruler_has_personality = reformist_personality
					}
				}
				if = {
					limit = {
						tag = event_target:ynn_joust_opponent_1
					}
					event_target:ynn_joust_opponent_2 = {
						change_variable = {
							which = secondJoustPower
							value = 2
						}
					}
				}
				else_if = {
					limit = {
						tag = event_target:ynn_joust_opponent_2
					}
					custom_tooltip = ynn_joust_ruler_affinity_tt
					change_variable = {
						which = firstJoustPower
						value = 2
					}
				}
			}
			set_ruler_flag = ynn_joust_unpredictable
		}
	}

	after = {
		if = {
			limit = {
				tag = event_target:ynn_joust_opponent_2
			}
			event_target:ynn_joust_opponent_2 = {
				if = {
					limit = {
						NOT = {
							has_ruler_flag = ynn_tilt1
						}
					}
					set_ruler_flag = ynn_tilt1
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt1
					}
					set_ruler_flag = ynn_tilt2
					clr_ruler_flag = ynn_tilt1
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt2
					}
					set_ruler_flag = ynn_tilt3
					clr_ruler_flag = ynn_tilt2
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt3
					}
					set_ruler_flag = ynn_tilt4
					clr_ruler_flag = ynn_tilt3
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt4
					}
					set_ruler_flag = ynn_tilt5
					clr_ruler_flag = ynn_tilt4
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt5
					}
					set_ruler_flag = ynn_tilt6
					clr_ruler_flag = ynn_tilt5
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt6
					}
					set_ruler_flag = ynn_tilt7
					clr_ruler_flag = ynn_tilt5
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt7
					}
					set_ruler_flag = ynn_tilt8
					clr_ruler_flag = ynn_tilt7
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt8
					}
					set_ruler_flag = ynn_tilt9
					clr_ruler_flag = ynn_tilt8
				}
				else_if = {
					limit = {
						has_ruler_flag = ynn_tilt9
					}
					set_ruler_flag = ynn_tilt10
					clr_ruler_flag = ynn_tilt9
				}
				country_event = {
					id = ynn_joust_events.2
					days = 5
				}
			}
		}
		if = {
			limit = {
				event_target:ynn_joust_opponent_1 = {
					OR = {
						has_ruler_flag = ynn_joust_attack
						has_ruler_flag = ynn_joust_defend
						has_ruler_flag = ynn_joust_unpredictable
					}
				}
				event_target:ynn_joust_opponent_2 = {
					OR = {
						has_ruler_flag = ynn_joust_attack
						has_ruler_flag = ynn_joust_defend
						has_ruler_flag = ynn_joust_unpredictable
					}
				}
			}
			event_target:ynn_joust_opponent_1 = {
				set_ruler_flag = tilts_begun
			}
			event_target:ynn_joust_opponent_2 = {
				set_ruler_flag = tilts_begun
			}
			if = {
				limit = {
					has_ruler_flag = ynn_joust_attack
				}
				if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_attack
						}
					}
					subtract_variable = {
						which = firstJoustPower
						value = 4
					}
					subtract_variable = {
						which = secondJoustPower
						value = 4
					}
					set_ruler_flag = ynn_joust_even
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_even
					}
				}
				else_if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_unpredictable
						}
					}
					change_variable = {
						which = firstJoustPower
						value = 2
					}
					subtract_variable = {
						which = secondJoustPower
						value = 7
					}
					set_ruler_flag = ynn_joust_win
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_loss
					}
				}
				else_if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_defend
						}
					}
					subtract_variable = {
						which = firstJoustPower
						value = 7
					}
					change_variable = {
						which = secondJoustPower
						value = 2
					}
					set_ruler_flag = ynn_joust_loss
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_win
					}
				}
			}
			else_if = {
				limit = {
					has_ruler_flag = ynn_joust_defend
				}
				if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_defend
						}
					}
					subtract_variable = {
						which = firstJoustPower
						value = 3
					}
					subtract_variable = {
						which = secondJoustPower
						value = 3
					}
					set_ruler_flag = ynn_joust_even
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_even
					}
				}
				else_if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_unpredictable
						}
					}
					change_variable = {
						which = secondJoustPower
						value = 2
					}
					subtract_variable = {
						which = firstJoustPower
						value = 7
					}
					set_ruler_flag = ynn_joust_loss
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_win
					}
				}
				else_if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_attack
						}
					}
					subtract_variable = {
						which = secondJoustPower
						value = 7
					}
					change_variable = {
						which = firstJoustPower
						value = 2
					}
					set_ruler_flag = ynn_joust_win
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_loss
					}
				}
			}
			else_if = {
				limit = {
					has_ruler_flag = ynn_joust_unpredictable
				}
				if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_unpredictable
						}
					}
					subtract_variable = {
						which = firstJoustPower
						value = 3
					}
					subtract_variable = {
						which = secondJoustPower
						value = 3
					}
					set_ruler_flag = ynn_joust_even
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_even
					}
				}
				else_if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_defend
						}
					}
					change_variable = {
						which = firstJoustPower
						value = 2
					}
					subtract_variable = {
						which = secondJoustPower
						value = 7
					}
					set_ruler_flag = ynn_joust_win
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_loss
					}
				}
				else_if = {
					limit = {
						event_target:ynn_joust_opponent_1 = {
							has_ruler_flag = ynn_joust_attack
						}
					}
					subtract_variable = {
						which = firstJoustPower
						value = 7
					}
					change_variable = {
						which = secondJoustPower
						value = 2
					}
					set_ruler_flag = ynn_joust_loss
					event_target:ynn_joust_opponent_1 = {
						set_ruler_flag = ynn_joust_win
					}
				}
			}
		}
	}
}

#The joust ends and you lose
country_event = {
	id = ynn_joust_events.4
	title = ynn_joust_events.4.t
	desc = ynn_joust_events.4.d
	picture = TOURNAMENT_eventPicture

	is_triggered_only = yes
	hidden = yes

	trigger = {
		has_regency = no
	}

	option = {
		name = ynn_joust_events.4.a
		ai_chance = {
			factor = 1
		}
		if = {
			limit = {
				event_target:ynn_joust_opponent_1 = {
					tag = event_target:ynn_joust_winner
				}
			}
			event_target:ynn_joust_opponent_2 = {
				clr_ruler_flag = ynn_tilt10
				clear_joust_flags_effect = yes
				clr_ruler_flag = ynn_tilt1
				clr_ruler_flag = ynn_tilt2
				clr_ruler_flag = ynn_tilt3
				clr_ruler_flag = ynn_tilt4
				clr_ruler_flag = ynn_tilt5
				clr_ruler_flag = ynn_tilt6
				clr_ruler_flag = ynn_tilt7
				clr_ruler_flag = ynn_tilt8
				clr_ruler_flag = ynn_tilt9
				clr_ruler_flag = ynn_tilt10
				ynn_joust_death_check_effect = {
					OneJoustWin = yes
					HasNum = event_target:ynn_joust_opponent_2
				}
			}
			clr_ruler_flag = ynn_tilt10
			clear_joust_flags_effect = yes
			clr_ruler_flag = ynn_tilt1
			clr_ruler_flag = ynn_tilt2
			clr_ruler_flag = ynn_tilt3
			clr_ruler_flag = ynn_tilt4
			clr_ruler_flag = ynn_tilt5
			clr_ruler_flag = ynn_tilt6
			clr_ruler_flag = ynn_tilt7
			clr_ruler_flag = ynn_tilt8
			clr_ruler_flag = ynn_tilt9
			clr_ruler_flag = ynn_tilt10
		}
		else_if = {
			limit = {
				event_target:ynn_joust_opponent_2 = {
					tag = event_target:ynn_joust_winner
				}
			}
			event_target:ynn_joust_opponent_1 = {
				clr_ruler_flag = ynn_tilt10
				clear_joust_flags_effect = yes
				clr_ruler_flag = ynn_tilt1
				clr_ruler_flag = ynn_tilt2
				clr_ruler_flag = ynn_tilt3
				clr_ruler_flag = ynn_tilt4
				clr_ruler_flag = ynn_tilt5
				clr_ruler_flag = ynn_tilt6
				clr_ruler_flag = ynn_tilt7
				clr_ruler_flag = ynn_tilt8
				clr_ruler_flag = ynn_tilt9
				clr_ruler_flag = ynn_tilt10
				ynn_joust_death_check_effect = {
					TwoJoustWin = yes
					HasNum = event_target:ynn_joust_opponent_2
				}
			}
			clr_ruler_flag = ynn_tilt10
			clear_joust_flags_effect = yes
			clr_ruler_flag = ynn_tilt1
			clr_ruler_flag = ynn_tilt2
			clr_ruler_flag = ynn_tilt3
			clr_ruler_flag = ynn_tilt4
			clr_ruler_flag = ynn_tilt5
			clr_ruler_flag = ynn_tilt6
			clr_ruler_flag = ynn_tilt7
			clr_ruler_flag = ynn_tilt8
			clr_ruler_flag = ynn_tilt9
			clr_ruler_flag = ynn_tilt10
		}

		if = {
			limit = {
				event_target:ynn_joust_opponent_2 = {
					OR = {
						has_ruler_flag = offender_in_honour_joust
						has_ruler_flag = defender_in_honour_joust
					}
				}
			}
			ynn_joust_end_effect = {
				JOUSTWINNER = event_target:ynn_joust_winner
				JOUSTLOSER = ROOT
				ynnhonour = yes
			}
		}
		else_if = {
			limit = {
				event_target:ynn_joust_opponent_2 = {
					has_ruler_flag = G26_partaking_joust
				}
			}
			ynn_joust_end_effect = {
				JOUSTWINNER = event_target:ynn_joust_winner
				JOUSTLOSER = ROOT
				G26Joust = yes
			}
		}
	}
}
