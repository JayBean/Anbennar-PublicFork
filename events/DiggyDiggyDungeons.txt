namespace = diggy_dungeons

# Create dungeons or not
# Launch by the immediate effect of diggy_expedition.12 at the end of a succesfull expedition
province_event = {
	id = diggy_dungeons.0
	title = diggy_dungeons.0.t
	desc = diggy_dungeons.0.d
	picture = CAVE_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	trigger = {
		has_dlc = "Leviathan"
		REB = { NOT = { check_variable = { dwarovarDungeon = 10 } } }
		NOT = {
			province_group = hold_province
			has_special_expedition = yes 
		}
	}
	
	immediate = {
	}
	
	after = {
	}
	
	#no
	option = {
        name = diggy_dungeons.0.a
        ai_chance = { factor = 90 }
	}
	#yes
	option = {
        name = diggy_dungeons.0.a
        ai_chance = { 
			factor = 10 
			modifier = { factor = 1.2 check_variable = { dangerLevel = 3 } }
			modifier = { factor = 1.3 check_variable = { dangerLevel = 4 } }
			modifier = { factor = 1.4 check_variable = { dangerLevel = 5 } }

			modifier = { factor = 0 province_id = 4289 } #additional failsafe for stramolgiv
		}
		province_event = { id = diggy_dungeons.1 }
	}
}

# Select which dungeon to add
province_event = {
	id = diggy_dungeons.1
	title = diggy_dungeons.1.t
	desc = diggy_dungeons.1.d
	picture = CAVE_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
	}
	
	after = {
	}
	
	# No dungeon. It's here if no other option is available
	option = {
        name = diggy_dungeons.1.a
        ai_chance = { factor = 1 }
	}
	
	#Frogarsalforn, library of the ancients
	option = {
        name = diggy_dungeons.1.b
        ai_chance = { 
			factor = 100
			modifier = {
				factor = 1.5
				superregion = west_serpentspine_superregion
			}
			modifier = {
				factor = 1.5
				area_for_scope_province = { province_group = hold_province }
			}
		}
		trigger = { NOT = { has_global_flag = dd_frogarsalforn } }
		set_global_flag = dd_frogarsalforn
		set_province_flag = dd_frogarsalforn_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.100 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}

	#Stunveigry�rth, petrified forest
	option = {
        name = diggy_dungeons.1.c
        ai_chance = { 
			factor = 100
			modifier = {
				factor = 3
				any_neighbor_province = { has_terrain = gladeway }
			}
		}
		trigger = { NOT = { has_global_flag = dd_stunveigryorth } }
		set_global_flag = dd_stunveigryorth
		set_province_flag = dd_stunveigryorth_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.200 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}

	#Wytlramvar, Roots of the Spine
	option = {
        name = diggy_dungeons.1.c
        ai_chance = { 
			factor = 100
			modifier = {
				factor = 0.5
				OR = {
					trade_goods = gold
					trade_goods = mithril
				}
			}
			modifier = {
				factor = 1.5
				has_terrain = cavern
			}
			modifier = {
				factor = 1.5
				has_terrain = cavern
				all_neighbor_province = { has_terrain = cavern }
			}
		}
		trigger = { NOT = { has_global_flag = dd_wytlramvar } }
		set_global_flag = dd_wytlramvar
		set_province_flag = dd_wytlramvar_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.300 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}
	
	#Dimlherd, Geothermal Facility
	option = {
        name = diggy_dungeons.1.c
        ai_chance = { 
			factor = 100
			modifier = {
				factor = 1.5
				region = serpentreach_region
			}
		}
		trigger = { NOT = { has_global_flag = dd_dimlherd } }
		set_global_flag = dd_dimlherd
		set_province_flag = dd_dimlherd_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.400 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}

	#Grumhardhum, Great Forge
	option = {
		name = diggy_dungeons.1.c
		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0.5
				NOT = { region = west_dwarovar_region }
			}
		}
		trigger = { NOT = { has_global_flag = dd_grumhardhum } }
		set_global_flag = dd_grumhardhum
		set_province_flag = dd_grumhardhum_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.500 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}

	#Leforn V�mbr�thar, Abandoned Workshop
	option = {
        name = diggy_dungeons.1.c
        ai_chance = { 
			factor = 100
			modifier = {
				factor = 2
				#special named caves
				OR = {
					province_id = 2974 #grognirs crack
					province_id = 2961 #kekkigs prototype
					province_id = 4030 #gorge of erreg
					province_id = 4054 #kurzor cavern
					province_id = 4060 #kikkimig outlet
					province_id = 4148 #lords gorge
					province_id = 4214 #hehogrims mausoleum
					area = greatcavern_area
					province_id = 4288 #greatbeard cavern
				}
			}
		}
		trigger = { NOT = { has_global_flag = dd_leforn } }
		set_global_flag = dd_leforn
		set_province_flag = dd_leforn_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.600 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}

	#Rizv�mbr�thar, Forbidden Rune Workshop
	option = {
		name = diggy_dungeons.1.c
		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0.5
				NOT = { region = middle_dwarovar_region }
			}
		}
		trigger = { NOT = { has_global_flag = dd_rizvambrethar } }
		set_global_flag = dd_rizvambrethar
		set_province_flag = dd_rizvambrethar_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.700 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}

	#�fralgl�rf, Trecherous Chasm
	option = {
		name = diggy_dungeons.1.c
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				has_terrain = dwarven_road
			}
		}
		trigger = { NOT = { has_global_flag = dd_ofralglarf } }
		set_global_flag = dd_ofralglarf
		set_province_flag = dd_ofralglarf_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.800 }			#Dungeon description event
		save_event_target_as = dungeon_province
		hidden_effect = { owner = { country_event = { id = diggy_dungeons.5 } } }
	}
}

# Start the Dungeon Event Chain
province_event = {
	id = diggy_dungeons.2
	title = diggy_dungeons.2.t
	desc = diggy_dungeons.2.d
	picture = CAVE_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
	}
	
	after = {
	}
	
	# Select which dungeon to launch depending on the province flag set on diggy_dungeons.1
	option = {
        name = diggy_dungeons.2.a
        ai_chance = { factor = 100 }
		trigger_switch = {
			on_trigger = has_province_flag

			# Frogarsalforn, library of the ancients
			dd_frogarsalforn_flag = { dungeon_start_exploration = { dungeon = frogarsalforn floor1 = 101 floor2 = 120 floor3 = 142 } }

			# Stunveigry�rth, petrified forest
			dd_stunveigryorth_flag = { dungeon_start_exploration = { dungeon = stunveigryorth floor1 = 201 floor2 = 223 floor3 = 249 } }

			#Wytlramvar, Roots of the Spine
			dd_wytlramvar_flag = { dungeon_start_exploration = { dungeon = wytlramvar floor1 = 301 floor2 = 321 floor3 = 347 } }

			#Dimlherd, Geothermal Facility
			dd_dimlherd_flag = { dungeon_start_exploration = { dungeon = dimlherd floor1 = 401 floor2 = 429 floor3 = 453 } }

			#Grumhardhum, Great Forge
			dd_grumhardhum_flag = { dungeon_start_exploration = { dungeon = grumhardhum floor1 = 501 floor2 = 521 floor3 = 545 } }

			#Leforn V�mbr�thar, Abandoned Workshop
			dd_leforn_flag = { dungeon_start_exploration = { dungeon = leforn floor1 = 601 floor2 = 621 floor3 = 643 } }

			#Rizv�mbr�thar, Forbidden Rune Workshop
			dd_rizvambrethar_flag = { dungeon_start_exploration = { dungeon = rizvambrethar floor1 = 701 floor2 = 723 floor3 = 749 } }
			
			#�fralgl�rf, Trecherous Chasm
			dd_ofralglarf_flag = { dungeon_start_exploration = { dungeon = ofralglarf floor1 = 801 floor2 = 822 floor3 = 851 } }
		}
		province_event = { id = diggy_dungeons.2000 }
	}
}

#Dungeon Menu - During Exped
province_event = {
	id = diggy_dungeons.3
	title = diggy_dungeons.3.t
	desc = diggy_dungeons.3.d
	picture = DWARVEN_DUNGEON_ONGOING_eventPicture
	goto = ROOT
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}
	
	immediate = {
		hidden_effect = {
			update_party_costs = yes
			owner = { set_country_flag = debug_menu }
		}
		
	}
	
	after = {
		hidden_effect = { owner = { clr_country_flag = debug_menu } }
	}
	
	#Refresh
	option = {
        name = diggy_expedition.10.a
        ai_chance = { factor = 100 }
		hidden_effect = { province_event = { id = diggy_dungeons.4 } }
	}
	
	#Close
	option = {
        name = diggy_expedition.close
        ai_chance = { factor = 100 }
	}
}

province_event = {
	id = diggy_dungeons.4
	title = diggy_dungeons.4.t
	desc = diggy_dungeons.4.d
	picture = CAVE_eventPicture
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
	}
	
	after = {
	}
	
	option = {
        name = diggy_dungeons.4.a
        ai_chance = { factor = 100 }
		hidden_effect = { province_event = { id = diggy_dungeons.3 } }
	}
}

#these are necessary to actually build the stupid monument
country_event = {
	id = diggy_dungeons.5
	title = diggy_dungeons.2000.t
	desc = diggy_dungeons.2000.d
	picture = CAVE_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	option = {
        name = diggy_dungeons.2000.a
        ai_chance = { factor = 100 }
		country_event = { id = diggy_dungeons.6 }
	}
}
#yes, twice
country_event = {
	id = diggy_dungeons.6
	title = diggy_dungeons.2000.t
	desc = diggy_dungeons.2000.d
	picture = CAVE_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	option = {
        name = diggy_dungeons.2000.a
        ai_chance = { factor = 100 }
		event_target:dungeon_province = {
			set_province_flag = buildable_dungeon
			trigger_switch = {
				on_trigger = has_province_flag

				dd_frogarsalforn_flag = { add_great_project = { type = dd_frogarsalforn } }

				dd_stunveigryorth_flag = { add_great_project = { type = dd_stunveigryorth } }

				dd_wytlramvar_flag = { add_great_project = { type = dd_wytlramvar } }

				dd_dimlherd_flag = { add_great_project = { type = dd_dimlherd } }

				dd_grumhardhum_flag = { add_great_project = { type = dd_grumhardhum } }

				dd_leforn_flag = { add_great_project = { type = dd_leforn } }

				dd_rizvambrethar_flag = { add_great_project = { type = dd_rizvambrethar } }

				dd_ofralglarf_flag = { add_great_project = { type = dd_ofralglarf } }
			}
		}
	}
}

#AI prep
province_event = {
	id = diggy_dungeons.1500
	title = diggy_dungeons.1500.t
	desc = diggy_dungeons.1500.d
	picture = CAVE_eventPicture
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		always = yes
	}
	
	option = {
        name = diggy_dungeons.1500.a
        ai_chance = { factor = 100 }
		generate_ai_party = yes
		set_province_flag = sent_expedition_@owner
		set_province_flag = expedition_in_progress
		province_event = { id = diggy_dungeons.2 days = 30 }
		owner = { clr_country_flag = debug_menu }
	}
}

# Progress Loop
province_event = {
	id = diggy_dungeons.2000
	title = diggy_dungeons.2000.t
	desc = diggy_dungeons.2000.d
	picture = CAVE_eventPicture
	
	hidden = yes	#Must be hidden, not hidden for test purposes
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		has_province_flag = expedition_in_progress
		NOT = { has_province_modifier = expedition_death_timer }
	}
	
	immediate = {
	}
	
	after = {
	}
	
	option = {
        name = diggy_dungeons.2000.a
        ai_chance = { factor = 100 }
		dungeon_progress = yes
		
		if = {
			limit = { NOT = { check_variable = { partyManpower = 1 } } } #No more soldiers, you ded
			province_event = { id = diggy_dungeons.2001 }
		}
		else = {
			province_event = { id = diggy_dungeons.2000 days = 30 }
		}
	}
}

#Expedition Dead
province_event = {
	id = diggy_dungeons.2001
	title = diggy_expedition.13.t #uses the normal expedition death loc
	desc = diggy_expedition.13.d
	picture = LOOMING_DEATH_eventPicture
	goto = ROOT
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		has_province_flag = expedition_in_progress
		NOT = { has_province_modifier = expedition_death_timer }
	}
	
	immediate = {
		hidden_effect = { clr_province_flag = sent_expedition_@owner }
	}
	
	after = {
	}
	
	#Damnation
	option = {
        name = diggy_expedition.13.a
        ai_chance = { factor = 100 }
		owner = {
			add_prestige = -20
			random = {
				chance = 50
				add_stability = -1
			}
		}
		custom_tooltip = expedition_dead_tooltip
		hidden_effect = { expedition_dead_effect = yes }
	}
}



###############################
######## Frogarsalforn ########
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.100
    title = diggy_dungeons.100.t
    desc = diggy_dungeons.100.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.100.a
        ai_chance = { factor = 100 }
    }
}
# Ancient Library floor 1
# Beginning Floor 1
province_event = {
	id = diggy_dungeons.101
	title = diggy_dungeons.101.t
	desc = diggy_dungeons.101.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.101.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 102
			
			base_failure = 20
			failure_id = 103
		}
	}
	option = {
		name = diggy_dungeons.101.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 104 }
	}
}

# Beginning Floor 1: Clear the webs (E) - Success
province_event = {
	id = diggy_dungeons.102
	title = diggy_dungeons.102.t
	desc = diggy_dungeons.102.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.102.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 104 }
	}
}

# Beginning Floor 1: Clear the webs (E) - Failure
province_event = {
	id = diggy_dungeons.103
	title = diggy_dungeons.103.t
	desc = diggy_dungeons.103.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.103.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 104 }
	}
}

# Reading Hall
province_event = {
	id = diggy_dungeons.104
	title = diggy_dungeons.104.t
	desc = diggy_dungeons.104.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.104.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = frogarsalforn_1_broken_statue
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 105
			
			base_failure = 20
			failure_id = 106
		}
	}
	option = {
		name = diggy_dungeons.104.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 105
			
			base_failure = 40
			failure_id = 106
		}
	}
}

# Reading Hall: Destroy the statue (E) - Success
province_event = {
	id = diggy_dungeons.105
	title = diggy_dungeons.105.t
	desc = {
		trigger = { has_province_flag =  frogarsalforn_1_broken_statue }
		desc = diggy_dungeons.105.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = frogarsalforn_1_broken_statue } }
		desc = diggy_dungeons.105.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.105.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 107 }
	}
}

# Reading Hall: Destroy the statue (E) - Failure
province_event = {
	id = diggy_dungeons.106
	title = diggy_dungeons.106.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.106.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.106.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.106.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 107 }
	}
}

# Main Library
province_event = {
	id = diggy_dungeons.107
	title = diggy_dungeons.107.t
	desc = diggy_dungeons.107.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.107.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 109 }
	}
	option = {
		name = diggy_dungeons.107.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 108 }
	}
}

# Papermill
province_event = {
	id = diggy_dungeons.108
	title = diggy_dungeons.108.t
	desc = diggy_dungeons.108.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.108.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 111
			
			base_failure = 20
			failure_id = 110
		}
	}
}

# Bookbinder
province_event = {
	id = diggy_dungeons.109
	title = diggy_dungeons.109.t
	desc = diggy_dungeons.109.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.109.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = frogarsalforn_1_bookbinder
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 111
			
			base_failure = 40
			failure_id = 110
		}
	}
}

# Papermill: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.110
	title = diggy_dungeons.110.t
	desc = {
		trigger = { NOT = { has_province_flag = frogarsalforn_1_bookbinder } }
		desc = diggy_dungeons.110.d.1
	}
	desc = {
		trigger = { has_province_flag = frogarsalforn_1_bookbinder }
		desc = diggy_dungeons.110.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.110.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 112 }
	}
}

# Bookbinder: Fight (E) - Success
province_event = {
	id = diggy_dungeons.111
	title = diggy_dungeons.111.t
	desc = {
		trigger = { NOT = { has_province_flag = frogarsalforn_1_bookbinder } }
		desc = diggy_dungeons.111.d.1
	}
	desc = {
		trigger = { has_province_flag = frogarsalforn_1_bookbinder }
		desc = diggy_dungeons.111.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.111.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 113 }
	}
}

# Emergency System
province_event = {
	id = diggy_dungeons.112
	title = diggy_dungeons.112.t
	desc = diggy_dungeons.112.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.112.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 114
			
			base_failure = 20
			failure_id = 115
		}
	}
	option = {
		name = diggy_dungeons.112.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 116 }
	}
}

# Main Library
province_event = {
	id = diggy_dungeons.113
	title = diggy_dungeons.113.t
	desc = diggy_dungeons.113.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.113.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 118
			
			base_failure = 60
			failure_id = 117
		}
	}
}

# Emergency System: Yay - Success
province_event = {
	id = diggy_dungeons.114
	title = diggy_dungeons.114.t
	desc = diggy_dungeons.114.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.114.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 113 }
	}
}

# Emergency System: Yay - Failure
province_event = {
	id = diggy_dungeons.115
	title = diggy_dungeons.115.t
	desc = diggy_dungeons.115.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.115.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Emergency System: Nay - Failure
province_event = {
	id = diggy_dungeons.116
	title = diggy_dungeons.116.t
	desc = diggy_dungeons.116.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.116.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Main Library: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.117
	title = diggy_dungeons.117.t
	desc = diggy_dungeons.117.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.117.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Main Library: Fight (H) - Success
province_event = {
	id = diggy_dungeons.118
	title = diggy_dungeons.118.t
	desc = diggy_dungeons.118.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.118.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 119 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.119
	title = diggy_dungeons.119.t
	desc = diggy_dungeons.119.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Ancient Library floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.120
	title = diggy_dungeons.120.t
	desc = diggy_dungeons.120.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.120.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 121
			
			base_failure = 20
			failure_id = 122
		}
	}
}

# Beginning Floor 2: Fight (E) - Success
province_event = {
	id = diggy_dungeons.121
	title = diggy_dungeons.121.t
	desc = diggy_dungeons.121.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.121.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 123 }
	}
}

# Beginning Floor 2: Fight (E) - Failure
province_event = {
	id = diggy_dungeons.122
	title = diggy_dungeons.122.t
	desc = diggy_dungeons.122.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.122.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 123 }
	}
}

# Get Down
province_event = {
	id = diggy_dungeons.123
	title = diggy_dungeons.123.t
	desc = diggy_dungeons.123.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.123.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 126
			
			base_failure = 40
			failure_id = 125
		}
	}
	option = {
		name = diggy_dungeons.123.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 124 }
	}
}

# Get Down: Just rope down - Failure
province_event = {
	id = diggy_dungeons.124
	title = diggy_dungeons.124.t
	desc = diggy_dungeons.124.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.124.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 127 }
	}
}

# Get Down: Secure the thing (M) - Failure
province_event = {
	id = diggy_dungeons.125
	title = diggy_dungeons.125.t
	desc = diggy_dungeons.125.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.125.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 127 }
	}
}

# Get Down: Secure the thing (M) - Success
province_event = {
	id = diggy_dungeons.126
	title = diggy_dungeons.126.t
	desc = diggy_dungeons.126.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.126.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 127 }
	}
}

# Chasm 1
province_event = {
	id = diggy_dungeons.127
	title = diggy_dungeons.127.t
	desc = diggy_dungeons.127.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.127.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 128
			
			base_failure = 40
			failure_id = 129
		}
	}
}

# Chasm 1: Fight (M) - Success
province_event = {
	id = diggy_dungeons.128
	title = diggy_dungeons.128.t
	desc = diggy_dungeons.128.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.128.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 130 }
	}
}

# Chasm 1: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.129
	title = diggy_dungeons.129.t
	desc = diggy_dungeons.129.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.129.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 130 }
	}
}

# Chasm 2
province_event = {
	id = diggy_dungeons.130
	title = diggy_dungeons.130.t
	desc = diggy_dungeons.130.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.130.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 131
			
			base_failure = 40
			failure_id = 132
		}
	}
}

# Chasm 2: Fight (M) - Success
province_event = {
	id = diggy_dungeons.131
	title = diggy_dungeons.131.t
	desc = diggy_dungeons.131.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.131.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 133 }
	}
}

# Chasm 2: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.132
	title = diggy_dungeons.132.t
	desc = diggy_dungeons.132.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.132.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 600}

		dungeon_progress_advancement = { id = 133 }
	}
}

# Big Boss
province_event = {
	id = diggy_dungeons.133
	title = diggy_dungeons.133.t
	desc = diggy_dungeons.133.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.133.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 134
			
			base_failure = 60
			failure_id = 135
		}
	}
	option = {
		name = diggy_dungeons.133.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 136
			
			base_failure = 40
			failure_id = 137
		}
	}
}

# Big Boss: Make a Trap (H) - Success
province_event = {
	id = diggy_dungeons.134
	title = diggy_dungeons.134.t
	desc = diggy_dungeons.134.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.134.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 138 }
	}
}

# Big Boss: Make a Trap (H) - Failure
province_event = {
	id = diggy_dungeons.135
	title = diggy_dungeons.135.t
	desc = diggy_dungeons.135.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.135.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 136
			
			base_failure = 60
			failure_id = 137
		}
	}
}

# Big Boss: Fight (H) - Success
province_event = {
	id = diggy_dungeons.136
	title = diggy_dungeons.136.t
	desc = diggy_dungeons.136.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.136.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 138 }
	}
}

# Big Boss: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.137
	title = diggy_dungeons.137.t
	desc = diggy_dungeons.137.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.137.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Way Up
province_event = {
	id = diggy_dungeons.138
	title = diggy_dungeons.138.t
	desc = diggy_dungeons.138.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.138.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 139
			
			base_failure = 40
			failure_id = 140
		}
	}
}

# Way Up: Seal the wall (M) - Success
province_event = {
	id = diggy_dungeons.139
	title = diggy_dungeons.139.t
	desc = diggy_dungeons.139.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.139.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 141 }
	}
}

# Way Up: Seal the wall (M) - Failure
province_event = {
	id = diggy_dungeons.140
	title = diggy_dungeons.140.t
	desc = diggy_dungeons.140.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.140.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { remove_tooltip = yes loss = 150}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 141 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.141
	title = diggy_dungeons.141.t
	desc = diggy_dungeons.141.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Ancient Library floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.142
	title = diggy_dungeons.142.t
	desc = diggy_dungeons.142.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.142.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 143 }
	}
	option = {
		name = diggy_dungeons.142.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 145
			
			base_failure = 40
			failure_id = 144
		}
	}
}

# Collapsing Shelf
province_event = {
	id = diggy_dungeons.143
	title = diggy_dungeons.143.t
	desc = diggy_dungeons.143.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.143.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 147
			
			base_failure = 40
			failure_id = 146
		}
	}
}

# Beginning Floor 3: Barricade door (M) - Failure
province_event = {
	id = diggy_dungeons.144
	title = diggy_dungeons.144.t
	desc = diggy_dungeons.144.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.144.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 148
			
			base_failure = 40
			failure_id = 149
		}
	}
}

# Beginning Floor 3: Barricade door (M) - Success
province_event = {
	id = diggy_dungeons.145
	title = diggy_dungeons.145.t
	desc = diggy_dungeons.145.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.145.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Collapsing Shelf: Evade (M) - Failure
province_event = {
	id = diggy_dungeons.146
	title = diggy_dungeons.146.t
	desc = diggy_dungeons.146.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.146.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Collapsing Shelf: Evade (M) - Success
province_event = {
	id = diggy_dungeons.147
	title = diggy_dungeons.147.t
	desc = diggy_dungeons.147.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.147.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Beginning Floor 3: Barricade door (M) - Failure: Fight (M) - Success
province_event = {
	id = diggy_dungeons.148
	title = diggy_dungeons.148.t
	desc = diggy_dungeons.148.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.148.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Beginning Floor 3: Barricade door (M) - Failure: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.149
	title = diggy_dungeons.149.t
	desc = diggy_dungeons.149.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.149.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Scribe Room
province_event = {
	id = diggy_dungeons.150
	title = diggy_dungeons.150.t
	desc = diggy_dungeons.150.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.150.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 152
			
			base_failure = 60
			failure_id = 151
		}
	}
	option = {
		name = diggy_dungeons.150.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 153
			
			base_failure = 40
			failure_id = 154
		}
	}
}

# Scribe Room: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.151
	title = diggy_dungeons.151.t
	desc = diggy_dungeons.151.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.151.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 155 }
	}
}

# Scribe Room: Fight (H) - Success
province_event = {
	id = diggy_dungeons.152
	title = diggy_dungeons.152.t
	desc = diggy_dungeons.152.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.152.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 155 }
	}
}

# Scribe Room: Try to catch (M) - Success
province_event = {
	id = diggy_dungeons.153
	title = diggy_dungeons.153.t
	desc = diggy_dungeons.153.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.153.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 156 }
	}
}

# Scribe Room: Try to catch (M) - Failure
province_event = {
	id = diggy_dungeons.154
	title = diggy_dungeons.154.t
	desc = diggy_dungeons.154.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.154.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 156 }
	}
}

# Gold Room
province_event = {
	id = diggy_dungeons.155
	title = diggy_dungeons.155.t
	desc = diggy_dungeons.155.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.155.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 158
			
			base_failure = 40
			failure_id = 157
		}
	}
}

# Room Somewhere
province_event = {
	id = diggy_dungeons.156
	title = diggy_dungeons.156.t
	desc = diggy_dungeons.156.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.156.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 160
			
			base_failure = 20
			failure_id = 161
		}
	}
	option = {
		name = diggy_dungeons.156.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Gold Room: try to calm down (M) - Failure
province_event = {
	id = diggy_dungeons.157
	title = diggy_dungeons.157.t
	desc = diggy_dungeons.157.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.157.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Gold Room: try to calm down (M) - Success
province_event = {
	id = diggy_dungeons.158
	title = diggy_dungeons.158.t
	desc = diggy_dungeons.158.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.158.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Knowledge Elemental
province_event = {
	id = diggy_dungeons.159
	title = diggy_dungeons.159.t
	desc = diggy_dungeons.159.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.159.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 162
			
			base_failure = 60
			failure_id = 163
		}
	}
}

# Room Somewhere: Search Closely - Success
province_event = {
	id = diggy_dungeons.160
	title = diggy_dungeons.160.t
	desc = diggy_dungeons.160.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.160.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 159 }
	}
}

# Room Somewhere: Search Closely - Failure
province_event = {
	id = diggy_dungeons.161
	title = diggy_dungeons.161.t
	desc = diggy_dungeons.161.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.161.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Knowledge Elemental: Fight (H) - Success
province_event = {
	id = diggy_dungeons.162
	title = diggy_dungeons.162.t
	desc = diggy_dungeons.162.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.162.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 164 }
	}
}

# Knowledge Elemental: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.163
	title = diggy_dungeons.163.t
	desc = diggy_dungeons.163.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.163.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 164 }
	}
}

# Living Spell
province_event = {
	id = diggy_dungeons.164
	title = diggy_dungeons.164.t
	desc = diggy_dungeons.164.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.164.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 165
			
			base_failure = 60
			failure_id = 166
		}
	}
}

# Living Spell: Fight (H) - Success
province_event = {
	id = diggy_dungeons.165
	title = diggy_dungeons.165.t
	desc = diggy_dungeons.165.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.165.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 167 }
	}
}

# Living Spell: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.166
	title = diggy_dungeons.166.t
	desc = diggy_dungeons.166.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.166.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.167
	title = diggy_dungeons.167.t
	desc = diggy_dungeons.167.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}

}

###############################
######## Stunveigryôrth #######
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.200
    title = diggy_dungeons.200.t
    desc = diggy_dungeons.200.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.200.a
        ai_chance = { factor = 100 }
    }
}
# Petrified Forest floor 1
# Beginning
province_event = {
	id = diggy_dungeons.201
	title = diggy_dungeons.201.t
	desc = diggy_dungeons.201.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.201.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 204
			
			base_failure = 20
			failure_id = 203
		}
	}
	option = {
		name = diggy_dungeons.201.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 202 }
	}
}

# A Brook Through the Canopy
province_event = {
	id = diggy_dungeons.202
	title = diggy_dungeons.202.t
	desc = diggy_dungeons.202.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.202.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 205 }
	}
	option = {
		name = diggy_dungeons.202.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 206 }
	}
}

# Beginning: Widen entrance (E) - Failure
province_event = {
	id = diggy_dungeons.203
	title = diggy_dungeons.203.t
	desc = diggy_dungeons.203.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.203.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 202 }
	}
}

# Beginning: Widen entrance (E) - Success
province_event = {
	id = diggy_dungeons.204
	title = diggy_dungeons.204.t
	desc = diggy_dungeons.204.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.204.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 202 }
	}
}

# Enchanting Lake
province_event = {
	id = diggy_dungeons.205
	title = diggy_dungeons.205.t
	desc = diggy_dungeons.205.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.205.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = stunveigryorth_1_lake
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 209
			
			base_failure = 20
			failure_id = 210
		}
	}
	option = {
		name = diggy_dungeons.205.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 207
			
			base_failure = 40
			failure_id = 208
		}
	}
}

# Light from Below
province_event = {
	id = diggy_dungeons.206
	title = diggy_dungeons.206.t
	desc = diggy_dungeons.206.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.206.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 207
			
			base_failure = 40
			failure_id = 208
		}
	}
	option = {
		name = diggy_dungeons.206.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 211
			
			base_failure = 40
			failure_id = 208
		}
	}
}

# Enchanting Lake: Dig quickly (M) - Success
province_event = {
	id = diggy_dungeons.207
	title = diggy_dungeons.207.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_1_lake } }
		desc = diggy_dungeons.207.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_1_lake }
		desc = diggy_dungeons.207.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.207.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Enchanting Lake: Dig quickly (M) - Failure
province_event = {
	id = diggy_dungeons.208
	title = diggy_dungeons.208.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_1_lake } }
		desc = diggy_dungeons.208.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_1_lake }
		desc = diggy_dungeons.208.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.208.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Enchanting Lake: Take the dive (E) - Success
province_event = {
	id = diggy_dungeons.209
	title = diggy_dungeons.209.t
	desc = diggy_dungeons.209.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.209.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Enchanting Lake: Take the dive (E) - Failure
province_event = {
	id = diggy_dungeons.210
	title = diggy_dungeons.210.t
	desc = diggy_dungeons.210.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.210.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Light from Below: Descend quietly (M) - Success
province_event = {
	id = diggy_dungeons.211
	title = diggy_dungeons.211.t
	desc = diggy_dungeons.211.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.211.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Inside the Massive Hollow Tree
province_event = {
	id = diggy_dungeons.212
	title = diggy_dungeons.212.t
	desc = diggy_dungeons.212.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.212.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 213
			
			base_failure = 40
			failure_id = 214
		}
	}
}

# Inside the Massive Hollow Tree: Descend stairs (M) - Success
province_event = {
	id = diggy_dungeons.213
	title = diggy_dungeons.213.t
	desc = diggy_dungeons.213.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.213.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 215 }
	}
}

# Inside the Massive Hollow Tree: Descend stairs (M) - Failure
province_event = {
	id = diggy_dungeons.214
	title = diggy_dungeons.214.t
	desc = diggy_dungeons.214.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.214.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 215 }
	}
}

# A Strange Treasure
province_event = {
	id = diggy_dungeons.215
	title = diggy_dungeons.215.t
	desc = diggy_dungeons.215.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.215.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 216
			
			base_failure = 20
			failure_id = 218
		}
	}
	option = {
		name = diggy_dungeons.215.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 217
			
			base_failure = 60
			failure_id = 218
		}
	}
}

# A Strange Treasure: Scrape carefully (E) - Success
province_event = {
	id = diggy_dungeons.216
	title = diggy_dungeons.216.t
	desc = diggy_dungeons.216.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.216.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 219 }
	}
}

# A Strange Treasure: Grab greedily (H) - Success
province_event = {
	id = diggy_dungeons.217
	title = diggy_dungeons.217.t
	desc = diggy_dungeons.217.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.217.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 219 }
	}
}

# A Strange Treasure: Scrape carefully (E) - Failure
province_event = {
	id = diggy_dungeons.218
	title = diggy_dungeons.218.t
	desc = diggy_dungeons.218.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.218.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_manpower = { remove_tooltip = yes loss = 400}

		dungeon_progress_advancement = { id = 219 }
	}
}

# Thick Bark
province_event = {
	id = diggy_dungeons.219
	title = diggy_dungeons.219.t
	desc = diggy_dungeons.219.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.219.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = stunveigryorth_1_explosives
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 220
			
			base_failure = 20
			failure_id = 221
		}
	}
	option = {
		name = diggy_dungeons.219.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 220
			
			base_failure = 40
			failure_id = 221
		}
	}
}

# Thick Bark: Use explosives (E) - Success
province_event = {
	id = diggy_dungeons.220
	title = diggy_dungeons.220.t
	desc = {
		trigger = { has_province_flag = stunveigryorth_1_explosives }
		desc = diggy_dungeons.220.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_1_explosives } }
		desc = diggy_dungeons.220.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.220.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 222 }
	}
}

# Thick Bark: Use explosives (E) - Failure
province_event = {
	id = diggy_dungeons.221
	title = diggy_dungeons.221.t
	desc = {
		trigger = { has_province_flag = stunveigryorth_1_explosives }
		desc = diggy_dungeons.221.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_1_explosives } }
		desc = diggy_dungeons.221.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.221.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 222 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.222
	title = diggy_dungeons.222.t
	desc = diggy_dungeons.222.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Petrified Forest floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.223
	title = diggy_dungeons.223.t
	desc = diggy_dungeons.223.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.223.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 225
			
			base_failure = 40
			failure_id = 226
		}
	}
	option = {
		name = diggy_dungeons.223.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 227
			
			base_failure = 20
			failure_id = 224
		}
	}
}

# Beginning Floor 2: Narrow opening (E) - Failure
province_event = {
	id = diggy_dungeons.224
	title = diggy_dungeons.224.t
	desc = diggy_dungeons.224.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.224.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

	}
}

# Beginning Floor 2: Speed decline (M) - Success
province_event = {
	id = diggy_dungeons.225
	title = diggy_dungeons.225.t
	desc = diggy_dungeons.225.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.225.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 228 }
	}
}

# Beginning Floor 2: Speed decline (M) - Failure
province_event = {
	id = diggy_dungeons.226
	title = diggy_dungeons.226.t
	desc = diggy_dungeons.226.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.226.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 228 }
	}
}

# Beginning Floor 2: Narrow opening (E) - Success
province_event = {
	id = diggy_dungeons.227
	title = diggy_dungeons.227.t
	desc = diggy_dungeons.227.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.227.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 229 }
	}
}

# Stone Dryads
province_event = {
	id = diggy_dungeons.228
	title = diggy_dungeons.228.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_2_dig } }
		desc = diggy_dungeons.228.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_2_dig }
		desc = diggy_dungeons.228.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.228.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 230
			
			base_failure = 40
			failure_id = 231
		}
	}
	option = {
		name = diggy_dungeons.228.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = stunveigryorth_2_pulverise
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 232
			
			base_failure = 60
			failure_id = 231
		}
	}
}

# Dancing lights
province_event = {
	id = diggy_dungeons.229
	title = diggy_dungeons.229.t
	desc = diggy_dungeons.229.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.229.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 233 }
	}
	option = {
		name = diggy_dungeons.229.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		set_province_flag = stunveigryorth_2_dig
		dungeon_progress_advancement = { id = 228 }
	}
}

# Stone Dryads: Request passage (M) - Success
province_event = {
	id = diggy_dungeons.230
	title = diggy_dungeons.230.t
	desc = diggy_dungeons.230.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.230.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 233 }
	}
}

# Stone Dryads: Pulverise them (H) - Failure
province_event = {
	id = diggy_dungeons.231
	title = diggy_dungeons.231.t
	desc = {
		trigger = { has_province_flag = stunveigryorth_2_pulverise }
		desc = diggy_dungeons.231.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_2_pulverise } }
		desc = diggy_dungeons.231.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.231.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 233 }
	}
}

# Stone Dryads: Pulverise them (H) - Success
province_event = {
	id = diggy_dungeons.232
	title = diggy_dungeons.232.t
	desc = diggy_dungeons.232.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.232.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 233 }
	}
}

# Long-Closed Rift
province_event = {
	id = diggy_dungeons.233
	title = diggy_dungeons.233.t
	desc = diggy_dungeons.233.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.233.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 235 }
	}
	option = {
		name = diggy_dungeons.233.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = stunveigryorth_2_explosives
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 234
			
			base_failure = 20
			failure_id = 235
		}
	}
}

# Long-Closed Rift: Explosives will do (E) - Success
province_event = {
	id = diggy_dungeons.234
	title = diggy_dungeons.234.t
	desc = {
		trigger = { has_province_flag = stunveigryorth_2_explosives }
		desc = diggy_dungeons.234.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_2_explosives } }
		desc = diggy_dungeons.234.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.234.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 236 }
	}
}

# Long-Closed Rift: Wield it (M) - Failure
province_event = {
	id = diggy_dungeons.235
	title = diggy_dungeons.235.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_2_explosives } }
		desc = diggy_dungeons.235.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_2_explosives }
		desc = diggy_dungeons.235.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.235.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 236 }
	}
}

# Bridged Chasm
province_event = {
	id = diggy_dungeons.236
	title = diggy_dungeons.236.t
	desc = diggy_dungeons.236.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.236.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 239
			
			base_failure = 20
			failure_id = 237
		}
	}
	option = {
		name = diggy_dungeons.236.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = stunveigryorth_2_descend
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 238
			
			base_failure = 40
			failure_id = 237
		}
	}
}

# Bridged Chasm: A fallen tree (E) - Failure
province_event = {
	id = diggy_dungeons.237
	title = diggy_dungeons.237.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_2_descend } }
		desc = diggy_dungeons.237.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_2_descend }
		desc = diggy_dungeons.237.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.237.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 240 }
	}
}

# Bridged Chasm: Descend (M) - Success
province_event = {
	id = diggy_dungeons.238
	title = diggy_dungeons.238.t
	desc = diggy_dungeons.238.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.238.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 240 }
	}
}

# Bridged Chasm: A fallen tree (E) - Success
province_event = {
	id = diggy_dungeons.239
	title = diggy_dungeons.239.t
	desc = diggy_dungeons.239.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.239.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 240 }
	}
}

# Stone Faerie Ring
province_event = {
	id = diggy_dungeons.240
	title = diggy_dungeons.240.t
	desc = diggy_dungeons.240.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.240.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 242
			
			base_failure = 60
			failure_id = 241
		}
	}
	option = {
		name = diggy_dungeons.240.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 243 }
	}
}

# Stone Faerie Ring: Risk it (H) - Failure
province_event = {
	id = diggy_dungeons.241
	title = diggy_dungeons.241.t
	desc = diggy_dungeons.241.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.241.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 243 }
	}
}

# Stone Faerie Ring: Risk it (H) - Success
province_event = {
	id = diggy_dungeons.242
	title = diggy_dungeons.242.t
	desc = diggy_dungeons.242.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.242.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}

		dungeon_progress_advancement = { id = 243 }
	}
}

# Exposed Roots
province_event = {
	id = diggy_dungeons.243
	title = diggy_dungeons.243.t
	desc = diggy_dungeons.243.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.243.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 244
			
			base_failure = 60
			failure_id = 247
		}
	}
	option = {
		name = diggy_dungeons.243.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 245
			
			base_failure = 20
			failure_id = 246
		}
	}
}

# Exposed Roots: Magical means (H) - Success
province_event = {
	id = diggy_dungeons.244
	title = diggy_dungeons.244.t
	desc = diggy_dungeons.244.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.244.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 248 }
	}
}

# Exposed Roots: Gunpowder (E) - Success
province_event = {
	id = diggy_dungeons.245
	title = diggy_dungeons.245.t
	desc = diggy_dungeons.245.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.245.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 248 }
	}
}

# Exposed Roots: Gunpowder (E) - Failure
province_event = {
	id = diggy_dungeons.246
	title = diggy_dungeons.246.t
	desc = diggy_dungeons.246.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.246.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 248 }
	}
}

# Exposed Roots: Magical means (H) - Failure
province_event = {
	id = diggy_dungeons.247
	title = diggy_dungeons.247.t
	desc = diggy_dungeons.247.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.247.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.248
	title = diggy_dungeons.248.t
	desc = diggy_dungeons.248.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Petrified Forest floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.249
	title = diggy_dungeons.249.t
	desc = diggy_dungeons.249.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.249.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 250 }
	}
	option = {
		name = diggy_dungeons.249.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 251 }
	}
}

# Upper Path
province_event = {
	id = diggy_dungeons.250
	title = diggy_dungeons.250.t
	desc = diggy_dungeons.250.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.250.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 253
			
			base_failure = 40
			failure_id = 252
		}
	}
	option = {
		name = diggy_dungeons.250.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = stunveigryorth_3_hammer
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 253
			
			base_failure = 20
			failure_id = 252
		}
	}
}

# Boggle Nest
province_event = {
	id = diggy_dungeons.251
	title = diggy_dungeons.251.t
	desc = diggy_dungeons.251.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.251.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 255
			
			base_failure = 40
			failure_id = 256
		}
	}
	option = {
		name = diggy_dungeons.251.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = stunveigryorth_3_smoke
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 254
			
			base_failure = 40
			failure_id = 256
		}
	}
}

# Upper Path: Chance it (M) - Failure
province_event = {
	id = diggy_dungeons.252
	title = diggy_dungeons.252.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_3_hammer } }
		desc = diggy_dungeons.252.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_3_hammer }
		desc = diggy_dungeons.252.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.252.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 251 }
	}
}

# Upper Path: Chance it (M) - Success
province_event = {
	id = diggy_dungeons.253
	title = diggy_dungeons.253.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_3_hammer } }
		desc = diggy_dungeons.253.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_3_hammer }
		desc = diggy_dungeons.253.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.253.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 257 }
	}
}

# Boggle Nest: Smoke them out (M) - Success
province_event = {
	id = diggy_dungeons.254
	title = diggy_dungeons.254.t
	desc = diggy_dungeons.254.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.254.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 258 }
	}
}

# Boggle Nest: Tight formation (M) - Success
province_event = {
	id = diggy_dungeons.255
	title = diggy_dungeons.255.t
	desc = diggy_dungeons.255.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.255.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 258 }
	}
}

# Boggle Nest: Smoke them out (M) - Failure
province_event = {
	id = diggy_dungeons.256
	title = diggy_dungeons.256.t
	desc = {
		trigger = { has_province_flag = stunveigryorth_3_smoke }
		desc = diggy_dungeons.256.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_3_smoke } }
		desc = diggy_dungeons.256.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.256.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 258 }
	}
}

# Satyr Feast Hall
province_event = {
	id = diggy_dungeons.257
	title = diggy_dungeons.257.t
	desc = diggy_dungeons.257.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.257.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 261
			
			base_failure = 20
			failure_id = 260
		}
	}
	option = {
		name = diggy_dungeons.257.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = stunveigryorth_3_illusion
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 259
			
			base_failure = 60
			failure_id = 260
		}
	}
}

# The Boneyard
province_event = {
	id = diggy_dungeons.258
	title = diggy_dungeons.258.t
	desc = diggy_dungeons.258.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.258.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 263
			
			base_failure = 40
			failure_id = 264
		}
	}
	option = {
		name = diggy_dungeons.258.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 262 }
	}
}

# Satyr Feast Hall: End the illusion (H) - Success
province_event = {
	id = diggy_dungeons.259
	title = diggy_dungeons.259.t
	desc = diggy_dungeons.259.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.259.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 262 }
	}
}

# Satyr Feast Hall: Indulge them (E) - Failure
province_event = {
	id = diggy_dungeons.260
	title = diggy_dungeons.260.t
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_3_illusion } }
		desc = diggy_dungeons.260.d.1
	}
	desc = {
		trigger = { has_province_flag = stunveigryorth_3_illusion }
		desc = diggy_dungeons.260.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.260.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 262 }
	}
}

# Satyr Feast Hall: Indulge them (E) - Success
province_event = {
	id = diggy_dungeons.261
	title = diggy_dungeons.261.t
	desc = diggy_dungeons.261.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.261.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 262 }
	}
}

# Ennis Hag
province_event = {
	id = diggy_dungeons.262
	title = diggy_dungeons.262.t
	desc = diggy_dungeons.262.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.262.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 267
			
			base_failure = 40
			failure_id = 266
		}
	}
	option = {
		name = diggy_dungeons.262.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 265
			
			base_failure = 20
			failure_id = 266
		}
	}
}

# The Boneyard: Loot it (M) - Success
province_event = {
	id = diggy_dungeons.263
	title = diggy_dungeons.263.t
	desc = diggy_dungeons.263.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.263.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 262 }
	}
}

# The Boneyard: Loot it (M) - Failure
province_event = {
	id = diggy_dungeons.264
	title = diggy_dungeons.264.t
	desc = diggy_dungeons.264.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.264.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 262 }
	}
}

# Ennis Hag: Kill on suspicion (E) - Success
province_event = {
	id = diggy_dungeons.265
	title = diggy_dungeons.265.t
	desc = diggy_dungeons.265.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.265.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 268 }
	}
}

# Ennis Hag: Kill on suspicion (E) - Failure
province_event = {
	id = diggy_dungeons.266
	title = diggy_dungeons.266.t
	desc = diggy_dungeons.266.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.266.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Ennis Hag: Identify (M) - Success
province_event = {
	id = diggy_dungeons.267
	title = diggy_dungeons.267.t
	desc = diggy_dungeons.267.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.267.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 268 }
	}
}

# Hag Lair
province_event = {
	id = diggy_dungeons.268
	title = diggy_dungeons.268.t
	desc = diggy_dungeons.268.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.268.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 271
			
			base_failure = 20
			failure_id = 269
		}
	}
	option = {
		name = diggy_dungeons.268.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = stunveigryorth_3_stick
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 270
			
			base_failure = 40
			failure_id = 269
		}
	}
}

# Hag Lair: Stick Together (M) - Failure
province_event = {
	id = diggy_dungeons.269
	title = diggy_dungeons.269.t
	desc = {
		trigger = { has_province_flag = stunveigryorth_3_stick }
		desc = diggy_dungeons.269.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = stunveigryorth_3_stick } }
		desc = diggy_dungeons.269.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.269.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 272 }
	}
}

# Hag Lair: Stick Together (M) - Success
province_event = {
	id = diggy_dungeons.270
	title = diggy_dungeons.270.t
	desc = diggy_dungeons.270.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.270.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 272 }
	}
}

# Hag Lair: Split up (E) - Success
province_event = {
	id = diggy_dungeons.271
	title = diggy_dungeons.271.t
	desc = diggy_dungeons.271.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.271.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 272 }
	}
}

# Ennis Hag
province_event = {
	id = diggy_dungeons.272
	title = diggy_dungeons.272.t
	desc = diggy_dungeons.272.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.272.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 275
			
			base_failure = 40
			failure_id = 273
		}
	}
	option = {
		name = diggy_dungeons.272.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 274
			
			base_failure = 60
			failure_id = 273
		}
	}
}

# Ennis Hag: Face the monster (H) - Failure
province_event = {
	id = diggy_dungeons.273
	title = diggy_dungeons.273.t
	desc = diggy_dungeons.273.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.273.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Ennis Hag: Face the monster (H) - Success
province_event = {
	id = diggy_dungeons.274
	title = diggy_dungeons.274.t
	desc = diggy_dungeons.274.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.274.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		dungeon_progress_advancement = { id = 276 }
	}
}

# Ennis Hag: Burn it down (M) - Success
province_event = {
	id = diggy_dungeons.275
	title = diggy_dungeons.275.t
	desc = diggy_dungeons.275.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.275.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 276 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.276
	title = diggy_dungeons.276.t
	desc = diggy_dungeons.276.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}



###############################
########## Wytlramvar #########
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.300
    title = diggy_dungeons.300.t
    desc = diggy_dungeons.300.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.300.a
        ai_chance = { factor = 100 }
    }
}
# The Roots of the Spine floor 1
# Collapsing wall
province_event = {
	id = diggy_dungeons.301
	title = diggy_dungeons.301.t
	desc = diggy_dungeons.301.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.301.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		dungeon_progress_advancement = { id = 302 }
	}
	option = {
		name = diggy_dungeons.301.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 303 }
	}
}

# storeroom
province_event = {
	id = diggy_dungeons.302
	title = diggy_dungeons.302.t
	desc = diggy_dungeons.302.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.302.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 306
			
			base_failure = 20
			failure_id = 305
		}
	}
	option = {
		name = diggy_dungeons.302.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		dungeon_progress_advancement = { id = 304 }
	}
}

# confusing junction
province_event = {
	id = diggy_dungeons.303
	title = diggy_dungeons.303.t
	desc = diggy_dungeons.303.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.303.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 308 }
	}
	option = {
		name = diggy_dungeons.303.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 307 }
	}
	option = {
		name = diggy_dungeons.303.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 309 }
	}
}

# collapsed exit
province_event = {
	id = diggy_dungeons.304
	title = diggy_dungeons.304.t
	desc = diggy_dungeons.304.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.304.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
		set_province_flag = wytlramvar_1_exit
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 311
			
			base_failure = 20
			failure_id = 310
		}
	}
	option = {
		name = diggy_dungeons.304.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_1_exit
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 311
			
			base_failure = 40
			failure_id = 310
		}
	}
}

# storeroom: search (E) - Failure
province_event = {
	id = diggy_dungeons.305
	title = diggy_dungeons.305.t
	desc = diggy_dungeons.305.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.305.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 304 }
	}
}

# storeroom: search (E) - Success
province_event = {
	id = diggy_dungeons.306
	title = diggy_dungeons.306.t
	desc = diggy_dungeons.306.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.306.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 304 }
	}
}

# reinforced door
province_event = {
	id = diggy_dungeons.307
	title = diggy_dungeons.307.t
	desc = diggy_dungeons.307.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.307.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 313
			
			base_failure = 60
			failure_id = 312
		}
	}
}

# Crystal growths
province_event = {
	id = diggy_dungeons.308
	title = diggy_dungeons.308.t
	desc = diggy_dungeons.308.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.308.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 314 }
	}
	option = {
		name = diggy_dungeons.308.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		dungeon_progress_advancement = { id = 315 }
	}
}

# Goblin patrol
province_event = {
	id = diggy_dungeons.309
	title = diggy_dungeons.309.t
	desc = diggy_dungeons.309.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.309.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 316
			
			base_failure = 40
			failure_id = 317
		}
	}
}

# collapsed exit: sprint across (M) - Failure
province_event = {
	id = diggy_dungeons.310
	title = diggy_dungeons.310.t
	desc = {
		trigger = { has_province_flag = wytlramvar_1_bridge }
		desc = diggy_dungeons.310.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_1_exit }
		desc = diggy_dungeons.310.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.310.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 318 }
	}
}

# collapsed exit: push through rubble (M) - Success
province_event = {
	id = diggy_dungeons.311
	title = diggy_dungeons.311.t
	desc = {
		trigger = { has_province_flag = wytlramvar_1_bridge }
		desc = diggy_dungeons.311.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_1_exit }
		desc = diggy_dungeons.311.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.311.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 318 }
	}
}

# reinforced door: break it down (H) - Failure
province_event = {
	id = diggy_dungeons.312
	title = diggy_dungeons.312.t
	desc = diggy_dungeons.312.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.312.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 303 }
	}
}

# reinforced door: break it down (H) - Success
province_event = {
	id = diggy_dungeons.313
	title = diggy_dungeons.313.t
	desc = diggy_dungeons.313.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.313.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 302 }
	}
}

# old rope bridge
province_event = {
	id = diggy_dungeons.314
	title = diggy_dungeons.314.t
	desc = diggy_dungeons.314.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.314.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_1_bridge
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 311
			
			base_failure = 40
			failure_id = 310
		}
	}
	option = {
		name = diggy_dungeons.314.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
		set_province_flag = wytlramvar_1_bridge
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 311
			
			base_failure = 20
			failure_id = 310
		}
	}
}

# Crystal monsters
province_event = {
	id = diggy_dungeons.315
	title = diggy_dungeons.315.t
	desc = diggy_dungeons.315.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.315.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

	}
	option = {
		name = diggy_dungeons.315.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_1_crystal
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 320
			
			base_failure = 60
			failure_id = 319
		}
	}
}

# Goblin patrol: fight (M) - Success
province_event = {
	id = diggy_dungeons.316
	title = diggy_dungeons.316.t
	desc = diggy_dungeons.316.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.316.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 314 }
	}
}

# Goblin patrol: fight (M) - Failure
province_event = {
	id = diggy_dungeons.317
	title = diggy_dungeons.317.t
	desc = diggy_dungeons.317.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.317.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 314 }
	}
}

# End event
province_event = {
	id = diggy_dungeons.318
	title = diggy_dungeons.318.t
	desc = diggy_dungeons.318.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

# Crystal monsters: leave crystals (E) - Failure
province_event = {
	id = diggy_dungeons.319
	title = diggy_dungeons.319.t
	desc = diggy_dungeons.319.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.319.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_loot = { remove_tooltip = yes loss = 75}

		dungeon_progress_advancement = { id = 314 }
	}
}

# Crystal monsters: fight (H) - Success
province_event = {
	id = diggy_dungeons.320
	title = diggy_dungeons.320.t
	desc = diggy_dungeons.320.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.320.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 314 }
	}
}
# The Roots of the Spine floor 2
# Past the lake
province_event = {
	id = diggy_dungeons.321
	title = diggy_dungeons.321.t
	desc = diggy_dungeons.321.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.321.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		dungeon_progress_advancement = { id = 323 }
	}
	option = {
		name = diggy_dungeons.321.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 322 }
	}
}

# around the lake
province_event = {
	id = diggy_dungeons.322
	title = diggy_dungeons.322.t
	desc = diggy_dungeons.322.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.322.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 324 }
	}
	option = {
		name = diggy_dungeons.322.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 325 }
	}
}

# through the lake
province_event = {
	id = diggy_dungeons.323
	title = diggy_dungeons.323.t
	desc = diggy_dungeons.323.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.323.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 326 }
	}
	option = {
		name = diggy_dungeons.323.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 327 }
	}
}

# crabs!
province_event = {
	id = diggy_dungeons.324
	title = diggy_dungeons.324.t
	desc = diggy_dungeons.324.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.324.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = wytlramvar_2_crabs
		dungeon_progress_advancement = { id = 329 }
	}
	option = {
		name = diggy_dungeons.324.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 330
			
			base_failure = 20
			failure_id = 328
		}
	}
}

# cave in a cave
province_event = {
	id = diggy_dungeons.325
	title = diggy_dungeons.325.t
	desc = diggy_dungeons.325.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.325.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 331
			
			base_failure = 40
			failure_id = 332
		}
	}
}

# strange swells
province_event = {
	id = diggy_dungeons.326
	title = diggy_dungeons.326.t
	desc = diggy_dungeons.326.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.326.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 324 }
	}
	option = {
		name = diggy_dungeons.326.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 333 }
	}
}

# island with goblins!
province_event = {
	id = diggy_dungeons.327
	title = diggy_dungeons.327.t
	desc = diggy_dungeons.327.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.327.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_2_island
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 335
			
			base_failure = 40
			failure_id = 334
		}
	}
}

# crabs!: feed (E) - Failure
province_event = {
	id = diggy_dungeons.328
	title = diggy_dungeons.328.t
	desc = diggy_dungeons.328.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.328.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 336 }
	}
}

# large angry crab/orcs living in the cave
province_event = {
	id = diggy_dungeons.329
	title = diggy_dungeons.329.t
	desc = {
		trigger = { has_province_flag = wytlramvar_2_crabs }
		desc = diggy_dungeons.329.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_2_crabs } }
		desc = diggy_dungeons.329.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.329.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 337
			
			base_failure = 20
			failure_id = 338
		}
	}
}

# crabs!: feed (E) - Success
province_event = {
	id = diggy_dungeons.330
	title = diggy_dungeons.330.t
	desc = diggy_dungeons.330.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.330.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 336 }
	}
}

# cave in a cave: search (M) - Success
province_event = {
	id = diggy_dungeons.331
	title = diggy_dungeons.331.t
	desc = diggy_dungeons.331.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.331.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		add_adk_effect = { add = 1 }		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 329 }
	}
}

# cave in a cave: search (M) - Failure
province_event = {
	id = diggy_dungeons.332
	title = diggy_dungeons.332.t
	desc = diggy_dungeons.332.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.332.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 329 }
	}
}

# mist spewer
province_event = {
	id = diggy_dungeons.333
	title = diggy_dungeons.333.t
	desc = diggy_dungeons.333.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.333.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 335
			
			base_failure = 60
			failure_id = 334
		}
	}
}

# island with goblins!: fight (H) - Failure
province_event = {
	id = diggy_dungeons.334
	title = diggy_dungeons.334.t
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_2_island } }
		desc = diggy_dungeons.334.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_2_island }
		desc = diggy_dungeons.334.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.334.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 339 }
	}
}

# island with goblins!: fight (H) - Success
province_event = {
	id = diggy_dungeons.335
	title = diggy_dungeons.335.t
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_2_island } }
		desc = diggy_dungeons.335.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_2_island }
		desc = diggy_dungeons.335.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.335.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 339 }
	}
}

# we're not alone
province_event = {
	id = diggy_dungeons.336
	title = diggy_dungeons.336.t
	desc = diggy_dungeons.336.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.336.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 341
			
			base_failure = 40
			failure_id = 340
		}
	}
}

# large angry crab/orcs living in the cave: fight (E) - Success
province_event = {
	id = diggy_dungeons.337
	title = diggy_dungeons.337.t
	desc = diggy_dungeons.337.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.337.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 336 }
	}
}

# large angry crab/orcs living in the cave: fight (E) - Failure
province_event = {
	id = diggy_dungeons.338
	title = diggy_dungeons.338.t
	desc = diggy_dungeons.338.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.338.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 336 }
	}
}

# sudden speed&nbsp;
province_event = {
	id = diggy_dungeons.339
	title = diggy_dungeons.339.t
	desc = diggy_dungeons.339.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.339.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_2_rapids
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 342
			
			base_failure = 40
			failure_id = 340
		}
	}
}

# we're not alone: traverse rapids (M) - Failure
province_event = {
	id = diggy_dungeons.340
	title = diggy_dungeons.340.t
	desc = {
		trigger = { has_province_flag = wytlramvar_2_rapids }
		desc = diggy_dungeons.340.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_2_rapids } }
		desc = diggy_dungeons.340.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.340.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 343 }
	}
}

# we're not alone: scout ahead (M)&nbsp; - Success
province_event = {
	id = diggy_dungeons.341
	title = diggy_dungeons.341.t
	desc = diggy_dungeons.341.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.341.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 343 }
	}
}

# sudden speed&nbsp;: traverse rapids (M) - Success
province_event = {
	id = diggy_dungeons.342
	title = diggy_dungeons.342.t
	desc = diggy_dungeons.342.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.342.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 343 }
	}
}

# Ancient legged fish
province_event = {
	id = diggy_dungeons.343
	title = diggy_dungeons.343.t
	desc = diggy_dungeons.343.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.343.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 345
			
			base_failure = 40
			failure_id = 344
		}
	}
}

# Ancient legged fish: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.344
	title = diggy_dungeons.344.t
	desc = diggy_dungeons.344.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.344.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Ancient legged fish: Fight (M) - Success
province_event = {
	id = diggy_dungeons.345
	title = diggy_dungeons.345.t
	desc = diggy_dungeons.345.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.345.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 346 }
	}
}

# End event
province_event = {
	id = diggy_dungeons.346
	title = diggy_dungeons.346.t
	desc = diggy_dungeons.346.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# The Roots of the Spine floor 3
# enter the ruins
province_event = {
	id = diggy_dungeons.347
	title = diggy_dungeons.347.t
	desc = diggy_dungeons.347.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.347.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 349 }
	}
	option = {
		name = diggy_dungeons.347.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 348 }
	}
}

# sleeping quarters
province_event = {
	id = diggy_dungeons.348
	title = diggy_dungeons.348.t
	desc = diggy_dungeons.348.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.348.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 350
			
			base_failure = 20
			failure_id = 351
		}
	}
}

# kitchen
province_event = {
	id = diggy_dungeons.349
	title = diggy_dungeons.349.t
	desc = diggy_dungeons.349.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.349.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 353
			
			base_failure = 40
			failure_id = 352
		}
	}
}

# sleeping quarters: clattering skeleton (E). if morale below 1/2 initial value then (M) - Success
province_event = {
	id = diggy_dungeons.350
	title = diggy_dungeons.350.t
	desc = diggy_dungeons.350.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.350.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 354 }
	}
}

# sleeping quarters: clattering skeleton (E). if morale below 1/2 initial value then (M) - Failure
province_event = {
	id = diggy_dungeons.351
	title = diggy_dungeons.351.t
	desc = diggy_dungeons.351.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.351.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 354 }
	}
}

# kitchen: search (M) - Failure
province_event = {
	id = diggy_dungeons.352
	title = diggy_dungeons.352.t
	desc = diggy_dungeons.352.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.352.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 355 }
	}
}

# kitchen: search (M) - Success
province_event = {
	id = diggy_dungeons.353
	title = diggy_dungeons.353.t
	desc = diggy_dungeons.353.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.353.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 355 }
	}
}

# t intersection
province_event = {
	id = diggy_dungeons.354
	title = diggy_dungeons.354.t
	desc = diggy_dungeons.354.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.354.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 356 }
	}
	option = {
		name = diggy_dungeons.354.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 357 }
	}
	option = {
		name = diggy_dungeons.354.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 349 }
	}
}

# t intersection
province_event = {
	id = diggy_dungeons.355
	title = diggy_dungeons.355.t
	desc = diggy_dungeons.355.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.355.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 356 }
	}
	option = {
		name = diggy_dungeons.355.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 357 }
	}
	option = {
		name = diggy_dungeons.355.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 348 }
	}
}

# closed gate
province_event = {
	id = diggy_dungeons.356
	title = diggy_dungeons.356.t
	desc = diggy_dungeons.356.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.356.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 359
			
			base_failure = 40
			failure_id = 358
		}
	}
	option = {
		name = diggy_dungeons.356.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_3_crank
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 359
			
			base_failure = 60
			failure_id = 358
		}
	}
}

# storage room
province_event = {
	id = diggy_dungeons.357
	title = diggy_dungeons.357.t
	desc = diggy_dungeons.357.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.357.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 361
			
			base_failure = 60
			failure_id = 360
		}
	}
	option = {
		name = diggy_dungeons.357.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = wytlramvar_3_shinies
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 362
			
			base_failure = 40
			failure_id = 360
		}
	}
}

# closed gate: fix the crank (H) - Failure
province_event = {
	id = diggy_dungeons.358
	title = diggy_dungeons.358.t
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_3_crank } }
		desc = diggy_dungeons.358.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_3_crank }
		desc = diggy_dungeons.358.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.358.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 363 }
	}
}

# closed gate: fix the crank (H) - Success
province_event = {
	id = diggy_dungeons.359
	title = diggy_dungeons.359.t
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_3_crank } }
		desc = diggy_dungeons.359.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_3_crank }
		desc = diggy_dungeons.359.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.359.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 363 }
	}
}

# storage room: search for shinies (M) - Failure
province_event = {
	id = diggy_dungeons.360
	title = diggy_dungeons.360.t
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_3_shinies } }
		desc = diggy_dungeons.360.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_3_shinies }
		desc = diggy_dungeons.360.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.360.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 364 }
	}
}

# storage room: search for clues (H) - Success
province_event = {
	id = diggy_dungeons.361
	title = diggy_dungeons.361.t
	desc = diggy_dungeons.361.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.361.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 364 }
	}
}

# storage room: search for shinies (M) - Success
province_event = {
	id = diggy_dungeons.362
	title = diggy_dungeons.362.t
	desc = diggy_dungeons.362.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.362.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 364 }
	}
}

# large chamber
province_event = {
	id = diggy_dungeons.363
	title = diggy_dungeons.363.t
	desc = diggy_dungeons.363.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.363.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 365
			
			base_failure = 40
			failure_id = 366
		}
	}
}

# t intersection
province_event = {
	id = diggy_dungeons.364
	title = diggy_dungeons.364.t
	desc = diggy_dungeons.364.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.364.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 348 }
	}
	option = {
		name = diggy_dungeons.364.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 349 }
	}
	option = {
		name = diggy_dungeons.364.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 356 }
	}
}

# large chamber: dodge (M) - Success
province_event = {
	id = diggy_dungeons.365
	title = diggy_dungeons.365.t
	desc = diggy_dungeons.365.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.365.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 367 }
	}
}

# large chamber: dodge (M) - Failure
province_event = {
	id = diggy_dungeons.366
	title = diggy_dungeons.366.t
	desc = diggy_dungeons.366.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.366.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 368 }
	}
}

# strange nest
province_event = {
	id = diggy_dungeons.367
	title = diggy_dungeons.367.t
	desc = diggy_dungeons.367.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.367.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 368 }
	}
	option = {
		name = diggy_dungeons.367.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		set_province_flag = wytlramvar_3_trap
		dungeon_progress_advancement = { id = 368 }
	}
}

# &nbsp;large camouflage bug
province_event = {
	id = diggy_dungeons.368
	title = diggy_dungeons.368.t
	desc = {
		trigger = { NOT = { has_province_flag = wytlramvar_3_trap } }
		desc = diggy_dungeons.368.d.1
	}
	desc = {
		trigger = { has_province_flag = wytlramvar_3_trap }
		desc = diggy_dungeons.368.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.368.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 369
			
			base_failure = 60
			failure_id = 370
		}
	}
}

# &nbsp;large camouflage bug: fight (H) - Success
province_event = {
	id = diggy_dungeons.369
	title = diggy_dungeons.369.t
	desc = diggy_dungeons.369.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.369.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		add_adk_effect = { add = 1 }
		dungeon_progress_advancement = { id = 371 }
	}
}

# &nbsp;large camouflage bug: fight (H) - Failure
province_event = {
	id = diggy_dungeons.370
	title = diggy_dungeons.370.t
	desc = diggy_dungeons.370.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.370.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.371
	title = diggy_dungeons.371.t
	desc = diggy_dungeons.371.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}


###############################
########### Dimlherd ##########
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.400
    title = diggy_dungeons.400.t
    desc = diggy_dungeons.400.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.400.a
        ai_chance = { factor = 100 }
    }
}
# Geothermal Facility floor 1
# Beginning
province_event = {
	id = diggy_dungeons.401
	title = diggy_dungeons.401.t
	desc = diggy_dungeons.401.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.401.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 402 }
	}
	option = {
		name = diggy_dungeons.401.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 403 }
	}
}

# Lava Tides
province_event = {
	id = diggy_dungeons.402
	title = diggy_dungeons.402.t
	desc = diggy_dungeons.402.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.402.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 405
			
			base_failure = 20
			failure_id = 404
		}
	}
}

# Ridge Pass
province_event = {
	id = diggy_dungeons.403
	title = diggy_dungeons.403.t
	desc = diggy_dungeons.403.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.403.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 402 }
	}
	option = {
		name = diggy_dungeons.403.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 407
			
			base_failure = 40
			failure_id = 406
		}
	}
}

# Lava Tides: Higher ground (E) - Failure
province_event = {
	id = diggy_dungeons.404
	title = diggy_dungeons.404.t
	desc = diggy_dungeons.404.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.404.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		dungeon_progress_advancement = { id = 408 }
	}
}

# Lava Tides: Higher ground (E) - Success
province_event = {
	id = diggy_dungeons.405
	title = diggy_dungeons.405.t
	desc = diggy_dungeons.405.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.405.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 408 }
	}
}

# Ridge Pass: Take the pass (M) - Failure
province_event = {
	id = diggy_dungeons.406
	title = diggy_dungeons.406.t
	desc = diggy_dungeons.406.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.406.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 402 }
	}
}

# Ridge Pass: Take the pass (M) - Success
province_event = {
	id = diggy_dungeons.407
	title = diggy_dungeons.407.t
	desc = diggy_dungeons.407.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.407.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 409 }
	}
}

# Slumbering Naga
province_event = {
	id = diggy_dungeons.408
	title = diggy_dungeons.408.t
	desc = diggy_dungeons.408.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.408.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 411
			
			base_failure = 40
			failure_id = 412
		}
	}
	option = {
		name = diggy_dungeons.408.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 413
			
			base_failure = 60
			failure_id = 410
		}
	}
}

# Old Dwarven Guardpost
province_event = {
	id = diggy_dungeons.409
	title = diggy_dungeons.409.t
	desc = diggy_dungeons.409.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.409.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 414
			
			base_failure = 20
			failure_id = 415
		}
	}
}

# Slumbering Naga: Tip-Toe Around (H) - Failure
province_event = {
	id = diggy_dungeons.410
	title = diggy_dungeons.410.t
	desc = diggy_dungeons.410.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.410.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 416 }
	}
}

# Slumbering Naga: Sneak Attack! (M) - Success
province_event = {
	id = diggy_dungeons.411
	title = diggy_dungeons.411.t
	desc = diggy_dungeons.411.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.411.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 417 }
	}
}

# Slumbering Naga: Sneak Attack! (M) - Failure
province_event = {
	id = diggy_dungeons.412
	title = diggy_dungeons.412.t
	desc = diggy_dungeons.412.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.412.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 1}

		dungeon_progress_advancement = { id = 417 }
	}
}

# Slumbering Naga: Tip-Toe Around (H) - Success
province_event = {
	id = diggy_dungeons.413
	title = diggy_dungeons.413.t
	desc = diggy_dungeons.413.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.413.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 417 }
	}
}

# Old Dwarven Guardpost: Break the door (E) - Success
province_event = {
	id = diggy_dungeons.414
	title = diggy_dungeons.414.t
	desc = diggy_dungeons.414.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.414.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_supplies = { add_tooltip = yes add = 4}

		dungeon_progress_advancement = { id = 417 }
	}
}

# Old Dwarven Guardpost: Break the door (E) - Failure
province_event = {
	id = diggy_dungeons.415
	title = diggy_dungeons.415.t
	desc = diggy_dungeons.415.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.415.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 417 }
	}
}

# Naga's Offer
province_event = {
	id = diggy_dungeons.416
	title = diggy_dungeons.416.t
	desc = diggy_dungeons.416.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.416.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 417 }
	}
	option = {
		name = diggy_dungeons.416.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 419
			
			base_failure = 60
			failure_id = 418
		}
	}
}

# Flameskulls from above
province_event = {
	id = diggy_dungeons.417
	title = diggy_dungeons.417.t
	desc = diggy_dungeons.417.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.417.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 422
			
			base_failure = 20
			failure_id = 421
		}
	}
	option = {
		name = diggy_dungeons.417.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 423
			
			base_failure = 40
			failure_id = 421
		}
	}
	option = {
		name = diggy_dungeons.417.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 420
			
			base_failure = 60
			failure_id = 421
		}
	}
}

# Naga's Offer: trick some party members (H) - Failure
province_event = {
	id = diggy_dungeons.418
	title = diggy_dungeons.418.t
	desc = diggy_dungeons.418.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.418.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 800}

		dungeon_progress_advancement = { id = 417 }
	}
}

# Naga's Offer: trick some party members (H) - Success
province_event = {
	id = diggy_dungeons.419
	title = diggy_dungeons.419.t
	desc = diggy_dungeons.419.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.419.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 424 }
	}
}

# Flameskulls from above: Warriors to Front (H) - Success
province_event = {
	id = diggy_dungeons.420
	title = diggy_dungeons.420.t
	desc = diggy_dungeons.420.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.420.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 425 }
	}
}

# Flameskulls from above: Battle Formation (M) - Failure
province_event = {
	id = diggy_dungeons.421
	title = diggy_dungeons.421.t
	desc = diggy_dungeons.421.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.421.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 400}

		dungeon_progress_advancement = { id = 425 }
	}
}

# Flameskulls from above: Clerics to Front (E) - Success
province_event = {
	id = diggy_dungeons.422
	title = diggy_dungeons.422.t
	desc = diggy_dungeons.422.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.422.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 425 }
	}
}

# Flameskulls from above: Battle Formation (M) - Success
province_event = {
	id = diggy_dungeons.423
	title = diggy_dungeons.423.t
	desc = diggy_dungeons.423.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.423.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 425 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.424
	title = diggy_dungeons.424.t
	desc = diggy_dungeons.424.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

# Massive Lava Waterfall
province_event = {
	id = diggy_dungeons.425
	title = diggy_dungeons.425.t
	desc = diggy_dungeons.425.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.425.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 426
			
			base_failure = 40
			failure_id = 428
		}
	}
	option = {
		name = diggy_dungeons.425.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 427
			
			base_failure = 60
			failure_id = 428
		}
		hidden_effect = {
			set_province_flag = dimlherd_lava_canoeing_flag
		}
	}
}

# Massive Lava Waterfall: Rock Climbing (M) - Success
province_event = {
	id = diggy_dungeons.426
	title = diggy_dungeons.426.t
	desc = diggy_dungeons.426.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.426.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 424 }
	}
}

# Massive Lava Waterfall: Extreme Canoeing (H) - Success
province_event = {
	id = diggy_dungeons.427
	title = diggy_dungeons.427.t
	desc = diggy_dungeons.427.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.427.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 1}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 424 }
	}
}

# Massive Lava Waterfall: Extreme Canoeing (H) - Failure
province_event = {
	id = diggy_dungeons.428
	title = diggy_dungeons.428.t
	desc = {
		trigger = {
			NOT = { has_province_flag = dimlherd_lava_canoeing_flag }
		}
		desc = diggy_dungeons.428.d.1
	}
	desc = {
		trigger = {
			has_province_flag = dimlherd_lava_canoeing_flag
		}
		desc = diggy_dungeons.428.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.428.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 424 }

		hidden_effect = { clr_province_flag = dimlherd_lava_canoeing_flag }
	}
}
# Geothermal Facility floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.429
	title = diggy_dungeons.429.t
	desc = diggy_dungeons.429.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.429.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 430
			
			base_failure = 60
			failure_id = 431
		}
	}
	option = {
		name = diggy_dungeons.429.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 432 }
	}
}

# Beginning Floor 2: blow the walls (H) - Success
province_event = {
	id = diggy_dungeons.430
	title = diggy_dungeons.430.t
	desc = diggy_dungeons.430.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.430.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }
		dungeon_progress_advancement = { id = 432 }
	}
}

# Beginning Floor 2: blow the walls (H) - Failure
province_event = {
	id = diggy_dungeons.431
	title = diggy_dungeons.431.t
	desc = diggy_dungeons.431.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.431.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		set_province_flag = dimlherd_explosives_flag

		dungeon_progress_advancement = { id = 433 }
	}
}

# Heat Stroke
province_event = {
	id = diggy_dungeons.432
	title = diggy_dungeons.432.t
	desc = diggy_dungeons.432.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.432.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 434
			
			base_failure = 20
			failure_id = 435
		}
	}
	option = {
		name = diggy_dungeons.432.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 434
			
			base_failure = 60
			failure_id = 435
		}
	}
}

# The Eruption
province_event = {
	id = diggy_dungeons.433
	title = diggy_dungeons.433.t
	desc = diggy_dungeons.433.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.433.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 436
			
			base_failure = 40
			failure_id = 437
		}
	}
}

# Heat Stroke: Use water (E) - Success
province_event = {
	id = diggy_dungeons.434
	title = diggy_dungeons.434.t
	desc = diggy_dungeons.434.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.434.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 438 }
	}
}

# Heat Stroke: Use water (E) - Failure
province_event = {
	id = diggy_dungeons.435
	title = diggy_dungeons.435.t
	desc = diggy_dungeons.435.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.435.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 438 }
	}
}

# The Eruption: Search for old failsafe (M) - Success
province_event = {
	id = diggy_dungeons.436
	title = diggy_dungeons.436.t
	desc = diggy_dungeons.436.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.436.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 438 }
	}
}

# The Eruption: Search for old failsafe (M) - Failure
province_event = {
	id = diggy_dungeons.437
	title = diggy_dungeons.437.t
	desc = diggy_dungeons.437.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.437.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 1}

		dungeon_progress_advancement = { id = 438 }
	}
}

# Kobolds Camp
province_event = {
	id = diggy_dungeons.438
	title = diggy_dungeons.438.t
	desc = diggy_dungeons.438.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.438.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 439
			
			base_failure = 40
			failure_id = 440
		}
	}
	option = {
		name = diggy_dungeons.438.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 441
			
			base_failure = 20
			failure_id = 442
		}
	}
}

# Kobolds Camp: Attempt diplomacy (M) - Success
province_event = {
	id = diggy_dungeons.439
	title = diggy_dungeons.439.t
	desc = diggy_dungeons.439.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.439.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { add_tooltip = yes add = 4}

		dungeon_progress_advancement = { id = 443 }
	}
}

# Kobolds Camp: Attempt diplomacy (M) - Failure
province_event = {
	id = diggy_dungeons.440
	title = diggy_dungeons.440.t
	desc = diggy_dungeons.440.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.440.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 444 }
	}
}

# Kobolds Camp: To arms! (E) - Success
province_event = {
	id = diggy_dungeons.441
	title = diggy_dungeons.441.t
	desc = diggy_dungeons.441.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.441.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 444 }
	}
}

# Kobolds Camp: To arms! (E) - Failure
province_event = {
	id = diggy_dungeons.442
	title = diggy_dungeons.442.t
	desc = diggy_dungeons.442.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.442.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_loot = { remove_tooltip = yes loss = 75}

		dungeon_progress_advancement = { id = 444 }
	}
}

# Kobolds' Warning
province_event = {
	id = diggy_dungeons.443
	title = diggy_dungeons.443.t
	desc = diggy_dungeons.443.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.443.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 444 }
	}
	option = {
		name = diggy_dungeons.443.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 445 }
	}
}

# Behir sighted!
province_event = {
	id = diggy_dungeons.444
	title = diggy_dungeons.444.t
	desc = diggy_dungeons.444.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.444.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 446
			
			base_failure = 60
			failure_id = 447
		}
	}
}

# Facility Entrance
province_event = {
	id = diggy_dungeons.445
	title = diggy_dungeons.445.t
	desc = diggy_dungeons.445.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.445.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 451
			
			base_failure = 40
			failure_id = 450
		}
	}
	option = {
		name = diggy_dungeons.445.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 449
			
			base_failure = 60
			failure_id = 448
		}
	}
}

# Behir sighted!: Fight (H) - Success
province_event = {
	id = diggy_dungeons.446
	title = diggy_dungeons.446.t
	desc = diggy_dungeons.446.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.446.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 445 }
	}
}

# Behir sighted!: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.447
	title = diggy_dungeons.447.t
	desc = diggy_dungeons.447.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.447.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Facility Entrance: Throw bombs (H) - Failure
province_event = {
	id = diggy_dungeons.448
	title = diggy_dungeons.448.t
	desc = {
		trigger = { NOT = { has_province_flag = dimlherd_explosives_flag } }
		desc = diggy_dungeons.448.d.1
	}
	desc = {
		trigger = { has_province_flag = dimlherd_explosives_flag }
		desc = diggy_dungeons.448.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.448.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 1}

		dungeon_progress_advancement = { id = 452 }
	}
}

# Facility Entrance: Throw bombs (H) - Success
province_event = {
	id = diggy_dungeons.449
	title = diggy_dungeons.449.t
	desc = {
		trigger = { NOT = { has_province_flag = dimlherd_explosives_flag } }
		desc = diggy_dungeons.449.d.1
	}
	desc = {
		trigger = { has_province_flag = dimlherd_explosives_flag }
		desc = diggy_dungeons.449.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.449.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 452 }
	}
}

# Facility Entrance: To battle! (M) - Failure
province_event = {
	id = diggy_dungeons.450
	title = diggy_dungeons.450.t
	desc = diggy_dungeons.450.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.450.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 452 }
	}
}

# Facility Entrance: To battle! (M) - Success
province_event = {
	id = diggy_dungeons.451
	title = diggy_dungeons.451.t
	desc = diggy_dungeons.451.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.451.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 452 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.452
	title = diggy_dungeons.452.t
	desc = diggy_dungeons.452.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Geothermal Facility floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.453
	title = diggy_dungeons.453.t
	desc = diggy_dungeons.453.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.453.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 454 }
		
	}
	option = {
		name = diggy_dungeons.453.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 455 }
	}
}

# Turbines
province_event = {
	id = diggy_dungeons.454
	title = diggy_dungeons.454.t
	desc = diggy_dungeons.454.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		hidden_effect = {
			set_province_flag = dimlherd_generator_flag
		}
	}

	option = {
		name = diggy_dungeons.454.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 456
			
			base_failure = 40
			failure_id = 457
		}
	}
}

# Research Lab
province_event = {
	id = diggy_dungeons.455
	title = diggy_dungeons.455.t
	desc = diggy_dungeons.455.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		hidden_effect = {
			set_province_flag = dimlherd_laboratory_flag
		}
	}

	option = {
		name = diggy_dungeons.455.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 460
			
			base_failure = 60
			failure_id = 461
		}
	}
	option = {
		name = diggy_dungeons.455.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 459
			
			base_failure = 40
			failure_id = 458
		}
	}
}

# Turbines: Unstuck it (M) - Success
province_event = {
	id = diggy_dungeons.456
	title = diggy_dungeons.456.t
	desc = diggy_dungeons.456.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.456.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 462 }
	}
}

# Turbines: Unstuck it (M) - Failure
province_event = {
	id = diggy_dungeons.457
	title = diggy_dungeons.457.t
	desc = diggy_dungeons.457.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.457.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}

		dungeon_progress_advancement = { id = 462 }
	}
}

# Research Lab: send the tinkerers (M) - Failure
province_event = {
	id = diggy_dungeons.458
	title = diggy_dungeons.458.t
	desc = diggy_dungeons.458.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.458.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 463 }
	}
}

# Research Lab: send the tinkerers (M) - Success
province_event = {
	id = diggy_dungeons.459
	title = diggy_dungeons.459.t
	desc = diggy_dungeons.459.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.459.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }
		dungeon_progress_advancement = { id = 463 }
	}
}

# Research Lab: send the mages (H) - Success
province_event = {
	id = diggy_dungeons.460
	title = diggy_dungeons.460.t
	desc = diggy_dungeons.460.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.460.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { add_tooltip = yes add = 4}

		dungeon_progress_advancement = { id = 463 }
	}
}

# Research Lab: send the mages (H) - Failure
province_event = {
	id = diggy_dungeons.461
	title = diggy_dungeons.461.t
	desc = diggy_dungeons.461.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.461.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 463 }
	}
}

# Power Restored
province_event = {
	id = diggy_dungeons.462
	title = diggy_dungeons.462.t
	desc = diggy_dungeons.462.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.462.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 464
			
			base_failure = 40
			failure_id = 465
		}
	}
}

# Where to now?
province_event = {
	id = diggy_dungeons.463
	title = diggy_dungeons.463.t
	desc = diggy_dungeons.463.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.463.a
		trigger = {
			NOT = {
				has_province_flag = dimlherd_generator_flag
			}
		}
		ai_chance = { factor = 100 }

		dungeon_progress_advancement = { id = 454 }
	}
	option = {
		name = diggy_dungeons.463.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 466 }
	}
}

# Power Restored: Fight (M) - Success
province_event = {
	id = diggy_dungeons.464
	title = diggy_dungeons.464.t
	desc = diggy_dungeons.464.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.464.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 467 }
	}
}

# Power Restored: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.465
	title = diggy_dungeons.465.t
	desc = diggy_dungeons.465.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.465.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 467 }
	}
}

# Atrium
province_event = {
	id = diggy_dungeons.466
	title = diggy_dungeons.466.t
	desc = diggy_dungeons.466.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.466.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 469
			
			base_failure = 60
			failure_id = 468
		}
	}
	option = {
		name = diggy_dungeons.466.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 470
			
			base_failure = 20
			failure_id = 468
		}
	}
	option = {
		name = diggy_dungeons.466.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 470
			
			base_failure = 40
			failure_id = 468
		}
	}
}

# Where to now?
province_event = {
	id = diggy_dungeons.467
	title = diggy_dungeons.467.t
	desc = diggy_dungeons.467.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.467.a
		trigger = {
			NOT = {
				has_province_flag = dimlherd_laboratory_flag
			}
		}
		ai_chance = { factor = 100 }

		dungeon_progress_advancement = { id = 455 }
	}
	option = {
		name = diggy_dungeons.467.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 466 }
	}
}

# Atrium: Clerics, go! (M) - Failure
province_event = {
	id = diggy_dungeons.468
	title = diggy_dungeons.468.t
	desc = diggy_dungeons.468.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.468.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 471 }
	}
}

# Atrium: Mages, go! (H) - Success
province_event = {
	id = diggy_dungeons.469
	title = diggy_dungeons.469.t
	desc = diggy_dungeons.469.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.469.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 1}

		dungeon_progress_advancement = { id = 471 }
	}
}

# Atrium: Clerics, go! (M) - Success
province_event = {
	id = diggy_dungeons.470
	title = diggy_dungeons.470.t
	desc = diggy_dungeons.470.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.470.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 471 }
	}
}

# Magma Core
province_event = {
	id = diggy_dungeons.471
	title = diggy_dungeons.471.t
	desc = diggy_dungeons.471.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.471.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 472
			
			base_failure = 60
			failure_id = 473
		}
	}
}

# Magma Core: Reactivate! (H) - Success
province_event = {
	id = diggy_dungeons.472
	title = diggy_dungeons.472.t
	desc = diggy_dungeons.472.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.472.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 474 }
	}
}

# Magma Core: Reactivate! (H) - Failure
province_event = {
	id = diggy_dungeons.473
	title = diggy_dungeons.473.t
	desc = diggy_dungeons.473.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.473.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.474
	title = diggy_dungeons.474.t
	desc = diggy_dungeons.474.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

###############################
######### Grumhardhum #########
###############################

# Misc event presenting what the dungeons is
province_event = {
	id = diggy_dungeons.500
	title = diggy_dungeons.500.t
	desc = diggy_dungeons.500.d
	picture = CAVE_eventPicture
    
	is_triggered_only = yes
    
	trigger = {
		always = yes
	}
    
	immediate = {
	}
    
	after = {
	}
    
	# Nice
	option = {
		name = diggy_dungeons.500.a
		ai_chance = { factor = 100 }
	}
}
# Grunhardhum floor 1
# Beginning Floor 1
province_event = {
	id = diggy_dungeons.501
	title = diggy_dungeons.501.t
	desc = diggy_dungeons.501.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.501.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 502
			
			base_failure = 40
			failure_id = 503
		}
	}
	option = {
		name = diggy_dungeons.501.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 502
			
			base_failure = 20
			failure_id = 503
		}
	}
}

# Beginning Floor 1: Break it down (M) - Success
province_event = {
	id = diggy_dungeons.502
	title = diggy_dungeons.502.t
	desc = diggy_dungeons.502.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.502.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 504 }
	}
}

# Beginning Floor 1: Break it down (M) - Failure
province_event = {
	id = diggy_dungeons.503
	title = diggy_dungeons.503.t
	desc = diggy_dungeons.503.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.503.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 504 }
	}
}

# The Great Forge room
province_event = {
	id = diggy_dungeons.504
	title = diggy_dungeons.504.t
	desc = diggy_dungeons.504.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		hidden_effect = { set_province_flag = grumhardhum_1_forgeroom }
	}

	option = {
		name = diggy_dungeons.504.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 505
			
			base_failure = 40
			failure_id = 506
		}
	}
}

# The Great Forge room: Fight (M) - Success
province_event = {
	id = diggy_dungeons.505
	title = diggy_dungeons.505.t
	desc = diggy_dungeons.505.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.505.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# The Great Forge room: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.506
	title = diggy_dungeons.506.t
	desc = diggy_dungeons.506.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.506.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# Where to first?
province_event = {
	id = diggy_dungeons.507
	title = diggy_dungeons.507.t
	desc = {
		trigger = { has_province_flag = grumhardhum_1_forgeroom }
		desc = diggy_dungeons.507.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_1_forgeroom } }
		desc = diggy_dungeons.507.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	after = { clr_province_flag = grumhardhum_1_forgeroom }

	#upper
	option = {
		name = diggy_dungeons.507.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_1_upperlvl }
		}
		set_province_flag = grumhardhum_1_upperlvl
		dungeon_progress_advancement = { id = 508 }
	}

	#main
	option = {
		name = diggy_dungeons.507.b
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_1_mainlvl }
		}
		set_province_flag = grumhardhum_1_mainlvl
		dungeon_progress_advancement = { id = 509 }
	}

	#maintenance
	option = {
		name = diggy_dungeons.507.c
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_1_maintenancelvl }
		}
		set_province_flag = grumhardhum_1_maintenancelvl
		dungeon_progress_advancement = { id = 510 }
	}
	option = {
		name = diggy_dungeons.507.e
		ai_chance = { factor = 100 }
		trigger = {
			has_province_flag = grumhardhum_1_upperlvl
			has_province_flag = grumhardhum_1_mainlvl
			has_province_flag = grumhardhum_1_maintenancelvl
		}

		dungeon_progress_advancement = { id = 511 }
	}
}

# Upper Platform
province_event = {
	id = diggy_dungeons.508
	title = diggy_dungeons.508.t
	desc = diggy_dungeons.508.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.508.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 512
			
			base_failure = 20
			failure_id = 513
		}
	}
}

# Main Level
province_event = {
	id = diggy_dungeons.509
	title = diggy_dungeons.509.t
	desc = diggy_dungeons.509.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.509.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 514
			
			base_failure = 40
			failure_id = 515
		}
	}
}

# Maintenance Level
province_event = {
	id = diggy_dungeons.510
	title = diggy_dungeons.510.t
	desc = diggy_dungeons.510.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.510.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 516
			
			base_failure = 60
			failure_id = 517
		}
	}
	option = {
		name = diggy_dungeons.510.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = grumhardhum_1_emergencyvalves
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 516
			
			base_failure = 40
			failure_id = 517
		}
	}
}

# The Elevator
province_event = {
	id = diggy_dungeons.511
	title = diggy_dungeons.511.t
	desc = diggy_dungeons.511.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.511.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 518
			
			base_failure = 20
			failure_id = 519
		}
	}
	option = {
		name = diggy_dungeons.511.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 518
			
			base_failure = 40
			failure_id = 519
		}
	}
}

# Upper Platform: Fight (E) - Success
province_event = {
	id = diggy_dungeons.512
	title = diggy_dungeons.512.t
	desc = diggy_dungeons.512.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.512.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# Upper Platform: Fight (E) - Failure
province_event = {
	id = diggy_dungeons.513
	title = diggy_dungeons.513.t
	desc = diggy_dungeons.513.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.513.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# Main Level: Fight (M) - Success
province_event = {
	id = diggy_dungeons.514
	title = diggy_dungeons.514.t
	desc = diggy_dungeons.514.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.514.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# Main Level: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.515
	title = diggy_dungeons.515.t
	desc = diggy_dungeons.515.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.515.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# Maintenance Level: Repair the emergency valves(M) - Success
province_event = {
	id = diggy_dungeons.516
	title = diggy_dungeons.516.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_1_emergencyvalves } }
		desc = diggy_dungeons.516.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_1_emergencyvalves }
		desc = diggy_dungeons.516.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.516.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 600 }
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# Maintenance Level: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.517
	title = diggy_dungeons.517.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_1_emergencyvalves } }
		desc = diggy_dungeons.517.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_1_emergencyvalves }
		desc = diggy_dungeons.517.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.517.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1.5 }

		dungeon_progress_advancement = { id = 507 }
	}
}

# The Elevator: Use scavenged stuff (M) - Success
province_event = {
	id = diggy_dungeons.518
	title = diggy_dungeons.518.t
	desc = diggy_dungeons.518.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.518.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 520 }
	}
}

# The Elevator: Use scavenged stuff (M) - Failure
province_event = {
	id = diggy_dungeons.519
	title = diggy_dungeons.519.t
	desc = diggy_dungeons.519.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.519.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_supplies = { remove_tooltip = yes loss = 8 }

		dungeon_progress_advancement = { id = 520 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.520
	title = diggy_dungeons.520.t
	desc = diggy_dungeons.520.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Grunhardhum floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.521
	title = diggy_dungeons.521.t
	desc = diggy_dungeons.521.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_2_cauldron } }

	option = {
		name = diggy_dungeons.521.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 523
			
			base_failure = 20
			failure_id = 522
		}
	}
	option = {
		name = diggy_dungeons.521.b
		ai_chance = { factor = 100 }
		trigger = {
			owner = { culture_group = dwarven }
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 524 }
	}
}

# Beginning Floor 2: Try to decipher it (E) - Failure
province_event = {
	id = diggy_dungeons.522
	title = diggy_dungeons.522.t
	desc = diggy_dungeons.522.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.522.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 525 }
	}
}

# Beginning Floor 2: Try to decipher it (E) - Success
province_event = {
	id = diggy_dungeons.523
	title = diggy_dungeons.523.t
	desc = diggy_dungeons.523.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.523.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 525 }
	}
}

# Success
province_event = {
	id = diggy_dungeons.524
	title = diggy_dungeons.524.t
	desc = diggy_dungeons.524.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.524.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 1 }

		dungeon_progress_advancement = { id = 525 }
	}
}

# The Cauldron
province_event = {
	id = diggy_dungeons.525
	title = diggy_dungeons.525.t
	desc = {
		trigger = { has_province_flag = grumhardhum_2_cauldron }
		desc = diggy_dungeons.525.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_2_cauldron } }
		desc = diggy_dungeons.525.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	after = { clr_province_flag = grumhardhum_2_cauldron }

	#control room
	option = {
		name = diggy_dungeons.525.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_2_controlroom }
		}
		set_province_flag = grumhardhum_2_controlroom
		dungeon_progress_advancement = { id = 526 }
	}
	#tunnel
	option = {
		name = diggy_dungeons.525.b
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_2_tunnel }
		}
		set_province_flag = grumhardhum_2_tunnel
		dungeon_progress_advancement = { id = 527 }
	}
	#continue
	option = {
		name = diggy_dungeons.525.c
		ai_chance = { factor = 100 }
		trigger = {
			has_province_flag = grumhardhum_2_controlroom
			has_province_flag = grumhardhum_2_tunnel
		}
		dungeon_progress_advancement = { id = 528 }
	}
}

# Control Room
province_event = {
	id = diggy_dungeons.526
	title = diggy_dungeons.526.t
	desc = diggy_dungeons.526.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	#lever
	option = {
		name = diggy_dungeons.526.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_2_lever }
		}
		set_province_flag = grumhardhum_2_lever

		if = {
			limit = { has_province_flag = grumhardhum_2_control_correct1 }
			set_province_flag = grumhardhum_2_control_correct2
		}
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 529
			
			base_failure = 40
			failure_id = 530
		}
	}
	
	#left valve
	option = {
		name = diggy_dungeons.526.b
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_2_leftvalve }
		}
		set_province_flag = grumhardhum_2_leftvalve

		dungeon_encounter_effect = {
			base_success = 80
			success_id = 529
			
			base_failure = 20
			failure_id = 530
		}
	}
	#right valve
	option = {
		name = diggy_dungeons.526.c
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_2_rightvalve }
		}
		set_province_flag = grumhardhum_2_rightvalve

		if = {
			limit = { 
				has_province_flag = grumhardhum_2_leftvalve
				NOT = { has_province_flag = grumhardhum_2_lever }
			}
			set_province_flag = grumhardhum_2_control_correct1
		}
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 529
			
			base_failure = 40
			failure_id = 530
		}
	}
	#read
	option = {
		name = diggy_dungeons.526.e
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = grumhardhum_2_labels }
			NOT = {
				AND = {
					has_province_flag = grumhardhum_2_lever
					has_province_flag = grumhardhum_2_leftvalve
					has_province_flag = grumhardhum_2_rightvalve
				}
			}
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = grumhardhum_2_labels
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 532
			
			base_failure = 40
			failure_id = 531
		}
	}
	#continue
	option = {
		name = diggy_dungeons.526.f
		ai_chance = { factor = 100 }
		trigger = {
			has_province_flag = grumhardhum_2_lever
			has_province_flag = grumhardhum_2_leftvalve
			has_province_flag = grumhardhum_2_rightvalve
		}

		dungeon_progress_advancement = { id = 525 }
	}
}

# Maintenance Tunnel
province_event = {
	id = diggy_dungeons.527
	title = diggy_dungeons.527.t
	desc = diggy_dungeons.527.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.527.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 534
			
			base_failure = 40
			failure_id = 533
		}
	}
	option = {
		name = diggy_dungeons.527.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = grumhardhum_2_throwwater
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 534
			
			base_failure = 20
			failure_id = 533
		}
	}
}

# Deeper in
province_event = {
	id = diggy_dungeons.528
	title = diggy_dungeons.528.t
	desc = {
		trigger = { 
			AND = {
				has_province_flag = grumhardhum_2_control_correct2
				has_province_flag = grumhardhum_2_tunnel_success
			}
		}
		desc = diggy_dungeons.528.d.1
	}
	desc = {
		trigger = {
			OR = {
				AND = {
					NOT = { has_province_flag = grumhardhum_2_control_correct2 }
					has_province_flag = grumhardhum_2_tunnel_success
				}
				AND = {
					has_province_flag = grumhardhum_2_control_correct2
					NOT = { has_province_flag = grumhardhum_2_tunnel_success }
				}
			}
		}
		desc = diggy_dungeons.528.d.2
	}
	desc = {
		trigger = { 
			has_province_flag = grumhardhum_2_control_correct2
			has_province_flag = grumhardhum_2_tunnel_success
		}
		desc = diggy_dungeons.528.d.3
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	#big daddy ooze
	option = {
		name = diggy_dungeons.528.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = {
				has_province_flag = grumhardhum_2_control_correct2
				has_province_flag = grumhardhum_2_tunnel_success
			}
		}

		dungeon_progress_advancement = { id = 535 }
	}

	#small oozes
	option = {
		name = diggy_dungeons.528.b
		ai_chance = { factor = 100 }
		trigger = {
			OR = {
				AND = {
					NOT = { has_province_flag = grumhardhum_2_control_correct2 }
					has_province_flag = grumhardhum_2_tunnel_success
				}
				AND = {
					has_province_flag = grumhardhum_2_control_correct2
					NOT = { has_province_flag = grumhardhum_2_tunnel_success }
				}
			}
		}

		dungeon_progress_advancement = { id = 536 }
	}

	#clear path
	option = {
		name = diggy_dungeons.528.c
		ai_chance = { factor = 100 }
		trigger = { 
			has_province_flag = grumhardhum_2_control_correct2
			has_province_flag = grumhardhum_2_tunnel_success
		}
		dungeon_progress_advancement = { id = 537 }
	}
}

# Control Room: Pull the big lever (E) - Success
province_event = {
	id = diggy_dungeons.529
	title = diggy_dungeons.529.t
	desc = diggy_dungeons.529.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.529.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 526 }
	}
}

# Control Room: Pull the big lever (E) - Failure
province_event = {
	id = diggy_dungeons.530
	title = diggy_dungeons.530.t
	desc = diggy_dungeons.530.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.530.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 526 }
	}
}

# Control Room: Read the labels (M) - Failure
province_event = {
	id = diggy_dungeons.531
	title = diggy_dungeons.531.t
	desc = diggy_dungeons.531.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.531.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 526 }
	}
}

# Control Room: Read the labels (M) - Success
province_event = {
	id = diggy_dungeons.532
	title = diggy_dungeons.532.t
	desc = diggy_dungeons.532.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.532.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 526 }
	}
}

# Maintenance Tunnel: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.533
	title = diggy_dungeons.533.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_2_throwwater } }
		desc = diggy_dungeons.533.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_2_throwwater }
		desc = diggy_dungeons.533.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.533.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 538 }
	}
}

# Maintenance Tunnel: Throw Water (E) - Success
province_event = {
	id = diggy_dungeons.534
	title = diggy_dungeons.534.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_2_throwwater } }
		desc = diggy_dungeons.534.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_2_throwwater }
		desc = diggy_dungeons.534.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.534.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 538 }
	}
}

# Big Daddy Ooze
province_event = {
	id = diggy_dungeons.535
	title = diggy_dungeons.535.t
	desc = diggy_dungeons.535.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.535.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 10
			success_id = 539
			
			base_failure = 90
			failure_id = 540
		}
	}
	#throwwater
	option = {
		name = diggy_dungeons.535.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 30
			success_id = 539
			
			base_failure = 70
			failure_id = 540
		}
	}
}

# Small Oozes
province_event = {
	id = diggy_dungeons.536
	title = diggy_dungeons.536.t
	desc = diggy_dungeons.536.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.536.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 542
			
			base_failure = 40
			failure_id = 541
		}
	}
}

# End Event
province_event = {
	id = diggy_dungeons.537
	title = diggy_dungeons.537.t
	desc = diggy_dungeons.537.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		if = {
			limit = { 
				has_province_flag = grumhardhum_2_control_correct2
				has_province_flag = grumhardhum_2_tunnel_success
			}
			hidden_effect = { owner = { set_country_flag = grumhardhum_2_correct_clear } }
		}
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

# Stuck Floodgate
province_event = {
	id = diggy_dungeons.538
	title = diggy_dungeons.538.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_2_control_correct2 } }
		desc = diggy_dungeons.538.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_2_control_correct2 }
		desc = diggy_dungeons.538.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.538.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 543
			
			base_failure = 40
			failure_id = 544
		}
	}
	#explosives
	option = {
		name = diggy_dungeons.538.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = grumhardhum_2_blowup
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 543
			
			base_failure = 20
			failure_id = 544
		}
	}
}

# Big Daddy Ooze: Throw all the water (70) - Success
province_event = {
	id = diggy_dungeons.539
	title = diggy_dungeons.539.t
	desc = diggy_dungeons.539.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.539.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }
		change_party_manpower = { remove_tooltip = yes loss = 600 }

		dungeon_progress_advancement = { id = 537 }
	}
}

# Big Daddy Ooze: Throw all the water (70) - Failure
province_event = {
	id = diggy_dungeons.540
	title = diggy_dungeons.540.t
	desc = diggy_dungeons.540.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.540.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }
		change_party_manpower = { remove_tooltip = yes loss = 1000 }

		dungeon_progress_advancement = { id = 537 }
	}
}

# Small Oozes: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.541
	title = diggy_dungeons.541.t
	desc = diggy_dungeons.541.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.541.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 600 }

		dungeon_progress_advancement = { id = 537 }
	}
}

# Small Oozes: Fight (M) - Success
province_event = {
	id = diggy_dungeons.542
	title = diggy_dungeons.542.t
	desc = diggy_dungeons.542.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.542.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 537 }
	}
}

# Stuck Floodgate: Blow up debris (E) - Success
province_event = {
	id = diggy_dungeons.543
	title = diggy_dungeons.543.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_2_blowup } }
		desc = diggy_dungeons.543.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_2_blowup }
		desc = diggy_dungeons.543.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.543.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		set_province_flag = grumhardhum_2_tunnel_success
		dungeon_progress_advancement = { id = 525 }
	}
}

# Stuck Floodgate: Blow up debris (E) - Failure
province_event = {
	id = diggy_dungeons.544
	title = diggy_dungeons.544.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_2_blowup } }
		desc = diggy_dungeons.544.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_2_blowup }
		desc = diggy_dungeons.544.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.544.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_supplies = { remove_tooltip = yes loss = 8 }

		dungeon_progress_advancement = { id = 525 }
	}
}

# Grunhardhum floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.545
	title = diggy_dungeons.545.t
	desc = diggy_dungeons.545.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.545.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 546
			
			base_failure = 40
			failure_id = 547
		}
	}
	option = {
		name = diggy_dungeons.545.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 548
			
			base_failure = 20
			failure_id = 549
		}
	}
}

# Beginning Floor 3: Extra Payment (M) - Success
province_event = {
	id = diggy_dungeons.546
	title = diggy_dungeons.546.t
	desc = diggy_dungeons.546.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.546.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_effectiveness = { remove_tooltip = yes loss = 10 }

		dungeon_progress_advancement = { id = 550 }
	}
}

# Beginning Floor 3: Extra Payment (M) - Failure
province_event = {
	id = diggy_dungeons.547
	title = diggy_dungeons.547.t
	desc = diggy_dungeons.547.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.547.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 550 }
	}
}

# Beginning Floor 3: Extra Rations (E) - Success
province_event = {
	id = diggy_dungeons.548
	title = diggy_dungeons.548.t
	desc = diggy_dungeons.548.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.548.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_effectiveness = { remove_tooltip = yes loss = 10 }

		dungeon_progress_advancement = { id = 550 }
	}
}

# Beginning Floor 3: Extra Rations (E) - Failure
province_event = {
	id = diggy_dungeons.549
	title = diggy_dungeons.549.t
	desc = diggy_dungeons.549.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.549.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		change_party_effectiveness = { remove_tooltip = yes loss = 10 }

		dungeon_progress_advancement = { id = 550 }
	}
}

# The Furnace
province_event = {
	id = diggy_dungeons.550
	title = diggy_dungeons.550.t
	desc = {
		trigger = { owner = { has_country_flag = grumhardhum_2_correct_clear } }
		desc = diggy_dungeons.550.d.1
	}
	desc = {
		trigger = { owner = { NOT = { has_country_flag = grumhardhum_2_correct_clear } } }
		desc = diggy_dungeons.550.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}


	option = {
		name = diggy_dungeons.550.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		if = {
			limit = { owner = { has_country_flag = grumhardhum_2_correct_clear } }
			change_party_effectiveness = { add_tooltip = yes add = 5 }
			change_party_morale = { add_tooltip = yes add = 0.5 }
		}

		dungeon_progress_advancement = { id = 551 }
	}
	option = {
		name = diggy_dungeons.550.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		if = {
			limit = { owner = { has_country_flag = grumhardhum_2_correct_clear } }
			change_party_effectiveness = { add_tooltip = yes add = 5 }
			change_party_morale = { add_tooltip = yes add = 0.5 }
		}
		dungeon_progress_advancement = { id = 552 }
	}
}

# The Vents
province_event = {
	id = diggy_dungeons.551
	title = diggy_dungeons.551.t
	desc = diggy_dungeons.551.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_vents } }

	option = {
		name = diggy_dungeons.551.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 553
			
			base_failure = 20
			failure_id = 554
		}
	}
}

# The Floodgates
province_event = {
	id = diggy_dungeons.552
	title = diggy_dungeons.552.t
	desc = diggy_dungeons.552.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_floodgates } }

	option = {
		name = diggy_dungeons.552.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 555
			
			base_failure = 20
			failure_id = 554
		}
	}
}

# The Vents: Do it (E) - Success
province_event = {
	id = diggy_dungeons.553
	title = diggy_dungeons.553.t
	desc = diggy_dungeons.553.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_vents_success } }

	option = {
		name = diggy_dungeons.553.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

#Main Failure that leads to boss
province_event = {
	id = diggy_dungeons.554
	title = diggy_dungeons.554.t
	desc = diggy_dungeons.554.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.554.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 557 }
	}
}

#The Floodgates: Do it (E) - Success
province_event = {
	id = diggy_dungeons.555
	title = diggy_dungeons.555.t
	desc = diggy_dungeons.555.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_floodgates_success } }

	option = {
		name = diggy_dungeons.555.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_effectiveness = { add_tooltip = yes add = 5 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

# The Water Cannons
province_event = {
	id = diggy_dungeons.556
	title = diggy_dungeons.556.t
	desc = diggy_dungeons.556.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_cannons } }

	option = {
		name = diggy_dungeons.556.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 559
			
			base_failure = 40
			failure_id = 554
		}
	}
}

# The Heart
province_event = {
	id = diggy_dungeons.557
	title = diggy_dungeons.557.t
	desc = {
		trigger = { 
			NOT = {
				AND = {
					has_province_flag = grumhardhum_3_vents
					has_province_flag = grumhardhum_3_floodgates
					has_province_flag = grumhardhum_3_cannons
					has_province_flag = grumhardhum_3_cage
					has_province_flag = grumhardhum_3_golems
					has_province_flag = grumhardhum_3_sprinklers
				}
			}
		}
		desc = diggy_dungeons.557.d.1
	}
	desc = {
		trigger = { 
			has_province_flag = grumhardhum_3_vents
			has_province_flag = grumhardhum_3_floodgates
			has_province_flag = grumhardhum_3_cannons
			has_province_flag = grumhardhum_3_cage
			has_province_flag = grumhardhum_3_golems
			has_province_flag = grumhardhum_3_sprinklers
		}
		desc = diggy_dungeons.557.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}


	#run away
	option = {
		name = diggy_dungeons.557.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = {
				AND = {
					has_province_flag = grumhardhum_3_vents
					has_province_flag = grumhardhum_3_floodgates
					has_province_flag = grumhardhum_3_cannons
					has_province_flag = grumhardhum_3_cage
					has_province_flag = grumhardhum_3_golems
					has_province_flag = grumhardhum_3_sprinklers
				}
			}
		}

		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_elementalrun_1 } }
			set_province_flag = grumhardhum_3_elementalrun_1
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_elementalrun_2 } }
			set_province_flag = grumhardhum_3_elementalrun_2
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_elementalrun_3 } }
			set_province_flag = grumhardhum_3_elementalrun_3
		}
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 563
			
			base_failure = 20
			failure_id = 562
			added_failure_modifier = "
				modifier = { factor = 1.5 has_province_flag = grumhardhum_3_elementalrun_1 }
				modifier = { factor = 2.5 has_province_flag = grumhardhum_3_elementalrun_2 }
				modifier = { factor = 4 has_province_flag = grumhardhum_3_elementalrun_3 }
			"
		}
	}

	#fight
	option = {
		name = diggy_dungeons.557.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		if = {
			limit = {
				NOT = {
					AND = {
						has_province_flag = grumhardhum_3_vents
						has_province_flag = grumhardhum_3_floodgates
						has_province_flag = grumhardhum_3_cannons
						has_province_flag = grumhardhum_3_cage
						has_province_flag = grumhardhum_3_golems
						has_province_flag = grumhardhum_3_sprinklers
					}
				}
			}
			custom_tooltip = diggy_dungeons.557.tooltip
		}

		if = {
			limit = {
				has_province_flag = grumhardhum_3_vents_success
				has_province_flag = grumhardhum_3_floodgates_success
				has_province_flag = grumhardhum_3_cannons_success
				has_province_flag = grumhardhum_3_cage_success
				has_province_flag = grumhardhum_3_golems_success
				has_province_flag = grumhardhum_3_sprinklers_success
			}
			dungeon_encounter_effect = {
				base_success = 40
				success_id = 560
	
				base_failure = 60
				failure_id = 561
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 5
					has_province_flag = grumhardhum_3_vents_success
					has_province_flag = grumhardhum_3_floodgates_success
					has_province_flag = grumhardhum_3_cannons_success
					has_province_flag = grumhardhum_3_cage_success
					has_province_flag = grumhardhum_3_golems_success
					has_province_flag = grumhardhum_3_sprinklers_success
				}
			}
			dungeon_encounter_effect = {
				base_success = 30
				success_id = 560
	
				base_failure = 70
				failure_id = 561
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 4
					has_province_flag = grumhardhum_3_vents_success
					has_province_flag = grumhardhum_3_floodgates_success
					has_province_flag = grumhardhum_3_cannons_success
					has_province_flag = grumhardhum_3_cage_success
					has_province_flag = grumhardhum_3_golems_success
					has_province_flag = grumhardhum_3_sprinklers_success
				}
			}
			dungeon_encounter_effect = {
				base_success = 25
				success_id = 560
	
				base_failure = 75
				failure_id = 561
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 3
					has_province_flag = grumhardhum_3_vents_success
					has_province_flag = grumhardhum_3_floodgates_success
					has_province_flag = grumhardhum_3_cannons_success
					has_province_flag = grumhardhum_3_cage_success
					has_province_flag = grumhardhum_3_golems_success
					has_province_flag = grumhardhum_3_sprinklers_success
				}
			}
			dungeon_encounter_effect = {
				base_success = 20
				success_id = 560
	
				base_failure = 80
				failure_id = 561
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 2
					has_province_flag = grumhardhum_3_vents_success
					has_province_flag = grumhardhum_3_floodgates_success
					has_province_flag = grumhardhum_3_cannons_success
					has_province_flag = grumhardhum_3_cage_success
					has_province_flag = grumhardhum_3_golems_success
					has_province_flag = grumhardhum_3_sprinklers_success
				}
			}
			dungeon_encounter_effect = {
				base_success = 15
				success_id = 560
	
				base_failure = 85
				failure_id = 561
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 1
					has_province_flag = grumhardhum_3_vents_success
					has_province_flag = grumhardhum_3_floodgates_success
					has_province_flag = grumhardhum_3_cannons_success
					has_province_flag = grumhardhum_3_cage_success
					has_province_flag = grumhardhum_3_golems_success
					has_province_flag = grumhardhum_3_sprinklers_success
				}
			}
			dungeon_encounter_effect = {
				base_success = 10
				success_id = 560
	
				base_failure = 90
				failure_id = 561
			}
		}
		else = {
			dungeon_encounter_effect = {
				base_success = 5
				success_id = 560

				base_failure = 95
				failure_id = 561
			}
		}
	}
}

# The Cage
province_event = {
	id = diggy_dungeons.558
	title = diggy_dungeons.558.t
	desc = diggy_dungeons.558.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_cage } }

	option = {
		name = diggy_dungeons.558.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 564
			
			base_failure = 40
			failure_id = 554
		}
	}
}

# The Water Cannons: Do it (M) - Success
province_event = {
	id = diggy_dungeons.559
	title = diggy_dungeons.559.t
	desc = diggy_dungeons.559.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_cannons_success } }

	option = {
		name = diggy_dungeons.559.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_effectiveness = { add_tooltip = yes add = 10 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

# The Heart: Fight it (95) - Success
province_event = {
	id = diggy_dungeons.560
	title = diggy_dungeons.560.t
	desc = diggy_dungeons.560.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.560.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 800 }

		dungeon_progress_advancement = { id = 566 }
	}
}

# The Heart: Fight it (95) - Failure
province_event = {
	id = diggy_dungeons.561
	title = diggy_dungeons.561.t
	desc = diggy_dungeons.561.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.561.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# The Heart: Run Away (E) - Failure
province_event = {
	id = diggy_dungeons.562
	title = diggy_dungeons.562.t
	desc = diggy_dungeons.562.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.562.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 800 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

# The Heart: Run Away (E) - Success
province_event = {
	id = diggy_dungeons.563
	title = diggy_dungeons.563.t
	desc = diggy_dungeons.563.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.563.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

# The Cage: Reapply Wards (M) - Success
province_event = {
	id = diggy_dungeons.564
	title = diggy_dungeons.564.t
	desc = diggy_dungeons.564.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_cage_success } }

	option = {
		name = diggy_dungeons.564.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { add_tooltip = yes add = 10 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

# Security Golems
province_event = {
	id = diggy_dungeons.565
	title = diggy_dungeons.565.t
	desc = diggy_dungeons.565.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_golems } }

	option = {
		name = diggy_dungeons.565.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 568
			
			base_failure = 60
			failure_id = 554
		}
	}
}

# Weakened Elemental
province_event = {
	id = diggy_dungeons.566
	title = diggy_dungeons.566.t
	desc = {
		trigger = { NOT = { has_province_flag = grumhardhum_3_elementalfight_fail } }
		desc = diggy_dungeons.566.d.1
	}
	desc = {
		trigger = { has_province_flag = grumhardhum_3_elementalfight_fail }
		desc = diggy_dungeons.566.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	after = { clr_province_flag = grumhardhum_3_elementalfight_fail }

	option = {
		name = diggy_dungeons.566.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_encounter_effect = {
			base_success = 60
			success_id = 570
			
			base_failure = 40
			failure_id = 569
		}
	}
}

# The Sprinklers
province_event = {
	id = diggy_dungeons.567
	title = diggy_dungeons.567.t
	desc = diggy_dungeons.567.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_sprinklers } }

	option = {
		name = diggy_dungeons.567.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 571
			
			base_failure = 60
			failure_id = 554
		}
	}
}

# Security Golems: Do it (H) - Success
province_event = {
	id = diggy_dungeons.568
	title = diggy_dungeons.568.t
	desc = diggy_dungeons.568.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_golems_success } }

	option = {
		name = diggy_dungeons.568.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { add_tooltip = yes add = 10 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}

# Weakened Elemental: You herd me (M) - Failure
province_event = {
	id = diggy_dungeons.569
	title = diggy_dungeons.569.t
	desc = diggy_dungeons.569.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_elementalfight_fail } }

	option = {
		name = diggy_dungeons.569.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }
		change_party_manpower = { remove_tooltip = yes loss = 600 }

		dungeon_progress_advancement = { id = 566 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.570
	title = diggy_dungeons.570.t
	desc = diggy_dungeons.570.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		hidden_effect = { owner = { clr_country_flag = grumhardhum_2_correct_clear } }
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

# The Sprinklers: Fix them (H) - Success
province_event = {
	id = diggy_dungeons.571
	title = diggy_dungeons.571.t
	desc = diggy_dungeons.571.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = grumhardhum_3_sprinklers_success } }

	option = {
		name = diggy_dungeons.571.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { add_tooltip = yes add = 10 }

		#yes this is ugly but a scripted effect would break because PDX, so must be copy pasted everywhere
		if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_vents } }
			dungeon_progress_advancement = { id = 551 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_floodgates } }
			dungeon_progress_advancement = { id = 552 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cannons } }
			dungeon_progress_advancement = { id = 556 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_cage } }
			dungeon_progress_advancement = { id = 558 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_golems } }
			dungeon_progress_advancement = { id = 565 }
		}
		else_if = {
			limit = { NOT = { has_province_flag = grumhardhum_3_sprinklers } }
			dungeon_progress_advancement = { id = 567 }
		}
		else = { dungeon_progress_advancement = { id = 557 } }
	}
}


###############################
###### Leforn V�mbr�thar ######
###############################

# Misc event presenting what the dungeons is
province_event = {
	id = diggy_dungeons.600
	title = diggy_dungeons.600.t
	desc = diggy_dungeons.600.d
	picture = CAVE_eventPicture
    
	is_triggered_only = yes
    
	trigger = {
		always = yes
	}
    
	immediate = {
	}
    
	after = {
	}
    
	# Nice
	option = {
		name = diggy_dungeons.600.a
		ai_chance = { factor = 100 }
	}
}
# Abandoned Workshop floor 1
# Beginning
province_event = {
	id = diggy_dungeons.601
	title = diggy_dungeons.601.t
	desc = diggy_dungeons.601.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.601.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 602 }
	}
	option = {
		name = diggy_dungeons.601.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 603 }
	}
}

# Cave
province_event = {
	id = diggy_dungeons.602
	title = diggy_dungeons.602.t
	desc = diggy_dungeons.602.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.602.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 605
			
			base_failure = 40
			failure_id = 604
		}
	}
}

# River
province_event = {
	id = diggy_dungeons.603
	title = diggy_dungeons.603.t
	desc = diggy_dungeons.603.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.603.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 607
			
			base_failure = 40
			failure_id = 606
		}
	}
	option = {
		name = diggy_dungeons.603.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		set_province_flag = leforn_1_bomb		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 607
			
			base_failure = 20
			failure_id = 606
		}
	}
}

# Cave: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.604
	title = diggy_dungeons.604.t
	desc = diggy_dungeons.604.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.604.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 608 }
	}
}

# Cave: Fight (M) - Success
province_event = {
	id = diggy_dungeons.605
	title = diggy_dungeons.605.t
	desc = diggy_dungeons.605.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.605.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 608 }
	}
}

# River: Push boulder (M) - Failure
province_event = {
	id = diggy_dungeons.606
	title = diggy_dungeons.606.t
	desc = {
		trigger = { NOT = { has_province_flag = leforn_1_bomb } }
		desc = diggy_dungeons.606.d.1
	}
	desc = {
		trigger = { has_province_flag = leforn_1_bomb }
		desc = diggy_dungeons.606.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.606.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 602 }
	}
}

# River: Push boulder (M) - Success
province_event = {
	id = diggy_dungeons.607
	title = diggy_dungeons.607.t
	desc = {
		trigger = { NOT = { has_province_flag = leforn_1_bomb } }
		desc = diggy_dungeons.607.d.1
	}
	desc = {
		trigger = { has_province_flag = leforn_1_bomb }
		desc = diggy_dungeons.607.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.607.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 609 }
	}
}

# Broken Wall
province_event = {
	id = diggy_dungeons.608
	title = diggy_dungeons.608.t
	desc = diggy_dungeons.608.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.608.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 611
			
			base_failure = 60
			failure_id = 610
		}
	}
	option = {
		name = diggy_dungeons.608.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		set_province_flag = leforn_1_stabilize		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 611
			
			base_failure = 40
			failure_id = 610
		}
	}
}

# Maintenance Exit
province_event = {
	id = diggy_dungeons.609
	title = diggy_dungeons.609.t
	desc = diggy_dungeons.609.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.609.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 612
			
			base_failure = 20
			failure_id = 613
		}
	}
}

# Broken Wall: Walk through (H) - Failure
province_event = {
	id = diggy_dungeons.610
	title = diggy_dungeons.610.t
	desc = {
		trigger = { NOT = { has_province_flag = leforn_1_stabilize } }
		desc = diggy_dungeons.610.d.1
	}
	desc = {
		trigger = { has_province_flag = leforn_1_stabilize }
		desc = diggy_dungeons.610.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.610.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 614 }
	}
}

# Broken Wall: Walk through (H) - Success
province_event = {
	id = diggy_dungeons.611
	title = diggy_dungeons.611.t
	desc = {
		trigger = { NOT = { has_province_flag = leforn_1_stabilize } }
		desc = diggy_dungeons.611.d.1
	}
	desc = {
		trigger = { has_province_flag = leforn_1_stabilize }
		desc = diggy_dungeons.611.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.611.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 614 }
	}
}

# Maintenance Exit: Break the door (E) - Success
province_event = {
	id = diggy_dungeons.612
	title = diggy_dungeons.612.t
	desc = diggy_dungeons.612.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.612.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 614 }
	}
}

# Maintenance Exit: Break the door (E) - Failure
province_event = {
	id = diggy_dungeons.613
	title = diggy_dungeons.613.t
	desc = diggy_dungeons.613.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.613.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 614 }
	}
}

# Storage Room
province_event = {
	id = diggy_dungeons.614
	title = diggy_dungeons.614.t
	desc = diggy_dungeons.614.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.614.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 615
			
			base_failure = 60
			failure_id = 616
		}
	}
	option = {
		name = diggy_dungeons.614.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 617 }
	}
}

# Storage Room: Search closely (H) - Success
province_event = {
	id = diggy_dungeons.615
	title = diggy_dungeons.615.t
	desc = diggy_dungeons.615.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.615.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { add_tooltip = yes add = 8 }
		add_adk_effect = { add = 1 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 617 }
	}
}

# Storage Room: Search closely (H) - Failure
province_event = {
	id = diggy_dungeons.616
	title = diggy_dungeons.616.t
	desc = diggy_dungeons.616.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.616.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 617 }
	}
}

# Spider Nest
province_event = {
	id = diggy_dungeons.617
	title = diggy_dungeons.617.t
	desc = diggy_dungeons.617.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.617.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 618
			
			base_failure = 40
			failure_id = 619
		}
	}
}

# Spider Nest: Fight (M) - Success
province_event = {
	id = diggy_dungeons.618
	title = diggy_dungeons.618.t
	desc = diggy_dungeons.618.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.618.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 620 }
	}
}

# Spider Nest: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.619
	title = diggy_dungeons.619.t
	desc = diggy_dungeons.619.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.619.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 620 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.620
	title = diggy_dungeons.620.t
	desc = diggy_dungeons.620.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Abandoned Workshop floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.621
	title = diggy_dungeons.621.t
	desc = diggy_dungeons.621.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.621.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 622
			
			base_failure = 40
			failure_id = 623
		}
	}
}

# Beginning Floor 2: Fight (M) - Success
province_event = {
	id = diggy_dungeons.622
	title = diggy_dungeons.622.t
	desc = diggy_dungeons.622.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.622.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 624 }
	}
}

# Beginning Floor 2: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.623
	title = diggy_dungeons.623.t
	desc = diggy_dungeons.623.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.623.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 625 }
	}
}

# Generator/Turbine
province_event = {
	id = diggy_dungeons.624
	title = diggy_dungeons.624.t
	desc = diggy_dungeons.624.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.624.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 626 }
	}
	option = {
		name = diggy_dungeons.624.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 625 }
	}
}

# Machine Room
province_event = {
	id = diggy_dungeons.625
	title = diggy_dungeons.625.t
	desc = diggy_dungeons.625.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.625.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 627
			
			base_failure = 40
			failure_id = 628
		}
	}
}

# Boiler
province_event = {
	id = diggy_dungeons.626
	title = diggy_dungeons.626.t
	desc = diggy_dungeons.626.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.626.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 630
			
			base_failure = 20
			failure_id = 631
		}
	}
	option = {
		name = diggy_dungeons.626.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 629 }
	}
}

# Machine Room: Fight (M) - Success
province_event = {
	id = diggy_dungeons.627
	title = diggy_dungeons.627.t
	desc = diggy_dungeons.627.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.627.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 632 }
	}
}

# Machine Room: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.628
	title = diggy_dungeons.628.t
	desc = diggy_dungeons.628.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.628.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 632 }
	}
}

# Machine Room
province_event = {
	id = diggy_dungeons.629
	title = diggy_dungeons.629.t
	desc = diggy_dungeons.629.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.629.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 633
			
			base_failure = 40
			failure_id = 634
		}
	}
}

# Boiler: Try to fix (E) - Success
province_event = {
	id = diggy_dungeons.630
	title = diggy_dungeons.630.t
	desc = diggy_dungeons.630.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.630.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 629 }
	}
}

# Boiler: Try to fix (E) - Failure
province_event = {
	id = diggy_dungeons.631
	title = diggy_dungeons.631.t
	desc = diggy_dungeons.631.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.631.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 629 }
	}
}

# Power Transmission
province_event = {
	id = diggy_dungeons.632
	title = diggy_dungeons.632.t
	desc = diggy_dungeons.632.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.632.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 635 }
	}
	option = {
		name = diggy_dungeons.632.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 637
			
			base_failure = 60
			failure_id = 636
		}
	}
}

# Machine Room: Fight (M) - Success
province_event = {
	id = diggy_dungeons.633
	title = diggy_dungeons.633.t
	desc = diggy_dungeons.633.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.633.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 635 }
	}
}

# Machine Room: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.634
	title = diggy_dungeons.634.t
	desc = diggy_dungeons.634.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.634.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 632 }
	}
}

# Pump
province_event = {
	id = diggy_dungeons.635
	title = diggy_dungeons.635.t
	desc = diggy_dungeons.635.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.635.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 638
			
			base_failure = 40
			failure_id = 639
		}
	}
}

# Machine Room: Fight (M) - Failure: Try to fix (H) - Failure
province_event = {
	id = diggy_dungeons.636
	title = diggy_dungeons.636.t
	desc = diggy_dungeons.636.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.636.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 640
			
			base_failure = 40
			failure_id = 641
		}
	}
}

# Power Transmission: Try to fix (H) - Success
province_event = {
	id = diggy_dungeons.637
	title = diggy_dungeons.637.t
	desc = diggy_dungeons.637.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.637.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 635 }
	}
}

# Pump: Fight (M) - Success
province_event = {
	id = diggy_dungeons.638
	title = diggy_dungeons.638.t
	desc = diggy_dungeons.638.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.638.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 642 }
	}
}

# Pump: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.639
	title = diggy_dungeons.639.t
	desc = diggy_dungeons.639.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.639.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Machine Room: Fight (M) - Failure: Try to fix (H) - Failure: Fight (M) - Success
province_event = {
	id = diggy_dungeons.640
	title = diggy_dungeons.640.t
	desc = diggy_dungeons.640.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.640.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 635 }
	}
}

# Machine Room: Fight (M) - Failure: Try to fix (H) - Failure: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.641
	title = diggy_dungeons.641.t
	desc = diggy_dungeons.641.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.641.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 635 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.642
	title = diggy_dungeons.642.t
	desc = diggy_dungeons.642.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Abandoned Workshop floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.643
	title = diggy_dungeons.643.t
	desc = diggy_dungeons.643.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.643.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 645 }
	}
	option = {
		name = diggy_dungeons.643.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 644 }
	}
}

# Gem Storage
province_event = {
	id = diggy_dungeons.644
	title = diggy_dungeons.644.t
	desc = diggy_dungeons.644.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = leforn_3_gems } }

	option = {
		name = diggy_dungeons.644.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225 }

		dungeon_progress_advancement = { id = 646 }
	}
}

# Forge
province_event = {
	id = diggy_dungeons.645
	title = diggy_dungeons.645.t
	desc = diggy_dungeons.645.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = { hidden_effect = { set_province_flag = leforn_3_forge } }

	option = {
		name = diggy_dungeons.645.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 648
			
			base_failure = 40
			failure_id = 647
		}
	}
}

# Jeweller
province_event = {
	id = diggy_dungeons.646
	title = diggy_dungeons.646.t
	desc = diggy_dungeons.646.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.646.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 651
			
			base_failure = 40
			failure_id = 652
		}
	}
	option = {
		name = diggy_dungeons.646.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 650
			
			base_failure = 20
			failure_id = 649
		}
	}
}

# Forge: Extinguish (M) - Failure
province_event = {
	id = diggy_dungeons.647
	title = diggy_dungeons.647.t
	desc = diggy_dungeons.647.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.647.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 653 }
	}
}

# Forge: Extinguish (M) - Success
province_event = {
	id = diggy_dungeons.648
	title = diggy_dungeons.648.t
	desc = diggy_dungeons.648.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.648.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 653 }
	}
}

# Jeweller: Flee (E) - Failure
province_event = {
	id = diggy_dungeons.649
	title = diggy_dungeons.649.t
	desc = diggy_dungeons.649.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.649.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		set_province_flag = leforn_3_jeweller
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_loot = { remove_tooltip = yes loss = 75 }

		dungeon_progress_advancement = { id = 653 }
	}
}

# Jeweller: Flee (E) - Success
province_event = {
	id = diggy_dungeons.650
	title = diggy_dungeons.650.t
	desc = diggy_dungeons.650.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.650.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 654 }
	}
}

# Jeweller: Fight (M) - Success
province_event = {
	id = diggy_dungeons.651
	title = diggy_dungeons.651.t
	desc = diggy_dungeons.651.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.651.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 654 }
	}
}

# Jeweller: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.652
	title = diggy_dungeons.652.t
	desc = diggy_dungeons.652.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.652.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 654 }
	}
}

# Smithy
province_event = {
	id = diggy_dungeons.653
	title = diggy_dungeons.653.t
	desc = {
		trigger = { NOT = { has_province_flag = leforn_3_jeweller } }
		desc = diggy_dungeons.653.d.2
	}
	desc = {
		trigger = { has_province_flag = leforn_3_jeweller }
		desc = diggy_dungeons.653.d.1
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.653.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 655
			
			base_failure = 20
			failure_id = 656
		}
	}
}

# Where next?
province_event = {
	id = diggy_dungeons.654
	title = diggy_dungeons.654.t
	desc = diggy_dungeons.654.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.654.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = leforn_3_forge }
		}

		dungeon_progress_advancement = { id = 645 }
	}
	option = {
		name = diggy_dungeons.654.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 657 }
	}
}

# Smithy: Fight (E) - Success
province_event = {
	id = diggy_dungeons.655
	title = diggy_dungeons.655.t
	desc = diggy_dungeons.655.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.655.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 658 }
	}
}

# Smithy: Fight (E) - Failure
province_event = {
	id = diggy_dungeons.656
	title = diggy_dungeons.656.t
	desc = diggy_dungeons.656.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.656.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 658 }
	}
}

# Barracks
province_event = {
	id = diggy_dungeons.657
	title = diggy_dungeons.657.t
	desc = diggy_dungeons.657.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.657.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 659
			
			base_failure = 40
			failure_id = 660
		}
	}
}

# Where next?
province_event = {
	id = diggy_dungeons.658
	title = diggy_dungeons.658.t
	desc = diggy_dungeons.658.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.658.a
		ai_chance = { factor = 100 }
		trigger = {
			NOT = { has_province_flag = leforn_3_gems }
		}

		dungeon_progress_advancement = { id = 644 }
	}
	option = {
		name = diggy_dungeons.658.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 657 }
	}
}

# Barracks: Fight (M) - Success
province_event = {
	id = diggy_dungeons.659
	title = diggy_dungeons.659.t
	desc = diggy_dungeons.659.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.659.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 661 }
	}
}

# Barracks: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.660
	title = diggy_dungeons.660.t
	desc = diggy_dungeons.660.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.660.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 661 }
	}
}

# Main Room
province_event = {
	id = diggy_dungeons.661
	title = diggy_dungeons.661.t
	desc = diggy_dungeons.661.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.661.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 662
			
			base_failure = 60
			failure_id = 663
		}
	}
}

# Main Room: Fight (H) - Success
province_event = {
	id = diggy_dungeons.662
	title = diggy_dungeons.662.t
	desc = diggy_dungeons.662.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.662.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 664 }
	}
}

# Main Room: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.663
	title = diggy_dungeons.663.t
	desc = diggy_dungeons.663.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.663.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.664
	title = diggy_dungeons.664.t
	desc = diggy_dungeons.664.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

###############################
######## Rizv�mbr�thar ########
###############################

# Misc event presenting what the dungeons is
province_event = {
	id = diggy_dungeons.700
	title = diggy_dungeons.700.t
	desc = diggy_dungeons.700.d
	picture = CAVE_eventPicture
    
	is_triggered_only = yes
    
	trigger = {
		always = yes
	}
    
	immediate = {
	}
    
	after = {
	}
    
	# Nice
	option = {
		name = diggy_dungeons.700.a
		ai_chance = { factor = 100 }
	}
}
# Runic Workshop floor 1
# Runic Gateway
province_event = {
	id = diggy_dungeons.701
	title = diggy_dungeons.701.t
	desc = diggy_dungeons.701.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.701.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_1_entry
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 702 # Runic Gateway: Break it open! (H) - Success
			
			base_failure = 60
			failure_id = 703 # Runic Gateway: Break it open! (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.701.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 702 # Runic Gateway: Break it open! (H) - Success
			
			base_failure = 20
			failure_id = 703 # Runic Gateway: Break it open! (H) - Failure
		}
	}
}

# Runic Gateway: Break it open! (H) - Success
province_event = {
	id = diggy_dungeons.702
	title = diggy_dungeons.702.t
	desc = {
        trigger = { NOT = { has_province_flag = runeshop_1_entry } }
        desc = diggy_dungeons.702.d.1
    }
    desc = {
        trigger = { has_province_flag = runeshop_1_entry }
        desc = diggy_dungeons.702.d.2
    }
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.702.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 704 } # Trap-filled Hall
	}
}

# Runic Gateway: Break it open! (H) - Failure
province_event = {
	id = diggy_dungeons.703
	title = diggy_dungeons.703.t
	desc = {
        trigger = { NOT = { has_province_flag = runeshop_1_entry } }
        desc = diggy_dungeons.703.d.1
    }
    desc = {
        trigger = { has_province_flag = runeshop_1_entry }
        desc = diggy_dungeons.703.d.2
    }

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.703.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 704 } # Trap-filled Hall
	}
}

# Trap-filled Hall
province_event = {
	id = diggy_dungeons.704
	title = diggy_dungeons.704.t
	desc = diggy_dungeons.704.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.704.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_1_traps
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 706 # Trap-filled Hall: Make Blindfolds - Success
			
			base_failure = 40
			failure_id = 705 # Trap-filled Hall: Just don't look... (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.704.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 706 } # Trap-filled Hall: Make Blindfolds - Success
	}
}

# Trap-filled Hall: Just don't look... (M) - Failure
province_event = {
	id = diggy_dungeons.705
	title = diggy_dungeons.705.t
	desc = diggy_dungeons.705.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.705.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_effectiveness = { remove_tooltip = yes loss = 5 }

		dungeon_progress_advancement = { id = 707 } # Signs of Runesmithing
	}
}

# Trap-filled Hall: Make Blindfolds - Success
province_event = {
	id = diggy_dungeons.706
	title = diggy_dungeons.706.t
	desc = {
        trigger = { NOT = { has_province_flag = runeshop_1_traps } }
        desc = diggy_dungeons.706.d.1
    }
    desc = {
        trigger = { has_province_flag = runeshop_1_traps	 }
        desc = diggy_dungeons.706.d.2
    }
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.706.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 707 } # Signs of Runesmithing
	}
}

# Signs of Runesmithing
province_event = {
	id = diggy_dungeons.707
	title = diggy_dungeons.707.t
	desc = diggy_dungeons.707.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.707.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 708 # Signs of Runesmithing: investigate chests (M) - Success
			
			base_failure = 40
			failure_id = 710 # Signs of Runesmithing: investigate chests (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.707.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 711 # Signs of Runesmithing: investigate room (H) - Success
			
			base_failure = 60
			failure_id = 710 # Signs of Runesmithing: investigate chests (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.707.c
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = runeshop_1_perimeter

		dungeon_progress_advancement = { id = 709 } # Signs of Runesmithing: secure perimeter - Success
	}
}

# Signs of Runesmithing: investigate chests (M) - Success
province_event = {
	id = diggy_dungeons.708
	title = diggy_dungeons.708.t
	desc = diggy_dungeons.708.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.708.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 712 } # Golem Encountered
	}
}

# Signs of Runesmithing: secure perimeter - Success
province_event = {
	id = diggy_dungeons.709
	title = diggy_dungeons.709.t
	desc = diggy_dungeons.709.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.709.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { add_tooltip = yes add = 5 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 712 } # Golem Encountered
	}
}

# Signs of Runesmithing: investigate chests (M) - Failure
province_event = {
	id = diggy_dungeons.710
	title = diggy_dungeons.710.t
	desc = diggy_dungeons.710.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.710.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 713 } # War Golem Fight
	}
}

# Signs of Runesmithing: investigate room (H) - Success
province_event = {
	id = diggy_dungeons.711
	title = diggy_dungeons.711.t
	desc = diggy_dungeons.711.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.711.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 712 } # Golem Encountered
	}
}

# Golem Encountered
province_event = {
	id = diggy_dungeons.712
	title = diggy_dungeons.712.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_1_perimeter }
        }
        desc = diggy_dungeons.712.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_1_perimeter
        }
        desc = diggy_dungeons.712.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.712.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_1_attack

		dungeon_progress_advancement = { id = 713 } # War Golem Fight
	}
	option = {
		name = diggy_dungeons.712.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 714 } # Golem Encountered: Shut it down - Success
	}
}

# War Golem Fight
province_event = {
	id = diggy_dungeons.713
	title = diggy_dungeons.713.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_1_attack }
        }
        desc = diggy_dungeons.713.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_1_attack
        }
        desc = diggy_dungeons.713.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.713.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 717 # War Golem Fight: Normal Attack (M) - Success
			
			base_failure = 40
			failure_id = 715 # War Golem Fight: Explosives (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.713.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 716 # War Golem Fight: Explosives (H) - Success
			
			base_failure = 60
			failure_id = 715 # War Golem Fight: Explosives (H) - Failure
		}
	}
}

# Golem Encountered: Shut it down - Success
province_event = {
	id = diggy_dungeons.714
	title = diggy_dungeons.714.t
	desc = diggy_dungeons.714.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.714.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 718 } # Mecha-Spiders!
	}
}

# War Golem Fight: Explosives (H) - Failure
province_event = {
	id = diggy_dungeons.715
	title = diggy_dungeons.715.t
	desc = diggy_dungeons.715.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.715.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_effectiveness = { remove_tooltip = yes loss = 5 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 718 } # Mecha-Spiders!
	}
}

# War Golem Fight: Explosives (H) - Success
province_event = {
	id = diggy_dungeons.716
	title = diggy_dungeons.716.t
	desc = diggy_dungeons.716.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.716.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { remove_tooltip = yes loss = 5 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 718 } # Mecha-Spiders!
	}
}

# War Golem Fight: Normal Attack (M) - Success
province_event = {
	id = diggy_dungeons.717
	title = diggy_dungeons.717.t
	desc = diggy_dungeons.717.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.717.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 718 } # Mecha-Spiders!
	}
}

# Mecha-Spiders!
province_event = {
	id = diggy_dungeons.718
	title = diggy_dungeons.718.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.718.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.718.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.718.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 719 # Mecha-Spiders!: crush them (E) - Success
			
			base_failure = 20
			failure_id = 720 # Mecha-Spiders!: crush them (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.718.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 721 } # Mecha-Spiders!: Let them fix it - Success
	}
}

# Mecha-Spiders!: crush them (E) - Success
province_event = {
	id = diggy_dungeons.719
	title = diggy_dungeons.719.t
	desc = diggy_dungeons.719.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.719.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 722 } # End Event
	}
}

# Mecha-Spiders!: crush them (E) - Failure
province_event = {
	id = diggy_dungeons.720
	title = diggy_dungeons.720.t
	desc = diggy_dungeons.720.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.720.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 722 } # End Event
	}
}

# Mecha-Spiders!: Let them fix it - Success
province_event = {
	id = diggy_dungeons.721
	title = diggy_dungeons.721.t
	desc = diggy_dungeons.721.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.721.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }
		change_party_manpower = { add_tooltip = yes add = 200 }

		dungeon_progress_advancement = { id = 722 } # End Event
	}
}

# End Event
province_event = {
	id = diggy_dungeons.722
	title = diggy_dungeons.722.t
	desc = diggy_dungeons.722.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Runic Workshop floor 2
# Strange Workfloor
province_event = {
	id = diggy_dungeons.723
	title = diggy_dungeons.723.t
	desc = diggy_dungeons.723.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.723.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = runeshop_2_perimeter
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 725 # Strange Workfloor: Do a perimeter sweep (E) - Success
			
			base_failure = 20
			failure_id = 724 # Strange Workfloor: Do a perimeter sweep (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.723.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 726 # Strange Workfloor: Loot raw material! (M) - Success
			
			base_failure = 40
			failure_id = 724 # Strange Workfloor: Do a perimeter sweep (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.723.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 727 # Strange Workfloor: Loot finished stuff! (H) - Success
			
			base_failure = 60
			failure_id = 724 # Strange Workfloor: Do a perimeter sweep (E) - Failure
		}
	}
}

# Strange Workfloor: Do a perimeter sweep (E) - Failure
province_event = {
	id = diggy_dungeons.724
	title = diggy_dungeons.724.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_perimeter }
        }
        desc = diggy_dungeons.724.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_perimeter
        }
        desc = diggy_dungeons.724.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.724.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 728 } # Golem Assembly
	}
}

# Strange Workfloor: Do a perimeter sweep (E) - Success
province_event = {
	id = diggy_dungeons.725
	title = diggy_dungeons.725.t
	desc = diggy_dungeons.725.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.725.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 729 } # Odd machinery
	}
}

# Strange Workfloor: Loot raw material! (M) - Success
province_event = {
	id = diggy_dungeons.726
	title = diggy_dungeons.726.t
	desc = diggy_dungeons.726.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.726.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 729 } # Odd machinery
	}
}

# Strange Workfloor: Loot finished stuff! (H) - Success
province_event = {
	id = diggy_dungeons.727
	title = diggy_dungeons.727.t
	desc = diggy_dungeons.727.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.727.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225 }

		dungeon_progress_advancement = { id = 729 } # Odd machinery
	}
}

# Golem Assembly
province_event = {
	id = diggy_dungeons.728
	title = diggy_dungeons.728.t
	desc = diggy_dungeons.728.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.728.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = runeshop_2_assembly
		set_province_flag = runeshop_2_shutdown

		dungeon_progress_advancement = { id = 730 } # Golem Assembly: Smash them all! (H) - Success
	}
	option = {
		name = diggy_dungeons.728.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_2_assembly
		set_province_flag = runeshop_2_violence

		dungeon_encounter_effect = {
			base_success = 40
			success_id = 730 # Golem Assembly: Smash them all! (H) - Success
			
			base_failure = 60
			failure_id = 731 # Golem Assembly: Mages blast them! (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.728.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_2_assembly
		set_province_flag = runeshop_2_magic
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 730 # Golem Assembly: Smash them all! (H) - Success
			
			base_failure = 20
			failure_id = 731 # Golem Assembly: Mages blast them! (E) - Failure
		}
	}
}

# Odd machinery
province_event = {
	id = diggy_dungeons.729
	title = diggy_dungeons.729.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_assembly }
        }
        desc = diggy_dungeons.729.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_assembly
        }
        desc = diggy_dungeons.729.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.729.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_2_destroy
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 732 # Odd machinery: Destroy it (H) - Success
			
			base_failure = 60
			failure_id = 733 # Odd machinery: Turn it off (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.729.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 732 # Odd machinery: Destroy it (H) - Success
			
			base_failure = 20
			failure_id = 733 # Odd machinery: Turn it off (E) - Failure
		}
	}
}

# Golem Assembly: Smash them all! (H) - Success
province_event = {
	id = diggy_dungeons.730
	title = diggy_dungeons.730.t
	desc = {
        trigger = {
            has_province_flag = runeshop_2_violence
        }
        desc = diggy_dungeons.730.d.1
    }
    	desc = {
        trigger = {
            has_province_flag = runeshop_2_magic
        }
        desc = diggy_dungeons.730.d.2
    }
	desc = {
        trigger = {
            has_province_flag = runeshop_2_shutdown
        }
        desc = diggy_dungeons.730.d.3
    }

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.730.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 729 } # Odd machinery
	}
}

# Golem Assembly: Mages blast them! (E) - Failure
province_event = {
	id = diggy_dungeons.731
	title = diggy_dungeons.731.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_violence }
        }
        desc = diggy_dungeons.731.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_violence
        }
        desc = diggy_dungeons.731.d.1
    }

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.731.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 1000 }
		change_party_morale = { remove_tooltip = yes loss = 2 }

		dungeon_progress_advancement = { id = 729 } # Odd machinery
	}
}

# Odd machinery: Destroy it (H) - Success
province_event = {
	id = diggy_dungeons.732
	title = diggy_dungeons.732.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_destroy }
        }
        desc = diggy_dungeons.732.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_destroy
        }
        desc = diggy_dungeons.732.d.1
    }

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.732.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 734 } # Runic Gateway
	}
}

# Odd machinery: Turn it off (E) - Failure
province_event = {
	id = diggy_dungeons.733
	title = diggy_dungeons.733.t
    desc = diggy_dungeons.733.d

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.733.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 734 } # Runic Gateway
	}
}

# Runic Gateway
province_event = {
	id = diggy_dungeons.734
	title = diggy_dungeons.734.t
	desc = diggy_dungeons.734.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.734.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_2_activate
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 736 # Runic Gateway: Activate it! (H) - Success
			
			base_failure = 60
			failure_id = 735 # Runic Gateway: Look it over carefully (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.734.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 737 # Runic Gateway: Look it over carefully (E) - Success
			
			base_failure = 20
			failure_id = 735 # Runic Gateway: Look it over carefully (E) - Failure
		}
	}
}

# Runic Gateway: Look it over carefully (E) - Failure
province_event = {
	id = diggy_dungeons.735
	title = diggy_dungeons.735.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_activate }
        }
        desc = diggy_dungeons.735.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_activate
        }
        desc = diggy_dungeons.735.d.1
    }

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.735.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 600 }
		change_party_morale = { remove_tooltip = yes loss = 1 }
		change_party_effectiveness = { remove_tooltip = yes loss = 10 }

		dungeon_progress_advancement = { id = 738 } # Gateway to Hell
	}
}

# Runic Gateway: Activate it! (H) - Success
province_event = {
	id = diggy_dungeons.736
	title = diggy_dungeons.736.t
	desc = diggy_dungeons.736.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.736.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 738 } # Gateway to Hell
	}
}

# Runic Gateway: Look it over carefully (E) - Success
province_event = {
	id = diggy_dungeons.737
	title = diggy_dungeons.737.t
	desc = diggy_dungeons.737.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.737.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 738 } # Gateway to Hell
	}
}

# Gateway to Hell
province_event = {
	id = diggy_dungeons.738
	title = diggy_dungeons.738.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_activate }
        }
        desc = diggy_dungeons.738.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_activate
        }
        desc = diggy_dungeons.738.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.738.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 739 # Gateway to Hell: Hold them off! (M) - Success
			
			base_failure = 40
			failure_id = 740 # Gateway to Hell: Hold them off! (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.738.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = runeshop_2_barricade

		dungeon_encounter_effect = {
			base_success = 80
			success_id = 739 # Gateway to Hell: Hold them off! (M) - Success
			
			base_failure = 20
			failure_id = 740 # Gateway to Hell: Hold them off! (M) - Failure
		}
	}
}

# Gateway to Hell: Hold them off! (M) - Success
province_event = {
	id = diggy_dungeons.739
	title = diggy_dungeons.739.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_barricade }
        }
        desc = diggy_dungeons.739.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_barricade
        }
        desc = diggy_dungeons.739.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.739.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 741 } # The Breach is shut
	}
}

# Gateway to Hell: Hold them off! (M) - Failure
province_event = {
	id = diggy_dungeons.740
	title = diggy_dungeons.740.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_2_barricade }
        }
        desc = diggy_dungeons.740.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_2_barricade
        }
        desc = diggy_dungeons.740.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.740.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 1 }
		change_party_effectiveness = { remove_tooltip = yes loss = 10 }

		dungeon_progress_advancement = { id = 742 } # Hold or Die!
	}
}

# The Breach is shut
province_event = {
	id = diggy_dungeons.741
	title = diggy_dungeons.741.t
	desc = diggy_dungeons.741.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.741.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 743 } # The Breach is shut: Loot the floor! - Success
	}
	option = {
		name = diggy_dungeons.741.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 745 # The Breach is shut: Investigate the Gateway (H) - Success
			
			base_failure = 60
			failure_id = 744 # The Breach is shut: Investigate the Gateway (H) - Failure
		}
	}
}

# Hold or Die!
province_event = {
	id = diggy_dungeons.742
	title = diggy_dungeons.742.t
	desc = diggy_dungeons.742.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.742.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 747 # Hold or Die!: Rig up a bomb! (E) - Success
			
			base_failure = 40
			failure_id = 746 # Hold or Die!: Rig up a bomb! (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.742.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 747 # Hold or Die!: Rig up a bomb! (E) - Success
			
			base_failure = 20
			failure_id = 746 # Hold or Die!: Rig up a bomb! (E) - Failure
		}
	}
}

# The Breach is shut: Loot the floor! - Success
province_event = {
	id = diggy_dungeons.743
	title = diggy_dungeons.743.t
	desc = diggy_dungeons.743.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.743.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 748 } # End Event
	}
}

# The Breach is shut: Investigate the Gateway (H) - Failure
province_event = {
	id = diggy_dungeons.744
	title = diggy_dungeons.744.t
	desc = diggy_dungeons.744.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.744.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 748 } # End Event
	}
}

# The Breach is shut: Investigate the Gateway (H) - Success
province_event = {
	id = diggy_dungeons.745
	title = diggy_dungeons.745.t
	desc = diggy_dungeons.745.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.745.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225 }

		dungeon_progress_advancement = { id = 748 } # End Event
	}
}

# Hold or Die!: Rig up a bomb! (E) - Failure
province_event = {
	id = diggy_dungeons.746
	title = diggy_dungeons.746.t
	desc = diggy_dungeons.746.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.746.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Hold or Die!: Rig up a bomb! (E) - Success
province_event = {
	id = diggy_dungeons.747
	title = diggy_dungeons.747.t
	desc = diggy_dungeons.747.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.747.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 800 }

		dungeon_progress_advancement = { id = 741 } # The Breach is shut
	}
}

# End Event
province_event = {
	id = diggy_dungeons.748
	title = diggy_dungeons.748.t
	desc = diggy_dungeons.748.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Runic Workshop floor 3
# Actions...
province_event = {
	id = diggy_dungeons.749
	title = diggy_dungeons.749.t
	desc = diggy_dungeons.749.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.749.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 750 # Actions...: Divination may help? (M) - Success
			
			base_failure = 40
			failure_id = 751 # Actions...: Divination may help? (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.749.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_3_search
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 750 # Actions...: Divination may help? (M) - Success
			
			base_failure = 60
			failure_id = 752 # Actions...: Split up and search (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.749.c
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 750 # Actions...: Divination may help? (M) - Success
			
			base_failure = 40
			failure_id = 752 # Actions...: Split up and search (H) - Failure
		}
	}
}

# Actions...: Divination may help? (M) - Success
province_event = {
	id = diggy_dungeons.750
	title = diggy_dungeons.750.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_search }
        }
        desc = diggy_dungeons.750.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_search
        }
        desc = diggy_dungeons.750.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.750.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 753 } # Dwarf and Machine
	}
}

# Actions...: Divination may help? (M) - Failure
province_event = {
	id = diggy_dungeons.751
	title = diggy_dungeons.751.t
	desc = diggy_dungeons.751.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.751.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { remove_tooltip = yes loss = 1.5 }

		dungeon_progress_advancement = { id = 753 } # Dwarf and Machine
	}
}

# Actions...: Split up and search (H) - Failure
province_event = {
	id = diggy_dungeons.752
	title = diggy_dungeons.752.t
	desc = diggy_dungeons.752.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.752.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 753 } # Dwarf and Machine
	}
}

# Dwarf and Machine
province_event = {
	id = diggy_dungeons.753
	title = diggy_dungeons.753.t
	desc = diggy_dungeons.753.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.753.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_3_charge
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 754 # Dwarf and Machine: Charge! (H) - Success
			
			base_failure = 60
			failure_id = 755 # Dwarf and Machine: Steady and Hold! (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.753.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 754 # Dwarf and Machine: Charge! (H) - Success
			
			base_failure = 40
			failure_id = 755 # Dwarf and Machine: Steady and Hold! (M) - Failure
		}
	}
}

# Dwarf and Machine: Charge! (H) - Success
province_event = {
	id = diggy_dungeons.754
	title = diggy_dungeons.754.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_charge }
        }
        desc = diggy_dungeons.754.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_charge
        }
        desc = diggy_dungeons.754.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.754.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 756 } # The Chase
	}
}

# Dwarf and Machine: Steady and Hold! (M) - Failure
province_event = {
	id = diggy_dungeons.755
	title = diggy_dungeons.755.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_charge }
        }
        desc = diggy_dungeons.755.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_charge
        }
        desc = diggy_dungeons.755.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.755.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 600 }
		change_party_morale = { remove_tooltip = yes loss = 1.5 }

		dungeon_progress_advancement = { id = 757 } # Rally the Troops
	}
}

# The Chase
province_event = {
	id = diggy_dungeons.756
	title = diggy_dungeons.756.t
	desc = diggy_dungeons.756.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.756.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 758 } # The Chase: Mages cast Haste - Success
	}
	option = {
		name = diggy_dungeons.756.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_3_fastest

		dungeon_encounter_effect = {
			base_success = 60
			success_id = 759 # The Chase: Send our Fastest! (M) - Success
			
			base_failure = 40
			failure_id = 760 # The Chase: Send our Fastest! (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.756.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 759 # The Chase: Send our Fastest! (M) - Success
			
			base_failure = 60
			failure_id = 760 # The Chase: Send our Fastest! (M) - Failure
		}
	}
}

# Rally the Troops
province_event = {
	id = diggy_dungeons.757
	title = diggy_dungeons.757.t
	desc = diggy_dungeons.757.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.757.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 762 # Rally the Troops: An inspiring speech! (M) - Success
			
			base_failure = 40
			failure_id = 763 # Rally the Troops: An inspiring speech! (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.757.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 761 # Rally the Troops: Bounties and Rations! (E) - Success
			
			base_failure = 20
			failure_id = 763 # Rally the Troops: An inspiring speech! (M) - Failure
		}
	}
}

# The Chase: Mages cast Haste - Success
province_event = {
	id = diggy_dungeons.758
	title = diggy_dungeons.758.t
	desc = diggy_dungeons.758.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.758.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 764 } # The Runevault (Initial)
	}
}

# The Chase: Send our Fastest! (M) - Success
province_event = {
	id = diggy_dungeons.759
	title = diggy_dungeons.759.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_fastest }
        }
        desc = diggy_dungeons.759.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_fastest
        }
        desc = diggy_dungeons.759.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.759.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_effectiveness = { remove_tooltip = yes loss = 5 }

		dungeon_progress_advancement = { id = 764 } # The Runevault (Initial)
	}
}

# The Chase: Send our Fastest! (M) - Failure
province_event = {
	id = diggy_dungeons.760
	title = diggy_dungeons.760.t
	desc = diggy_dungeons.760.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.760.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }
		set_province_flag = failure

		dungeon_progress_advancement = { id = 764 } # The Runevault (Initial)
	}
}

# Rally the Troops: Bounties and Rations! (E) - Success
province_event = {
	id = diggy_dungeons.761
	title = diggy_dungeons.761.t
	desc = diggy_dungeons.761.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.761.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_effectiveness = { add_tooltip = yes add = 5 }

		dungeon_progress_advancement = { id = 756 } # The Chase
	}
}

# Rally the Troops: An inspiring speech! (M) - Success
province_event = {
	id = diggy_dungeons.762
	title = diggy_dungeons.762.t
	desc = diggy_dungeons.762.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.762.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 756 } # The Chase
	}
}

# Rally the Troops: An inspiring speech! (M) - Failure
province_event = {
	id = diggy_dungeons.763
	title = diggy_dungeons.763.t
	desc = diggy_dungeons.763.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.763.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

	}
}

# The Runevault (Initial)
province_event = {
	id = diggy_dungeons.764
	title = diggy_dungeons.764.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_failure }
        }
        desc = diggy_dungeons.764.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_failure
        }
        desc = diggy_dungeons.764.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.764.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag  = runeshop_3_source
		dungeon_progress_advancement = { id = 765 } # The Runevault (Power Hunt)
	}
	option = {
		name = diggy_dungeons.764.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 766 } # The Runevault (Frontal Assault)
	}
}

# The Runevault (Power Hunt)
province_event = {
	id = diggy_dungeons.765
	title = diggy_dungeons.765.t
	desc = diggy_dungeons.765.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.765.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 768 } # The Runevault (Power Hunt): Halanna's Breath may be the key? - Success
	}
	option = {
		name = diggy_dungeons.765.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 767 } # The Runevault (Power Hunt): Greed is Good (H) - Failure
	}
}

# The Runevault (Frontal Assault)
province_event = {
	id = diggy_dungeons.766
	title = diggy_dungeons.766.t
	desc = diggy_dungeons.766.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.766.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_3_anvil
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 769 # The Runevault (Frontal Assault): Hammer and Anvil (E) - Success
			
			base_failure = 20
			failure_id = 767 # The Runevault (Power Hunt): Greed is Good (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.766.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 769 # The Runevault (Frontal Assault): Hammer and Anvil (E) - Success
			
			base_failure = 40
			failure_id = 767 # The Runevault (Power Hunt): Greed is Good (H) - Failure
		}
	}
}

# The Runevault (Power Hunt): Greed is Good (H) - Failure
province_event = {
	id = diggy_dungeons.767
	title = diggy_dungeons.767.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_source }
        }
        desc = diggy_dungeons.767.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_source
        }
        desc = diggy_dungeons.767.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.767.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		clr_province_flag = runeshop_3_source

		dungeon_progress_advancement = { id = 764 } # The Runevault (Initial)
	}
}

# The Runevault (Power Hunt): Halanna's Breath may be the key? - Success
province_event = {
	id = diggy_dungeons.768
	title = diggy_dungeons.768.t
	desc = diggy_dungeons.768.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.768.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 1 }

		dungeon_progress_advancement = { id = 770 } # The Runevault (Cutting the Cable)
	}
}

# The Runevault (Frontal Assault): Hammer and Anvil (E) - Success
province_event = {
	id = diggy_dungeons.769
	title = diggy_dungeons.769.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_anvil }
        }
        desc = diggy_dungeons.769.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_anvil
        }
        desc = diggy_dungeons.769.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.769.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 771 } # The Runevault (Midpoint)
	}
}

# The Runevault (Cutting the Cable)
province_event = {
	id = diggy_dungeons.770
	title = diggy_dungeons.770.t
	desc = diggy_dungeons.770.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.770.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 772 # The Runevault (Cutting the Cable): Create a Runic Item (E) - Success
			
			base_failure = 20
			failure_id = 767 # The Runevault (Power Hunt): Greed is Good (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.770.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_3_ritual

		dungeon_encounter_effect = {
			base_success = 60
			success_id = 773 # The Runevault (Cutting the Cable): Big Ritual Attack (M) - Success
			
			base_failure = 40
			failure_id = 767 # The Runevault (Power Hunt): Greed is Good (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.770.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 773 # The Runevault (Cutting the Cable): Big Ritual Attack (M) - Success
			
			base_failure = 60
			failure_id = 767 # The Runevault (Power Hunt): Greed is Good (H) - Failure
		}
	}
}

# The Runevault (Midpoint)
province_event = {
	id = diggy_dungeons.771
	title = diggy_dungeons.771.t
	desc = diggy_dungeons.771.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.771.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 775 } # The Runevault (Midpoint): Victory or our Death. - Success
	}
	option = {
		name = diggy_dungeons.771.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 774 # The Runevault (Midpoint): Greed is Good (H) - Success
			
			base_failure = 60
			failure_id = 767 # The Runevault (Power Hunt): Greed is Good (H) - Failure
		}
	}
}

# The Runevault (Cutting the Cable): Create a Runic Item (E) - Success
province_event = {
	id = diggy_dungeons.772
	title = diggy_dungeons.772.t
	desc = diggy_dungeons.772.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.772.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { add_tooltip = yes add = 5 }

		dungeon_progress_advancement = { id = 776 } # The Runevault <br>(Final Showdown)
	}
}

# The Runevault (Cutting the Cable): Big Ritual Attack (M) - Success
province_event = {
	id = diggy_dungeons.773
	title = diggy_dungeons.773.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_ritual }
        }
        desc = diggy_dungeons.773.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_ritual
        }
        desc = diggy_dungeons.773.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.773.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_manpower = { remove_tooltip = yes loss = 400 }

		dungeon_progress_advancement = { id = 776 } # The Runevault <br>(Final Showdown)
	}
}

# The Runevault (Midpoint): Greed is Good (H) - Success
province_event = {
	id = diggy_dungeons.774
	title = diggy_dungeons.774.t
	desc = diggy_dungeons.774.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.774.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { remove_tooltip = yes loss = 10 }

		dungeon_progress_advancement = { id = 776 } # The Runevault <br>(Final Showdown)
	}
}

# The Runevault (Midpoint): Victory or our Death. - Success
province_event = {
	id = diggy_dungeons.775
	title = diggy_dungeons.775.t
	desc = diggy_dungeons.775.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.775.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_effectiveness = { add_tooltip = yes add = 10 }
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 776 } # The Runevault <br>(Final Showdown)
	}
}

# The Runevault <br>(Final Showdown)
province_event = {
	id = diggy_dungeons.776
	title = diggy_dungeons.776.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.776.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.776.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.776.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		set_province_flag = runeshop_3_diplomacy

		dungeon_encounter_effect = {
			base_success = 40
			success_id = 778 # The Runevault <br>(Final Showdown): It's not worth it, Dwarf! (H) - Success
			
			base_failure = 60
			failure_id = 777 # The Runevault <br>(Final Showdown): It's not worth it, Dwarf! (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.776.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		set_province_flag = runeshop_3_banish

		dungeon_encounter_effect = {
			base_success = 80
			success_id = 779 # The Runevault <br>(Final Showdown): Kill him quickly! (M) - Success
			
			base_failure = 20
			failure_id = 777 # The Runevault <br>(Final Showdown): It's not worth it, Dwarf! (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.776.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 779 # The Runevault <br>(Final Showdown): Kill him quickly! (M) - Success
			
			base_failure = 40
			failure_id = 777 # The Runevault <br>(Final Showdown): It's not worth it, Dwarf! (H) - Failure
		}
	}
}

# The Runevault <br>(Final Showdown): It's not worth it, Dwarf! (H) - Failure
province_event = {
	id = diggy_dungeons.777
	title = diggy_dungeons.777.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_diplomacy }
        }
        desc = diggy_dungeons.777.d.1
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_diplomacy
        }
        desc = diggy_dungeons.777.d.2
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.777.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# The Runevault <br>(Final Showdown): It's not worth it, Dwarf! (H) - Success
province_event = {
	id = diggy_dungeons.778
	title = diggy_dungeons.778.t
	desc = diggy_dungeons.778.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.778.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225 }
		change_party_supplies = { add_tooltip = yes add = 8 }

		dungeon_progress_advancement = { id = 780 } # Event with Choice
	}
}

# The Runevault <br>(Final Showdown): Kill him quickly! (M) - Success
province_event = {
	id = diggy_dungeons.779
	title = diggy_dungeons.779.t
	desc = {
        trigger = {
            NOT = { has_province_flag = runeshop_3_banish }
        }
        desc = diggy_dungeons.779.d.2
    }
    desc = {
        trigger = {
            has_province_flag = runeshop_3_banish
        }
        desc = diggy_dungeons.779.d.1
    }


	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.779.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 781 } # End Event
	}
}

# Event with Choice
province_event = {
	id = diggy_dungeons.780
	title = diggy_dungeons.780.t
	desc = diggy_dungeons.780.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.780.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 782 } # Event with Choice: MY EMOTIONS - Success
	}
}

# End Event
province_event = {
	id = diggy_dungeons.781
	title = diggy_dungeons.781.t
	desc = diggy_dungeons.781.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

# Event with Choice: MY EMOTIONS - Success
province_event = {
	id = diggy_dungeons.782
	title = diggy_dungeons.782.t
	desc = diggy_dungeons.782.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.782.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 783 } # End Event
	}
}

# End Event
province_event = {
	id = diggy_dungeons.783
	title = diggy_dungeons.783.t
	desc = diggy_dungeons.783.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

###############################
###### �fralgl�rf ######
###############################

# Misc event presenting what the dungeons is
province_event = {
	id = diggy_dungeons.800
	title = diggy_dungeons.800.t
	desc = diggy_dungeons.800.d
	picture = CAVE_eventPicture
    
	is_triggered_only = yes
    
	trigger = {
		always = yes
	}
    
	immediate = {
	}
    
	after = {
	}
    
	# Nice
	option = {
		name = diggy_dungeons.800.a
		ai_chance = { factor = 100 }
	}
}
# Treacherous Chasm floor 1
# Beginning Floor 1
province_event = {
	id = diggy_dungeons.801
	title = diggy_dungeons.801.t
	desc = diggy_dungeons.801.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.801.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 803 # Beginning Floor 1: Search for slope (M) - Success
			
			base_failure = 40
			failure_id = 802 # Beginning Floor 1: Search for slope (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.801.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 804 # Beginning Floor 1: Rope through the spikes (E) - Success
			
			base_failure = 20
			failure_id = 805 # Beginning Floor 1: Rope through the spikes (E) - Failure
		}
	}
}

# Beginning Floor 1: Search for slope (M) - Failure
province_event = {
	id = diggy_dungeons.802
	title = diggy_dungeons.802.t
	desc = diggy_dungeons.802.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.802.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 806 } # Rope Bridge
	}
}

# Beginning Floor 1: Search for slope (M) - Success
province_event = {
	id = diggy_dungeons.803
	title = diggy_dungeons.803.t
	desc = diggy_dungeons.803.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.803.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 806 } # Rope Bridge
	}
}

# Beginning Floor 1: Rope through the spikes (E) - Success
province_event = {
	id = diggy_dungeons.804
	title = diggy_dungeons.804.t
	desc = diggy_dungeons.804.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.804.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 807 } # Terrace
	}
}

# Beginning Floor 1: Rope through the spikes (E) - Failure
province_event = {
	id = diggy_dungeons.805
	title = diggy_dungeons.805.t
	desc = diggy_dungeons.805.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.805.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 807 } # Terrace
	}
}

# Rope Bridge
province_event = {
	id = diggy_dungeons.806
	title = diggy_dungeons.806.t
	desc = diggy_dungeons.806.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.806.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 808 # Rope Bridge: It'll hold (E) - Success
			
			base_failure = 20
			failure_id = 809 # Rope Bridge: It'll hold (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.806.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 810 } # Old Campsite
	}
}

# Terrace
province_event = {
	id = diggy_dungeons.807
	title = diggy_dungeons.807.t
	desc = diggy_dungeons.807.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.807.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 811 # Terrace: om nom nom (E) - Success
			
			base_failure = 20
			failure_id = 812 # Terrace: om nom nom (E) - Failure
		}
	}
	option = {
		name = diggy_dungeons.807.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 813 } # Waterfall
	}
}

# Rope Bridge: It'll hold (E) - Success
province_event = {
	id = diggy_dungeons.808
	title = diggy_dungeons.808.t
	desc = diggy_dungeons.808.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.808.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 810 } # Old Campsite
	}
}

# Rope Bridge: It'll hold (E) - Failure
province_event = {
	id = diggy_dungeons.809
	title = diggy_dungeons.809.t
	desc = diggy_dungeons.809.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.809.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 810 } # Old Campsite
	}
}

# Old Campsite
province_event = {
	id = diggy_dungeons.810
	title = diggy_dungeons.810.t
	desc = diggy_dungeons.810.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.810.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = ofralglarf_1_investigate
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 815 # Waterfall: Investigate (E) - Success
			
			base_failure = 20
			failure_id = 814 # Old Campsite: Get over it without Bennet Foddy (M) - Failure
		}
	}
}

# Terrace: om nom nom (E) - Success
province_event = {
	id = diggy_dungeons.811
	title = diggy_dungeons.811.t
	desc = diggy_dungeons.811.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.811.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 813 } # Waterfall
	}
}

# Terrace: om nom nom (E) - Failure
province_event = {
	id = diggy_dungeons.812
	title = diggy_dungeons.812.t
	desc = diggy_dungeons.812.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.812.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 813 } # Waterfall
	}
}

# Waterfall
province_event = {
	id = diggy_dungeons.813
	title = diggy_dungeons.813.t
	desc = diggy_dungeons.813.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.813.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 815 # Waterfall: Investigate (E) - Success
			
			base_failure = 40
			failure_id = 814 # Old Campsite: Get over it without Bennet Foddy (M) - Failure
		}
	}
}

# Old Campsite: Get over it without Bennet Foddy (M) - Failure
province_event = {
	id = diggy_dungeons.814
	title = diggy_dungeons.814.t
	desc = {
		trigger = { has_province_flag = ofralglarf_1_investigate }
		desc = diggy_dungeons.814.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_1_investigate } }
		desc = diggy_dungeons.814.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.814.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 816 } # Traces of temple
	}
}

# Waterfall: Investigate (E) - Success
province_event = {
	id = diggy_dungeons.815
	title = diggy_dungeons.815.t
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_1_investigate } }
		desc = diggy_dungeons.815.d.1
	}
	desc = {
		trigger = { has_province_flag = ofralglarf_1_investigate }
		desc = diggy_dungeons.815.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.815.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 816 } # Traces of temple
	}
}

# Traces of temple
province_event = {
	id = diggy_dungeons.816
	title = diggy_dungeons.816.t
	desc = diggy_dungeons.816.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.816.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 817 # Traces of temple: Investigate (E) - Success
			
			base_failure = 20
			failure_id = 818 # Traces of temple: Investigate (E) - Failure
		}
	}
}

# Traces of temple: Investigate (E) - Success
province_event = {
	id = diggy_dungeons.817
	title = diggy_dungeons.817.t
	desc = diggy_dungeons.817.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.817.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 819 } # End Event
	}
}

# Traces of temple: Investigate (E) - Failure
province_event = {
	id = diggy_dungeons.818
	title = diggy_dungeons.818.t
	desc = diggy_dungeons.818.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.818.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 820 # Traces of temple: Investigate (E) - Failure: Fight! (M) - Success
			
			base_failure = 40
			failure_id = 821 # Traces of temple: Investigate (E) - Failure: Fight! (M) - Failure
		}
	}
}

# End Event
province_event = {
	id = diggy_dungeons.819
	title = diggy_dungeons.819.t
	desc = diggy_dungeons.819.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	
	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}

# Traces of temple: Investigate (E) - Failure: Fight! (M) - Success
province_event = {
	id = diggy_dungeons.820
	title = diggy_dungeons.820.t
	desc = diggy_dungeons.820.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.820.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 819 } # End Event
	}
}

# Traces of temple: Investigate (E) - Failure: Fight! (M) - Failure
province_event = {
	id = diggy_dungeons.821
	title = diggy_dungeons.821.t
	desc = diggy_dungeons.821.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.821.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 819 } # End Event
	}
}
# Treacherous Chasm floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.822
	title = diggy_dungeons.822.t
	desc = diggy_dungeons.822.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.822.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 823 # Beginning Floor 2: Follow the path (E) - Success
			
			base_failure = 20
			failure_id = 824 # Beginning Floor 2: Follow the path (E) - Failure
		}
	}
}

# Beginning Floor 2: Follow the path (E) - Success
province_event = {
	id = diggy_dungeons.823
	title = diggy_dungeons.823.t
	desc = diggy_dungeons.823.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.823.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 825 } # Labyrinth
	}
}

# Beginning Floor 2: Follow the path (E) - Failure
province_event = {
	id = diggy_dungeons.824
	title = diggy_dungeons.824.t
	desc = diggy_dungeons.824.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.824.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 825 } # Labyrinth
	}
}

# Labyrinth
province_event = {
	id = diggy_dungeons.825
	title = diggy_dungeons.825.t
	desc = diggy_dungeons.825.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.825.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 827 # Labyrinth: Scale the Wall (H) - Success
			
			base_failure = 60
			failure_id = 828 # Labyrinth: Scale the Wall (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.825.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 826 } # Crossing
	}
}

# Crossing
province_event = {
	id = diggy_dungeons.826
	title = diggy_dungeons.826.t
	desc = diggy_dungeons.826.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.826.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 829 # Crossing: Straight (M) - Success
			
			base_failure = 40
			failure_id = 830 # Crossing: Straight (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.826.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 831 # Crossing: Right (M) - Success
			
			base_failure = 40
			failure_id = 832 # Crossing: Right (M) - Failure
		}
	}
}

# Labyrinth: Scale the Wall (H) - Success
province_event = {
	id = diggy_dungeons.827
	title = diggy_dungeons.827.t
	desc = diggy_dungeons.827.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.827.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 833 } # On the walls
	}
}

# Labyrinth: Scale the Wall (H) - Failure
province_event = {
	id = diggy_dungeons.828
	title = diggy_dungeons.828.t
	desc = diggy_dungeons.828.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.828.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 826 } # Crossing
	}
}

# Crossing: Straight (M) - Success
province_event = {
	id = diggy_dungeons.829
	title = diggy_dungeons.829.t
	desc = diggy_dungeons.829.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.829.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75 }
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 834 } # Altar
	}
}

# Crossing: Straight (M) - Failure
province_event = {
	id = diggy_dungeons.830
	title = diggy_dungeons.830.t
	desc = diggy_dungeons.830.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.830.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 834 } # Altar
	}
}

# Crossing: Right (M) - Success
province_event = {
	id = diggy_dungeons.831
	title = diggy_dungeons.831.t
	desc = diggy_dungeons.831.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.831.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 835 } # Chapel
	}
}

# Crossing: Right (M) - Failure
province_event = {
	id = diggy_dungeons.832
	title = diggy_dungeons.832.t
	desc = diggy_dungeons.832.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.832.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 835 } # Chapel
	}
}

# On the walls
province_event = {
	id = diggy_dungeons.833
	title = diggy_dungeons.833.t
	desc = diggy_dungeons.833.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.833.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 838 # On the walls: Through Window (M) - Success
			
			base_failure = 40
			failure_id = 836 # On the walls: Through Window (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.833.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = ofralglarf_2_lock
		dungeon_encounter_effect = {
			base_success = 80
			success_id = 838 # On the walls: Through Window (M) - Success
			
			base_failure = 20
			failure_id = 837 # On the walls: Pick lock (E) - Failure
		}
	}
}

# Altar
province_event = {
	id = diggy_dungeons.834
	title = diggy_dungeons.834.t
	desc = diggy_dungeons.834.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.834.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 835 } # Chapel
	}
	option = {
		name = diggy_dungeons.834.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 839 # Altar: Translate (M) - Success
			
			base_failure = 40
			failure_id = 840 # Altar: Translate (M) - Failure
		}
	}
}

# Chapel
province_event = {
	id = diggy_dungeons.835
	title = diggy_dungeons.835.t
	desc = diggy_dungeons.835.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.835.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 841 # Chapel: Break the door (H) - Success
			
			base_failure = 60
			failure_id = 842 # Chapel: Break the door (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.835.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = ofralglarf_2_drill
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 841 # Chapel: Break the door (H) - Success
			
			base_failure = 40
			failure_id = 842 # Chapel: Break the door (H) - Failure
		}
	}
}

# On the walls: Through Window (M) - Failure
province_event = {
	id = diggy_dungeons.836
	title = diggy_dungeons.836.t
	desc = diggy_dungeons.836.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.836.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 835 } # Chapel
	}
}

# On the walls: Pick lock (E) - Failure
province_event = {
	id = diggy_dungeons.837
	title = diggy_dungeons.837.t
	desc = diggy_dungeons.837.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.837.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 843 } # church?
	}
}

# On the walls: Through Window (M) - Success
province_event = {
	id = diggy_dungeons.838
	title = diggy_dungeons.838.t
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_2_lock } }
		desc = diggy_dungeons.838.d.1
	}
	desc = {
		trigger = { has_province_flag = ofralglarf_2_lock }
		desc = diggy_dungeons.838.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.838.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 843 } # church?
	}
}

# Altar: Translate (M) - Success
province_event = {
	id = diggy_dungeons.839
	title = diggy_dungeons.839.t
	desc = diggy_dungeons.839.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.839.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 844 } # Grand Hall
	}
}

# Altar: Translate (M) - Failure
province_event = {
	id = diggy_dungeons.840
	title = diggy_dungeons.840.t
	desc = diggy_dungeons.840.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.840.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 844 } # Grand Hall
	}
}

# Chapel: Break the door (H) - Success
province_event = {
	id = diggy_dungeons.841
	title = diggy_dungeons.841.t
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_2_drill } }
		desc = diggy_dungeons.841.d.1
	}
	desc = {
		trigger = { has_province_flag = ofralglarf_2_drill }
		desc = diggy_dungeons.841.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.841.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150 }

		dungeon_progress_advancement = { id = 844 } # Grand Hall
	}
}

# Chapel: Break the door (H) - Failure
province_event = {
	id = diggy_dungeons.842
	title = diggy_dungeons.842.t
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_2_drill } }
		desc = diggy_dungeons.842.d.1
	}
	desc = {
		trigger = { has_province_flag = ofralglarf_2_drill }
		desc = diggy_dungeons.842.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.842.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 844 } # Grand Hall
	}
}

# church?
province_event = {
	id = diggy_dungeons.843
	title = diggy_dungeons.843.t
	desc = diggy_dungeons.843.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.843.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 845 # church?: Clear the rubble (M) - Success
			
			base_failure = 40
			failure_id = 846 # church?: Clear the rubble (M) - Failure
		}
	}
}

# Grand Hall
province_event = {
	id = diggy_dungeons.844
	title = diggy_dungeons.844.t
	desc = diggy_dungeons.844.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.844.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 847 # Grand Hall: Get in (H) - Success
			
			base_failure = 60
			failure_id = 848 # Grand Hall: Get in (H) - Failure
		}
	}
}

# church?: Clear the rubble (M) - Success
province_event = {
	id = diggy_dungeons.845
	title = diggy_dungeons.845.t
	desc = diggy_dungeons.845.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.845.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 849 } # Sanctum
	}
}

# church?: Clear the rubble (M) - Failure
province_event = {
	id = diggy_dungeons.846
	title = diggy_dungeons.846.t
	desc = diggy_dungeons.846.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.846.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 849 } # Sanctum
	}
}

# Grand Hall: Get in (H) - Success
province_event = {
	id = diggy_dungeons.847
	title = diggy_dungeons.847.t
	desc = diggy_dungeons.847.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.847.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 849 } # Sanctum
	}
}

# Grand Hall: Get in (H) - Failure
province_event = {
	id = diggy_dungeons.848
	title = diggy_dungeons.848.t
	desc = diggy_dungeons.848.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.848.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_loot = { remove_tooltip = yes loss = 75 }

		dungeon_progress_advancement = { id = 849 } # Sanctum
	}
}

# Sanctum
province_event = {
	id = diggy_dungeons.849
	title = diggy_dungeons.849.t
	desc = diggy_dungeons.849.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.849.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 850 } # End Event
	}
}

# End Event
province_event = {
	id = diggy_dungeons.850
	title = diggy_dungeons.850.t
	desc = diggy_dungeons.850.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
# Treacherous Chasm floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.851
	title = diggy_dungeons.851.t
	desc = diggy_dungeons.851.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.851.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 852 # Beginning Floor 3: Up the wall! (M) - Success
			
			base_failure = 40
			failure_id = 853 # Beginning Floor 3: Up the wall! (M) - Failure
		}
	}
}

# Beginning Floor 3: Up the wall! (M) - Success
province_event = {
	id = diggy_dungeons.852
	title = diggy_dungeons.852.t
	desc = diggy_dungeons.852.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.852.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 854 } # Shortcut?
	}
}

# Beginning Floor 3: Up the wall! (M) - Failure
province_event = {
	id = diggy_dungeons.853
	title = diggy_dungeons.853.t
	desc = diggy_dungeons.853.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.853.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 854 } # Shortcut?
	}
}

# Shortcut?
province_event = {
	id = diggy_dungeons.854
	title = diggy_dungeons.854.t
	desc = diggy_dungeons.854.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.854.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 855 # Shortcut?: follow him (M) - Success
			
			base_failure = 40
			failure_id = 856 # Shortcut?: follow him (M) - Failure
		}
	}
	option = {
		name = diggy_dungeons.854.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 857 # Shortcut?: let's try it (M) - Success
			
			base_failure = 40
			failure_id = 858 # Shortcut?: let's try it (M) - Failure
		}
	}
}

# Shortcut?: follow him (M) - Success
province_event = {
	id = diggy_dungeons.855
	title = diggy_dungeons.855.t
	desc = diggy_dungeons.855.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.855.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 859 } # the chase continues
	}
}

# Shortcut?: follow him (M) - Failure
province_event = {
	id = diggy_dungeons.856
	title = diggy_dungeons.856.t
	desc = diggy_dungeons.856.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.856.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 859 } # the chase continues
	}
}

# Shortcut?: let's try it (M) - Success
province_event = {
	id = diggy_dungeons.857
	title = diggy_dungeons.857.t
	desc = diggy_dungeons.857.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.857.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 860 } # Cliff
	}
}

# Shortcut?: let's try it (M) - Failure
province_event = {
	id = diggy_dungeons.858
	title = diggy_dungeons.858.t
	desc = diggy_dungeons.858.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.858.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 861 } # lookout
	}
}

# the chase continues
province_event = {
	id = diggy_dungeons.859
	title = diggy_dungeons.859.t
	desc = diggy_dungeons.859.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.859.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 862 # the chase continues: bomb the rock (M) - Success
			
			base_failure = 60
			failure_id = 864 # the chase continues: Runnin' (H) - Failure
		}
	}
	option = {
		name = diggy_dungeons.859.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
		set_province_flag = ofralglarf_3_bomb
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 862 # the chase continues: bomb the rock (M) - Success
			
			base_failure = 40
			failure_id = 863 # the chase continues: bomb the rock (M) - Failure
		}
	}
}

# Cliff
province_event = {
	id = diggy_dungeons.860
	title = diggy_dungeons.860.t
	desc = diggy_dungeons.860.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.860.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 865 # Cliff: Walk (M) - Success
			
			base_failure = 40
			failure_id = 866 # Cliff: Walk (M) - Failure
		}
	}
}

# lookout
province_event = {
	id = diggy_dungeons.861
	title = diggy_dungeons.861.t
	desc = diggy_dungeons.861.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.861.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 860 # Cliff
			
			base_failure = 60
			failure_id = 867 # lookout: Please don't escape (H) - Failure
		}
	}
}

# the chase continues: bomb the rock (M) - Success
province_event = {
	id = diggy_dungeons.862
	title = diggy_dungeons.862.t
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_3_bomb } }
		desc = diggy_dungeons.862.d.1
	}
	desc = {
		trigger = { has_province_flag = ofralglarf_3_bomb }
		desc = diggy_dungeons.862.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.862.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 1 }

		dungeon_progress_advancement = { id = 868 } # stairs
	}
}

# the chase continues: bomb the rock (M) - Failure
province_event = {
	id = diggy_dungeons.863
	title = diggy_dungeons.863.t
	desc = diggy_dungeons.863.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.863.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 868 } # stairs
	}
}

# the chase continues: Runnin' (H) - Failure
province_event = {
	id = diggy_dungeons.864
	title = diggy_dungeons.864.t
	desc = diggy_dungeons.864.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.864.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Cliff: Walk (M) - Success
province_event = {
	id = diggy_dungeons.865
	title = diggy_dungeons.865.t
	desc = diggy_dungeons.865.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.865.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }

		dungeon_progress_advancement = { id = 869 } # ruined overhang
	}
}

# Cliff: Walk (M) - Failure
province_event = {
	id = diggy_dungeons.866
	title = diggy_dungeons.866.t
	desc = diggy_dungeons.866.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.866.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200 }

		dungeon_progress_advancement = { id = 869 } # ruined overhang
	}
}

# lookout: Please don't escape (H) - Failure
province_event = {
	id = diggy_dungeons.867
	title = diggy_dungeons.867.t
	desc = diggy_dungeons.867.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.867.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# stairs
province_event = {
	id = diggy_dungeons.868
	title = diggy_dungeons.868.t
	desc = diggy_dungeons.868.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.868.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		set_province_flag = ofralglarf_3_stairs
		dungeon_encounter_effect = {
			base_success = 60
			success_id = 871 # ruined overhang: walk up (M) - Success
			
			base_failure = 40
			failure_id = 870 # stairs: climb up (H) - Failure
		}
	}
}

# ruined overhang
province_event = {
	id = diggy_dungeons.869
	title = diggy_dungeons.869.t
	desc = diggy_dungeons.869.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.869.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 868 } # stairs
	}
	option = {
		name = diggy_dungeons.869.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 871 # ruined overhang: walk up (M) - Success
			
			base_failure = 60
			failure_id = 870 # stairs: climb up (H) - Failure
		}
	}
}

# stairs: climb up (H) - Failure
province_event = {
	id = diggy_dungeons.870
	title = diggy_dungeons.870.t
	desc = {
		trigger = { has_province_flag = ofralglarf_3_stairs }
		desc = diggy_dungeons.870.d.1
	}
	desc = {
		trigger = { NOT ={ has_province_flag = ofralglarf_3_stairs } }
		desc = diggy_dungeons.870.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.870.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5 }

		dungeon_progress_advancement = { id = 872 } # the last confrontation
	}
}

# ruined overhang: walk up (M) - Success
province_event = {
	id = diggy_dungeons.871
	title = diggy_dungeons.871.t
	desc = {
		trigger = { has_province_flag = ofralglarf_3_stairs }
		desc = diggy_dungeons.871.d.1
	}
	desc = {
		trigger = { NOT = { has_province_flag = ofralglarf_3_stairs } }
		desc = diggy_dungeons.871.d.2
	}

	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.871.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5 }
		change_party_loot = { add_tooltip = yes add = 75 }

		dungeon_progress_advancement = { id = 872 } # the last confrontation
	}
}

# the last confrontation
province_event = {
	id = diggy_dungeons.872
	title = diggy_dungeons.872.t
	desc = diggy_dungeons.872.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.872.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
		dungeon_encounter_effect = {
			base_success = 40
			success_id = 873 # the last confrontation: fight him (H) - Success
			
			base_failure = 60
			failure_id = 874 # the last confrontation: fight him (H) - Failure
		}
	}
}

# the last confrontation: fight him (H) - Success
province_event = {
	id = diggy_dungeons.873
	title = diggy_dungeons.873.t
	desc = diggy_dungeons.873.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.873.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225 }

		dungeon_progress_advancement = { id = 875 } # End Event
	}
}

# the last confrontation: fight him (H) - Failure
province_event = {
	id = diggy_dungeons.874
	title = diggy_dungeons.874.t
	desc = diggy_dungeons.874.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	option = {
		name = diggy_dungeons.874.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.875
	title = diggy_dungeons.875.t
	desc = diggy_dungeons.875.d
	picture = CAVE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
		NOT = { has_province_modifier = expedition_death_timer }
	}

	immediate = {
		dungeon_immediate_effect = yes
	}

	after = {
		hidden_effect = { set_province_flag = floor_explored }
	}

    # All to manpower
	option = {
        name = diggy_expedition.12.a
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = back_to_manpower_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Infantry unit and manpower
	option = {
        name = diggy_expedition.12.b
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { check_variable = { partyLoot = 1 } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
		currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
		currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		custom_tooltip = base_expedition_loot_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to manpower
	option = {
        name = diggy_expedition.12.c
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { add_manpower = 1 }
			}
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Pay them, back to the field
	option = {
        name = diggy_expedition.12.e
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		hidden_effect = {
			while = {
				limit = { check_variable = { partyManpower = 1000 } }
				subtract_variable = { partyManpower = 1000 }
				owner = { infantry = PREV }
			}
			owner = { add_manpower = 1 }
		}
		custom_tooltip = pay_the_difference_tooltip
		currency_effect_expedition = { currency = treasury badLoot = yes takeFrom = owner }
		custom_tooltip = back_to_manpower_unit_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
	
	# Fuck them
	option = {
        name = diggy_expedition.12.f
        ai_chance = { factor = 100 }
		trigger = { hidden_trigger = { NOT = { check_variable = { partyLoot = 1 } } } }
		special_reward_expedition = yes
		owner = { 
			add_country_modifier = {
				name = dwarovar_expedition_douche
				duration = 3650
			}
		}
		custom_tooltip = dont_pay_the_difference_tooltip
		if = {
			limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
			province_event = { id = diggy_expedition.14 }
		}
		else = { hidden_effect = { clear_expedition_effect = yes } }
	}
}
