
namespace = damestear

#Adding a Damestear
# country_event = {
	# id = damestear.1
	# title = damestear.1.t
	# desc = damestear.1.d
	# picture = ARTWORK_eventPicture
	
	# hidden = yes
	# mean_time_to_happen  = {
		# years = 100
	# }
	
	# trigger = {
		# always = no
		# damestear_can_spawn = yes
	# }
	
	# option = {
        # name = damestear.1.a
        # ai_chance = { factor = 100 }
	# }
# }

#Removing Damestear
province_event = {
	id = damestear.2
	title = damestear.2.t
	desc = damestear.2.d
	picture = TRADE_GOODS_METALS_AND_MINING_EQUIPENT_eventPicture
	goto = root
	
	mean_time_to_happen  = {
		years = 30
		
		modifier = {
			factor = 0.7
			REB = {
				check_variable = {
					which = num_damestear
					value = 25
				}
			}
		}
		
		modifier = {
			factor = 1.2
			
			has_province_modifier = damestear_rich_deposit
		}
	}
	
	trigger = {
		trade_goods = damestear
		NOT = { has_province_flag = permanent_damestear }
		NOT = { has_province_modifier = dwindling_ressources }
		#Silverforge Surface Mine variation
		NOT = {
			OR = {
				has_province_flag = surface_mine0
				has_province_flag = surface_mine1
				has_province_flag = surface_mine2
				has_province_flag = surface_mine3
				has_province_flag = surface_mine4
				has_province_flag = surface_mine5
			}
		}
	}
	
	option = {
        name = damestear.2.a
        ai_chance = { factor = 100 }
		add_permanent_province_modifier = {
			name = dwindling_ressources
			duration = -1
		}
		hidden_effect = { province_event = { id = damestear.5 days = 1825 random = 3650 } }
	}
}

#Removing a Relics
province_event = {
	id = damestear.5
	title = damestear.5.t
	desc = damestear.5.d
	picture = ARTWORK_eventPicture
	goto = root
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			trade_goods = damestear
			has_province_modifier = dwindling_ressources
		}
	}
	
	option = {
		name = damestear.5.a
		ai_chance = { factor = 100 }
		remove_province_modifier = dwindling_ressources
		if = {
			limit = { trade_goods = damestear }
			change_trade_goods = unknown
			remove_province_modifier = hold_foundry
			remove_province_modifier = hold_foundry_2
			hidden_effect = { clr_province_flag = specialized_hold }
		}
		if = {
			limit = { NOT = { has_province_modifier = eordan_expedition_site } }
			remove_province_modifier = eordan_expedition_site
			hidden_effect = { REB = { subtract_variable = { num_damestear = 1 } } }
		}
	}
}

country_event = {
	id = damestear.3
	title = damestear.3.t
	desc = damestear.3.d
	picture = FEAST_eventPicture
	goto = province

	mean_time_to_happen  = {
		years = 100
	}
	
	trigger = {
		damestear_can_spawn = yes
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_city = yes
					NOT = {
						trade_goods = precursor_relics
						trade_goods = damestear
						trade_goods = gold
						trade_goods = gems
						has_province_flag = damestear_no_spawn
						has_terrain = dwarven_hold
						has_terrain = dwarven_hold_surface
					}
				}
				save_event_target_as = province
			}
		}
	}
	
	option = {
        name = damestear.3.a
        ai_chance = { factor = 100 }
		event_target:province = {
			change_trade_goods = damestear
		}
		set_add_damestear_count = yes
	}
}

country_event = {
	id = damestear.4
	title = damestear.4.t
	desc = damestear.4.d
	picture = COMET_SIGHTED_eventPicture
	goto = damestear_province

	mean_time_to_happen  = {
		years = 300
	}
	
	trigger = {
		damestear_can_spawn = yes
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_city = yes
					NOT = {
						trade_goods = precursor_relics
						trade_goods = damestear
						trade_goods = gold
						has_terrain = dwarven_hold
						has_terrain = dwarven_hold_surface
						has_terrain = cavern
						has_terrain = dwarven_road
					}
				}
				save_event_target_as = damestear_province
			}
		}
	}
	
	option = {
        name = damestear.4.a
        ai_chance = { factor = 100 }
		event_target:damestear_province = {
			add_base_tax = -2
			add_base_production = -2
			add_base_manpower = -2
			add_permanent_province_modifier = {
				name = damestear_rich_deposit
				duration = -1
			}
			change_trade_goods = damestear
		}
		set_add_damestear_count = yes
	}
}

#Removing Damestear from Silverforge Surface Mine
province_event = {
	id = damestear.5
	title = damestear.5.t
	desc = damestear.5.d
	picture = TRADE_GOODS_METALS_AND_MINING_EQUIPENT_eventPicture
	goto = root
	
	mean_time_to_happen  = {
		years = 80
	}
	
	trigger = {
		trade_goods = damestear
		NOT = { has_province_modifier = skyfall_damestear } # We don't want the Damestear of Ardail to deplete
		NOT = { has_province_flag = permanent_damestear }
		#Silverforge Surface Mine variation
		OR = {
			has_province_flag = surface_mine0
			has_province_flag = surface_mine1
			has_province_flag = surface_mine2
			has_province_flag = surface_mine3
			has_province_flag = surface_mine4
			has_province_flag = surface_mine5
		}
	}
	
	option = {
        name = damestear.5.a
        ai_chance = { factor = 100 }
		ROOT = {
			random_list = {
				25 = {
					change_trade_goods = copper
				}
				40 = {
					change_trade_goods = iron
				}
				26 = {
					change_trade_goods = gems
				}
				6 = {
					change_trade_goods = gold
				}
				2 = {
					change_trade_goods = coal
				}
				1 = {
					change_trade_goods = precursor_relics
				}
			}
			remove_province_modifier = damestear_rich_deposit
		}
		hidden_effect = {
			REB = {
				subtract_variable = {
					which = num_damestear
					value = 1
				}
			}
			set_rem_damestear_count = yes
		}
	}
}